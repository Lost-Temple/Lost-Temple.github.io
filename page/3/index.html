<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.blockchainof.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="自留地">
<meta property="og:url" content="http://www.blockchainof.com/page/3/index.html">
<meta property="og:site_name" content="自留地">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="暂留白">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://www.blockchainof.com/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>自留地</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">自留地</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-主页">

    <a href="/" rel="section"><i class="fas fa-home fa-fw"></i>主页</a>

  </li>
        <li class="menu-item menu-item-标签">

    <a href="/tags/" rel="section"><i class="fas fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-分类">

    <a href="/categories/" rel="section"><i class="fas fa-folder-open fa-fw"></i>分类</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.blockchainof.com/2024/05/19/12345%E6%A8%A1%E5%9E%8B%E9%80%9A%E7%94%A8%E5%9E%8B%E8%A7%A3%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="暂留白">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自留地">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/05/19/12345%E6%A8%A1%E5%9E%8B%E9%80%9A%E7%94%A8%E5%9E%8B%E8%A7%A3%E6%B3%95/" class="post-title-link" itemprop="url">12345模型通用型解法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-05-19 18:41:13" itemprop="dateCreated datePublished" datetime="2024-05-19T18:41:13+08:00">2024-05-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-06-02 19:07:03" itemprop="dateModified" datetime="2024-06-02T19:07:03+08:00">2024-06-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">数学</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E5%AD%A6/%E5%88%9D%E4%B8%AD/" itemprop="url" rel="index"><span itemprop="name">初中</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="模型">12345 模型</h1>
<p>一个直角，被分成3个角，其中一个是45度，其它两个角的tan值为 1/2 和
1/3。这3个条件是知二推一。相当于一个特殊型，通过这个特殊型，我们在不使用高中三角函数的前提下来探究一下更通用的规律。</p>
<h1 id="通用解1">通用解1</h1>
<p><img src="/2024/05/19/12345%E6%A8%A1%E5%9E%8B%E9%80%9A%E7%94%A8%E5%9E%8B%E8%A7%A3%E6%B3%95/001.png"></p>
<p><span class="math display">\[\begin{equation}
\begin{aligned}
&amp;思路：在直线AD上找到一个点E，使|AE|=a+b。E有可能在D左侧，也有可能在D右侧。\\
&amp;我们只关注一点：|AE|=a+b \\
&amp;易证\triangle ABG \cong \triangle GFH \Rightarrow |EH|=b-a \\
&amp;再利用\triangle AEH \sim \triangle ADJ，得出|DJ| 的值
\end{aligned}
\end{equation}\]</span></p>
<h1 id="通用解2">通用解2</h1>
<p><img src="/2024/05/19/12345%E6%A8%A1%E5%9E%8B%E9%80%9A%E7%94%A8%E5%9E%8B%E8%A7%A3%E6%B3%95/002.png"></p>
<h1 id="总结">总结</h1>
<p>其实是构造了三垂直模型/半角构造出全等三角形后，进一步使用相似三角型的求出题目所要求的线段长。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.blockchainof.com/2024/05/19/%E5%9D%87%E5%80%BC%E4%B8%8D%E7%AD%89%E5%BC%8F-002/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="暂留白">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自留地">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/05/19/%E5%9D%87%E5%80%BC%E4%B8%8D%E7%AD%89%E5%BC%8F-002/" class="post-title-link" itemprop="url">均值不等式-002</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-05-19 07:43:00 / 修改时间：13:59:22" itemprop="dateCreated datePublished" datetime="2024-05-19T07:43:00+08:00">2024-05-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">数学</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E5%AD%A6/%E5%88%9D%E4%B8%AD/" itemprop="url" rel="index"><span itemprop="name">初中</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="引言">引言</h1>
<p>本文主要描述射影定理和均值不等式的联系，从而可以从几何层面去理解均值不等式这样的代数式。</p>
<h1 id="几何视角">几何视角</h1>
<figure>
<img src="/2024/05/19/%E5%9D%87%E5%80%BC%E4%B8%8D%E7%AD%89%E5%BC%8F-002/001.png" alt="几何视角的均值不等式">
<figcaption aria-hidden="true">几何视角的均值不等式</figcaption>
</figure>
<h1 id="代数视角">代数视角</h1>
<h2 id="二元">二元</h2>
<p><span class="math display">\[\begin{equation}
\sqrt{\frac{x^2+y^2}{2}} \geq \frac{x+y}{2} \geq \sqrt{xy} \geq
\frac{2}{\frac{1}{x}+\frac{1}{y}}
\end{equation}\]</span></p>
<h2 id="n元">n元</h2>
<p><span class="math display">\[\begin{equation}
\sqrt{\frac{\sum_{i=1}^{n}{x_{i}^2}}{n}} \geq
\frac{\sum_{i=1}^{n}{x_{i}}}{n} \geq \sqrt[n]{\prod_{i=1}^{n} x_i} \geq
\frac{n}{\sum_{i=1}^{n}\frac{1}{ x_{i}}}
\end{equation}\]</span></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.blockchainof.com/2024/05/18/%E5%9D%87%E5%80%BC%E4%B8%8D%E7%AD%89%E5%BC%8F-001/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="暂留白">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自留地">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/05/18/%E5%9D%87%E5%80%BC%E4%B8%8D%E7%AD%89%E5%BC%8F-001/" class="post-title-link" itemprop="url">均值不等式-001</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-05-18 18:58:07" itemprop="dateCreated datePublished" datetime="2024-05-18T18:58:07+08:00">2024-05-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-05-19 07:27:22" itemprop="dateModified" datetime="2024-05-19T07:27:22+08:00">2024-05-19</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">数学</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E5%AD%A6/%E5%88%9D%E4%B8%AD/" itemprop="url" rel="index"><span itemprop="name">初中</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="均值不等式">均值不等式</h1>
<p>均值不等式是数学中一类重要的不等式，它描述了数列或函数的平均值与其他值之间的关系。常见的均值不等式包括算术平均值不小于几何平均值、几何平均值不小于调和平均值等。下面简要介绍一些常见的均值不等式：</p>
<h2 id="调和平均值">调和平均值</h2>
<p><span class="math display">\[\begin{equation}
    H_{n}=\frac{n}{\sum_{i=1}^{n}\frac{1}{
x_{i}}}=\frac{n}{\frac{1}{x_{1}}+\frac{1}{x_{2}}+\ldots
+\frac{1}{x_{n}}}
\end{equation}\]</span></p>
<h2 id="几何平均值">几何平均值</h2>
<p><span class="math display">\[\begin{equation}
    G_{n}=\sqrt[n]{\prod_{i=1}^{n} x_i}=\sqrt[n]{x_{1}x_{2}\ldots x_{n}}
\end{equation}\]</span></p>
<h2 id="算术平均数">算术平均数</h2>
<p><span class="math display">\[\begin{equation}
    A_{n}=\frac{\sum_{i=1}^{n}{x_{i}}}{n}=\frac{x_{1}+x_{2}+\ldots+x_{n}}{n}
\end{equation}\]</span></p>
<h2 id="平方平均数">平方平均数</h2>
<p><span class="math display">\[\begin{equation}
    Q_{n}=\sqrt{\frac{\sum_{i=1}^{n}{x_{i}^2}}{n}}=\sqrt{\frac{x_{1}^2+x_{2}^2+\ldots+x_{n}^2}{n}}
\end{equation}\]</span></p>
<h2 id="结论">结论</h2>
<p><span class="math display">\[\begin{equation}
    H_{n} \leq G_{n} \leq A_{n} \leq Q_{n}
\end{equation}\]</span></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.blockchainof.com/2024/05/17/Docker%E7%9F%A5%E8%AF%86%E7%82%B902/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="暂留白">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自留地">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/05/17/Docker%E7%9F%A5%E8%AF%86%E7%82%B902/" class="post-title-link" itemprop="url">Docker知识点02</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-05-17 10:21:25" itemprop="dateCreated datePublished" datetime="2024-05-17T10:21:25+08:00">2024-05-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-05-24 16:30:40" itemprop="dateModified" datetime="2024-05-24T16:30:40+08:00">2024-05-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/" itemprop="url" rel="index"><span itemprop="name">云原生</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD/" itemprop="url" rel="index"><span itemprop="name">基础设施</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言">前言</h1>
<p>需要搭建spark集群以及hadoop集群，并且使它间之间进行交互。目标：编写一个yaml，用于一键部署。本文先试验一个个部署，最终形成一个一键部署的方案。</p>
<h1 id="实践">实践</h1>
<h2 id="hadoop集群单机部署试验">hadoop集群单机部署试验</h2>
<ol type="1">
<li><p>拉取appache官方镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull apache/hadoop</span><br></pre></td></tr></table></figure></li>
<li><p>在服务器本地目录创建所需文件</p>
<ul>
<li><p>创建<code>docker-compose.yaml</code>文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">   <span class="attr">namenode:</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">apache/hadoop:3</span></span><br><span class="line">      <span class="attr">networks:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">hadoop_network</span></span><br><span class="line">      <span class="attr">hostname:</span> <span class="string">namenode</span></span><br><span class="line">      <span class="attr">command:</span> [<span class="string">&quot;hdfs&quot;</span>, <span class="string">&quot;namenode&quot;</span>]</span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">9870</span><span class="string">:9870</span></span><br><span class="line">        <span class="bullet">-</span> <span class="number">8020</span><span class="string">:8020</span></span><br><span class="line">      <span class="attr">env_file:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./config</span></span><br><span class="line">      <span class="attr">environment:</span></span><br><span class="line">          <span class="attr">ENSURE_NAMENODE_DIR:</span> <span class="string">&quot;/tmp/hadoop-root/dfs/name&quot;</span></span><br><span class="line">   <span class="attr">datanode:</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">apache/hadoop:3</span></span><br><span class="line">      <span class="attr">networks:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">hadoop_network</span></span><br><span class="line">      <span class="attr">command:</span> [<span class="string">&quot;hdfs&quot;</span>, <span class="string">&quot;datanode&quot;</span>]</span><br><span class="line">      <span class="attr">env_file:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./config</span></span><br><span class="line">   <span class="attr">resourcemanager:</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">apache/hadoop:3</span></span><br><span class="line">      <span class="attr">networks:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">hadoop_network</span></span><br><span class="line">      <span class="attr">hostname:</span> <span class="string">resourcemanager</span></span><br><span class="line">      <span class="attr">command:</span> [<span class="string">&quot;yarn&quot;</span>, <span class="string">&quot;resourcemanager&quot;</span>]</span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">         <span class="bullet">-</span> <span class="number">8088</span><span class="string">:8088</span></span><br><span class="line">      <span class="attr">env_file:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./config</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./test.sh:/opt/test.sh</span></span><br><span class="line">   <span class="attr">nodemanager:</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">apache/hadoop:3</span></span><br><span class="line">      <span class="attr">networks:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">hadoop_network</span></span><br><span class="line">      <span class="attr">command:</span> [<span class="string">&quot;yarn&quot;</span>, <span class="string">&quot;nodemanager&quot;</span>]</span><br><span class="line">      <span class="attr">env_file:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">./config</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">hadoop_network:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">hadoop-net</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>自定义网络，这样定义是会自动创建这个网络的</p>
</blockquote>
<p>如果网络已经存在，那可以这样指定(在后续我们一键部署时这个很重要，需要让每个容器在同一网络内，<code>docker stack</code>
部署还需要这个网络为<code>overlay</code>网络)</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">hadoop_network:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">hadoop-net</span></span><br></pre></td></tr></table></figure></li>
<li><p>上述文件中有一个<code>config</code>文件用来设置一些环境变量，所以我们再创建一个<code>config</code>文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">CORE-SITE.XML_fs.default.name=hdfs://namenode</span><br><span class="line">CORE-SITE.XML_fs.defaultFS=hdfs://namenode</span><br><span class="line">HDFS-SITE.XML_dfs.namenode.rpc-address=namenode:8020</span><br><span class="line">HDFS-SITE.XML_dfs.replication=1</span><br><span class="line">MAPRED-SITE.XML_mapreduce.framework.name=yarn</span><br><span class="line">MAPRED-SITE.XML_yarn.app.mapreduce.am.env=HADOOP_MAPRED_HOME=$HADOOP_HOME</span><br><span class="line">MAPRED-SITE.XML_mapreduce.map.env=HADOOP_MAPRED_HOME=$HADOOP_HOME</span><br><span class="line">MAPRED-SITE.XML_mapreduce.reduce.env=HADOOP_MAPRED_HOME=$HADOOP_HOME</span><br><span class="line">YARN-SITE.XML_yarn.resourcemanager.hostname=resourcemanager</span><br><span class="line">YARN-SITE.XML_yarn.nodemanager.pmem-check-enabled=false</span><br><span class="line">YARN-SITE.XML_yarn.nodemanager.delete.debug-delay-sec=600</span><br><span class="line">YARN-SITE.XML_yarn.nodemanager.vmem-check-enabled=false</span><br><span class="line">YARN-SITE.XML_yarn.nodemanager.aux-services=mapreduce_shuffle</span><br><span class="line">CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.maximum-applications=10000</span><br><span class="line">CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.maximum-am-resource-percent=0.1</span><br><span class="line">CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.resource-calculator=org.apache.hadoop.yarn.util.resource.DefaultResourceCalculator</span><br><span class="line">CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.root.queues=default</span><br><span class="line">CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.root.default.capacity=100</span><br><span class="line">CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.root.default.user-limit-factor=1</span><br><span class="line">CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.root.default.maximum-capacity=100</span><br><span class="line">CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.root.default.state=RUNNING</span><br><span class="line">CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.root.default.acl_submit_applications=*</span><br><span class="line">CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.root.default.acl_administer_queue=*</span><br><span class="line">CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.node-locality-delay=40</span><br><span class="line">CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.queue-mappings=</span><br><span class="line">CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.queue-mappings-override.enable=false</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里面没有指定<code>HADOOP_HOME</code>的值，部署的时候会有一个警告，但也不影响使用，后来我就在这个文件中，这个变量使用前，添加了一行<code>HADOOP_HOME=/opt/hadoop</code></p>
</blockquote></li>
</ul></li>
<li><p>检查所需文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[centos@maodaoming-1 hadoop]$ ll</span><br><span class="line">total 8</span><br><span class="line">-rw-rw-r--. 1 centos centos 1789 May 17 09:21 config</span><br><span class="line">-rw-rw-r--. 1 centos centos  984 May 17 11:04 docker-compose.yaml</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="spark-集群单机部署">spark 集群单机部署</h1>
<p>因为是搭建FATE 2.1.0
版本的spark环境，所以使用的是使用FATE-Builder打包出来的spark镜像，包含：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yunpcds/spark-master        2.1.0-release   115b928c3b3d   21 hours ago    4.68GB</span><br><span class="line">yunpcds/spark-worker        2.1.0-release   371c1de5aabe   21 hours ago    4.68GB</span><br></pre></td></tr></table></figure>
<ol type="1">
<li>创建<code>docker-compose.yaml</code>文件</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">spark-master:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">spark-master</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">$&#123;IMAGE_PREFIX&#125;/spark-master:$&#123;IMAGE_TAG&#125;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">spark-master</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;7077:7077&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6066:6066&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">spark-slave:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">spark-slave</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">$&#123;IMAGE_PREFIX&#125;/spark-worker:$&#123;IMAGE_TAG&#125;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">spark-slave</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8781:8081&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/projects/:/data/projects/</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">SERVICE_PRECONDITION:</span> <span class="string">&quot;spark-master:7077&quot;</span></span><br><span class="line">      <span class="attr">EGGROLL_HOME:</span> <span class="string">&quot;/data/projects/fate/eggroll&quot;</span></span><br><span class="line">      <span class="attr">FATE_PROJECT_BASE:</span> <span class="string">&quot;/data/projects/fate&quot;</span></span><br><span class="line">      <span class="attr">VIRTUAL_ENV:</span> <span class="string">&quot;/data/projects/python/venv&quot;</span></span><br><span class="line">      <span class="attr">PYTHONPATH:</span> <span class="string">&quot;/data/projects/fate/:/data/projects/fate/eggroll/python:/data/projects/fate/fate/python:/data/projects/fate/fateflow/python:/data/projects/fate/python&quot;</span></span><br><span class="line">      <span class="attr">PATH:</span> <span class="string">&quot;/data/projects/python/venv/bin:/opt/hadoop-3.2.3/bin:/opt/hive/bin:/opt/spark-3.1.3-bin-hadoop3.2/bin:/opt/hadoop-3.2.3/bin/:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">spark_network:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">spark-net</span></span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>变量设置文件:<font size="5"><code>.env</code></font>文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">IMAGE_PREFIX=yunpcds</span><br><span class="line">IMAGE_TAG=2.1.0-release</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里面的变量会被传入到<code>docker-compose.yaml</code>中去,上面的PYTHONPATH,
PATH根据实际情况再调整；还有<font size="5">volumes</font>的映射，需要把fate的代码拷贝到宿主机的对应目录<code>/data/projects/</code></p>
</blockquote>
<ol start="3" type="1">
<li><p>查看所需文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[centos@maodaoming-2 spark]$ ll -a</span><br><span class="line">total 8</span><br><span class="line">drwxrwxr-x. 2 centos centos   45 May 17 15:33 .</span><br><span class="line">drwxrwxr-x. 4 centos centos   33 May 17 14:38 ..</span><br><span class="line">-rw-rw-r--. 1 centos centos 1103 May 17 14:56 docker-compose.yaml</span><br><span class="line">-rw-rw-r--. 1 centos centos   45 May 17 14:39 .env</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="一键部署">一键部署</h1>
<p>把<code>docker-compose.yaml</code>合并成一份，使用docker
stack部署：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">namenode:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">apache/hadoop:3</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">namenode</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;hdfs&quot;</span>, <span class="string">&quot;namenode&quot;</span>]</span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bigdata-network</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">target:</span> <span class="number">9870</span></span><br><span class="line">        <span class="attr">published:</span> <span class="number">9870</span></span><br><span class="line">        <span class="attr">protocol:</span> <span class="string">tcp</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">host</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">target:</span> <span class="number">9000</span></span><br><span class="line">        <span class="attr">published:</span> <span class="number">9000</span></span><br><span class="line">        <span class="attr">protocol:</span> <span class="string">tcp</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">host</span></span><br><span class="line">    <span class="attr">env_file:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./config</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ENSURE_NAMENODE_DIR:</span> <span class="string">&quot;/tmp/hadoop-root/dfs/name&quot;</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">endpoint_mode:</span> <span class="string">dnsrr</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&#x27;node.labels.nodename == node55&#x27;</span></span><br><span class="line">  <span class="attr">datanode:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">apache/hadoop:3</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;hdfs&quot;</span>, <span class="string">&quot;datanode&quot;</span>]</span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bigdata-network</span></span><br><span class="line">    <span class="attr">env_file:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./config</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">target:</span> <span class="number">1004</span></span><br><span class="line">        <span class="attr">published:</span> <span class="number">1004</span></span><br><span class="line">        <span class="attr">protocol:</span> <span class="string">tcp</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">host</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">target:</span> <span class="number">1006</span></span><br><span class="line">        <span class="attr">published:</span> <span class="number">1006</span></span><br><span class="line">        <span class="attr">protocol:</span> <span class="string">tcp</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">host</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">target:</span> <span class="number">9866</span></span><br><span class="line">        <span class="attr">published:</span> <span class="number">9864</span></span><br><span class="line">        <span class="attr">protocol:</span> <span class="string">tcp</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">host</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">endpoint_mode:</span> <span class="string">dnsrr</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&#x27;node.labels.nodename == node55&#x27;</span></span><br><span class="line">  <span class="attr">resourcemanager:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">apache/hadoop:3</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">resourcemanager</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;yarn&quot;</span>, <span class="string">&quot;resourcemanager&quot;</span>]</span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bigdata-network</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">8088</span><span class="string">:8088</span></span><br><span class="line">    <span class="attr">env_file:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./config</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&#x27;node.labels.nodename == node55&#x27;</span></span><br><span class="line">  <span class="attr">nodemanager:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">apache/hadoop:3</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;yarn&quot;</span>, <span class="string">&quot;nodemanager&quot;</span>]</span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bigdata-network</span></span><br><span class="line">    <span class="attr">env_file:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./config</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&#x27;node.labels.nodename == node55&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">spark-master:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">spark-master</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">$&#123;IMAGE_PREFIX&#125;/spark-master:$&#123;IMAGE_TAG&#125;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">spark-master</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bigdata-network</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;7077:7077&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6066:6066&quot;</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&#x27;node.role == manager&#x27;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&#x27;node.labels.nodename == node91&#x27;</span></span><br><span class="line">  <span class="attr">spark-slave:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">spark-worker</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">$&#123;IMAGE_PREFIX&#125;/spark-worker:$&#123;IMAGE_TAG&#125;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">spark-worker</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bigdata-network</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8781:8081&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/data/projects/:/data/projects/</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">SERVICE_PRECONDITION:</span> <span class="string">&quot;spark-master:7077&quot;</span></span><br><span class="line">      <span class="attr">EGGROLL_HOME:</span> <span class="string">&quot;/data/projects/fate/eggroll&quot;</span></span><br><span class="line">      <span class="attr">FATE_PROJECT_BASE:</span> <span class="string">&quot;/data/projects/fate&quot;</span></span><br><span class="line">      <span class="attr">VIRTUAL_ENV:</span> <span class="string">&quot;/data/projects/python/venv&quot;</span></span><br><span class="line">      <span class="attr">PYTHONPATH:</span> <span class="string">&quot;/data/projects/fate/:/data/projects/fate/eggroll/python:/data/projects/fate/fate/python:/data/projects/fate/fateflow/python:/data/projects/fate/python&quot;</span></span><br><span class="line">      <span class="attr">PATH:</span> <span class="string">&quot;/data/projects/python/venv/bin:/opt/hadoop-3.2.3/bin:/opt/hive/bin:/opt/spark-3.1.3-bin-hadoop3.2/bin:/opt/hadoop-3.2.3/bin/:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&#x27;node.role == manager&#x27;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&#x27;node.labels.nodename == node91&#x27;</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">hadoop_namenode:</span></span><br><span class="line">  <span class="attr">hadoop_datanode1:</span></span><br><span class="line">  <span class="attr">hadoop_datanode2:</span></span><br><span class="line">  <span class="attr">hadoop_datanode3:</span></span><br><span class="line">  <span class="attr">hadoop_historyserver:</span></span><br><span class="line">  <span class="attr">kerberos_db:</span></span><br><span class="line">  <span class="attr">kerberos_keytab:</span></span><br><span class="line">    <span class="attr">driver_opts:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">nfs</span></span><br><span class="line">      <span class="attr">o:</span> <span class="string">addr=192.168.11.74,nfsvers=4,minorversion=0,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport</span></span><br><span class="line">      <span class="attr">device:</span> <span class="string">:/home/centos/nfs_share/volume/bigdata/keytab</span></span><br><span class="line">  <span class="attr">hive_metastore:</span></span><br><span class="line">  <span class="attr">mysql_data:</span></span><br><span class="line">  <span class="attr">linkis_log:</span></span><br><span class="line">  <span class="attr">linkis_runtime:</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">bigdata-network:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">bigdata-network</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：有volumes映射的一定要注意，如果路径不存在就启动失败</p>
</blockquote>
<p>启动脚本编写：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker stack rm bigdata</span><br><span class="line"></span><br><span class="line">sleep 1s</span><br><span class="line"></span><br><span class="line">echo &quot;请注意清理nodedata的volume!!!&quot;</span><br><span class="line"></span><br><span class="line">[ -f .env ] &amp;&amp; export $(sed &#x27;/^#/d&#x27; .env)</span><br><span class="line">docker stack deploy -c docker-stack-deploy.yaml bigdata</span><br></pre></td></tr></table></figure>
<p>启动后检查是否成功：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[centos@maodaoming-2 flow-spark-v2-env]$ docker service ls</span><br><span class="line"></span><br><span class="line">gzpqsvib86y6   bigdata_datanode          replicated   1/1        apache/hadoop:3</span><br><span class="line">proujh710xqf   bigdata_namenode          replicated   1/1        apache/hadoop:3</span><br><span class="line">fyok561q2qiv   bigdata_nodemanager       replicated   1/1        apache/hadoop:3</span><br><span class="line">72gzt56c9yrp   bigdata_resourcemanager   replicated   0/1        apache/hadoop:3                      *:8088-&gt;8088/tcp</span><br><span class="line">opo2n1jaa0bj   bigdata_spark-master      replicated   1/1        yunpcds/spark-master:2.1.0-release   *:6066-&gt;6066/tcp, *:7077-&gt;7077/tcp, *:8080-&gt;8080/tcp</span><br><span class="line">rsxhqoanjd3y   bigdata_spark-worker      replicated   1/1        yunpcds/spark-worker:2.1.0-release   *:8781-&gt;8081/tcp</span><br><span class="line">chwttx82rp8u   busybox                   replicated   1/1        busybox:latest</span><br></pre></td></tr></table></figure>
<p>可以查看到<code>bigdata_resourcemanager</code>是启动失败的。可以用以下命令查看日志：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[centos@maodaoming-2 flow-spark-v2-env]$ docker service ps  --no-trunc bigdata_resourcemanager</span><br><span class="line"></span><br><span class="line">z8i8jbqpzz8zbmkh0w9k8i91o   bigdata_resourcemanager.1       apache/hadoop:3@sha256:af361b20bec0dfb13f03279328572ba764926e918c4fe716e197b8be2b08e37f   maodaoming-1.novalocal   Ready           Rejected 1 second ago     &quot;invalid mount config for type &quot;bind&quot;: bind source path does not exist: /home/centos/flow-spark-v2-env/test.sh&quot;</span><br><span class="line">spmxmabdm0gikj33y4bxoot51    \_ bigdata_resourcemanager.1   apache/hadoop:3@sha256:af361b20bec0dfb13f03279328572ba764926e918c4fe716e197b8be2b08e37f   maodaoming-1.novalocal   Shutdown        Rejected 6 seconds ago    &quot;invalid mount config for type &quot;bind&quot;: bind source path does not exist: /home/centos/flow-spark-v2-env/test.sh&quot;</span><br><span class="line">zo68mawn5flwwejynq54iwus0    \_ bigdata_resourcemanager.1   apache/hadoop:3@sha256:af361b20bec0dfb13f03279328572ba764926e918c4fe716e197b8be2b08e37f   maodaoming-1.novalocal   Shutdown        Rejected 11 seconds ago   &quot;invalid mount config for type &quot;bind&quot;: bind source path does not exist: /home/centos/flow-spark-v2-env/test.sh&quot;</span><br><span class="line">60ew6r1iqf9wppbc3dojq0566    \_ bigdata_resourcemanager.1   apache/hadoop:3@sha256:af361b20bec0dfb13f03279328572ba764926e918c4fe716e197b8be2b08e37f   maodaoming-1.novalocal   Shutdown        Rejected 17 seconds ago   &quot;invalid mount config for type &quot;bind&quot;: bind source path does not exist: /home/centos/flow-spark-v2-env/test.sh&quot;</span><br><span class="line">nk9rzlaqqw2e1rr4ali2634mp    \_ bigdata_resourcemanager.1   apache/hadoop:3@sha256:af361b20bec0dfb13f03279328572ba764926e918c4fe716e197b8be2b08e37f   maodaoming-1.novalocal   Shutdown        Rejected 21 seconds ago   &quot;invalid mount config for type &quot;bind&quot;: bind source path does not exist: /home/centos/flow-spark-v2-env/test.sh&quot;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.blockchainof.com/2024/04/24/vcpkg%E7%9A%84%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="暂留白">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自留地">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/04/24/vcpkg%E7%9A%84%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/" class="post-title-link" itemprop="url">vcpkg的使用记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-04-24 08:24:30 / 修改时间：13:59:30" itemprop="dateCreated datePublished" datetime="2024-04-24T08:24:30+08:00">2024-04-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/" itemprop="url" rel="index"><span itemprop="name">开发环境</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="安装vcpkg">安装vcpkg</h1>
<h2 id="clone-vcpkg">clone vcpkg</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/microsoft/vcpkg</span><br></pre></td></tr></table></figure>
<h2 id="install-vcpkg">install vcpkg</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd vcpkg</span><br><span class="line">./bootstrap-vcpkg.sh</span><br></pre></td></tr></table></figure>
<h2 id="设置环境变量">设置环境变量</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">vcpkg</span></span><br><span class="line">export VCPKG_ROOT=~/vcpkg</span><br><span class="line">export PATH=$PATH:$VCPKG_ROOT</span><br><span class="line">export VCPKG_DEFAULT_TRIPLET=arm64-osx</span><br></pre></td></tr></table></figure>
<blockquote>
<p>VCPKG_DEFAULT_TRIPLET 设置了默认的TRIPLET，vcpkg install
时就无需指定triplet</p>
</blockquote>
<h1 id="vcpkg-install">vcpkg install</h1>
<h2 id="安装boost">安装boost</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vcpkg install boost</span><br></pre></td></tr></table></figure>
<p>在最后会出错，有警告信息如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">CMake Warning at ports/python3/portfile.cmake:7 (message):</span><br><span class="line">  python3 currently requires the following programs from the system package</span><br><span class="line">  manager:</span><br><span class="line"></span><br><span class="line">      autoconf automake autoconf-archive</span><br><span class="line"></span><br><span class="line">  On Debian and Ubuntu derivatives:</span><br><span class="line"></span><br><span class="line">      sudo apt-get install autoconf automake autoconf-archive</span><br><span class="line"></span><br><span class="line">  On recent Red Hat and Fedora derivatives:</span><br><span class="line"></span><br><span class="line">      sudo dnf install autoconf automake autoconf-archive</span><br><span class="line"></span><br><span class="line">  On Arch Linux and derivatives:</span><br><span class="line"></span><br><span class="line">      sudo pacman -S autoconf automake autoconf-archive</span><br><span class="line"></span><br><span class="line">  On Alpine:</span><br><span class="line"></span><br><span class="line">      apk add autoconf automake autoconf-archive</span><br><span class="line"></span><br><span class="line">  On macOS:</span><br><span class="line"></span><br><span class="line">      brew install autoconf automake autoconf-archive</span><br></pre></td></tr></table></figure>
<blockquote>
<p>按照上述警告信息操作后再重新执行vcpkg install boost，成功</p>
</blockquote>
<h2 id="安装nlohmann-json">安装nlohmann-json</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vcpkg install nlohmann-json</span><br></pre></td></tr></table></figure>
<h1 id="创建c项目">创建c++项目</h1>
<h3 id="vcpkg-创建项目">vcpkg 创建项目</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir helloworld &amp;&amp; cd helloworld</span><br><span class="line">vcpkg new --application</span><br></pre></td></tr></table></figure>
<blockquote>
<p>会生成vcpkg.json文件，项目中的依赖库信息会保存在里面</p>
</blockquote>
<h3 id="添加依赖">添加依赖</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vcpkg add port nlohmann-json</span><br></pre></td></tr></table></figure>
<p>执行后在<code>vcpkg.json</code>文件中会添加这个依赖：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;dependencies&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;nlohmann-json&quot;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="创建cmakelists.txt文件">创建<code>CMakeLists.txt</code>文件</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required(VERSION 3.10)</span><br><span class="line">project(HelloWorld)</span><br><span class="line">add_executable(HelloWorld helloworld.cpp)</span><br><span class="line">find_package(nlohmann_json CONFIG REQUIRED)</span><br><span class="line">target_link_libraries(HelloWorld PRIVATE nlohmann_json::nlohmann_json)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>CMakeLists.txt</code>中并没有指定nlohmann_json包的路径，那CMake怎么找到这些依赖包呢？那就要用到<code>CMakePresets.json</code>文件</p>
</blockquote>
<h2 id="创建cmakepresets.json文件">创建<code>CMakePresets.json</code>文件</h2>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;configurePresets&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;generator&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Ninja&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;binaryDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;sourceDir&#125;/build&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;cacheVariables&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;CMAKE_TOOLCHAIN_FILE&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$env&#123;VCPKG_ROOT&#125;/scripts/buildsystems/vcpkg.cmake&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里就需要在环境变量中设置<code>VCPKG_ROOT</code></p>
</blockquote>
<p>有了<code>CMakePresets.json</code>后，使用以下命令，会对cmake build
做一下一些前置的设置操作：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake --preset=default</span><br></pre></td></tr></table></figure>
<h2 id="编译">编译</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake --build build</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.blockchainof.com/2024/03/05/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85nasm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="暂留白">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自留地">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/03/05/%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85nasm/" class="post-title-link" itemprop="url">源码编译安装nasm</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-03-05 11:26:47 / 修改时间：11:36:40" itemprop="dateCreated datePublished" datetime="2024-03-05T11:26:47+08:00">2024-03-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B1%87%E7%BC%96/" itemprop="url" rel="index"><span itemprop="name">汇编</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="从源代码编译安装-nasm">从源代码编译安装 Nasm</h1>
<h2 id="下载-nasm-源代码">下载 Nasm 源代码</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://www.nasm.us/pub/nasm/releasebuilds/nasm-2.15.05.tar.gz</span><br></pre></td></tr></table></figure>
<h2 id="解压源代码">解压源代码</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvzf nasm-2.15.05.tar.gz</span><br></pre></td></tr></table></figure>
<h2 id="进入源代码目录">进入源代码目录</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd nasm-2.15.05</span><br></pre></td></tr></table></figure>
<h2 id="配置编译环境">配置编译环境</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br></pre></td></tr></table></figure>
<h2 id="编译安装">编译安装</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure>
<h2 id="验证-nasm-版本">验证 Nasm 版本</h2>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nasm --version</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.blockchainof.com/2024/02/19/Docker%E7%9F%A5%E8%AF%86%E7%82%B901/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="暂留白">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自留地">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/02/19/Docker%E7%9F%A5%E8%AF%86%E7%82%B901/" class="post-title-link" itemprop="url">Docker知识点01</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-02-19 09:16:00" itemprop="dateCreated datePublished" datetime="2024-02-19T09:16:00+08:00">2024-02-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-05-24 16:30:34" itemprop="dateModified" datetime="2024-05-24T16:30:34+08:00">2024-05-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/" itemprop="url" rel="index"><span itemprop="name">云原生</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/%E5%9F%BA%E7%A1%80%E8%AE%BE%E6%96%BD/" itemprop="url" rel="index"><span itemprop="name">基础设施</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="名词">名词</h1>
<table>
<colgroup>
<col style="width: 4%">
<col style="width: 95%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">名词</th>
<th style="text-align: left;">说明</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Bridge 网络</td>
<td style="text-align: left;">1. Bridge 网络是 Docker
默认创建的网络模式。当您在 Docker
中创建一个新的容器时，默认会将容器连接到名为 bridge 的网络中 <br> 2.
Bridge
网络允许容器与宿主机以及同一主机上的其他容器进行通信，但默认情况下不允许容器之间跨主机通信
<br> 3. Bridge 网络使用 Linux
系统上的桥接技术，在宿主机上创建一个虚拟的网桥设备，用于连接容器和主机的物理网络接口
<br> 4. Bridge 网络适用于单个主机上的容器通信</td>
</tr>
<tr class="even">
<td style="text-align: left;">Overlay 网络</td>
<td style="text-align: left;">1. Overlay 网络用于跨多个 Docker
主机构建容器集群，并允许集群中的容器之间进行跨主机通信 <br> 2. Overlay
网络使用了 VxLAN 技术，在不同主机上创建虚拟的 Overlay
网络，容器可以通过该网络进行通信 <br> 3. Overlay 网络通常用于 Docker
Swarm 集群或 Kubernetes 集群中，用于构建分布式应用和微服务架构 <br> 4.
Overlay 网络适用于跨多个主机的容器通信</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MTU</td>
<td style="text-align: left;">最大传输单元MTU（Maximum Transmission
Unit，MTU），是指网络能够传输的最大数据包大小，以字节为单位。MTU的大小决定了发送端一次能够发送报文的最大字节数。如果MTU超过了接收端所能够承受的最大值，或者是超过了发送路径上途经的某台设备所能够承受的最大值，就会造成报文分片甚至丢弃，加重网络传输的负担。如果太小，那实际传送的数据量就会过小，影响传输效率。</td>
</tr>
</tbody>
</table>
<h1 id="overlay网络">Overlay网络</h1>
<p>docker
swarm在启动的过程中会创建两个默认的网络：docker_gwbridge和ingress.</p>
<ul>
<li><strong>docker_gwbridge</strong>：通过这个网络，容器可以连接到宿主机。（它的driver就是bridge)</li>
<li><strong>ingress</strong>：由docker
swarm创建的overlay网络，这个网络用于将服务暴露给外部访问，docker
swarm就是通过它实现的routing
mesh（将外部请求路由到不同主机的容器）。</li>
</ul>
<p>例子如下： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[centos@bd-2 ~]$ docker network ls</span><br><span class="line">NETWORK ID     NAME                           DRIVER    SCOPE</span><br><span class="line">69477a3560e9   bridge                         bridge    local</span><br><span class="line">320cd9ae8475   centos_default                 bridge    local</span><br><span class="line">d344065cc4cc   docker_gwbridge                bridge    local</span><br><span class="line">da5d24e5d251   flow-admin-backend_admin-net   bridge    local</span><br><span class="line">4d5b92424942   flow-admin-front_admin-net     bridge    local</span><br><span class="line">qqfrntz0lrex   hadoop-com                     overlay   swarm</span><br><span class="line">5cd8e1bc97a5   host                           host      local</span><br><span class="line">mtysig457puz   ingress                        overlay   swarm</span><br><span class="line">7ad98d08bd3c   none                           null      local  </span><br></pre></td></tr></table></figure></p>
<h1 id="docker0的mtu">docker0的mtu</h1>
<p>mtu查看 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig | grep mtu</span><br></pre></td></tr></table></figure>
如果宿主机的mtu比docker0的mtu还小，网络会存在问题，所以是需要修改docker0的mtu</p>
<p>我直接通过修改/etc/docker/daemon.json文件： <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;log-driver&quot;</span><span class="punctuation">:</span><span class="string">&quot;json-file&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;log-opts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;max-size&quot;</span><span class="punctuation">:</span><span class="string">&quot;200m&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;max-file&quot;</span><span class="punctuation">:</span><span class="string">&quot;3&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;live-restore&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;mtu&quot;</span><span class="punctuation">:</span> <span class="number">1450</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;insecure-registries&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;192.168.10.166:88&quot;</span><span class="punctuation">,</span><span class="string">&quot;192.168.9.68&quot;</span><span class="punctuation">,</span><span class="string">&quot;192.168.11.149:8888&quot;</span><span class="punctuation">,</span><span class="string">&quot;192.168.11.168:8888&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>重启docker</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>
<p>重新查看mtu，如果docker中此时没有容器在运行，那会发现docker0的mtu还是原先的值。这里有坑：当docker中有容器在运行时，再去查看docker0的mtu就生效了。
强迫症可以修改daemon.json配置，重启docker服务后，再使用命令临时修改docker0的mtu：
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ip link set docker0 mtu 1450</span><br></pre></td></tr></table></figure></p>
<h1 id="swarm集群搭建">Swarm集群搭建</h1>
<p>初始化manager节点 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm init --advertise-addr 192.168.10.91:2377</span><br></pre></td></tr></table></figure> 正常情况输出类似以下的提示：
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Swarm initialized: current node (tg66scjfm2kgw5z7pb7vpnrye) is now a manager.</span><br><span class="line"></span><br><span class="line">To add a worker to this swarm, run the following command:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-4e22sso1h4dofwqzq25a6crgc9fzk4it6237jdd6ezuzqknsw5-79qgv3b9sc88wa8jk5etylpty 192.168.10.91:2377</span><br><span class="line"></span><br><span class="line">To add a manager to this swarm, run &#x27;docker swarm join-token manager&#x27; and follow the instructions.</span><br></pre></td></tr></table></figure></p>
<p>后续想要查看怎么加入到swarm集群，使用以下命令: <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取Manager节点加入命令</span></span><br><span class="line">docker swarm join-token manager</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">获取Worker节点加入命令</span></span><br><span class="line">docker swarm join-token worker</span><br></pre></td></tr></table></figure></p>
<p>可以到work节点上执行： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker swarm join --token SWMTKN-1-4e22sso1h4dofwqzq25a6crgc9fzk4it6237jdd6ezuzqknsw5-79qgv3b9sc88wa8jk5etylpty 192.168.10.91:2377</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<p>如果是多manager的话，可以在其它manager节点执行： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm join --token SWMTKN-1-4e22sso1h4dofwqzq25a6crgc9fzk4it6237jdd6ezuzqknsw5-2ccx8qd17rc0ydci0kcw9qfy2 192.168.10.91:2377</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>这里有坑，就是docker的daemon.json中配置的mtu，对于swarm的overlay网络是不起作用的。</p>
</blockquote>
<p>修改overlay网络的mtu和eth0,docker0的mtu保持一致 1.
在manager节点中先获取子网信息 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network inspect -f &#x27;&#123;&#123;json .IPAM&#125;&#125;&#x27; docker_gwbridge</span><br></pre></td></tr></table></figure> 返回： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;Driver&quot;:&quot;default&quot;,&quot;Options&quot;:null,&quot;Config&quot;:[&#123;&quot;Subnet&quot;:&quot;172.18.0.0/16&quot;,&quot;Gateway&quot;:&quot;172.18.0.1&quot;&#125;]&#125; </span><br></pre></td></tr></table></figure> 2.
manager节点退出swarm集群(自定义docker_gwbridge网络，则必须在将 Docker
主机加入 swarm 之前或暂时从 swarm 中移除后进行) <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm leave --force</span><br></pre></td></tr></table></figure> 3.
manager节点停掉docker服务 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop docker.service</span><br></pre></td></tr></table></figure> 4.
manager节点中删掉虚拟网卡docker_gwbridge <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ip link set docker_gwbridge down</span><br><span class="line">sudo ip link del dev docker_gwbridge</span><br></pre></td></tr></table></figure> 5.
manager节点中启动docker <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker.service</span><br></pre></td></tr></table></figure> 6.
manager节点中重建docker_gwbridge（这一步用到了第1步获取的子网信息以及设置我们要的mtu值）
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker network rm docker_gwbridge</span><br><span class="line">docker network create \</span><br><span class="line">  --subnet 172.18.0.0/16 \</span><br><span class="line">  --gateway 172.18.0.1 \</span><br><span class="line">  --opt com.docker.network.bridge.name=docker_gwbridge \</span><br><span class="line">  --opt com.docker.network.bridge.enable_icc=false \</span><br><span class="line">  --opt com.docker.network.bridge.enable_ip_masquerade=true \</span><br><span class="line">  --opt com.docker.network.driver.mtu=1450 \</span><br><span class="line">  docker_gwbridge</span><br></pre></td></tr></table></figure>
<strong>再到work节点上执行相同的命令执行1~6步骤</strong>完成docker_gwbridge网络的自定义创建</p>
<ol start="7" type="1">
<li><p>manager节点中查看ingress网络信息 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network inspect -f &#x27;&#123;&#123;json .IPAM&#125;&#125;&#x27; ingress</span><br></pre></td></tr></table></figure> 返回
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;Driver&quot;:&quot;default&quot;,&quot;Options&quot;:null,&quot;Config&quot;:[&#123;&quot;Subnet&quot;:&quot;10.0.0.0/24&quot;,&quot;Gateway&quot;:&quot;10.0.0.1&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure></p></li>
<li><p>manager节点中删除ingress network <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network rm ingress</span><br></pre></td></tr></table></figure> &gt;
这一步会有个警告</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WARNING! Before removing the routing-mesh network, make sure all the nodes in your swarm run the same docker engine version. Otherwise, removal may not be effective and functionality of newly create ingress networks will be impaired.</span><br></pre></td></tr></table></figure>
<blockquote>
<p>所以swarm中的节点的docker版本最好保持一致</p>
</blockquote></li>
<li><p>manager节点中重建ingress(记得使用之前查看的ingress网络中的子网以及网关，mtu自定义修改)
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker network create \</span><br><span class="line">  --driver overlay \</span><br><span class="line">  --ingress \</span><br><span class="line">  --subnet=10.0.0.0/24 \</span><br><span class="line">  --gateway=10.0.0.1 \</span><br><span class="line">  --opt com.docker.network.driver.mtu=1450 \</span><br><span class="line">  ingress</span><br></pre></td></tr></table></figure></p></li>
<li><p>然后就是其它的manager节点/worker节点的加入了 &gt;
<strong>注意：新机器在join到swarm之前，得先重建docker_gwbridge(mtu得保持一致）</strong></p></li>
<li><p>验证mtu是否都按我们定义的修改了 启动一个swarm service
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker service create -td --name busybox busybox</span><br></pre></td></tr></table></figure> 查看mtu <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig | grep mtu</span><br></pre></td></tr></table></figure> 返回 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1450</span><br><span class="line">docker_gwbridge: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1450</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1450</span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">veth21384b6: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1450</span><br><span class="line">veth41d39c5: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1450</span><br></pre></td></tr></table></figure></p></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.blockchainof.com/2024/02/18/nfs%E5%85%B1%E4%BA%AB%E7%9B%AE%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="暂留白">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自留地">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/02/18/nfs%E5%85%B1%E4%BA%AB%E7%9B%AE%E5%BD%95/" class="post-title-link" itemprop="url">nfs共享目录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-02-18 15:17:59 / 修改时间：15:49:14" itemprop="dateCreated datePublished" datetime="2024-02-18T15:17:59+08:00">2024-02-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="nfs-服务">nfs 服务</h1>
<ol type="1">
<li><p>安装 NFS 服务器软件包：首先，在 Fedora 系统上安装 NFS
服务器软件包。NFS
服务器软件包通常是<code>nfs-utils</code>，你可以使用以下命令安装：
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo dnf install nfs-utils</span><br><span class="line"></span><br></pre></td></tr></table></figure></p></li>
<li><p>配置<code>NFS</code>服务器：<code>NFS</code>
服务器的配置文件是<code>/etc/exports</code>，你需要编辑这个文件来指定要共享的目录和相关的共享选项。比如，你可以使用<code>vi</code>或者其他文本编辑器来编辑<code>/etc/exports</code>文件：</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/exports</span><br></pre></td></tr></table></figure></p>
<p>在打开的文件中，你可以添加类似如下的行来指定共享的目录和相关选项：
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home/maodaoming/nfs_share/volume *(rw,sync,no_root_squash,no_subtree_check,insecure)</span><br></pre></td></tr></table></figure> 这行表示将 /home/maodaoming/nfs_share/volume
目录共享给所有客户端,还定义了相应的权限</p></li>
<li><p>重载 NFS 服务器配置：编辑完成 /etc/exports 文件后，你需要重新加载
NFS 服务器配置使之生效。你可以使用以下命令来重新加载： <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo exportfs -r</span><br></pre></td></tr></table></figure>
这个命令会重新加载 /etc/exports
文件中的配置，并使新的共享目录生效。</p></li>
<li><p>启动 NFS 服务器：使用以下命令启动 NFS 服务器：
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start nfs-server</span><br></pre></td></tr></table></figure></p></li>
<li><p>设置开机启动 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable nfs-server</span><br></pre></td></tr></table></figure></p></li>
</ol>
<h1 id="客户端">客户端</h1>
<ol type="1">
<li><p>创建本地挂载点：在 macOS 上创建一个本地目录，用于挂载 NFS
共享。例如，你可以在 macOS 上创建一个名为 /mnt/nfs_share 的目录：
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /mnt/nfs_share</span><br></pre></td></tr></table></figure></p></li>
<li><p>挂载 NFS 共享：使用 mount 命令挂载 NFS 共享。你需要指定 NFS
服务器的 IP 地址（或主机名）以及共享的远程目录和本地挂载点。例如：
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mount -t nfs &lt;NFS服务器IP&gt;:/home/maodaoming/nfs_share/volume /mnt/nfs_share</span><br></pre></td></tr></table></figure></p></li>
<li><p><del>卸载挂载点</del> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo umount /mnt/nfs_share</span><br></pre></td></tr></table></figure></p></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.blockchainof.com/2023/12/14/Flink-%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0-Window-%E6%9C%BA%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="暂留白">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自留地">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/12/14/Flink-%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0-Window-%E6%9C%BA%E5%88%B6/" class="post-title-link" itemprop="url">Flink原理与实现:Window机制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-12-14 10:58:46 / 修改时间：17:54:52" itemprop="dateCreated datePublished" datetime="2023-12-14T10:58:46+08:00">2023-12-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/Flink/" itemprop="url" rel="index"><span itemprop="name">Flink</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="简介">简介</h1>
<p>Flink 认为 Batch 是 Streaming 的一个特例，所以 Flink
底层引擎是一个流式引擎，在上面实现了流处理和批处理。而窗口（window）就是从
Streaming 到 Batch 的一个桥梁。Flink
提供了非常完善的窗口机制，这是我认为的 Flink
最大的亮点之一（其他的亮点包括消息乱序处理，和 checkpoint
机制）。本文我们将介绍流式处理中的窗口概念，介绍 Flink 内建的一些窗口和
Window API，最后讨论下窗口在底层是如何实现的。</p>
<h1 id="什么是-window">什么是 Window</h1>
<p>在流处理应用中，数据是连续不断的，因此我们不可能等到所有数据都到了才开始处理。当然我们可以每来一个消息就处理一次，但是有时我们需要做一些聚合类的处理，例如：在过去的1分钟内有多少用户点击了我们的网页。在这种情况下，我们必须定义一个窗口，用来收集最近一分钟内的数据，并对这个窗口内的数据进行计算。</p>
<p>窗口可以是时间驱动的（Time
Window，例如：每30秒钟），也可以是数据驱动的（Count
Window，例如：每一百个元素）。一种经典的窗口分类可以分成：翻滚窗口（Tumbling
Window，无重叠），滚动窗口（Sliding
Window，有重叠），和会话窗口（Session Window，活动间隙）。</p>
<p>我们举个具体的场景来形象地理解不同窗口的概念。假设，淘宝网会记录每个用户每次购买的商品个数，我们要做的是统计不同窗口中用户购买商品的总数。下图给出了几种经典的窗口切分概述图：</p>
<figure>
<img src="/2023/12/14/Flink-%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0-Window-%E6%9C%BA%E5%88%B6/Snipaste_2023-12-14_11-17-27.png" alt="窗口切分概述图">
<figcaption aria-hidden="true">窗口切分概述图</figcaption>
</figure>
<p>上图中，raw data stream
代表用户的购买行为流，圈中的数字代表该用户本次购买的商品个数，事件是按时间分布的，所以可以看出事件之间是有time
gap的。Flink 提供了上图中所有的窗口类型，下面我们会逐一进行介绍。</p>
<h1 id="time-window">Time Window</h1>
<p>就如名字所说的，Time Window
是根据时间对数据流进行分组的。这里我们涉及到了流处理中的时间问题，时间问题和消息乱序问题是紧密关联的，这是流处理中现存的难题之一，我们将在后续的
EventTime 和消息乱序处理 中对这部分问题进行深入探讨。这里我们只需要知道
Flink 提出了三种时间的概念，分别是event
time（事件时间：事件发生时的时间），ingestion
time（摄取时间：事件进入流处理系统的时间），processing
time（处理时间：消息被计算处理的时间）。Flink
中窗口机制和时间类型是完全解耦的，也就是说当需要改变时间类型时不需要更改窗口逻辑相关的代码。</p>
<h2 id="tumbling-time-window">Tumbling Time Window</h2>
<p>如上图，我们需要统计每一分钟中用户购买的商品的总数，需要将用户的行为事件按每一分钟进行切分，这种切分被成为翻滚时间窗口（Tumbling
Time
Window）。翻滚窗口能将数据流切分成不重叠的窗口，每一个事件只能属于一个窗口。通过使用
DataStream API，我们可以这样实现：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Stream of (userId, buyCnt)</span></span><br><span class="line"><span class="keyword">val</span> buyCnts: <span class="type">DataStream</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> tumblingCnts: <span class="type">DataStream</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = buyCnts</span><br><span class="line">  <span class="comment">// key stream by userId</span></span><br><span class="line">  .keyBy(<span class="number">0</span>) </span><br><span class="line">  <span class="comment">// tumbling time window of 1 minute length</span></span><br><span class="line">  .timeWindow(<span class="type">Time</span>.minutes(<span class="number">1</span>))</span><br><span class="line">  <span class="comment">// compute sum over buyCnt</span></span><br><span class="line">  .sum(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h2 id="sliding-time-window">Sliding Time Window</h2>
<p>但是对于某些应用，它们需要的窗口是不间断的，需要平滑地进行窗口聚合。比如，我们可以每30秒计算一次最近一分钟用户购买的商品总数。这种窗口我们称为滑动时间窗口（Sliding
Time Window）。在滑窗中，一个元素可以对应多个窗口。通过使用 DataStream
API，我们可以这样实现：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> slidingCnts: <span class="type">DataStream</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = buyCnts</span><br><span class="line">  .keyBy(<span class="number">0</span>) </span><br><span class="line">  <span class="comment">// sliding time window of 1 minute length and 30 secs trigger interval</span></span><br><span class="line">  .timeWindow(<span class="type">Time</span>.minutes(<span class="number">1</span>), <span class="type">Time</span>.seconds(<span class="number">30</span>))</span><br><span class="line">  .sum(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h1 id="count-window">Count Window</h1>
<p>Count Window 是根据元素个数对数据流进行分组的。</p>
<h2 id="tumbling-count-window">Tumbling Count Window</h2>
<p>当我们想要每100个用户购买行为事件统计购买总数，那么每当窗口中填满100个元素了，就会对窗口进行计算，这种窗口我们称之为翻滚计数窗口（Tumbling
Count Window），上图所示窗口大小为3个。通过使用 DataStream
API，我们可以这样实现：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Stream of (userId, buyCnts)</span></span><br><span class="line"><span class="keyword">val</span> buyCnts: <span class="type">DataStream</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> tumblingCnts: <span class="type">DataStream</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = buyCnts</span><br><span class="line">  <span class="comment">// key stream by sensorId</span></span><br><span class="line">  .keyBy(<span class="number">0</span>)</span><br><span class="line">  <span class="comment">// tumbling count window of 100 elements size</span></span><br><span class="line">  .countWindow(<span class="number">100</span>)</span><br><span class="line">  <span class="comment">// compute the buyCnt sum </span></span><br><span class="line">  .sum(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h2 id="sliding-count-window">Sliding Count Window</h2>
<p>当然Count Window 也支持 Sliding
Window，虽在上图中未描述出来，但和Sliding Time
Window含义是类似的，例如每10个元素计算一次最近100个元素的总和，代码示例如下。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> slidingCnts: <span class="type">DataStream</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = vehicleCnts</span><br><span class="line">  .keyBy(<span class="number">0</span>)</span><br><span class="line">  <span class="comment">// sliding count window of 100 elements size and 10 elements trigger interval</span></span><br><span class="line">  .countWindow(<span class="number">100</span>, <span class="number">10</span>)</span><br><span class="line">  .sum(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h1 id="session-window">Session Window</h1>
<p>在这种用户交互事件流中，我们首先想到的是将事件聚合到会话窗口中（一段用户持续活跃的周期），由非活跃的间隙分隔开。如上图所示，就是需要计算每个用户在活跃期间总共购买的商品数量，如果用户30秒没有活动则视为会话断开（假设raw
data stream是单个用户的购买行为流）。Session Window 的示例代码如下：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Stream of (userId, buyCnts)</span></span><br><span class="line"><span class="keyword">val</span> buyCnts: <span class="type">DataStream</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = ...</span><br><span class="line">    </span><br><span class="line"><span class="keyword">val</span> sessionCnts: <span class="type">DataStream</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = vehicleCnts</span><br><span class="line">    .keyBy(<span class="number">0</span>)</span><br><span class="line">    <span class="comment">// session window based on a 30 seconds session gap interval </span></span><br><span class="line">    .window(<span class="type">ProcessingTimeSessionWindows</span>.withGap(<span class="type">Time</span>.seconds(<span class="number">30</span>)))</span><br><span class="line">    .sum(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>一般而言，window
是在无限的流上定义了一个有限的元素集合。这个集合可以是基于时间的，元素个数的，时间和个数结合的，会话间隙的，或者是自定义的。Flink
的 DataStream API
提供了简洁的算子来满足常用的窗口操作，同时提供了通用的窗口机制来允许用户自己定义窗口分配逻辑。下面我们会对
Flink 窗口相关的 API 进行剖析。</p>
<h1 id="剖析-window-api">剖析 Window API</h1>
<p>得益于 Flink Window API
松耦合设计，我们可以非常灵活地定义符合特定业务的窗口。Flink
中定义一个窗口主要需要以下三个组件。</p>
<ul>
<li><p>Window Assigner：用来决定某个元素被分配到哪个/哪些窗口中去。</p>
<p>如下类图展示了目前内置实现的 Window Assigners：</p>
<figure>
<img src="/2023/12/14/Flink-%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0-Window-%E6%9C%BA%E5%88%B6/WindowAssigners.png" alt="WindowAssigners">
<figcaption aria-hidden="true">WindowAssigners</figcaption>
</figure></li>
<li><p>Trigger：触发器。决定了一个窗口何时能够被计算或清除，每个窗口都会拥有一个自己的Trigger。</p>
<p>如下类图展示了目前内置实现的 Triggers： <img src="/2023/12/14/Flink-%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0-Window-%E6%9C%BA%E5%88%B6/Triggers.png" alt="Triggers"></p></li>
<li><p>Evictor：可以译为“驱逐者”。在Trigger触发之后，在窗口被处理之前，Evictor（如果有Evictor的话）会用来剔除窗口中不需要的元素，相当于一个filter。</p>
<p>如下类图展示了目前内置实现的 Evictors： <img src="/2023/12/14/Flink-%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0-Window-%E6%9C%BA%E5%88%B6/Evictors.png" alt="Evictors"></p></li>
</ul>
<p>上述三个组件的不同实现的不同组合，可以定义出非常复杂的窗口。Flink
中内置的窗口也都是基于这三个组件构成的，当然内置窗口有时候无法解决用户特殊的需求，所以
Flink
也暴露了这些窗口机制的内部接口供用户实现自定义的窗口。下面我们将基于这三者探讨窗口的实现机制。</p>
<h1 id="window-的实现">Window 的实现</h1>
<p>下图描述了 Flink 的窗口机制以及各组件之间是如何相互工作的。</p>
<figure>
<img src="/2023/12/14/Flink-%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0-Window-%E6%9C%BA%E5%88%B6/组件交互.png" alt="组件交互">
<figcaption aria-hidden="true">组件交互</figcaption>
</figure>
<p>首先上图中的组件都位于一个算子（window
operator）中，数据流源源不断地进入算子，每一个到达的元素都会被交给
WindowAssigner。WindowAssigner
会决定元素被放到哪个或哪些窗口（window），可能会创建新窗口。因为一个元素可以被放入多个窗口中，所以同时存在多个窗口是可能的。注意，Window本身只是一个ID标识符，其内部可能存储了一些元数据，如TimeWindow中有开始和结束时间，但是并不会存储窗口中的元素。窗口中的元素实际存储在
Key/Value State
中，key为Window，value为元素集合（或聚合值）。为了保证窗口的容错性，该实现依赖了
Flink 的 State 机制（参见 <a target="_blank" rel="noopener" href="https://ci.apache.org/projects/flink/flink-docs-master/apis/streaming/state.html?spm=a2c6h.12873639.article-detail.8.571d3dd5xKjhTf">state
文档</a>）。</p>
<p>每一个窗口都拥有一个属于自己的
Trigger，Trigger上会有定时器，用来决定一个窗口何时能够被计算或清除。每当有元素加入到该窗口，或者之前注册的定时器超时了，那么Trigger都会被调用。Trigger的返回结果可以是
continue（不做任何操作），fire（处理窗口数据），purge（移除窗口和窗口中的数据），或者
fire +
purge。一个Trigger的调用结果只是fire的话，那么会计算窗口并保留窗口原样，也就是说窗口中的数据仍然保留不变，等待下次Trigger
fire的时候再次执行计算。一个窗口可以被重复计算多次直到它被 purge
了。在purge之前，窗口会一直占用着内存。</p>
<p>当Trigger
fire了，窗口中的元素集合就会交给Evictor（如果指定了的话）。Evictor
主要用来遍历窗口中的元素列表，并决定最先进入窗口的多少个元素需要被移除。剩余的元素会交给用户指定的函数进行窗口的计算。如果没有
Evictor 的话，窗口中的所有元素会一起交给函数进行计算。</p>
<p>计算函数收到了窗口的元素（可能经过了 Evictor
的过滤），并计算出窗口的结果值，并发送给下游。窗口的结果值可以是一个也可以是多个。DataStream
API 上可以接收不同类型的计算函数，包括预定义的sum(),min(),max()，还有
ReduceFunction，FoldFunction，还有WindowFunction。WindowFunction
是最通用的计算函数，其他的预定义的函数基本都是基于该函数实现的。</p>
<p>Flink
对于一些聚合类的窗口计算（如sum,min）做了优化，因为聚合类的计算不需要将窗口中的所有数据都保存下来，只需要保存一个result值就可以了。每个进入窗口的元素都会执行一次聚合函数并修改result值。这样可以大大降低内存的消耗并提升性能。但是如果用户定义了
Evictor，则不会启用对聚合窗口的优化，因为 Evictor
需要遍历窗口中的所有元素，必须要将窗口中所有元素都存下来。</p>
<h1 id="源码分析">源码分析</h1>
<p>上述的三个组件构成了 Flink
的窗口机制。为了更清楚地描述窗口机制，以及解开一些疑惑（比如 purge 和
Evictor 的区别和用途），我们将一步步地解释 Flink 内置的一些窗口（Time
Window，Count Window，Session Window）是如何实现的。</p>
<h2 id="count-window-实现">Count Window 实现</h2>
<p>Count Window 是使用三组件的典范，我们可以在 KeyedStream 上创建 Count
Window，其源码如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tumbling count window</span></span><br><span class="line"><span class="keyword">public</span> WindowedStream&lt;T, KEY, GlobalWindow&gt; <span class="title function_">countWindow</span><span class="params">(<span class="type">long</span> size)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> window(GlobalWindows.create())  <span class="comment">// create window stream using GlobalWindows</span></span><br><span class="line">        .trigger(PurgingTrigger.of(CountTrigger.of(size))); <span class="comment">// trigger is window size</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// sliding count window</span></span><br><span class="line"><span class="keyword">public</span> WindowedStream&lt;T, KEY, GlobalWindow&gt; <span class="title function_">countWindow</span><span class="params">(<span class="type">long</span> size, <span class="type">long</span> slide)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> window(GlobalWindows.create())</span><br><span class="line">        .evictor(CountEvictor.of(size))  <span class="comment">// evictor is window size</span></span><br><span class="line">        .trigger(CountTrigger.of(slide)); <span class="comment">// trigger is slide size</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第一个函数是申请翻滚计数窗口，参数为窗口大小。第二个函数是申请滑动计数窗口，参数分别为窗口大小和滑动大小。它们都是基于
GlobalWindows 这个 WindowAssigner
来创建的窗口，该assigner会将所有元素都分配到同一个global
window中，所有GlobalWindows的返回值一直是 GlobalWindow
单例。基本上自定义的窗口都会基于该assigner实现。</p>
<p>翻滚计数窗口并不带evictor，只注册了一个trigger。该trigger是带purge功能的
CountTrigger。也就是说每当窗口中的元素数量达到了
window-size，trigger就会返回fire+purge，窗口就会执行计算并清空窗口中的所有元素，再接着储备新的元素。从而实现了tumbling的窗口之间无重叠。</p>
<p>滑动计数窗口的各窗口之间是有重叠的，但我们用的 GlobalWindows assinger
从始至终只有一个窗口，不像 sliding time assigner
可以同时存在多个窗口。所以trigger结果不能带purge，也就是说计算完窗口后窗口中的数据要保留下来（供下个滑窗使用）。另外，trigger的间隔是slide-size，evictor的保留的元素个数是window-size。也就是说，每个滑动间隔就触发一次窗口计算，并保留下最新进入窗口的window-size个元素，剔除旧元素。</p>
<p>假设有一个滑动计数窗口，每2个元素计算一次最近4个元素的总和，那么窗口工作示意图如下所示：</p>
<figure>
<img src="/2023/12/14/Flink-%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0-Window-%E6%9C%BA%E5%88%B6/窗口工作示意图.png" alt="窗口工作示意图">
<figcaption aria-hidden="true">窗口工作示意图</figcaption>
</figure>
<p>图中所示的各个窗口逻辑上是不同的窗口，但在物理上是同一个窗口。该滑动计数窗口，trigger的触发条件是元素个数达到2个（每进入2个元素就会触发一次），evictor保留的元素个数是4个，每次计算完窗口总和后会保留剩余的元素。所以第一次触发trigger是当元素5进入，第三次触发trigger是当元素2进入，并驱逐5和2，计算剩余的4个元素的总和（22）并发送出去，保留下2,4,9,7元素供下个逻辑窗口使用。</p>
<h2 id="time-window-实现">Time Window 实现</h2>
<p>同样的，我们也可以在 KeyedStream 上申请 Time
Window，其源码如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tumbling time window</span></span><br><span class="line"><span class="keyword">public</span> WindowedStream&lt;T, KEY, TimeWindow&gt; <span class="title function_">timeWindow</span><span class="params">(Time size)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (environment.getStreamTimeCharacteristic() == TimeCharacteristic.ProcessingTime) &#123;</span><br><span class="line">        <span class="keyword">return</span> window(TumblingProcessingTimeWindows.of(size));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> window(TumblingEventTimeWindows.of(size));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// sliding time window</span></span><br><span class="line"><span class="keyword">public</span> WindowedStream&lt;T, KEY, TimeWindow&gt; <span class="title function_">timeWindow</span><span class="params">(Time size, Time slide)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (environment.getStreamTimeCharacteristic() == TimeCharacteristic.ProcessingTime) &#123;</span><br><span class="line">        <span class="keyword">return</span> window(SlidingProcessingTimeWindows.of(size, slide));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> window(SlidingEventTimeWindows.of(size, slide));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在方法体内部会根据当前环境注册的时间类型，使用不同的WindowAssigner创建window。可以看到，EventTime和IngestTime都使用了XXXEventTimeWindows这个assigner，因为EventTime和IngestTime在底层的实现上只是在Source处为Record打时间戳的实现不同，在window
operator中的处理逻辑是一样的。</p>
<p>这里我们主要分析sliding process time window，如下是相关源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SlidingProcessingTimeWindows</span> <span class="keyword">extends</span> <span class="title class_">WindowAssigner</span>&lt;Object, TimeWindow&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> slide;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SlidingProcessingTimeWindows</span><span class="params">(<span class="type">long</span> size, <span class="type">long</span> slide)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.size = size;</span><br><span class="line">        <span class="built_in">this</span>.slide = slide;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;TimeWindow&gt; <span class="title function_">assignWindows</span><span class="params">(Object element, <span class="type">long</span> timestamp)</span> &#123;</span><br><span class="line">        timestamp = System.currentTimeMillis();</span><br><span class="line">        List&lt;TimeWindow&gt; windows = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;((<span class="type">int</span>) (size / slide));</span><br><span class="line">        <span class="comment">// 对齐时间戳</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">lastStart</span> <span class="operator">=</span> timestamp - timestamp % slide;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> lastStart;</span><br><span class="line">            start &gt; timestamp - size;</span><br><span class="line">            start -= slide) &#123;</span><br><span class="line">            <span class="comment">// 当前时间戳对应了多个window</span></span><br><span class="line">            windows.add(<span class="keyword">new</span> <span class="title class_">TimeWindow</span>(start, start + size));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> windows;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProcessingTimeTrigger</span> <span class="keyword">extends</span> <span class="title class_">Trigger</span>&lt;Object, TimeWindow&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">// 每个元素进入窗口都会调用该方法</span></span><br><span class="line">    <span class="keyword">public</span> TriggerResult <span class="title function_">onElement</span><span class="params">(Object element, <span class="type">long</span> timestamp, TimeWindow window, TriggerContext ctx)</span> &#123;</span><br><span class="line">        <span class="comment">// 注册定时器，当系统时间到达window end timestamp时会回调该trigger的onProcessingTime方法</span></span><br><span class="line">        ctx.registerProcessingTimeTimer(window.getEnd());</span><br><span class="line">        <span class="keyword">return</span> TriggerResult.CONTINUE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">// 返回结果表示执行窗口计算并清空窗口</span></span><br><span class="line">    <span class="keyword">public</span> TriggerResult <span class="title function_">onProcessingTime</span><span class="params">(<span class="type">long</span> time, TimeWindow window, TriggerContext ctx)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> TriggerResult.FIRE_AND_PURGE;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先，SlidingProcessingTimeWindows会对每个进入窗口的元素根据系统时间分配到(size
/
slide)个不同的窗口，并会在每个窗口上根据窗口结束时间注册一个定时器（相同窗口只会注册一份），当定时器超时时意味着该窗口完成了，这时会回调对应窗口的Trigger的onProcessingTime方法，返回FIRE_AND_PURGE，也就是会执行窗口计算并清空窗口。整个过程示意图如下：</p>
<figure>
<img src="/2023/12/14/Flink-%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0-Window-%E6%9C%BA%E5%88%B6/202312141604.png" alt="示意图">
<figcaption aria-hidden="true">示意图</figcaption>
</figure>
<p>如上图所示横轴代表时间戳（为简化问题，时间戳从0开始），第一条record会被分配到[-5,5)和[0,10)两个窗口中，当系统时间到5时，就会计算[-5,5)窗口中的数据，并将结果发送出去，最后清空窗口中的数据，释放该窗口资源。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.blockchainof.com/2023/12/06/Storm%E3%80%81Spark%E4%B8%8EFlink%E5%AF%B9%E6%AF%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="暂留白">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="自留地">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/12/06/Storm%E3%80%81Spark%E4%B8%8EFlink%E5%AF%B9%E6%AF%94/" class="post-title-link" itemprop="url">Storm、Spark与Flink对比</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-12-06 16:06:42" itemprop="dateCreated datePublished" datetime="2023-12-06T16:06:42+08:00">2023-12-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-12-08 11:43:04" itemprop="dateModified" datetime="2023-12-08T11:43:04+08:00">2023-12-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/Flink/" itemprop="url" rel="index"><span itemprop="name">Flink</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="引言">引言</h1>
<p>Apache Flink(以下简称flink) 是一个旨在提供‘一站式’
的分布式开源数据处理框架。和Spark的目标一样，都希望提供一个统一功能的计算平台给用户。虽然目标非常类似，但是flink在实现上和spark存在着很大的区别，flink是一个面向流的处理框架，输入在flink中是无界的，流数据是flink中的头等公民。这方面flink和storm有几分相似。那么有spark和storm这样成熟的计算框架存在，为什么flink还能占有一席之地呢？今天我们就从流处理的角度将flink和这两个框架进行一些分析和比较。</p>
<h1 id="名词解析">名词解析</h1>
<table>
<colgroup>
<col style="width: 33%">
<col style="width: 16%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>名词</th>
<th>说明</th>
<th>举例</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>无边界数据</td>
<td>无边界数据通常指的是无限持续生成的数据流，没有明确定义的终点。这样的数据流可能是实时生成的事件、传感器数据、日志记录等，它们源源不断地产生，没有固定的结束点。</td>
<td>实时传感器数据，如温度传感器、网络日志，用户点击事件流等。这些数据是持续不断生成的，流式处理系统需要实时处理并适应新的数据产生。</td>
</tr>
<tr class="even">
<td>有边界数据</td>
<td>有边界数据是有明确定义的开始和结束点的数据集。这样的数据集在某一时刻是完整的，不再发生变化。传统的批处理任务就是对有边界数据进行处理的典型例子。</td>
<td>关系数据库中的表、存储在文件中的数据集等。这些数据集在某一时刻是完整的，可以通过一次性加载到内存中进行批处理分析。</td>
</tr>
<tr class="odd">
<td>Exactly-Once 语义</td>
<td>精确一次（Exactly-Once）处理语义，确保在出现故障或恢复时不会丢失或重复处理事件。这是保证数据处理的一致性的重要特性。</td>
<td></td>
</tr>
<tr class="even">
<td>有状态计算</td>
<td>有状态的计算指能够处理具有记忆和上下文关联的计算任务。这对于处理事件序列、实时聚合和复杂的模式匹配非常有用。</td>
<td></td>
</tr>
<tr class="odd">
<td>Sink</td>
<td>Sink是Flink中一种用于将数据从流处理应用程序发送到外部系统的组件，用于定义数据的最终目的地</td>
<td>File Sink（文件输出）; Kafka Sink; Elasticsearch Sink; JDBC Sink;
Custom Sink;</td>
</tr>
</tbody>
</table>
<h1 id="流框架基于的实现方式">流框架基于的实现方式</h1>
<p>本文涉及的流框架基于的实现方式分为两大类。</p>
<ul>
<li><p>第一类是Native
Streaming，这类引擎中所有的data在到来的时候就会被立即处理，一条接着一条（HINT：
狭隘的来说是一条接着一条，但流引擎有时会为提高性能缓存一小部分data然后一次性处理），其中的代表就是storm和flink。</p></li>
<li><p>第二类则是基于Micro-batch，数据流被切分为一个一个小的批次，
然后再逐个被引擎处理。这些batch一般是以时间为单位进行切分，单位一般是‘秒‘，其中的典型代表则是spark了，不论是老的spark
DStream还是2.0以后推出的spark structured
streaming都是这样的处理机制；另外一个基于Micro-batch实现的就是storm
trident，它是对storm的更高层的抽象，因为以batch为单位，所以storm
trident的一些处理变得简单且高效。</p></li>
</ul>
<figure>
<img src="/2023/12/06/Storm%E3%80%81Spark%E4%B8%8EFlink%E5%AF%B9%E6%AF%94/Snipaste_2023-12-06_17-54-25.png" alt="分类">
<figcaption aria-hidden="true">分类</figcaption>
</figure>
<h1 id="流框架比较的关键指标">流框架比较的关键指标</h1>
<p>从流处理的角度将flink与spark和storm这两个框架进行比较，会主要关注以下几点，后续的对比也主要基于这几点展开：</p>
<ul>
<li><p>功能性（Functionality）- 是否能很好解决流处理功能上的痛点 ,
比如event time和out of order data。</p></li>
<li><p>容错性（Fault Tolerance） -
在failure之后能否恢复到故障之前的状态，并输出一致的结果；此外容错的代价也是越低越好，因为其直接影响性能。</p></li>
<li><p>吞吐量(throughputs)&amp; 延时(latency) -
性能相关的指标，高吞吐和低延迟某种意义上是不可兼得的，但好的流引擎应能兼顾高吞吐&amp;低延时。</p></li>
</ul>
<h1 id="功能性">功能性</h1>
<h2 id="各类时间的定义">各类时间的定义</h2>
<p><a target="_blank" rel="noopener" href="https://nightlies.apache.org/flink/flink-docs-release-1.2/dev/event_time.html">flink文档中关于各种时间的定义</a>
- Event time:
指数据或事件真正发生时间，比如用户点击网页时产生一条点击事件的数据，点击时间就是这条数据固有的Event
time。理解为每个单独事件在其产生设备上发生的时间。 - Processing time:
指计算框架处理这条数据的时间 - Ingestion Time: 摄入时间是事件进入 Flink
的时间。</p>
<pre><code>![时钟](./Storm、Spark与Flink对比/times_clocks.svg)

spark DStream和storm 1.0以前版本往往都折中地使用processing time来近似地实现event time相关的业务。显然，使用processing time模拟event time必然会产生一些误差， 特别是在产生数据堆积的时候，误差则更明显，甚至导致计算结果不可用。

在使用event time时，自然而然需要解决由网络延迟等因素导致的迟到或者乱序数据的问题。为了解决这个问题， spark、storm及flink都参考[streaming 102](https://www.oreilly.com/radar/the-world-beyond-batch-streaming-102/)引入了watermark和lateness的概念。</code></pre>
<ul>
<li><p>watermark:
是引擎处理事件的时间进度，代表一种状态，一般随着数据中的event
time的增长而增长。比如 watermark(t)代表整个流的event
time处理进度已经到达t，
时间是有序的，那么streaming不应该会再收到timestamp t’ &lt;
t的数据，而只会接受到timestamp t’ &gt;= t的数据。 如果收到一条timestamp
t’ &lt; t的数据， 那么就说明这条数据是迟到的。</p></li>
<li><p>lateness:
表示可以容忍迟到的程度，在lateness可容忍范围内的数据还会参与计算，超过的会被丢弃。</p></li>
</ul>
<h2 id="窗口操作">窗口操作</h2>
<h3 id="spark-structured-streaming-和flink对event-time处理机制的比较">spark
structured streaming 和flink对event time处理机制的比较</h3>
<ul>
<li><p>Flink</p>
<p>首先，我们结合图来看flink， 时间轴从左往右增大。当watermark WM处于时
间窗口区间内时，即WM ∈ [start, end] , event
time落在窗口范围内的任何乱序数据都会被接受；随着WM的增长并超过了窗口的结束时间，但还未超过可容忍的lateness时间范围，即WM
∈ (window_end,window_end+ lateness]， 这时乱序数据仍然可以被接受；
只有当WM超过 window_end+lateness, 即WM ∈ (window_end+ lateness, ∞)，
迟到的数据将会被丢弃。</p>
<figure>
<img src="/2023/12/06/Storm%E3%80%81Spark%E4%B8%8EFlink%E5%AF%B9%E6%AF%94/handle-late-records.jpg" alt="handle-late-records">
<figcaption aria-hidden="true">handle-late-records</figcaption>
</figure>
<p>fiink中watermark的计算也比较灵活，可以选择build-in的（如最大时间戳），也可以通过继承接口自定义实现。此外，用户可以选择周期性更新或者事件触发更新watermark。</p></li>
<li><p>Spark</p>
<p>首先,spark中watermark是通过上一个batch最大的timestamp再减去lateness得到的，即watermark
= Max(last batch timestamps) - lateness。当数据的event
time大于watermark时，数据会被接受，否则不论这条数据属于哪个窗口都会被丢弃。细节请参考<a target="_blank" rel="noopener" href="https://spark.apache.org/docs/latest/structured-streaming-programming-guide.html#window-operations-on-event-time">Window
Operations on Event Time</a></p></li>
</ul>
<p>下面来比较一下两者实现细节上的不同：</p>
<ul>
<li><p>lateness定义: 在spark中，迟到被定义为data的event
time和watermark的比较结果，当data的event time &lt;
watermark时，data被丢弃；flink中只有在watermark &gt; window_end +
lateness的时候，data才会被丢弃。</p></li>
<li><p>watermark更新: spark中watermark是上个batch中的max event
time，存在延迟；而在flink中是可以做到每条数据同步更新watermark。</p></li>
<li><p>window触发: flink中window计算会触发一次或多次，第一次在watermark
&gt;= window_end后立刻触发（main
fire），接着会在迟到数据到来后进行增量触发。spark只会在watermark（包含lateness）过了window_end之后才会触发，虽然计算结果一次性正确，但触发比flink起码多了一个lateness的延迟。</p></li>
</ul>
<p>上面三点可见flink在设计event
time处理模型还是较优的：watermark的计算实时性高，输出延迟低，而且接受迟到数据没有spark那么受限。</p>
<h3 id="sql-api方面的对比">SQL API方面的对比</h3>
<p>待续，网上资料都是较老版本的比对，不太准确，等自己实践过再来总结吧</p>
<h3 id="kafka-集成">Kafka 集成</h3>
<p>待续</p>
<h3 id="静态数据操作">静态数据操作</h3>
<p>待续</p>
<h1 id="吞吐量">吞吐量</h1>
<p>待续</p>
<h1 id="总结">总结</h1>
<p>待续</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">暂留白</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">100</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">210</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">暂留白</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>
-->

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>











<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
