[{"title":"pythonæœ¬åœ°å¼€å‘åŒ…çš„å®‰è£…","url":"/2025/05/12/pythonæœ¬åœ°å¼€å‘åŒ…çš„å®‰è£…/","content":"\n# pip install -e .\n\n`pip install -e .`çš„ä½œç”¨æ˜¯ä»¥â€œå¯ç¼–è¾‘æ¨¡å¼â€å®‰è£…å½“å‰ç›®å½•ä¸‹çš„PythonåŒ…ã€‚è¿™æ˜¯Pythoné¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­å¸¸ç”¨çš„æ“ä½œã€‚\n\n### **ğŸ“Œ å…·ä½“è§£é‡Šå¦‚ä¸‹ï¼š**\n\n- pipï¼šPython çš„åŒ…ç®¡ç†å·¥å…·ã€‚\n- installï¼šè¡¨ç¤ºä½ è¦å®‰è£…æŸä¸ªåŒ…ã€‚\n- -e æˆ– --editableï¼šè¡¨ç¤ºâ€œå¯ç¼–è¾‘â€æ¨¡å¼ï¼ˆeditable modeï¼‰ã€‚\n- .ï¼šæŒ‡å½“å‰ç›®å½•ï¼Œæ„æ€æ˜¯å®‰è£…å½“å‰ç›®å½•ä¸‹çš„åŒ…ã€‚\n\n### **ğŸ”§ å…¸å‹åº”ç”¨åœºæ™¯ï¼š**\n```shell\n\nmy_project/\nâ”œâ”€â”€ setup.py\nâ”œâ”€â”€ my_package/\nâ”‚   â””â”€â”€ __init__.py\n\n```\n\nä½ åœ¨ `my_project`ç›®å½•ä¸‹æ‰§è¡Œï¼š\n\n```shell\npip install -e .\n```\n\nè¿™æ—¶ï¼ŒPython ä¼šï¼š\n\n1. **è¯»å– setup.py æ¥å®‰è£…è¿™ä¸ªåŒ…**ã€‚\n2. **åˆ›å»ºä¸€ä¸ªæŒ‡å‘æºä»£ç ç›®å½•çš„ç¬¦å·é“¾æ¥**ï¼ˆè€Œä¸æ˜¯å¤åˆ¶ä»£ç ï¼‰ã€‚\n3. ä½ ä¿®æ”¹ my_package/ ä¸­çš„ä»£ç åï¼Œ**ä¸éœ€è¦é‡æ–°å®‰è£…åŒ…**ï¼Œä¿®æ”¹ç«‹åˆ»ç”Ÿæ•ˆã€‚\n\n### **âœ… é€‚åˆï¼š**\n\n- æ­£åœ¨å¼€å‘æˆ–è°ƒè¯•ä¸€ä¸ª Python åŒ…ã€‚\n- å¸Œæœ›ä¿®æ”¹ä»£ç åç«‹å³çœ‹åˆ°æ•ˆæœã€‚\n\n### **ğŸ†š æ™®é€šå®‰è£… (pip install .) åŒºåˆ«ï¼š**\n\n| **å‘½ä»¤**         | **æ˜¯å¦å¤åˆ¶ä»£ç ** | **ä¿®æ”¹æºç æ˜¯å¦è‡ªåŠ¨ç”Ÿæ•ˆ** | **åœºæ™¯**     |\n| ---------------- | ---------------- | ------------------------ | ------------ |\n| pip install .    | âœ… æ˜¯             | âŒ å¦                     | ç”Ÿäº§ç¯å¢ƒ     |\n| pip install -e . | âŒ å¦             | âœ… æ˜¯                     | å¼€å‘è°ƒè¯•é˜¶æ®µ |\n\n# ä½¿ç”¨åœºæ™¯ä¾‹å­\n\n## **ğŸ§© åœºæ™¯è¯´æ˜**\n\n- **A é¡¹ç›®ç›®å½•**ï¼š/path/to/project-Aï¼ˆç”¨ uv ç®¡ç†ï¼‰\n- **B åŒ…ç›®å½•**ï¼š/path/to/project-Bï¼ˆä½ åœ¨å¼€å‘çš„åŒ…ï¼‰\n- ä½ å¸Œæœ›åœ¨ A é¡¹ç›®ä¸­ä½¿ç”¨ B åŒ…ï¼Œå¹¶ä¸” **ä¿®æ”¹ B çš„ä»£ç å A èƒ½ç«‹åˆ»ç”Ÿæ•ˆ**ï¼ˆå³â€œå¯ç¼–è¾‘æ¨¡å¼â€ï¼‰\n\n## **âœ… æ­¥éª¤**\n\n### **1. ç¡®ä¿ B åŒ…ç»“æ„åˆæ³•**\n\nç¡®ä¿ project-B/ ä¸‹æœ‰ pyproject.toml æˆ– setup.pyï¼ˆæ¨èä½¿ç”¨ pyproject.tomlï¼‰ï¼š\n\n```toml\n[project]\nname = \"my-b-package\"\nversion = \"0.1.0\"\ndependencies = []\n\n[build-system]\nrequires = [\"setuptools\"]\nbuild-backend = \"setuptools.build_meta\"\n```\n\nå¦‚æœæ˜¯ setup.pyï¼š\n\n```python\nfrom setuptools import setup, find_packages\n\nsetup(\n    name=\"my-b-package\",\n    version=\"0.1.0\",\n    packages=find_packages(),\n)\n```\n\n### **2. è¿›å…¥ A é¡¹ç›®çš„æ ¹ç›®å½•**\n\n```shell\ncd /path/to/project-A\n```\n\n### **3. å¯ç”¨ uv çš„è™šæ‹Ÿç¯å¢ƒ**\n\nå¦‚æœä½ ä¸ä½¿ç”¨uvï¼Œè¿™ä¸€æ­¥è·³è¿‡\n\n```shell\nsource .venv/bin/activate\n```\n\n### **4. å®‰è£… B åŒ…ä¸ºå¯ç¼–è¾‘æ¨¡å¼**\n\n```bash\npip install -e /path/to/project-B\n```\n\n### **5. åœ¨ A é¡¹ç›®çš„ä»£ç ä¸­ä½¿ç”¨ B åŒ…**\n\n```python\nfrom my_b_package import some_module\n```\n\n\n\n## **ğŸ“Œ è¡¥å……ï¼šç‰ˆæœ¬ç®¡ç†æ–¹å¼**\n\nä½ å¯ä»¥æŠŠè¿™ä¸ªä¾èµ–å†™è¿› A é¡¹ç›®çš„ requirements.txt æˆ– pyproject.toml ä¸­ï¼Œä¾‹å¦‚ï¼š\n\n### **requirements.txt**\n\n###  **ç¤ºä¾‹ï¼š**\n\n```\n-e /path/to/project-B\n```\n\n","tags":["uv","install"],"categories":["Python","åŸºç¡€"]},{"title":"Tikzç»˜åˆ¶æ¯•è¾¾å“¥æ‹‰æ–¯æ ‘","url":"/2025/05/08/Tikzç»˜åˆ¶æ¯•è¾¾å“¥æ‹‰æ–¯æ ‘/","content":"\n# èƒŒæ™¯\n\nåœ¨æ•´ç†ä¸­è€ƒæ•°å­¦æŠ¼è½´é¢˜é›†æ—¶ï¼Œæƒ³ç”¨tikzç»˜åˆ¶å°é¢å›¾æ¡ˆã€‚ç”±æ­¤æœ‰äº†ä»¥ä¸‹ä»£ç ã€‚\n\n# ä»£ç \n\n```latex\n\\documentclass[tikz,border=3mm]{standalone}\n\\usepackage{xcolor}\n\\usetikzlibrary{backgrounds} % ç”¨äºèƒŒæ™¯çŸ©å½¢\n% å®šä¹‰æœ€å¤§æ·±åº¦\n\\newcommand{\\MaxDepth}{12}\n% é€’å½’å®ï¼š\\PythagorasTree{å±‚æ•°}{æ—‹è½¬è§’åº¦}\n\\newcommand{\\PythagorasTree}[2]{%\n  \\ifnum#1=0\n    % é€’å½’ç»ˆæ­¢\n  \\else\n    % è®¡ç®—å½“å‰æ·±åº¦æ¯”ä¾‹ tï¼Œå¹¶çº¿æ€§æ’å€¼ RGB é¢œè‰²\n    \\pgfmathsetmacro{\\t}{#1/\\MaxDepth}\n    \\pgfmathsetmacro{\\r}{\\t}\n    \\pgfmathsetmacro{\\g}{0.5+0.5*\\t}\n    \\pgfmathsetmacro{\\b}{0.5*(1-\\t)}\n    \\definecolor{MyColor}{rgb}{\\r,\\g,\\b}\n    % ç»˜åˆ¶å½“å‰æ­£æ–¹å½¢ï¼Œè®¾ç½®å¡«å……è‰²å’Œè¾¹æ¡†è‰²\n    \\draw[draw=MyColor,fill=MyColor] (0,0) rectangle (1,1);\n    % è®¡ç®—ä¸‹ä¸€å±‚æ·±åº¦\n    \\pgfmathtruncatemacro{\\next}{#1-1}\n    % å·¦åˆ†æ”¯ï¼šå‘ä¸Šå¹³ç§»1ï¼Œé¡ºæ—¶é’ˆæ—‹è½¬ #2 åº¦ï¼ŒæŒ‰ cos(#2) ç¼©æ”¾\n    \\begin{scope}[yshift=1cm, rotate=#2, scale={cos(#2)}]\n      \\PythagorasTree{\\next}{#2}\n    \\end{scope}\n    % å³åˆ†æ”¯ï¼šé€‚å½“å¹³ç§»åˆ°å³ä¸Šè§’ä½ç½®ï¼Œé€†æ—¶é’ˆæ—‹è½¬ (90-#2) åº¦ï¼ŒæŒ‰ sin(#2) ç¼©æ”¾\n    \\begin{scope}[\n      yshift={1cm*(1+sin(#2)*cos(#2))},\n      xshift={1cm*(cos(#2)*cos(#2))},\n      rotate={#2-90}, scale={sin(#2)}]\n      \\PythagorasTree{\\next}{#2}\n    \\end{scope}\n  \\fi\n}\n\n\\begin{document}\n\\begin{tikzpicture}[scale=1.5,\n    background rectangle/.style={fill=black}, show background rectangle]\n  % ä»æ·±åº¦ \\MaxDepth å¼€å§‹ï¼Œè§’åº¦è®¾ä¸º 45Â°\n  \\PythagorasTree{\\MaxDepth}{45}\n\\end{tikzpicture}\n\\end{document}\n```\n\n"},{"title":"pyenvå®‰è£…pythonå‘","url":"/2025/04/23/pyenvå®‰è£…pythonå‘/","content":"\n# ç¯å¢ƒï¼š\n\n- pyenv 2.3.27\n- CentOS Linux release 7.9.2009 (Core)\n\n# å®‰è£…\n\næŸ¥çœ‹èƒ½å®‰è£…çš„pythonæ¸…å•ï¼š\n\n```shell\npyenv install --list\n```\n\nå…ˆæ‹©å…¶ä¸­ä¹‹ä¸€å®‰è£…ï¼š\n\n```shell\npyenv install 3.10.13\n```\n\nå‘ï¼š\n\n```shell\npyenv install 3.10.13\nInstalling Python-3.10.13...\nTraceback (most recent call last):\n  File \"<string>\", line 1, in <module>\n  File \"/home/centos/.pyenv/versions/3.10.13/lib/python3.10/ssl.py\", line 99, in <module>\n    import _ssl             # if we can't import it, let the error propagate\nModuleNotFoundError: No module named '_ssl'\nERROR: The Python ssl extension was not compiled. Missing the OpenSSL lib?\n\nPlease consult to the Wiki page to fix the problem.\nhttps://github.com/pyenv/pyenv/wiki/Common-build-problems\n\nBUILD FAILED (CentOS Linux 7 using python-build 20180424)\n\nInspect or clean up the working tree at /tmp/python-build.20250423005759.24631\nResults logged to /tmp/python-build.20250423005759.24631.log\n\nLast 10 log lines:\n\tLD_LIBRARY_PATH=/tmp/python-build.20250423005759.24631/Python-3.10.13:/opt/rh/devtoolset-8/root/usr/lib64:/opt/rh/devtoolset-8/root/usr/lib:/opt/rh/devtoolset-8/root/usr/lib64/dyninst:/opt/rh/devtoolset-8/root/usr/lib/dyninst:/opt/rh/devtoolset-8/root/usr/lib64:/opt/rh/devtoolset-8/root/usr/lib ./python -E -m ensurepip \\\n\t\t$ensurepip --root=/ ; \\\nfi\nLooking in links: /tmp/tmp7v915qb4\nProcessing /tmp/tmp7v915qb4/setuptools-65.5.0-py3-none-any.whl\nProcessing /tmp/tmp7v915qb4/pip-23.0.1-py3-none-any.whl\nInstalling collected packages: setuptools, pip\n  WARNING: The scripts pip3 and pip3.10 are installed in '/home/centos/.pyenv/versions/3.10.13/bin' which is not on PATH.\n  Consider adding this directory to PATH or, if you prefer to suppress this warning, use --no-warn-script-location.\nSuccessfully installed pip-23.0.1 setuptools-65.5.0\n```\n\næŠŠä¾èµ–å®‰è£…ä¸Š(ä½†å®é™…ä¸Šå¹¶ä¸æ˜¯é—®é¢˜çš„æœ¬è´¨)ï¼š\n\n```shell\n# å®‰è£…ä¾èµ–\nsudo yum install -y gcc zlib-devel bzip2 bzip2-devel readline-devel sqlite sqlite-devel \\\n    openssl-devel xz xz-devel libffi-devel wget make\n\n# ç„¶åé‡æ–°å®‰è£… Python\npyenv install 3.10.13\n```\n\nè¿˜æ˜¯ä¸€æ ·å‡ºé”™ã€‚æŸ¥ä¸€ä¸‹opensslç‰ˆæœ¬ï¼š\n\n```shell\nopenssl --version\nOpenSSL 3.3.0-dev  (Library: OpenSSL 3.3.0-dev )\n```\n\nåˆ†æé—®é¢˜åŸå› å¯èƒ½æ„å»ºç¯å¢ƒä¸­ **OpenSSL ç‰ˆæœ¬ä¸ç¬¦åˆè¦æ±‚ï¼Œæˆ–è€… Python æ²¡æœ‰æ­£ç¡®é“¾æ¥åˆ° OpenSSL åº“è·¯å¾„**ã€‚å…¶å®å¯ä»¥å»åˆ†æ` log æ–‡ä»¶ /tmp/python-build.*.log`æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ã€‚\n\nå†™ä¸€ä¸ªè„šæœ¬è‡ªå·±ä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„opensslæ¥ç¼–è¯‘ï¼Œç„¶åæŒ‡å®šopensslè·¯å¾„ï¼›å†ä½¿ç”¨pyenv å®‰è£…python å§ã€‚`install_openssl_for_pyenv.sh`\n\n```shell\n#!/bin/bash\n\nset -e\n\nOPENSSL_VERSION=\"1.1.1w\"\nOPENSSL_DIR=\"/opt/openssl-$OPENSSL_VERSION\"\n\necho \"ğŸ“¦ å¼€å§‹å®‰è£… OpenSSL $OPENSSL_VERSION åˆ° $OPENSSL_DIR\"\n\n# å®‰è£…å¿…è¦ä¾èµ–\necho \"ğŸ”§ å®‰è£…ä¾èµ–åŒ…...\"\nsudo yum install -y gcc make zlib-devel perl wget tar\n\n# ä¸‹è½½ OpenSSL æºç \ncd /usr/local/src\nif [ -f \"openssl-$OPENSSL_VERSION.tar.gz\" ]; then\n    echo \"âœ… å·²ä¸‹è½½ openssl-$OPENSSL_VERSION.tar.gz\"\nelse\n    echo \"â¬‡ï¸ ä¸‹è½½ OpenSSL æºç ...\"\n    wget https://www.openssl.org/source/openssl-$OPENSSL_VERSION.tar.gz\nfi\n\n# è§£å‹\necho \"ğŸ“‚ è§£å‹æºç ...\"\nsudo rm -rf openssl-$OPENSSL_VERSION\nsudo tar -xzf openssl-$OPENSSL_VERSION.tar.gz\n\n# ç¼–è¯‘å®‰è£…\ncd openssl-$OPENSSL_VERSION\nsudo ./config --prefix=$OPENSSL_DIR --openssldir=$OPENSSL_DIR shared zlib\nsudo make -j$(nproc)\nsudo make install\n\n# è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆä»…å½“å‰ shell ç”Ÿæ•ˆï¼‰\necho \"ğŸŒ¿ è®¾ç½®ç¯å¢ƒå˜é‡ä¾› pyenv ä½¿ç”¨...\"\nexport LDFLAGS=\"-L$OPENSSL_DIR/lib\"\nexport CPPFLAGS=\"-I$OPENSSL_DIR/include\"\nexport PKG_CONFIG_PATH=\"$OPENSSL_DIR/lib/pkgconfig\"\nexport LD_LIBRARY_PATH=\"$OPENSSL_DIR/lib\"\n\necho \"\"\necho \"âœ… OpenSSL $OPENSSL_VERSION å®‰è£…å®Œæˆï¼\"\n\necho \"\"\necho \"ğŸ“Œ è¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… Pythonï¼ˆç¡®ä¿å·²åŠ è½½ä¸Šè¿°å˜é‡ï¼‰ï¼š\"\necho \"\"\necho \"  pyenv install 3.10.13\"\necho \"\"\necho \"ğŸ§  æç¤ºï¼šä½ å¯ä»¥å°†è¿™äº› export å‘½ä»¤å†™å…¥ ~/.bashrc æˆ– ~/.bash_profile ä»¥ä¾¿æ°¸ä¹…ç”Ÿæ•ˆã€‚\"\n```\n\næ‰§è¡Œä¸Šè¿°è„šæœ¬ï¼š\n\n```shell\nsudo bash install_openssl_for_pyenv.sh\n```\n\nå†æ‰§è¡Œï¼š\n\n```shell\npyenv install 3.10.13\n```\n\nä½†è¿˜æ˜¯æŠ¥ä¸€æ ·çš„é”™ã€‚è¯´æ˜åœ¨è„šæœ¬ä¸­æ‰§è¡Œçš„è¿™æ®µå¹¶æ²¡æœ‰èµ·æ•ˆï¼ˆå½“ç„¶ä¹Ÿæœ‰å¯èƒ½è¿˜æ˜¯opensslçš„ç‰ˆæœ¬é—®é¢˜ï¼‰ï¼š\n\n```shell\nexport LDFLAGS=\"-L$OPENSSL_DIR/lib\"\nexport CPPFLAGS=\"-I$OPENSSL_DIR/include\"\nexport PKG_CONFIG_PATH=\"$OPENSSL_DIR/lib/pkgconfig\"\nexport LD_LIBRARY_PATH=\"$OPENSSL_DIR/lib\"\n```\n\né—®é¢˜åˆ†æï¼šè™½ç„¶å¯¼å‡ºäº†å˜é‡ï¼Œä½† pyenv çš„æ„å»ºè¿‡ç¨‹å¯èƒ½ **åœ¨å­è¿›ç¨‹ä¸­ä¸¢å¤±äº†å®ƒä»¬**ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ˜¾å¼ç”¨å‰ç¼€æ–¹å¼ä¼ è¿›å»ï¼Œç¡®ä¿å®ƒç”Ÿæ•ˆã€‚\n\næ”¹ä¸ºä»¥ä¸‹å‘½ä»¤å®‰è£…python:\n\n```shell\nCFLAGS=\"-I/opt/openssl-1.1.1w/include\" \\\nLDFLAGS=\"-L/opt/openssl-1.1.1w/lib\" \\\nLD_LIBRARY_PATH=\"/opt/openssl-1.1.1w/lib\" \\\nPKG_CONFIG_PATH=\"/opt/openssl-1.1.1w/lib/pkgconfig\" \\\npyenv install 3.10.13\n```\n\næˆåŠŸï¼\n","tags":["pyenv","centos"],"categories":["Python","åŸºç¡€"]},{"title":"MinerUéƒ¨ç½²","url":"/2025/04/11/MinerUéƒ¨ç½²/","content":"\n# æ‹‰å–MinerU\n\n```shell\ngit clone https://github.com/opendatalab/MinerU.git\ncd Mineru\n```\n\n# å®‰è£…magic-pdf\n\n```shell\n# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ\nuv venv --python 3.10.16 .venv-310\nsource .venv-310/bin/activate\nuv pip install -U \"magic-pdf[full]\"\n```\n\n# ä¸‹è½½æ¨¡å‹æ–‡ä»¶\n\n```shell\n# é€‰æ‹©ä»HFä¸‹è½½ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä»modelscopeä¸‹è½½\n# cd scripts\n# python download_models.py\n\ncd scripts\npython download_models_hf.py\n```\n\n# è‡ªå®šä¹‰é…ç½®æ–‡ä»¶\n\nåœ¨å®Œæˆæ¨¡å‹ä¸‹è½½åï¼Œåœ¨ç”¨æˆ·ç›®å½•ä¸‹ä¼šç”Ÿæˆ`magic-pdf.json`:\n\n```json\n{\n    \"bucket_info\": {\n        \"bucket-name-1\": [\n            \"ak\",\n            \"sk\",\n            \"endpoint\"\n        ],\n        \"bucket-name-2\": [\n            \"ak\",\n            \"sk\",\n            \"endpoint\"\n        ]\n    },\n    \"models-dir\": \"/Users/mao/.cache/modelscope/hub/models/opendatalab/PDF-Extract-Kit-1___0/models\",\n    \"layoutreader-model-dir\": \"/Users/mao/.cache/modelscope/hub/models/ppaanngggg/layoutreader\",\n    \"device-mode\": \"cpu\",\n    \"layout-config\": {\n        \"model\": \"doclayout_yolo\"\n    },\n    \"formula-config\": {\n        \"mfd_model\": \"yolo_v8_mfd\",\n        \"mfr_model\": \"unimernet_small\",\n        \"enable\": true\n    },\n    \"table-config\": {\n        \"model\": \"rapid_table\",\n        \"sub_model\": \"slanet_plus\",\n        \"enable\": true,\n        \"max_time\": 400\n    },\n    \"llm-aided-config\": {\n        \"formula_aided\": {\n            \"api_key\": \"your_api_key\",\n            \"base_url\": \"https://dashscope.aliyuncs.com/compatible-mode/v1\",\n            \"model\": \"qwen2.5-7b-instruct\",\n            \"enable\": false\n        },\n        \"text_aided\": {\n            \"api_key\": \"your_api_key\",\n            \"base_url\": \"https://dashscope.aliyuncs.com/compatible-mode/v1\",\n            \"model\": \"qwen2.5-7b-instruct\",\n            \"enable\": false\n        },\n        \"title_aided\": {\n            \"api_key\": \"your_api_key\",\n            \"base_url\": \"https://dashscope.aliyuncs.com/compatible-mode/v1\",\n            \"model\": \"qwen2.5-32b-instruct\",\n            \"enable\": false\n        }\n    },\n    \"config_version\": \"1.2.0\"\n}\n```\n\n> å¯ä»¥å¼€å¯GPUåŠ é€Ÿï¼šæ›´æ”¹å‚æ•° device-mode = \"cuda\" ï¼Œ MAC å¯ä»¥ æ”¹ä¸ºdevice-mode = \"mps\"\n>\n> æ³¨æ„è¿™é‡Œè¦æ±‚cudaç‰ˆæœ¬ >= 12.1\n\n## å‡çº§CUDA\n\n```shell\nsudo apt-get update\nsudo apt-get install nvidia-driver-545\n```\n\n## é‡å¯\n\n```shell\nsudo reboot\n```\n\n## å®‰è£…paddlepaddle-gpu\n\n```shell\npython -m pip install paddlepaddle-gpu==3.0.0rc1 -i https://www.paddlepaddle.org.cn/packages/stable/cu118/\n```\n\n# è½¬æ¢\n\næŒ‰ç½‘ä¸Šæ‰¾çš„èµ„æ–™æ‰§è¡Œï¼š \n\n```shell\nmagic-pdf -p {some_pdf} -o {some_output_dir} -m auto\n```\n\n> è¿™ä¸ªä¼šå‡ºé”™ï¼Œè¿™ä¸ªæ˜¯1.x.xç‰ˆæœ¬çš„ï¼Œ0.x.xä¸­çš„æœ‰å¯èƒ½æ˜¯ä»¥ä¸‹çš„å‘½ä»¤\n\n```shell\nmagic-pdf --help\nUsage: magic-pdf [OPTIONS] COMMAND [ARGS]...\n\nOptions:\n  -v, --version  æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯\n  -h, --help     æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯\n\nCommands:\n  json-command\n  local-json-command\n  pdf-command\n```\n\n```shell\nmagic-pdf pdf-command --pdf /path/of/your/specific.pdf --inside_model true --model_mode full\n```\n\n1. æˆ‘ä½¿ç”¨ä½ç‰ˆæœ¬è·‘çš„æ—¶å€™é‡åˆ°numpyç‰ˆæœ¬å¤ªé«˜ï¼Œæƒé‡æ–‡ä»¶æ‰¾ä¸åˆ°ï¼ˆå¯èƒ½æˆ‘ä¸‹è½½çš„æ¨¡å‹æ–‡ä»¶ä¸å®Œæ•´å¯¼è‡´ï¼‰ç­‰å‘ï¼Œæœ€åè·‘é€šäº†ï¼Œä½†ç”Ÿæˆæ–‡ä»¶åœ¨å“ªæˆ‘æ‰¾ä¸åˆ°ï¼Œå› ä¸ºå‘½ä»¤ä¸­å°±æ²¡æœ‰æŒ‡å®šè¾“å‡ºçš„è·¯å¾„çš„å‚æ•°\n\n3. å¼ƒå‘ä»å¤´æ¥è¿‡\n\n\tå®‰è£…æ–°ç‰ˆ(æŸ¥çœ‹githubä¸Šå®˜æ–¹æœ€æ–°ä»€ä¹ˆç‰ˆæœ¬)\n\n  ```shell\n   uv pip install magic-pdf==1.3.2\n  ```\n\n  æ‰§è¡Œå‘½ä»¤\n\n  ```shell\n  magic-pdf -p /path/of/your/some.pdf -o /path/of/your/output -m auto\n  ```\n   \n  æç¤ºç¼ºåŒ…(ç¼ºå•¥è¡¥å•¥å°±å¥½äº†)ï¼š\n\n  ```shell\n  openai\n  doclayout_yolo\n  rapid_table\n  ```\n   \n4. æœ€åçš„~/magic-pdf.jsonå¦‚ä¸‹ï¼š\n\n```json\n{\n    \"bucket_info\": {\n        \"bucket-name-1\": [\n            \"ak\",\n            \"sk\",\n            \"endpoint\"\n        ],\n        \"bucket-name-2\": [\n            \"ak\",\n            \"sk\",\n            \"endpoint\"\n        ]\n    },\n    \"models-dir\": \"/Users/mao/.cache/huggingface/hub/models--wanderkid--PDF-Extract-Kit/snapshots/a29caa466f6d07be0e4863bba64204009128931a/models\",\n    \"layoutreader-model-dir\": \"/Users/mao/.cache/huggingface/hub/models--hantian--layoutreader/snapshots/641226775a0878b1014a96ad01b9642915136853\",\n    \"device-mode\": \"cpu\",\n    \"layout-config\": {\n        \"model\": \"doclayout_yolo\"\n    },\n    \"formula-config\": {\n        \"mfd_model\": \"yolo_v8_mfd\",\n        \"mfr_model\": \"unimernet_small\",\n        \"enable\": true\n    },\n    \"table-config\": {\n        \"model\": \"rapid_table\",\n        \"sub_model\": \"slanet_plus\",\n        \"enable\": true,\n        \"max_time\": 400\n    },\n    \"llm-aided-config\": {\n        \"formula_aided\": {\n            \"api_key\": \"your_api_key\",\n            \"base_url\": \"http://localhost:11434/v1\",\n            \"model\": \"qwen2.5:latest\",\n            \"enable\": false\n        },\n        \"text_aided\": {\n            \"api_key\": \"your_api_key\",\n            \"base_url\": \"http://localhost:11434/v1\",\n            \"model\": \"qwen2.5:latest\",\n            \"enable\": false\n        },\n        \"title_aided\": {\n            \"api_key\": \"your_api_key\",\n            \"base_url\": \"http://localhost:11434/v1\",\n            \"model\": \"qwen2.5:latest\",\n            \"enable\": false\n        }\n    },\n    \"config_version\": \"1.2.0\"\n}\n```\n\n","tags":["MinerU","pdf"]},{"title":"uvçš„ä½¿ç”¨","url":"/2025/03/20/uvçš„ä½¿ç”¨/","content":"\n# pythonç‰ˆæœ¬\n\nä½¿ç”¨pyenvè¿›è¡ŒPythonçš„ç‰ˆæœ¬ç®¡ç†ï¼Œå®‰è£…ï¼š\n\n```shell\ncurl -fsSL https://pyenv.run | bash\n```\n\nå®‰è£…å®Œæˆåä¼šåœ¨~/.bashrcä¸­æ·»åŠ ä¸€æ®µè„šæœ¬ï¼š\n\n```shell\nexport PYENV_ROOT=\"$HOME/.pyenv\"\ncommand -v pyenv >/dev/null || export PATH=\"$PYENV_ROOT/bin:$PATH\"\neval \"$(pyenv init -)\"\n```\n\n\n\n# å®‰è£…python\n\npyenv æŸ¥çœ‹ç‰ˆæœ¬æ¸…å•\n\n```shell\npyenv install --list\n```\n\né€‰æ‹©æŸä¸ªç‰ˆæœ¬è¿›è¡Œå®‰è£…\n\n```shell\npyenv install 3.10.16\n```\n\nè®¾ç½®pythonç‰ˆæœ¬\n\n```shell\npyenv global 3.10.16 # å…¨å±€\npyenv local 3.10.16 # åœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬\n```\n\n\n\n# å®‰è£…uv\n\n```shell\n# ä½¿ç”¨ pip å®‰è£…\npip install uv\n\n# æˆ–è€…é€šè¿‡å®˜æ–¹è„šæœ¬å®‰è£…ï¼ˆæ¨èï¼‰\ncurl -LsSf https://astral.sh/uv/install.sh | sh\n```\n\n# è™šæ‹Ÿç¯å¢ƒ\n\n- åˆ›å»ºç¯å¢ƒ\n\n  ```shell\n  uv venv --python 3.10.16 .venv-310  # åˆ›å»º310çš„ç¯å¢ƒ\n  uv venv --python 3.12.9 .venv-312 # åˆ›å»º312çš„ç¯å¢ƒ\n  ```\n\n- æ¿€æ´»ç¯å¢ƒ\n\n  ```shell\n  source .venv-310/bin/activate\n  ```\n  \n- åæ¿€æ´»ç¯å¢ƒ\n\n  ```shell\n  deactivate\n```\n\n# å®‰è£…åŒ…\n\nä½¿ç”¨uvåœ¨è™šæ‹Ÿç¯å¢ƒä¸‹å®‰è£…åŒ…\n\n```shell\nuv pip install \"httpx[socks]\"\n```\n\n","tags":["pyenv","uv"],"categories":["Python","åŸºç¡€"]},{"title":"Ollamaç›‘å¬ç«¯å£ä¿®æ”¹","url":"/2025/02/25/Ollamaç›‘å¬ç«¯å£ä¿®æ”¹/","content":"\n# èƒŒæ™¯\n\nå®‰è£…äº†`Anything LLM`,ç°åœ¨æƒ³åœ¨`Anything LLM`é…ç½®éæœ¬åœ°çš„`Ollama`ï¼Œéœ€è¦è®©`Ollama`çš„ç›‘å¬ç«¯å£æ”¹ä¸º`0.0.0.0:11434`\n\n# ä¿®æ”¹\n\n## MAC\n\n```shell\nlaunchctl setenv OLLAMA_HOST \"0.0.0.0:11434\"\n```\n\n## Linux\n\n```shell\nsystemctl edit ollama.service\n```\n\n```shell\n[Service]\nEnvironment=\"OLLAMA_HOST=0.0.0.0:11434\"\n```\n\n```shell\nsystemctl daemon-reload\nsystemctl restart ollama\n```\n\n\n\n","tags":["ollama","ç›‘å¬ç«¯å£"],"categories":["LLM"]},{"title":"åŸºäºDeepseekå’ŒRagDBæ‰“é€ æœ¬åœ°çŸ¥è¯†åº“","url":"/2025/02/20/åŸºäºDeepseekå’ŒRagDBæ‰“é€ æœ¬åœ°çŸ¥è¯†åº“/","content":"\n# æ„å»ºæ€è·¯\n\n1. ä½¿ç”¨Milvusæä¾›å­˜å‚¨ï¼ŒæŠŠPDFå†…å®¹è¿›è¡Œåˆ†å—ï¼Œå­˜å…¥åˆ°å‘é‡æ•°æ®åº“ä¸­\n2. æ„å»ºæ£€ç´¢é“¾\n3. ä½¿ç”¨æ£€ç´¢é“¾å»æŸ¥è¯¢é—®é¢˜ï¼Œè¿”å›ç­”æ¡ˆ\n\n# ç¯å¢ƒå‡†å¤‡\n\n```shell\n# å®‰è£…æ ¸å¿ƒä¾èµ–\npip install langchain langchain-community pymupdf pymilvus sentence-transformers ollama\ndocker run -d --name milvus -p 19530:19530 milvusdb/milvus:v2.3.3\n# å¦‚æœç³»ç»Ÿä¸­ä½¿ç”¨äº†ä»£ç†ï¼Œéœ€è¦å®‰è£…ä»¥ä¸‹åŒ…\npip install \"httpx[socks]\"\n```\n\n# å®Œæ•´å®ç°ä»£ç \n\n```python\nimport os\nfrom langchain_community.document_loaders import PyMuPDFLoader\nfrom langchain.text_splitter import RecursiveCharacterTextSplitter\nfrom langchain_huggingface import HuggingFaceEmbeddings\nfrom langchain_community.vectorstores import Milvus\nfrom langchain.chains import RetrievalQA\nfrom langchain.prompts import PromptTemplate\nfrom langchain_ollama import OllamaLLM\n\nclass PDFQA:\n    def __init__(self, model_name=\"deepseek-7b\"):\n        # åˆå§‹åŒ–é…ç½®\n        self.embeddings = HuggingFaceEmbeddings(\n            model_name=\"BAAI/bge-base-zh-v1.5\",\n            encode_kwargs={'normalize_embeddings': True}\n        )\n        self.llm = OllamaLLM(\n            base_url=\"http://localhost:11434\",\n            model=model_name,\n            num_ctx=8192,\n            temperature=0.3\n        )\n        self.vector_db = None\n        self.qa_chain = None\n\n    def init_vector_db(self, pdf_path: str):\n        \"\"\"PDFæ–‡æ¡£å¤„ç†ç®¡é“\"\"\"\n        # 1. åŠ è½½æ–‡æ¡£\n        loader = PyMuPDFLoader(pdf_path)\n        pages = loader.load()\n\n        # 2. ä¸­æ–‡ä¼˜åŒ–åˆ†å—\n        text_splitter = RecursiveCharacterTextSplitter(\n            chunk_size=500,\n            chunk_overlap=50,\n            separators=[\"\\n\\n\", \"\\n\", \"ã€‚\", \"ï¼\", \"ï¼Ÿ\", \"ï¼›\"]\n        )\n        splits = text_splitter.split_documents(pages)\n\n        # 3. åˆ›å»ºå‘é‡å­˜å‚¨\n        self.vector_db = Milvus.from_documents(\n            splits,\n            self.embeddings,\n            connection_args={\"host\": \"localhost\", \"port\": \"19530\"},\n            collection_name=\"pdf_qa\",\n            index_params={\n                \"metric_type\": \"L2\",\n                \"index_type\": \"IVF_FLAT\",\n                \"params\": {\"nlist\": 1024}\n            }\n        )\n\n    def build_qa_chain(self):\n        \"\"\"æ„å»ºé—®ç­”é“¾\"\"\"\n        # ä¸­æ–‡ä¼˜åŒ–æç¤ºæ¨¡æ¿\n        prompt_template = \"\"\"è¯·æ ¹æ®ä»¥ä¸‹ä¸Šä¸‹æ–‡ä¿¡æ¯å›ç­”é—®é¢˜ã€‚å¦‚æœæ— æ³•ä»ä¸Šä¸‹æ–‡ä¸­å¾—åˆ°ç­”æ¡ˆï¼Œè¯·å›ç­”\"æˆ‘ä¸çŸ¥é“\"ã€‚\n\n        ä¸Šä¸‹æ–‡ï¼š\n        {context}\n\n        é—®é¢˜ï¼š{question}\n        ç­”æ¡ˆï¼š\"\"\"\n\n        PROMPT = PromptTemplate(\n            template=prompt_template,\n            input_variables=[\"context\", \"question\"]\n        )\n\n        # åˆ›å»ºæ£€ç´¢é“¾\n        self.qa_chain = RetrievalQA.from_chain_type(\n            llm=self.llm,\n            chain_type=\"stuff\",\n            retriever=self.vector_db.as_retriever(\n                search_kwargs={\"k\": 3, \"score_threshold\": 0.7}\n            ),\n            chain_type_kwargs={\"prompt\": PROMPT},\n            return_source_documents=True\n        )\n\n    def query(self, question: str) -> dict:\n        \"\"\"æ‰§è¡ŒæŸ¥è¯¢\"\"\"\n        if not self.qa_chain:\n            raise ValueError(\"è¯·å…ˆåˆå§‹åŒ–å‘é‡æ•°æ®åº“å¹¶æ„å»ºé—®ç­”é“¾\")\n        return self.qa_chain({\"query\": question})\n\ndef main():\n    # åˆå§‹åŒ–ç³»ç»Ÿ\n    qa_system = PDFQA()\n    \n    # å¤„ç†PDFæ–‡æ¡£\n    pdf_path = input(\"è¯·è¾“å…¥PDFæ–‡ä»¶è·¯å¾„ï¼š\").strip()\n    if not os.path.exists(pdf_path):\n        print(\"æ–‡ä»¶ä¸å­˜åœ¨ï¼\")\n        return\n    \n    print(\"æ­£åœ¨å¤„ç†æ–‡æ¡£...\")\n    qa_system.init_vector_db(pdf_path)\n    qa_system.build_qa_chain()\n    print(\"ç³»ç»Ÿå‡†å¤‡å°±ç»ªï¼Œè¾“å…¥'é€€å‡º'ç»“æŸå¯¹è¯\")\n\n    # äº¤äº’å¾ªç¯\n    while True:\n        question = input(\"\\nè¯·è¾“å…¥é—®é¢˜ï¼š\").strip()\n        if question.lower() in [\"é€€å‡º\", \"exit\"]:\n            break\n        \n        result = qa_system.query(question)\n        \n        # æ˜¾ç¤ºç»“æœ\n        print(\"\\nç­”æ¡ˆï¼š\", result[\"result\"])\n        print(\"\\næ¥æºæ–‡æ¡£ï¼š\")\n        for i, doc in enumerate(result[\"source_documents\"][:2]):\n            print(f\"[æ–‡æ¡£{i+1}]\", doc.page_content[:200] + \"...\")\n\nif __name__ == \"__main__\":\n    main()\n```\n\n\n\n","tags":["milvus","Deepseek","rag"],"categories":["LLM"]},{"title":"Milvus dockerå•æœºç‰ˆå®‰è£…","url":"/2025/02/20/Milvus-dockerå•æœºç‰ˆå®‰è£…/","content":"\n# dockerè¿è¡Œ\n\nå®‰è£…æ­¥éª¤\n\n1. ä¸‹è½½å®‰è£…è„šæœ¬\n\n   ```shell\n   curl -sfL https://raw.githubusercontent.com/milvus-io/milvus/master/scripts/standalone_embed.sh -o standalone_embed.sh\n   ```\n\n2. æ‰§è¡Œè„šæœ¬å®‰è£…milvus\n\n   ```shell\n   bash standalone_embed.sh start\n   ```\n\n   ä»¥ä¸‹æ˜¯å®ƒçš„è¾“å‡ºï¼š\n\n   ```shell\n   Unable to find image 'milvusdb/milvus:v2.5.4' locally\n   v2.5.4: Pulling from milvusdb/milvus\n   Digest: sha256:081e5471cb53756bd86bf2e2bfbedadec9e87cb181583c6f19410b23a711be00\n   Status: Downloaded newer image for milvusdb/milvus:v2.5.4\n   Wait for Milvus Starting...\n   Start successfully.\n   To change the default Milvus configuration, add your settings to the user.yaml file and then restart the service.\n   ```\n\n# docker-compose è¿è¡Œ\n\nåˆè£…æ­¥éª¤\n\n1. ä¸‹è½½é…ç½®æ–‡ä»¶`milvus.yaml`\n\n   ```shell\n   wget https://raw.githubusercontent.com/milvus-io/milvus/v2.5.4/configs/milvus.yaml\n   ```\n\n2. ä¸‹è½½`docker-compose.yaml`æ–‡ä»¶\n\n   ```shell\n   wget https://github.com/milvus-io/milvus/releases/download/v2.5.4/milvus-standalone-docker-compose.yml -O docker-compose.yml\n   ```\n\n3. ä¿®æ”¹`docker-compose.yaml`æ–‡ä»¶\n\n   ```shell\n   ...\n     standalone:\n       container_name: milvus-standalone\n       image: milvusdb/milvus:v2.2.13\n       command: [\"milvus\", \"run\", \"standalone\"]\n       environment:\n         ETCD_ENDPOINTS: etcd:2379\n         MINIO_ADDRESS: minio:9000\n       volumes:\n         - /local/path/to/your/milvus.yaml:/milvus/configs/milvus.yaml   # Map the local path to the container path\n         - ${DOCKER_VOLUME_DIRECTORY:-.}/volumes/milvus:/var/lib/milvus\n       ports:\n         - \"19530:19530\"\n         - \"9091:9091\"\n       depends_on:\n         - \"etcd\"\n         - \"minio\"\n   ...\n   \n   ```\n\n4. å¯åŠ¨\n\n   ```shell\n   sudo docker compose up -d\n   ```\n\n   \n","tags":["docker","milvus","standalone"]},{"title":"nginxé…ç½®modsecurity","url":"/2025/02/12/nginxé…ç½®modsecurity/","content":"\n# å‡†å¤‡å·¥ä½œ\n\n1. æ“ä½œç³»ç»ŸCentos\n\n2. å®‰è£…ä¾èµ–\n\n   ```shell\n   yum install -y gcc-c++ flex bison yajl yajl-devel curl-devel curl GeoIP-devel doxygen zlib-devel pcre-devel lmdb-devel libxml2-devel ssdeep-devel lua-devel libtool autoconf automake wget epel-release openssl-devel\n   ```\n\n3. ä¸‹è½½å®‰è£…åŒ…\n\n   ```shell\n   mkdir nginx-setup\n   cd nginx-setup\n   # ä¸‹è½½ModSecurity\n   wget http://www.modsecurity.cn/download/modsecurity/modsecurity-v3.0.4.tar.gz\n   # ä¸‹è½½ModSecurity å’Œ nginxçš„æ¡¥æ¥æ–‡ä»¶(ç›´æ¥wgetä¸‹è½½ä¼šæœ‰é—®é¢˜ï¼Œè¿˜æ˜¯åœ¨æœ¬åœ°ç”¨æµè§ˆå™¨ä¸‹è½½ï¼Œå†ä¸Šä¼ )\n   wget https://codeload.github.com/SpiderLabs/ModSecurity-nginx/zip/refs/heads/master\n   # ä¸‹è½½nginx å®‰è£…åŒ…\n   wget http://nginx.org/download/nginx-1.25.5.tar.gz\n   # ä¸‹è½½ModSecurity æ ¸å¿ƒè§„åˆ™æ–‡ä»¶\n   wget http://www.modsecurity.cn/download/corerule/owasp-modsecurity-crs-3.3-dev.zip\n   \n   ```\n\n   å®‰è£…åŒ…å¦‚ä¸‹ï¼š\n\n   ```shell\n   -rw-r--r--.  1 root root   260374 5æœˆ  13 2020 modsecurity-nginx-master.zip\n   -rw-r--r--.  1 root root  2806291 5æœˆ  13 2020 modsecurity-v3.0.4.tar.gz\n   -rw-r--r--.  1 root root  1244060 4æœˆ  16 22:37 nginx-1.25.5.tar.gz\n   -rw-r--r--.  1 root root   460374 5æœˆ  13 2020 owasp-modsecurity-crs-3.3-dev.zip\n   ```\n\n# å®‰è£…\n\n## å®‰è£…ModSecurity\n\n```shell\ntar -zxvf modsecurity-v3.0.4.tar.gz\ncd modsecurity-v3.0.4\n#ç¼–è¯‘\nsh build.sh\n./configure\nsudo make && sudo make install\n\nlibtool: link: g++ -g -O2 -o rules_optimization optimization/rules_optimization-optimization.o  -L/usr/lib64/ ../src/.libs/libmodsecurity.a -lcurl -lGeoIP -lrt -lxml2 -lz -lm -ldl -llua-5.1 -lpcre -lyajl\nmake[2]: ç¦»å¼€ç›®å½•â€œ/home/centos/tools/nginx-mod/modsecurity-v3.0.4/testâ€\nmake[1]: ç¦»å¼€ç›®å½•â€œ/home/centos/tools/nginx-mod/modsecurity-v3.0.4/testâ€\nmake[1]: è¿›å…¥ç›®å½•â€œ/home/centos/tools/nginx-mod/modsecurity-v3.0.4â€\nmake[1]: å¯¹â€œall-amâ€æ— éœ€åšä»»ä½•äº‹ã€‚\nmake[1]: ç¦»å¼€ç›®å½•â€œ/home/centos/tools/nginx-mod/modsecurity-v3.0.4â€\nmake: *** æ²¡æœ‰è§„åˆ™å¯ä»¥åˆ›å»ºç›®æ ‡â€œinstalâ€ã€‚ åœæ­¢ã€‚\n# æœ€åçœ‹åˆ°æœ‰ä¸Šé¢çš„å†…å®¹è¡¨ç¤ºå®‰è£…å®Œæˆ\n```\n\n## å®‰è£…ModSecurity-Nginx\n\n```shell\n#è§£å‹ï¼š\nunzip Modsecurity-nginx-master.zip\n\n#ç§»åŠ¨åˆ°modsecurityç›®å½•ä¸‹ï¼š\nmv Modsecurity-nginx-master modsecurity-v3.0.4/modsecurity-nginx\n\n#ç°åœ¨çš„ç»“æ„\ncd modsecurity-v3.0.4\n\n-rwxr-xr-x.  1 1000 1000 707870 5æœˆ  11 11:05 configure\n-rw-r--r--.  1 root root 174749 5æœˆ  11 11:07 Makefile\n-rw-r--r--.  1 1000 1000  10210 1æœˆ  13 2020 modsecurity.conf-recommended\ndrwxr-xr-x.  5 root root    201 5æœˆ  11 11:11 modsecurity-nginx\ndrwxr-xr-x. 14 1000 1000   4096 5æœˆ  11 11:14 src\n...\n#å¯ä»¥çœ‹åˆ°modsecurity-nginxæ–‡ä»¶å¤¹åœ¨modsecurity-v3.0.4ç›®å½•ä¸‹\n```\n\n## ç¼–è¯‘å®‰è£…openssl\n\n```shell\nwget https://www.openssl.org/source/openssl-1.1.1w.tar.gz\ntar -zxvf openssl-1.1.1w.tar.gz\ncd openssl-1.1.1w\n./config --prefix=/usr/local/openssl-1.1.1 no-shared\nmake -j$(nproc)\nsudo make install_sw\n```\n\n## å®‰è£…nginx\n\n**å¦‚æœå·²ç»å®‰è£…äº†nginxå¯ä»¥åœ¨å®‰è£…çš„æ—¶å€™æŒ‡å®šå®‰è£…è·¯å¾„é¿å…å’ŒåŸæœ¬çš„nginxå†²çªè¦†ç›–ã€‚**\n\n```shell\n#è§£å‹ï¼š\ntar -zxvf nginx-1.25.5.tar.gz\n#æ”¹ä¸ªåå­—\nmv nginx-1.25.5 nginx-1.25.5-install\ncd nginx-1.25.5-install\n#ç¼–è¯‘\n./configure --prefix=/usr/local/nginx/nginx-1.25.5 --with-http_stub_status_module --with-http_ssl_module --with-file-aio --with-http_realip_module --add-dynamic-module=/home/centos/tools/nginx-mod/modsecurity-v3.0.4/modsecurity-nginx --with-openssl=/home/centos/tools/nginx-mod/openssl-1.1.1w\n\n#--add-dynamic-module æŒ‡å®šè¦æ·»åŠ çš„module è¿™é‡Œæ·»åŠ çš„æ˜¯modsecurity æŒ‡å®šäº†è·¯å¾„\n\n#ç»“æœï¼š\nConfiguration summary\n  + using system PCRE library\n  + using system OpenSSL library\n  + using system zlib library\n\n  nginx path prefix: \"/usr/local/nginx/nginx-1.25.5\"\n  nginx binary file: \"/usr/local/nginx/nginx-1.25.5/sbin/nginx\"\n  nginx modules path: \"/usr/local/nginx/nginx-1.25.5/modules\"\n  nginx configuration prefix: \"/usr/local/nginx/nginx-1.25.5/conf\"\n  nginx configuration file: \"/usr/local/nginx/nginx-1.25.5/conf/nginx.conf\"\n  nginx pid file: \"/usr/local/nginx/nginx-1.25.5/logs/nginx.pid\"\n  nginx error log file: \"/usr/local/nginx/nginx-1.25.5/logs/error.log\"\n  nginx http access log file: \"/usr/local/nginx/nginx-1.25.5/logs/access.log\"\n  nginx http client request body temporary files: \"client_body_temp\"\n  nginx http proxy temporary files: \"proxy_temp\"\n  nginx http fastcgi temporary files: \"fastcgi_temp\"\n  nginx http uwsgi temporary files: \"uwsgi_temp\"\n  nginx http scgi temporary files: \"scgi_temp\"\n#å¦‚æœæœ€åå‡ºç°ä¸Šé¢çš„å­—æ ·è¡¨ç¤ºç¼–è¯‘æˆåŠŸ\n\n#æ‰§è¡Œå®‰è£…ï¼š\nsudo make && sudo make install\n\n#ç»“æœ\ncp objs/ngx_http_modsecurity_module.so '/usr/local/nginx/nginx-1.25.5/modules/ngx_http_modsecurity_module.so'\nmake[1]: ç¦»å¼€ç›®å½•â€œ/home/centos/tools/nginx-mod/nginx-1.25.5-installâ€ \n#å¦‚æœå‡ºç°ä¸Šé¢çš„å­—æ ·è¡¨ç¤ºå®‰è£…æˆåŠŸ\n\n#ç°åœ¨çš„ç»“æ„\ndrwxr-xr-x. 13 1000  1000    4096 5æœˆ  11 11:49 modsecurity-v3.0.4\ndrwxr-xr-x. 12 root root      166 5æœˆ  11 14:36 nginx-1.25.5\ndrwxr-xr-x.  9  502 games     186 5æœˆ  11 11:52 nginx-1.25.5-install\n-rw-r--r--.  1 root root   460374 5æœˆ  13 2020 owasp-modsecurity-crs-3.3-dev.zip\n\n\n#è¿›å…¥å®‰è£…å¥½çš„nginxä¸‹çœ‹çœ‹\ndrwxr-xr-x. 3 root   root 4096 5æœˆ  11 14:31 conf\ndrwxr-xr-x. 2 root   root   40 5æœˆ  11 11:54 html\ndrwxr-xr-x. 2 root   root   58 5æœˆ  11 14:50 logs\ndrwxr-xr-x. 2 root   root   44 5æœˆ  11 11:54 modules\ndrwxr-xr-x. 2 root   root   19 5æœˆ  11 11:54 sbin\n```\n\n> --with-opensslæŒ‡å®šopensslçš„**æºç **çš„è·¯å¾„ï¼Œæ³¨æ„ï¼Œè¿™é‡Œæ˜¯æºç ï¼Œç¼–è¯‘æˆåŠŸåæœ‰ä¸€æ¡ä¿¡æ¯å¾ˆé‡è¦ï¼š`cp objs/ngx_http_modsecurity_module.so '/usr/local/nginx/nginx-1.25.5/modules/ngx_http_modsecurity_module.so'`\n\n# é˜²ç«å¢™è§„åˆ™\n\n1. å°†ModSecurityä¸‹çš„é…ç½®æ–‡ä»¶ å¤åˆ¶åˆ°nginx.config ç›®å½•ï¼Œæ–¹ä¾¿åæœŸæ›´æ”¹é…ç½®ï¼š\n\n   ```shell\n   mkdir -p /usr/local/nginx/nginx-1.25.5/conf/modsecurity\n   #å¤åˆ¶æ ¸å¿ƒé…ç½®æ–‡ä»¶\n   cp /home/centos/tools/nginx-mod/modsecurity-v3.0.4/modsecurity.conf-recommended /usr/local/nginx/nginx-1.25.5/conf/modsecurity/modsecurity.conf\n   cp /home/centos/tools/nginx-mod/modsecurity-v3.0.4/unicode.mapping  /usr/local/nginx/nginx-1.25.5/conf/modsecurity\n   ```\n\n2. æŠŠnginxæ·»åŠ åˆ°$PATHä¸­\n\n   ```shell\n   vim /etc/profile\n   ```\n\n   ```shelll\n   # nginx\n   export PATH=$PATH:/usr/local/nginx/nginx-1.25.5/sbin\n   ```\n\n3. ä¿®æ”¹nginx.confé…ç½®æ–‡ä»¶\n\n   ```shell\n   #user  nobody;\n   worker_processes  1;\n   \n   #error_log  logs/error.log;\n   #error_log  logs/error.log  notice;\n   #error_log  logs/error.log  info;\n   \n   #pid        logs/nginx.pid;\n   \n   #æ·»åŠ äº†è¿™ä¸€è¡Œï¼ŒåŠ è½½modsecurityæ¨¡å—ï¼Œè®©nginxæ”¯æŒwaf\n   load_module modules/ngx_http_modsecurity_module.so;\n   \n   events {\n       worker_connections  1024;\n   }\n   \n   \n   http {\n   \t\n   \t#å¼€å¯modsecurity\n   \tmodsecurity on;\n   \t#æŒ‡å®šmodsecurityæ ¸å¿ƒé…ç½®æ–‡ä»¶\n       modsecurity_rules_file /usr/local/nginx/nginx-1.25.5/conf/modsecurity/modsecurity.conf;\n   \n       include       mime.types;\n       default_type  application/octet-stream;\n   \n       #log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n       #                  '$status $body_bytes_sent \"$http_referer\" '\n       #                  '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n   \n       #access_log  logs/access.log  main;\n   \n       sendfile        on;\n       #tcp_nopush     on;\n   \n       #keepalive_timeout  0;\n       keepalive_timeout  65;\n   \n       #gzip  on;\n   \n       server {\n   \n           listen       80;\n           server_name  localhost;\n   \n           error_page   500 502 503 504  /50x.html;\n           location = /50x.html {\n               root   html;\n           }\n       }\n   }\n   ```\n\n   \n\n4. æ‰§è¡Œæµ‹è¯•\n\n   ç”±äºä½¿ç”¨centosç”¨æˆ·æ‰§è¡Œï¼Œæ‰€ä»¥ä¼šæœ‰æƒé™é—®é¢˜ï¼Œå¦‚ä¸‹ï¼š\n\n   ```shell\n   nginx -t\n   nginx: [emerg] \"modsecurity_rules_file\" directive Failed to open file: /var/log/modsec_audit.log in /usr/local/nginx/nginx-1.25.5/conf/nginx.conf:23\n   nginx: configuration file /usr/local/nginx/nginx-1.25.5/conf/nginx.conf test failed\n   ```\n\n   è§£å†³æ–¹æ³•ï¼š\n\n   ```shell\n   sudo touch /var/log/modsec_audit.log\n   sudo chown centos:centos /var/log/modsec_audit.log\n   sudo chmod 644 /var/log/modsec_audit.log\n   ```\n\n5. é‡æ–°æ‰§è¡Œ\n\n   ```shell\n   nginx -t\n   nginx: the configuration file /usr/local/nginx/nginx-1.25.5/conf/nginx.conf syntax is ok\n   nginx: [emerg] bind() to 0.0.0.0:80 failed (13: Permission denied)\n   nginx: configuration file /usr/local/nginx/nginx-1.25.5/conf/nginx.conf test failed\n   ```\n\n   è¿™ä¸ªåº”è¯¥æ˜¯ç”±äºcentosç”¨æˆ·æ²¡æœ‰æƒé™å¯¹1024ä»¥ä¸‹çš„ç«¯å£è¿›è¡Œç»‘å®šçš„ç¼˜æ•…\n\n6. åŠ sudoæ‰§è¡Œ\n\n  ```shell\nsudo /usr/local/nginx/nginx-1.25.5/sbin/nginx -t\nnginx: the configuration file /usr/local/nginx/nginx-1.25.5/conf/nginx.conf syntax is ok\nnginx: configuration file /usr/local/nginx/nginx-1.25.5/conf/nginx.conf test is successful\n# å¯åŠ¨\nsudo nginx\n  ```\n\n7. ä»¥ä¸Šæ­¥éª¤åªæ˜¯è¯´æ˜éƒ¨ç½²æˆåŠŸäº†ï¼Œæ¥ä¸‹æ¥æ·»åŠ é˜²ç«å¢™è§„åˆ™\n\n   ```shell\n   #è§£å‹ä¸‹è½½å¥½çš„è§„åˆ™æ–‡ä»¶\n   unzip owasp-modsecurity-crs-3.3-dev.zip\n   cd owasp-modsecurity-crs-3.3-dev\n   \n   #é…ç½®æ–‡ä»¶\n   cp crs-setup.conf.example /usr/local/nginx/nginx-1.25.5/conf/modsecurity/crs-setup.conf\n   \n   #å¤åˆ¶æ‰€æœ‰è§„åˆ™é…ç½®æ–‡ä»¶\n   cp -r rules /usr/local/nginx/nginx-1.25.5/conf/modsecurity/\n   \n   cd /usr/local/nginx/nginx-1.25.5/conf/modsecurity/rules\n   mv REQUEST-900-EXCLUSION-RULES-BEFORE-CRS.conf.example REQUEST-900-EXCLUSION-RULES-BEFORE-CRS.conf\n   mv RESPONSE-999-EXCLUSION-RULES-AFTER-CRS.conf.example RESPONSE-999-EXCLUSION-RULES-AFTER-CRS.conf\n   # å…³äºä¸Šé¢çš„ä¸¤ä¸ªæ–‡ä»¶è¯´æ˜ï¼š\n   #1. é€šè¿‡å…¨å±€æ–¹å¼ç¦ç”¨è§„åˆ™ï¼ŒæŒ‡ä»¤éœ€åŠ è½½åœ¨RESPONSE-999-EXCLUSION-RULES-AFTER-CRS.confæ–‡ä»¶ä¸­ï¼Œä¹Ÿå¯åˆ›å»ºè‡ªå®šä¹‰è§„åˆ™æ–‡ä»¶ï¼Œä½†éœ€å…ˆåŠ è½½ModSecurityæ ¸å¿ƒè§„åˆ™æ–‡ä»¶ï¼Œå†åŠ è½½è‡ªå®šä¹‰è§„åˆ™æ–‡ä»¶ã€‚\n   #2. é€šè¿‡ç™½åå•æ–¹å¼ç¦ç”¨è§„åˆ™ï¼ŒæŒ‡ä»¤éœ€åŠ è½½åœ¨REQUEST-900-EXCLUSION-RULES-BEFORE-CRS.confæ–‡ä»¶ä¸­ï¼Œä¹Ÿå¯åˆ›å»ºè‡ªå®šä¹‰è§„åˆ™æ–‡ä»¶ï¼Œä½†éœ€å…ˆåŠ è½½è‡ªå®šä¹‰è§„åˆ™æ–‡ä»¶ï¼Œå†åŠ è½½ModSecurityæ ¸å¿ƒè§„åˆ™æ–‡ä»¶ã€‚\n   ```\n\n8. å°†é˜²ç«å¢™é…ç½®æ–‡ä»¶åŠ è½½åˆ°nginxä¸­\n\n   ```shell\n   #æ‰“å¼€é…ç½®ï¼š\n   vim /usr/local/nginx/nginx-1.25.5/conf/modsecurity/modsecurity.conf\n   æ³¨é‡Šï¼š#SecRuleEngine DetectionOnly\n   æ·»åŠ ï¼šSecRuleEngine On\n   \n   æ³¨é‡Šï¼š#SecAuditLogParts ABIJDEFHZ\n   æ·»åŠ ï¼šSecAuditLogParts ABCDEFHZ\n   \n   æ·»åŠ é˜²æŠ¤è§„åˆ™æ–‡ä»¶\n   Include /usr/local/nginx/nginx-1.25.5/conf/modsecurity/crs-setup.conf\n   Include /usr/local/nginx/nginx-1.25.5/conf/modsecurity/rules/*.conf\n   \n   ```\n\n9. æµ‹è¯•æ‹¦æˆª\n\n   ```shell\n   sudo nginx -t\n   sudo nginx -s reload\n   \n   # æµ‹è¯•ä¼šè¢«æ‹¦æˆªçš„è¯·æ±‚çœ‹çœ‹æ˜¯å¦è¢«æ‹¦æˆª\n   wget http://192.168.10.55/projectName?PHPRC=/dev/fd/0\n   #å¯ä»¥çœ‹åˆ°è¢«æ‹¦æˆªäº† è¿”å›403\n   ```\n\n10. æŸ¥çœ‹æ—¥å¿—æƒ…å†µ\n\n   ```shell\n---2tpuLegv---A--\n[12/Feb/2025:01:35:24 +0000] 173932412476.453510 192.168.10.91 2061 10.1.3.243 80\n---2tpuLegv---B--\nGET /projectName?PHPRC=/dev/fd/0 HTTP/1.1\nUser-Agent: Wget/1.14 (linux-gnu)\nAccept: */*\nHost: 192.168.10.91\nConnection: Keep-Alive\n\n---2tpuLegv---D--\n\n---2tpuLegv---E--\n<html>\\x0d\\x0a<head><title>403 Forbidden</title></head>\\x0d\\x0a<body>\\x0d\\x0a<center><h1>403 Forbidden</h1></center>\\x0d\\x0a<hr><center>nginx/1.25.5</center>\\x0d\\x0a</body>\\x0d\\x0a</html>\\x0d\\x0a\n\n---2tpuLegv---F--\nHTTP/1.1 403\nServer: nginx/1.25.5\nDate: Wed, 12 Feb 2025 01:35:24 GMT\nContent-Length: 153\nContent-Type: text/html\nConnection: keep-alive\n\n---2tpuLegv---H--\nModSecurity: Warning. Matched \"Operator `Rx' with parameter `^[\\d.:]+$' against variable `REQUEST_HEADERS:Host' (Value: `192.168.10.91' ) [file \"/usr/local/nginx/nginx-1.25.5/conf/modsecurity/rules/REQUEST-920-PROTOCOL-ENFORCEMENT.conf\"] [line \"722\"] [id \"920350\"] [rev \"\"] [msg \"Host header is a numeric IP address\"] [data \"192.168.10.91\"] [severity \"4\"] [ver \"OWASP_CRS/3.2.0\"] [maturity \"0\"] [accuracy \"0\"] [tag \"application-multi\"] [tag \"language-multi\"] [tag \"platform-multi\"] [tag \"attack-protocol\"] [tag \"paranoia-level/1\"] [tag \"OWASP_CRS\"] [tag \"OWASP_CRS/PROTOCOL_VIOLATION/IP_HOST\"] [tag \"WASCTC/WASC-21\"] [tag \"OWASP_TOP_10/A7\"] [tag \"PCI/6.5.10\"] [hostname \"10.1.3.243\"] [uri \"/projectName\"] [unique_id \"173932412476.453510\"] [ref \"o0,13v94,13\"]\nModSecurity: Warning. Matched \"Operator `PmFromFile' with parameter `unix-shell.data' against variable `ARGS:PHPRC' (Value: `/dev/fd/0' ) [file \"/usr/local/nginx/nginx-1.25.5/conf/modsecurity/rules/REQUEST-932-APPLICATION-ATTACK-RCE.conf\"] [line \"496\"] [id \"932160\"] [rev \"\"] [msg \"Remote Command Execution: Unix Shell Code Found\"] [data \"Matched Data: dev/fd/ found within ARGS:PHPRC: /dev/fd/0\"] [severity \"2\"] [ver \"OWASP_CRS/3.2.0\"] [maturity \"0\"] [accuracy \"0\"] [tag \"application-multi\"] [tag \"language-shell\"] [tag \"platform-unix\"] [tag \"attack-rce\"] [tag \"paranoia-level/1\"] [tag \"OWASP_CRS\"] [tag \"OWASP_CRS/WEB_ATTACK/COMMAND_INJECTION\"] [tag \"WASCTC/WASC-31\"] [tag \"OWASP_TOP_10/A1\"] [tag \"PCI/6.5.2\"] [hostname \"10.1.3.243\"] [uri \"/projectName\"] [unique_id \"173932412476.453510\"] [ref \"o1,7v23,9t:urlDecodeUni,t:cmdLine,t:normalizePath,t:lowercase\"]\nModSecurity: Access denied with code 403 (phase 2). Matched \"Operator `Ge' with parameter `5' against variable `TX:ANOMALY_SCORE' (Value: `8' ) [file \"/usr/local/nginx/nginx-1.25.5/conf/modsecurity/rules/REQUEST-949-BLOCKING-EVALUATION.conf\"] [line \"80\"] [id \"949110\"] [rev \"\"] [msg \"Inbound Anomaly Score Exceeded (Total Score: 8)\"] [data \"\"] [severity \"2\"] [ver \"OWASP_CRS/3.2.0\"] [maturity \"0\"] [accuracy \"0\"] [tag \"application-multi\"] [tag \"language-multi\"] [tag \"platform-multi\"] [tag \"attack-generic\"] [hostname \"10.1.3.243\"] [uri \"/projectName\"] [unique_id \"173932412476.453510\"] [ref \"\"]\n\n---2tpuLegv---Z--\n   ```\n\n   \n","tags":["nginx","modsecurity"],"categories":["Webå¼€å‘","åŸºç¡€çŸ¥è¯†"]},{"title":"é˜¿åŸºç±³å¾·æŠ˜å¼¦å®šç†","url":"/2025/02/08/é˜¿åŸºç±³å¾·æŠ˜å¼¦å®šç†/","content":"\n# æŠ˜å¼¦å®šä¹‰\n\nä»åœ†å‘¨ä¸Šä»»ä½•ä¸€ç‚¹å‡ºå‘çš„ä¸¤æ¡å¼¦ç»„æˆçš„æŠ˜çº¿ï¼Œç§°ä¸ºè¯¥å›¾çš„ä¸€æ¡æŠ˜å¼¦\n\n# é˜¿åŸºç±³å¾·æŠ˜å¼¦å®šç†\n\nä¸€ä¸ªåœ†ä¸­ä¸€æ¡æŠ˜å¼¦æ‰€å¯¹çš„ä¸¤æ®µå¼§çš„ä¸­ç‚¹åœ¨è¾ƒé•¿å¼¦ä¸Šçš„å°„å½±ï¼Œå°±æ˜¯æŠ˜å¼¦çš„ä¸­ç‚¹ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒABå’ŒBCç»„æˆåœ†çš„æŠ˜å¼¦ï¼ŒAB&gt;BCï¼ŒDæ˜¯å¼§ABCçš„ä¸­ç‚¹ï¼ŒDEâŠ¥ABï¼Œå‚ç‚¹ä¸ºEï¼Œåˆ™AE=BC+BEã€‚\n\n![](é˜¿åŸºç±³å¾·æŠ˜å¼¦å®šç†/æŠ˜å¼¦å›¾.png)\n\n# è¯æ˜æ–¹æ³•\n\n## æˆªé•¿æ³•\n\n![](é˜¿åŸºç±³å¾·æŠ˜å¼¦å®šç†/è¯æ˜-æˆªé•¿æ³•.png)\n\n## è¡¥çŸ­æ³•\n\n![](é˜¿åŸºç±³å¾·æŠ˜å¼¦å®šç†/è¯æ˜-è¡¥çŸ­æ³•.png)\n\n## å‚çº¿æ³•\n\n![](é˜¿åŸºç±³å¾·æŠ˜å¼¦å®šç†/è¯æ˜-å‚çº¿æ³•.png)\n","tags":["é˜¿åŸºç±³å¾·æŠ˜å¼¦å®šç†","æŠ˜å¼¦"],"categories":["æ•°å­¦","åˆä¸­"]},{"title":"æµ·ä¼¦-ç§¦ä¹éŸ¶å…¬å¼","url":"/2025/01/27/æµ·ä¼¦-ç§¦ä¹éŸ¶å…¬å¼/","content":"\n# å…¬å¼\n\n\\begin{equation}\n\\begin{aligned}\nS=\\sqrt{P(P-a)(P-b)(P-c)}\n\\end{aligned}\n\\end{equation}\n\n# æ¨å¯¼\n\n![](æµ·ä¼¦-ç§¦ä¹éŸ¶å…¬å¼/å…¬å¼æ¨å¯¼.jpg)\n","tags":["ä¸‰è§’å½¢","é¢ç§¯"],"categories":["æ•°å­¦","åˆä¸­"]},{"title":"é˜¿æ°åœ†","url":"/2025/01/22/é˜¿æ°åœ†/","content":"\n# é˜¿æ³¢ç½—å°¼æ–¯åœ†\n\nåœ¨å¹³é¢ä¸€ç‚¹Pï¼Œåˆ°Aï¼ŒBä¸¤ç‚¹çš„è·ç¦»æ»¡è¶³:$\\frac{PA}{PB}=k(k\\ne 1)$ï¼Œé‚£ä¹ˆPçš„è½¨è¿¹ä¸ºä¸€ä¸ªä»¥å®šæ¯”kå†…åˆ†å’Œå¤–åˆ†å®šçº¿æ®µABçš„ä¸¤ä¸ªåˆ†ç‚¹è¿çº¿ä¸ºç›´å¾„çš„åœ†ã€‚\n\n![é˜¿æ°åœ†](é˜¿æ°åœ†/é˜¿æ°åœ†1.jpg)\n\n\\begin{equation}\n\\begin{aligned}\n\t&è®¾AB=a, å³åœ†å†…ç‚¹Bï¼Œåœ†å¤–ç‚¹Aé—´çš„è·ç¦»ä¸ºa\\\\\n\t&åˆ™AC=\\frac{ka}{k+1}, CB=\\frac{a}{k+1}\\\\\n\t&è®¾BD=x,\\frac{a+x}{x}=k\\Rightarrow x=\\frac{a}{k-1},å³BD=\\frac{a}{k-1}\\\\\n\t&\\therefore CD=2r=CB+BD=\\frac{a}{k+1}+\\frac{a}{k-1}=\\frac{2ak}{k^2-1}\\\\\n\t&\\therefore r=\\frac{ak}{k^2-1}\\\\\n\\end{aligned}\n\\end{equation}\n\n> ä¸Šè¿°æ˜¯åŸºäº`k>1`çš„æƒ…å†µçš„æ¨æ¼”è¿‡ç¨‹ï¼Œè®°ä½è¿™ä¸ªæ•°é‡å…³ç³»ï¼Œå°±èƒ½å¿«é€Ÿæ‰¾å†…ç‚¹ï¼Œå¤–ç‚¹","tags":["è§’å¹³åˆ†çº¿å®šç†","é˜¿æ°åœ†","è§’å¹³åˆ†çº¿é€†å®šç†"],"categories":["æ•°å­¦","åˆä¸­"]},{"title":"æ¯”ä¾‹æ€§è´¨","url":"/2025/01/21/æ¯”ä¾‹æ€§è´¨/","content":"\n# æ¯”ä¾‹æ€§è´¨\n\n1. åŸºæœ¬æ€§è´¨\n\n\t\\begin{equation} \n\t\t\\frac{a}{b}=\\frac{c}{d}\\Leftrightarrow ad=bc\\hspace{3cm}(bd\\ne 0)\n\t\\end{equation} \n\n2. åæ¯”æ€§è´¨\n\t\\begin{equation} \n\t\t\\frac{a}{b}=\\frac{c}{d}\\Leftrightarrow \\frac{b}{a}=\\frac{d}{c}\\hspace{3cm}(abcd\\ne 0)\n\t\\end{equation} \n\t\n3. æ›´æ¯”æ€§è´¨\n\t\\begin{equation} \n\t\t\\frac{a}{b}=\\frac{c}{d}\\Leftrightarrow \\frac{a}{c}=\\frac{b}{d}æˆ–\\frac{d}{b}=\\frac{c}{a}\\hspace{3cm}(abcd\\ne 0)\n\t\\end{equation} \n\t\n4. åˆæ¯”æ€§è´¨\n\t\\begin{equation} \n\t\t\\frac{a}{b}=\\frac{c}{d}\\Leftrightarrow \\frac{a+b}{b}=\\frac{c+d}{d}\\hspace{3cm}(bd\\ne 0)\n\t\\end{equation}\n\t\n5. åˆ†æ¯”æ€§è´¨\n\t\\begin{equation} \n\t\t\\frac{a}{b}=\\frac{c}{d}\\Leftrightarrow \\frac{a-b}{b}=\\frac{c-d}{d}\\hspace{3cm}(bd\\ne 0)\n\t\\end{equation}\n\t\n6. åˆåˆ†æ¯”æ€§è´¨\n\t\\begin{equation} \n\t\t\\frac{a}{b}=\\frac{c}{d}\\Leftrightarrow \\frac{a+b}{a-b}=\\frac{c+d}{c-d}\\hspace{3cm}(a\\ne b, c\\ne d)\n\t\\end{equation}\n\t\n7. ç­‰æ¯”æ€§è´¨\n\t\\begin{equation} \n\t\t\\frac{a_{1}}{b_{1}}=\\frac{a_{2}}{b_{2}}=\\frac{a_{3}}{b_{3}}=\\dots=\\frac{a_{k}}{b_{k}}\\Rightarrow \\frac{a_{1}+a_{2}+\\dots+a_{k}}{b_{1}+b_{2}+\\dots+b_{k}}=\\frac{a_{1}}{b_{1}} \\\\ (b_{1}+b_{2}+\\dots+b_{k}\\ne 0)\n\t\\end{equation}","tags":["åæ¯”","æ›´æ¯”","åˆæ¯”","åˆ†æ¯”","åˆåˆ†æ¯”","ç­‰æ¯”"],"categories":["æ•°å­¦","åˆä¸­"]},{"title":"ä¸­çº¿å®šç†","url":"/2025/01/17/ä¸­çº¿å®šç†/","content":"\n# ç®€ä»‹\n\n**ä¸­çº¿å®šç†**ï¼ˆpappuså®šç†ï¼‰ï¼Œåˆç§°**é‡å¿ƒå®šç†**ï¼Œæ˜¯æ¬§æ°å‡ ä½•çš„å®šç†ï¼Œè¡¨è¿°ä¸‰è§’å½¢ä¸‰è¾¹å’Œä¸­çº¿é•¿åº¦å…³ç³»ã€‚\n\nå®šç†å†…å®¹ï¼šä¸‰è§’å½¢ä¸€æ¡ä¸­çº¿ä¸¤ä¾§æ‰€å¯¹è¾¹å¹³æ–¹çš„å’Œç­‰äºåº•è¾¹ä¸€åŠçš„å¹³æ–¹åŠ ä¸Šè¿™æ¡ä¸­çº¿çš„å¹³æ–¹çš„å’Œçš„2å€ã€‚\n\nå³ï¼Œå¯¹ä»»æ„ä¸‰è§’å½¢â–³ABCï¼Œè®¾æ˜¯Içº¿æ®µBCçš„ä¸­ç‚¹ï¼ŒAIä¸ºä¸­çº¿ï¼Œåˆ™æœ‰å¦‚ä¸‹å…³ç³»ï¼š\n\n\\begin{equation}\n\\begin{aligned}\n& AB^2+AC^2=2BI^2+2AI^2 \\\\\n& AB^2+AC^2=\\frac{1}{2}BC^2+2AI^2\n\\end{aligned}\n\\end{equation}\n\n# è¯æ˜\n![ä¸­çº¿å®šç†](ä¸­çº¿å®šç†/ä¸­çº¿å®šç†.jpg)\n","tags":["æ–¯å›¾å°”ç‰¹å®šç†","Stewart","é˜¿æ³¢ç½—å°¼å¥¥æ–¯å®šç†"],"categories":["æ•°å­¦","åˆä¸­"]},{"title":"è§’å¹³åˆ†çº¿å®šç†","url":"/2025/01/16/è§’å¹³åˆ†çº¿å®šç†/","content":"\n# ç®€ä»‹\n\n**ï¼ˆå†…ï¼‰è§’å¹³åˆ†çº¿å®šç†**ï¼šä¸‰è§’å½¢ä¸€è§’çš„å†…è§’å¹³åˆ†çº¿åˆ†å‰²å¯¹è¾¹ä¸ºä¸¤æ®µï¼Œä¸¤æ®µçš„é•¿åº¦ä¹‹æ¯”ç­‰äºä¸¤æ¡é‚»è¾¹çš„é•¿åº¦ä¹‹æ¯”ã€‚åè¿‡æ¥ï¼Œæœ‰**ï¼ˆå†…ï¼‰è§’å¹³åˆ†çº¿é€†å®šç†**ï¼šæŠŠä¸‰è§’å½¢ä¸€è¾¹åˆ†å‰²ä¸ºé•¿åº¦ä¹‹æ¯”ç­‰äºé‚»è¾¹é•¿åº¦ä¹‹æ¯”çš„ä¸¤æ®µï¼Œåˆ™ç»è¿‡åˆ†å‰²ç‚¹ä¸å¯¹è§’é¡¶ç‚¹çš„ç›´çº¿ä¸ºå¯¹è§’çš„å†…è§’å¹³åˆ†çº¿ã€‚\n\nç±»ä¼¼åœ°ï¼Œå­˜åœ¨**å¤–è§’å¹³åˆ†çº¿å®šç†**å’Œ**å¤–è§’å¹³åˆ†çº¿é€†å®šç†**ã€‚å‰è€…æŒ‡çš„æ˜¯ï¼šä¸‰è§’å½¢ä¸€è§’çš„å¤–è§’å¹³åˆ†çº¿ä¸å¯¹è¾¹æ‰€åœ¨çš„ç›´çº¿ç›¸äº¤ï¼Œäº¤ç‚¹åˆ°å¯¹è¾¹ä¸Šä¸¤é¡¶ç‚¹çš„è·ç¦»ä¹‹æ¯”ç­‰äºä¸¤æ¡é‚»è¾¹çš„é•¿åº¦ä¹‹æ¯”ã€‚åè€…æŒ‡çš„æ˜¯ï¼šä¸‰è§’å½¢ä¸€è¾¹çš„å»¶é•¿çº¿ä¸Šæœ‰ä¸€ç‚¹åˆ°è¯¥è¾¹ä¸Šä¸¤é¡¶ç‚¹çš„è·ç¦»ä¹‹æ¯”ç­‰äºå¦å¤–ä¸¤è¾¹çš„é•¿åº¦ä¹‹æ¯”ï¼Œåˆ™ç»è¿‡è¯¥ç‚¹ä¸å¯¹è§’é¡¶ç‚¹çš„ç›´çº¿ä¸ºå¯¹è§’çš„å¤–è§’å¹³åˆ†çº¿ã€‚å†…ã€å¤–è§’å¹³åˆ†çº¿å®šç†ï¼ˆåŠé€†å®šç†ï¼‰ï¼Œåˆç§°**è§’å¹³åˆ†çº¿å®šç†**ï¼ˆåŠ**è§’å¹³åˆ†çº¿é€†å®šç†**ï¼‰ï¼Œåˆç§°**è§’å¹³åˆ†çº¿æ€§è´¨**ã€‚\n\n# è¯æ˜\n\n## å†…è§’å¹³åˆ†çº¿å®šç†åŠé€†å®šç†\n\n![å†…è§’å¹³åˆ†çº¿å®šç†](è§’å¹³åˆ†çº¿å®šç†/å†…è§’å¹³åˆ†çº¿å®šç†çš„è¯æ˜.png)\n\n## å¤–è§’å¹³åˆ†çº¿å®šç†åŠé€†å®šç†\n\n![å¤–è§’å¹³åˆ†çº¿å®šç†](è§’å¹³åˆ†çº¿å®šç†/å¤–è§’å¹³åˆ†çº¿å®šç†çš„è¯æ˜.png)\n\n","tags":["è§’å¹³åˆ†çº¿å®šç†","å†…è§’å¹³åˆ†çº¿","å¤–è§’å¹³åˆ†çº¿"],"categories":["æ•°å­¦","åˆä¸­"]},{"title":"Linuxé‡å®šå‘æŠ€å·§","url":"/2025/01/07/Linuxé‡å®šå‘æŠ€å·§/","content":"\n# linuxè¾“å‡ºé‡å®šå‘\n\n```shell\ncommand > file 2>&1\ncommand >> file 2>&1\n```\n\næ”¾åœ¨`>`åé¢çš„`&`ï¼Œè¡¨ç¤ºé‡å®šå‘çš„ç›®æ ‡ä¸æ˜¯ä¸€ä¸ª**æ–‡ä»¶**ï¼Œè€Œæ˜¯ä¸€ä¸ª**æ–‡ä»¶æè¿°ç¬¦**ï¼Œå†…ç½®çš„æ–‡ä»¶æè¿°ç¬¦å¦‚ä¸‹:\n```\n1 => stdout\n2 => stderr\n0 => stdin\n```\n\næ¢è¨€ä¹‹ `2>1` ä»£è¡¨å°†**stderr**é‡å®šå‘åˆ°å½“å‰è·¯å¾„ä¸‹æ–‡ä»¶åä¸º**1**çš„**regular file**ä¸­ï¼Œè€Œ`2>&1`ä»£è¡¨å°†**stderr**é‡å®šå‘åˆ°**æ–‡ä»¶æè¿°ç¬¦**ä¸º**1**çš„æ–‡ä»¶(å³`/dev/stdout`)ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯**stdout**åœ¨**file system**ä¸­çš„æ˜ å°„\nè€Œ**&>file**æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç”¨æ³•ï¼Œä¹Ÿå¯ä»¥å†™æˆ**>&file**ï¼ŒäºŒè€…çš„æ„æ€å®Œå…¨ç›¸åŒï¼Œéƒ½ç­‰ä»·äº\n\n```\n>file 2>&1\n```\n\n> æ­¤å¤„`&>`æˆ–è€…`>&`è§†ä½œæ•´ä½“ï¼Œåˆ†å¼€æ²¡æœ‰å•ç‹¬çš„å«ä¹‰\n\n**é¡ºåºé—®é¢˜ï¼š**\n\n```shell\nfind /etc -name .bashrc > list 2>&1\n# ä¸ºä»€ä¹ˆä¸èƒ½è°ƒä¸‹é¡ºåº,æ¯”å¦‚è¿™æ ·\nfind /etc -name .bashrc 2>&1 > list\n```\n\nç¬¬ä¸€ç§ï¼š\n\n```shell\nxxx > list 2>&1\n```\n\n- **å«ä¹‰ï¼š**\n\nâ€‹\t`> list`ï¼šå°†**æ ‡å‡†è¾“å‡º**ï¼ˆæ–‡ä»¶æè¿°ç¬¦ 1ï¼‰é‡å®šå‘åˆ°æ–‡ä»¶ listã€‚\n\nâ€‹\t`2>&1`ï¼šå°†**æ ‡å‡†é”™è¯¯**ï¼ˆæ–‡ä»¶æè¿°ç¬¦ 2ï¼‰é‡å®šå‘åˆ°ä¸æ ‡å‡†è¾“å‡ºç›¸åŒçš„ä½ç½®ã€‚\n\n- **æ‰§è¡Œé¡ºåºï¼š**\n\nâ€‹\t1. > list é¦–å…ˆå°†æ ‡å‡†è¾“å‡ºæŒ‡å‘æ–‡ä»¶ listã€‚\n\nâ€‹\t2. 2>&1 å°†æ ‡å‡†é”™è¯¯æŒ‡å‘ä¸æ ‡å‡†è¾“å‡ºç›¸åŒçš„åœ°æ–¹ï¼ˆå³æ–‡ä»¶ listï¼‰ã€‚\n\n- **æ•ˆæœï¼š**\n\nâ€‹\t**æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯éƒ½è¢«é‡å®šå‘åˆ°æ–‡ä»¶** list **ä¸­**ã€‚\n\nâ€‹\tè¿™æ˜¯æ­£ç¡®çš„ç”¨æ³•ã€‚\n\nç¬¬äºŒç§ï¼š\n\n```shell\nxxx 2>&1 > list\n```\n\n- **å«ä¹‰ï¼š**\n\nâ€‹\t`2>&1`ï¼šå°†**æ ‡å‡†é”™è¯¯**ï¼ˆæ–‡ä»¶æè¿°ç¬¦ 2ï¼‰é‡å®šå‘åˆ°å½“å‰çš„æ ‡å‡†è¾“å‡ºã€‚\n\nâ€‹\t`> list`ï¼šå°†**æ ‡å‡†è¾“å‡º**ï¼ˆæ–‡ä»¶æè¿°ç¬¦ 1ï¼‰é‡å®šå‘åˆ°æ–‡ä»¶ listã€‚\n\n- **æ‰§è¡Œé¡ºåºï¼š**\n\nâ€‹\t1. 2>&1 é¦–å…ˆå°†æ ‡å‡†é”™è¯¯æŒ‡å‘å½“å‰æ ‡å‡†è¾“å‡ºçš„ä½ç½®ã€‚\n\nâ€‹\t2. ç„¶åï¼Œ> list å°†æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ listï¼Œä½†æ­¤æ—¶æ ‡å‡†é”™è¯¯ä»ç„¶æŒ‡å‘åŸå§‹çš„æ ‡å‡†è¾“å‡ºï¼ˆå¯èƒ½æ˜¯ç»ˆç«¯ï¼‰ã€‚\n\n- **æ•ˆæœï¼š**\n\nâ€‹\t**æ ‡å‡†è¾“å‡ºè¢«å†™å…¥æ–‡ä»¶** listã€‚\n\nâ€‹\t**æ ‡å‡†é”™è¯¯ä»ç„¶è¾“å‡ºåˆ°ç»ˆç«¯**ï¼ˆå› ä¸ºå®ƒæŒ‡å‘çš„æ˜¯åŸå§‹æ ‡å‡†è¾“å‡ºï¼Œè€Œä¸æ˜¯æ–‡ä»¶ listï¼‰ã€‚\n\nâ€‹\tå¯¼è‡´æ— æ³•å®ç°æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯çš„ç»Ÿä¸€é‡å®šå‘ã€‚\n\n# è¾“å…¥é‡å®šå‘\n\n```shell\nwc < test.txt\n```\n\næŠŠtest.txtçš„å†…å®¹ä½œä¸º`wc`çš„è¾“å…¥ï¼Œæ•ˆæœå’Œä»¥ä¸‹å‘½ä»¤ç±»ä¼¼ï¼š\n\n```shell\ncat test.txt | wc\n```\n\næŠŠtest.txtçš„å†…å®¹é€šè¿‡ç®¡é“ä¼ è¾“ç»™`wc`\n\n# dev/null\n\nå¦‚æœå¸Œæœ›æ‰§è¡ŒæŸä¸ªå‘½ä»¤ï¼Œä½†åˆä¸å¸Œæœ›åœ¨å±å¹•ä¸Šæ˜¾ç¤ºè¾“å‡ºç»“æœï¼Œé‚£ä¹ˆå¯ä»¥å°†è¾“å‡ºé‡å®šå‘åˆ° /dev/nullï¼š\n\n```shell\ncommand > /dev/null\n```\n\n/dev/null æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ï¼Œå†™å…¥åˆ°å®ƒçš„å†…å®¹éƒ½ä¼šè¢«ä¸¢å¼ƒï¼›å¦‚æœå°è¯•ä»è¯¥æ–‡ä»¶è¯»å–å†…å®¹ï¼Œé‚£ä¹ˆä»€ä¹ˆä¹Ÿè¯»ä¸åˆ°ã€‚ä½†æ˜¯ /dev/null æ–‡ä»¶éå¸¸æœ‰ç”¨ï¼Œå°†å‘½ä»¤çš„è¾“å‡ºé‡å®šå‘åˆ°å®ƒï¼Œä¼šèµ·åˆ°\"ç¦æ­¢è¾“å‡º\"çš„æ•ˆæœã€‚\n\nå¦‚æœå¸Œæœ›å±è”½ `stdout `å’Œ `stderr`ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š\n\n```shell\ncommand > /dev/null 2>&1\n```\n\n# é‡å®šå‘æ·±å…¥\n\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¯ä¸ª Unix/Linux å‘½ä»¤è¿è¡Œæ—¶éƒ½ä¼šæ‰“å¼€ä¸‰ä¸ªæ–‡ä»¶ï¼š\n\n- æ ‡å‡†è¾“å…¥æ–‡ä»¶(stdin)ï¼šstdinçš„æ–‡ä»¶æè¿°ç¬¦ä¸º0ï¼ŒUnixç¨‹åºé»˜è®¤ä»stdinè¯»å–æ•°æ®ã€‚\n- æ ‡å‡†è¾“å‡ºæ–‡ä»¶(stdout)ï¼šstdout çš„æ–‡ä»¶æè¿°ç¬¦ä¸º1ï¼ŒUnixç¨‹åºé»˜è®¤å‘stdoutè¾“å‡ºæ•°æ®ã€‚\n- æ ‡å‡†é”™è¯¯æ–‡ä»¶(stderr)ï¼šstderrçš„æ–‡ä»¶æè¿°ç¬¦ä¸º2ï¼ŒUnixç¨‹åºä¼šå‘stderræµä¸­å†™å…¥é”™è¯¯ä¿¡æ¯ã€‚\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œcommand > file å°† stdout é‡å®šå‘åˆ° fileï¼Œcommand < file å°†stdin é‡å®šå‘åˆ° fileã€‚\n\nå¦‚æœå¸Œæœ› stderr é‡å®šå‘åˆ° fileï¼Œå¯ä»¥è¿™æ ·å†™:\n\n```shell\ncommand 2 > file\n```\n\nå¦‚æœå¸Œæœ› stderr è¿½åŠ åˆ° file æ–‡ä»¶æœ«å°¾ï¼Œå¯ä»¥è¿™æ ·å†™:\n\n```shell\ncommand 2 >> file\n```\n\nå¦‚æœå¸Œæœ›å°† stdout å’Œ stderr åˆå¹¶åé‡å®šå‘åˆ° fileï¼Œå¯ä»¥è¿™æ ·å†™ï¼š\n\n```shell\ncommand > file 2>&1\n# æˆ–è€…\ncommand >> file 2>&1\n```\n\nå¦‚æœå¸Œæœ›å¯¹ stdin å’Œ stdout éƒ½é‡å®šå‘ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š\n\n```shell\ncommand < file1 >file2\n```\n\ncommand å‘½ä»¤å°† stdin é‡å®šå‘åˆ° file1ï¼Œå°† stdout é‡å®šå‘åˆ° file2ã€‚\n\næ³¨æ„ï¼šä¸ºä»€ä¹ˆéœ€è¦å°†æ ‡å‡†é”™è¯¯é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºï¼Œå› ä¸ºæ ‡å‡†é”™è¯¯æ²¡æœ‰ç¼“å†²åŒºï¼Œè€Œstdoutæœ‰ã€‚\n\n| å‘½ä»¤            | è¯´æ˜                                               |\n| --------------- | -------------------------------------------------- |\n| command > file  | å°†è¾“å‡ºé‡å®šå‘åˆ° fileã€‚                              |\n| command < file  | å°†è¾“å…¥é‡å®šå‘åˆ° fileã€‚                              |\n| command >> file | å°†è¾“å‡ºä»¥è¿½åŠ çš„æ–¹å¼é‡å®šå‘åˆ° fileã€‚                  |\n| n > file        | å°†æ–‡ä»¶æè¿°ç¬¦ä¸º n çš„æ–‡ä»¶é‡å®šå‘åˆ° fileã€‚             |\n| n >> file       | å°†æ–‡ä»¶æè¿°ç¬¦ä¸º n çš„æ–‡ä»¶ä»¥è¿½åŠ çš„æ–¹å¼é‡å®šå‘åˆ° fileã€‚ |\n| n >& m          | å°†è¾“å‡ºæ–‡ä»¶ m å’Œ n åˆå¹¶ã€‚                           |\n| n <& m          | å°†è¾“å…¥æ–‡ä»¶ m å’Œ n åˆå¹¶ã€‚                           |\n| << tag          | å°†å¼€å§‹æ ‡è®° tag å’Œç»“æŸæ ‡è®° tag ä¹‹é—´çš„å†…å®¹ä½œä¸ºè¾“å…¥ã€‚ |\n","tags":["linux","é‡å®šå‘"],"categories":["Linux"]},{"title":"æ–¯ç‰¹ç“¦å°”ç‰¹å®šç†","url":"/2024/07/14/æ–¯ç‰¹ç“¦å°”ç‰¹å®šç†/","content":"\n# æ–¯ç‰¹ç“¦å°”ç‰¹å®šç†\n\n**æ–¯å›¾å°”ç‰¹å®šç†**ï¼ˆStewart's Theoremï¼‰æˆ–è¯‘**å²éƒ½åå®šç†ã€æ–¯ç‰¹ç“¦å°”ç‰¹å®šç†ã€æ–¯å›¾æ²ƒç‰¹å®šç†**ã€‚\n\n\\begin{equation} \n\\begin{aligned}\nåœ¨\\triangle ABC ä¸­ï¼Œåœ¨è¾¹BCä¸Šå–ä»»æ„ä¸€ç‚¹Pï¼Œåˆ™æœ‰ï¼š \\\\\n\\overline{AB}^2\\cdot \\overline{PC} + \\overline{AC}^2 \\cdot \\overline{PB} = \\overline{PA}^2 \\cdot \\overline{BC} + \\overline{BC} \\cdot \\overline{PB} \\cdot \\overline{PC} \\\\\n\\end{aligned}\n\\end{equation}\n\n![](./æ–¯ç‰¹ç“¦å°”ç‰¹å®šç†/Snipaste_2024-07-14_12-40-16.png)\n\nè¯æ˜è¿‡ç¨‹ï¼š\n![](./æ–¯ç‰¹ç“¦å°”ç‰¹å®šç†/Snipaste_2024-07-14_13-53-07.png)\n\n","tags":["æ–¯å›¾å°”ç‰¹å®šç†","Stewart","é˜¿æ³¢ç½—å°¼å¥¥æ–¯å®šç†"],"categories":["æ•°å­¦","åˆä¸­"]},{"title":"jenkins-pipelineé¡¹ç›®å®æˆ˜","url":"/2024/07/12/jenkins-pipelineé¡¹ç›®å®æˆ˜/","content":"\n# Jenkins pipelineä»»åŠ¡\n\n- éœ€è¦å®‰è£…æ’ä»¶ï¼š`Pipeline`\n\n- åˆ›å»ºPipelineä»»åŠ¡ï¼Œé…ç½®`æ„å»ºè§¦å‘å™¨`ï¼Œè¿™ä¸ªæ—¢ç„¶æ˜¯æµæ°´çº¿ä»»åŠ¡ï¼Œè¦å…ˆæœ‰ä¸ªåœ°æ–¹è§¦å‘è¿™ä¸ªä»»åŠ¡çš„æ‰§è¡Œï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºä¸€ä¸ª`webhook URL`ã€‚æˆ‘ä»¬éœ€è¦å®ç°çš„ç›®æ ‡æ˜¯ï¼Œå½“gitlabä¸Šæäº¤ä»£ç æˆ–è€…åˆ›å»º`push tag`æ—¶ï¼ŒæŠŠè¿™äº›äº‹ä»¶é€šçŸ¥åˆ°jenkinsï¼Œè®©å®ƒå¯åŠ¨è¿™ä¸ªæµæ°´çº¿ï¼Œæ‰€ä»¥è¿™é‡Œçš„`webhook URL`å°±æ˜¯ç”¨æ¥æ¥æ”¶gitlabå‘é€çš„é€šçŸ¥ç”¨çš„ï¼Œä½†jenkinsä¹Ÿä¸å¯èƒ½æ— æ¡ä»¶æ¥æ”¶æ‰€æœ‰çš„é€šçŸ¥ä¿¡æ¯ï¼Œæ‰€ä»¥è¿™é‡Œè¿˜æœ‰ä¸€ä¸ª`token`ï¼Œåªæœ‰`token`å¯ä»¥åœ¨é…ç½®ç•Œé¢ä¸­ç”Ÿæˆã€‚\n\n  ![æ„å»ºè§¦å‘å™¨é…ç½®](./jenkins-pipelineé¡¹ç›®å®æˆ˜/Snipaste_2024-07-12_11-09-01.png)\n\tTOKENçš„ç”Ÿæˆæ˜¯åœ¨**é«˜çº§**é€‰é¡¹ä¸­\n\t![tokençš„ç”Ÿæˆ](./jenkins-pipelineé¡¹ç›®å®æˆ˜/Snipaste_2024-07-12_11-16-58.png)\n\n- åœ¨`gitlab`ä¸­é…ç½®äº‹ä»¶é€šçŸ¥\n\tè¿›å…¥åˆ°gitlabä¸­é¡¹ç›®çš„`settings->integrations`\n\t- å¡«å†™`URL`ï¼Œå³jenkins pipeline ä»»åŠ¡çš„ webhook url\n\t- å¡«å†™`Secret Token`ï¼Œå³jenkins pipeline ä»»åŠ¡ä¸­ç”Ÿæˆçš„ token\n\t- Triggerä¸­æ ¹æ®éœ€è¦å‹¾é€‰ï¼Œæ¯”å¦‚å‹¾é€‰äº†`Tag push events`ï¼Œæ¯å½“ä½ åˆ›å»ºäº†æ–°çš„tagåï¼Œgitlabå°±ä¼šè§¦å‘ï¼ˆå‘é€é€šçŸ¥åˆ°webhook urlï¼‰jenkis pipelineä»»åŠ¡å¯åŠ¨\n\n- é…ç½®pipelineè„šæœ¬\n\n\t```groovy\n\tpipeline {\n\t    agent any\n\t\n\t    environment {\n\t        GIT_URL_FATE_BUILDER = \"http://x.x.x.x/YunPCDS/pcds-bfia/pcds-builder.git\"\n\t        GIT_URL_FATE = \"http://x.x.x.x/YunPCDS/pcds-bfia/fate.git\"\n\t        GIT_CREDENTIALS_ID = \"gitå¸å·åœ¨Jenkinsä¸­çš„å‡­æ®ID\"\n\t\n\t        DEST_PATH = '/home/centos/builder'\n\t\n\t        // è§¦å‘æ„å»ºçš„gitlab tag è·å–åˆ°çš„å€¼æ ·ä¾‹ï¼š refs/tags/v0.0.1-test\n\t        GITLAB_TAG_NAME = \"\"\n\t        // dockeré•œåƒæ ‡ç­¾\n\t        DOCKER_IMAGE_TAG = \"\"\n\t\n\t        SUBDIRECTORY_FATE = \"fate\"\n\t        SUBDIRECTORY_FATE_BUILDER = \"pcds-builder\"\n\t\n\t        PREFIX = \"yunpcds\"\n\t        // DOCKERHUBï¼Œç”¨äºæœ€åpush dockeré•œåƒ\n\t        DOCKER_REGISTRY = \"x.x.x.x:xxxx\"\n\t        // æœåŠ¡å™¨å”¯ä¸€æ ‡è¯†ï¼Œç”¨æ¥æŒ‡å®šåœ¨å“ªå°æœåŠ¡å™¨ä¸Šæ‰§è¡Œshellè„šæœ¬ï¼ˆå› ä¸ºä»»åŠ¡ä¸­æœ‰ä¸€ä¸ªæ­¥éª¤éœ€è¦åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡Œshellè„šæœ¬ï¼‰\n\t        HOST_SERVER_NAME = \"xxxx\"\n\t        // è®¾ç½®ä»£ç†ï¼ˆå¯é€‰ï¼‰\n\t        PROXY = \"http://x.x.x.x:xxxx http_proxy=http://x.x.x.x:xxxx all_proxy=socks5://x.x.x.x:xxxx\"\n\t        PCDS_WORKSPACE = \"\"\n\t        FATE_DIR = \"\"\n\t        BUILD_DIR = \"\"\n\t    }\n\t\n\t    stages {\n\t        // æ‰“å°æ‰€æœ‰ç¯å¢ƒå˜é‡ï¼Œä¾¿äºæŸ¥çœ‹è§¦å‘çš„Tagæ˜¯å“ªä¸ªç¯å¢ƒå˜é‡\n\t        stage('Print All Environment') {\n\t            steps {\n\t                script {\n\t                    sh 'printenv'\n\t                }\n\t            }\n\t        }\n\t\n\t        stage('Prepare Gitlab Tag Name') {\n\t            steps {\n\t                script {\n\t                    // è·å–è§¦å‘æ„å»ºçš„tag\n\t                    GITLAB_TAG_NAME = env.gitlabBranch\n\t                    def tagName = GITLAB_TAG_NAME.replace(\"refs/tags/\", \"\")\n\t                    DOCKER_IMAGE_TAG = tagName\n\t                    echo \"Triggered by GitLab tag: ${GITLAB_TAG_NAME}\"\n\t                    echo \"Setting DOCKER IMAGE TAG to ${DOCKER_IMAGE_TAG}\"\n\t                    PCDS_WORKSPACE = '/home/centos/jenkins/workspace/${JOB_NAME}'\n\t                    echo \"PCDS_WORKSPACE ==> ${PCDS_WORKSPACE}\"\n\t                    FATE_DIR = '${PCDS_WORKSPACE}/fate'\n\t                    BUILD_DIR = '${PCDS_WORKSPACE}/pcds-builder/docker-build'\n\t                }\n\t            }\n\t\n\t        }\n\t\n\t        stage('git checkout fate-builder') {\n\t            steps {\n\t                dir(\"${SUBDIRECTORY_FATE_BUILDER}\") {\n\t                    checkout([$class           : 'GitSCM', branches: [[name: \"dev-2.1.0\"]],\n\t                              userRemoteConfigs: [[credentialsId: \"${GIT_CREDENTIALS_ID}\", url: \"${GIT_URL_FATE_BUILDER}\"]]\n\t                    ])\n\t                }\n\t            }\n\t        }\n\t\n\t        stage('git checkout fate') {\n\t            steps {\n\t                dir(\"${SUBDIRECTORY_FATE}\") {\n\t                    checkout([$class           : 'GitSCM', branches: [[name: \"${GITLAB_TAG_NAME}\"]],\n\t                              userRemoteConfigs: [[credentialsId: \"${GIT_CREDENTIALS_ID}\", url: \"${GIT_URL_FATE}\"]]\n\t                    ])\n\t                }\n\t            }\n\t        }\n\t\n\t        stage('Docker Build and Push') {\n\t            steps {\n\t                sshPublisher(publishers: [sshPublisherDesc(configName: \"${HOST_SERVER_NAME}\", transfers: [sshTransfer(cleanRemote: false, excludes: '', execCommand: \"\"\"\n\t            export PCDS_WORKSPACE=${PCDS_WORKSPACE}\n\t            echo 'PCDS_WORKSPACE: ${PCDS_WORKSPACE}'\n\t\n\t            export FATE_DIR=${FATE_DIR}\n\t            export BUILD_DIR=${BUILD_DIR}\n\t\n\t            cd ${BUILD_DIR}/\n\t\n\t            echo 'PROXY: ${PROXY}'\n\t            export https_proxy=${PROXY}\n\t\n\t            PREFIX=${DOCKER_REGISTRY}/${PREFIX} GIT_TAG=${DOCKER_IMAGE_TAG}  bash -x build.sh all\n\t\n\t            docker login -u admin -p yunphant ${DOCKER_REGISTRY}\n\t\n\t            echo \"start push image\"\n\t            PREFIX=\"${DOCKER_REGISTRY}/${PREFIX}\" GIT_TAG=\"${DOCKER_IMAGE_TAG}\"  bash -x build.sh push\n\t            echo \"finish push image\"\n\t\n\t          \"\"\", execTimeout: 7200000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: '[, ]+',\n\t                        remoteDirectory: \"${PCDS_WORKSPACE}\", remoteDirectorySDF: false, removePrefix: '', sourceFiles: \"\")],\n\t                        usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: true)])\n\t\n\t                echo 'Docker Buildã€Push  SUCCESS'\n\t            }\n\t        }\n\t    }\n\t}\n\t```\n\t\n\t\n","tags":["jenkins","pipeline","webhook"],"categories":["äº‘åŸç”Ÿ","åŸºç¡€è®¾æ–½"]},{"title":"jenkinsæ­å»º","url":"/2024/06/13/jenkinsæ­å»º/","content":"\n# æ‹‰å–jenkinsæ–°ç‰ˆ\n\n```\ndocker pull jenkins/jenkins:latest\n```\n\n> æœ€è¿‘å›½å†…dockerä»“åº“é•œåƒä¼¼ä¹éƒ½å·²ä¸‹æ¶ï¼Œå¦‚æœä½¿ç”¨å›½å†…é•œåƒä»“åº“ï¼Œæ‹‰åˆ°çš„å¯èƒ½éƒ½æ˜¯æ—§ç‰ˆæœ¬\n\n\n# è¿è¡Œjenkinså®¹å™¨\n\n\n```shell\ndocker run -itd -p 8082:8080 -p 50000:50000 --name jenkins --privileged=true -v /home/centos/jenkins:/var/jenkins_home jenkins/jenkins:latest\n```\n\n# å®‰è£…å¸¸ç”¨æ’ä»¶\n\n- [Command Agent Launcher Pluginç‰ˆæœ¬107.v773860566e2e](https://plugins.jenkins.io/command-launcher)\n- [Extended Choice Parameter Pluginç‰ˆæœ¬382.v5697b_32134e8](https://plugins.jenkins.io/extended-choice-parameter)\n- [Git Parameter Plug-Inç‰ˆæœ¬0.9.19](https://plugins.jenkins.io/git-parameter)\n- [JavaMail APIç‰ˆæœ¬1.6.2-10](https://plugins.jenkins.io/javax-mail-api)\n- [Localization: Chinese (Simplified)ç‰ˆæœ¬371.v23851f835d6b_](https://plugins.jenkins.io/localization-zh-cn)\n- [Multiple SCMs pluginç‰ˆæœ¬0.8](https://plugins.jenkins.io/multiple-scms)\n- [Oracle Java SE Development Kit Installer Pluginç‰ˆæœ¬73.vddf737284550](https://plugins.jenkins.io/jdk-tool)\n- [Publish Over SSHç‰ˆæœ¬1.25](https://plugins.jenkins.io/publish-over-ssh)\n- [SSH Agent Pluginç‰ˆæœ¬367.vf9076cd4ee21](https://plugins.jenkins.io/ssh-agent)\n- [SSH Build Agents pluginç‰ˆæœ¬2.968.v6f8823c91de4](https://plugins.jenkins.io/ssh-slaves)\n- [SSH pluginç‰ˆæœ¬2.6.1](https://plugins.jenkins.io/ssh)\n- [SSH serverç‰ˆæœ¬3.330.vc866a_8389b_58](https://plugins.jenkins.io/sshd)\n\n> éœ€è¦ç§‘å­¦ä¸Šç½‘å®‰è£…æ’ä»¶\n","tags":["jenkins"],"categories":["äº‘åŸç”Ÿ","åŸºç¡€è®¾æ–½"]},{"title":"å¡ç“¦å®šç†å’Œæ¢…æ¶…åŠ³æ–¯å®šç†","url":"/2024/06/09/å¡ç“¦å®šç†å’Œæ¢…æ¶…åŠ³æ–¯å®šç†/","content":"\n# å®šç†è¯æ˜\n\n[å¼ æ™¯ä¸­](https://www.zhihu.com/search?q=å¼ æ™¯ä¸­&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={\"sourceType\"%3A\"answer\"%2C\"sourceId\"%3A603252421})é™¢å£«åœ¨ã€Šæ–°æ¦‚å¿µå‡ ä½•ã€‹ä¸­åˆ©ç”¨ã€Œ[å…±è¾¹å®šç†](https://www.zhihu.com/search?q=å…±è¾¹å®šç†&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra={\"sourceType\"%3A\"answer\"%2C\"sourceId\"%3A603252421})ã€è¯æ˜ã€Œæ¢…æ¶…åŠ³æ–¯å®šç†ã€å’Œã€Œå¡ç“¦å®šç†ã€ï¼Œè¯æ˜é•¿åº¦å‡ä¸ºä¸€è¡Œï¼Œè€Œä¸”å¼•ç†æœ¬èº«ä¹Ÿæ˜¯è¶³å¤Ÿç®€æ˜ç›´è§‚ï¼Œä»‹ç»å¦‚ä¸‹ï¼š\n\n- å…±è¾¹å®šç†\n\n  \\begin{equation}\n  \\begin{aligned}\n  &\\frac{S_{\\triangle PAB}}{S_{\\triangle QAB}}=\\frac{PM}{QM}\n  \\end{aligned}\n  \\end{equation}\n  \n  è¯¥å®šç†æœ‰å››ç§æƒ…å†µï¼Œå¦‚ä¸‹å›¾ï¼š\n  \n  ![](å¡ç“¦å®šç†å’Œæ¢…æ¶…åŠ³æ–¯å®šç†/å…±è¾¹å®šç†.png)\n\n- å¡ç“¦å®šç†ï¼ˆCeva's theoremï¼‰\n\n  ä¸‰è§’å½¢å†…ä¸‰çº¿äº¤äºä¸€ç‚¹ï¼Œåˆ™æœ‰ä»¥ä¸‹å…³ç³»ï¼š\n\n  \\begin{equation}\n  \\begin{aligned}\n  &\\frac{AF}{FB}\\cdot\\frac{BD}{DC}\\cdot\\frac{CE}{EA}=1\n  \\end{aligned}\n  \\end{equation}\n\n![](å¡ç“¦å®šç†å’Œæ¢…æ¶…åŠ³æ–¯å®šç†/å¡ç“¦å®šç†ç¤ºä¾‹å›¾.png)\n\n  \\begin{equation}\n  \\begin{aligned}\n  &\\frac{AF}{FB}\\cdot\\frac{BD}{DC}\\cdot\\frac{CE}{EA}=\\frac{S_{\\triangle GAC}}{S_{\\triangle GBC}}\\cdot\\frac{S_{\\triangle GBA}}{S_{\\triangle GAC}}\\cdot\\frac{S_{\\triangle GBC}}{S_{\\triangle GBA}}=1\n  \\end{aligned}\n  \\end{equation}\n\n- æ¢…æ¶…åŠ³æ–¯å®šç†ï¼ˆMenelaus' theoremï¼‰\n\n\tè¿‡ä¸‰è§’å½¢ä¸€è¾¹ä¸Šçš„ç‚¹åšä¸€ç›´çº¿ï¼Œåˆ†åˆ«ä¸å…¶ä½™ä¸¤è¾¹æˆ–å…¶å»¶é•¿çº¿æ‰€æˆªï¼Œåˆ™æ»¡è¶³ä¸€ä¸‹å…³ç³»ï¼š\n\n\t\\begin{equation}\n\t\\begin{aligned}\n\t&\\frac{AF}{FB}\\cdot\\frac{BD}{DC}\\cdot\\frac{CE}{EA}=1\n\t\\end{aligned}\n\t\\end{equation}\n\t\n\n![](å¡ç“¦å®šç†å’Œæ¢…æ¶…åŠ³æ–¯å®šç†/æ¢…æ¶…åŠ³æ–¯å®šç†ç¤ºä¾‹å›¾.png)\n\n  \\begin{equation}\n  \\begin{aligned}\n  &\\frac{AF}{FB}\\cdot\\frac{BD}{DC}\\cdot\\frac{CE}{EA}=\\frac{S_{\\triangle AED}}{S_{\\triangle BED}} \\cdot \\frac{S_{\\triangle BED}}{S_{\\triangle CED}}  \\cdot \\frac{S_{\\triangle CED}}{S_{\\triangle AED}}=1\n  \\end{aligned}\n  \\end{equation}\n\n- ä¾‹é¢˜\n\n  ![](å¡ç“¦å®šç†å’Œæ¢…æ¶…åŠ³æ–¯å®šç†/å·´èœ€ä¸­å­¦å¹³é¢å‡ ä½•è®²ä¹‰-1.1-é—®é¢˜4.png)\n","tags":["å¡ç“¦å®šç†","æ¢…æ¶…åŠ³æ–¯å®šç†","å…±è¾¹å®šç†"],"categories":["æ•°å­¦","åˆä¸­"]},{"title":"ç‰›é¡¿æ’ç­‰å¼","url":"/2024/06/02/ç‰›é¡¿æ’ç­‰å¼/","content":"\n\\begin{equation}\n\\begin{aligned}\n&è®¾a,b,c æ»¡è¶³a+b+c=1, a^2+b^2+c^2=2, a^3+b^3+c^3=3ï¼Œæ±‚: \\\\\n&(1) abc çš„å€¼ \\\\\n&(2) a^4+b^4+c^4çš„å€¼ \\\\\n\\\\\n&(1) è§£ï¼š\\\\\n&(a+b+c)^2=a^2+b^2+c^2+2ab+2bc+2ca=1 \\\\\n&ab+bc+ca=-\\frac{1}{2} \\\\\n&\\because a^3+b^3+c^3-3abc=(a+b+c)(a^2+b^2+c^2-ab-bc-ca) \\\\\n&\\therefore 3-3abc=2+\\frac{1}{2} \\\\\n&abc=\\frac{1}{6} \\\\\n\\\\\n&(2) è§£ï¼š\\\\\n&a^4+b^4+c^4=(a^2+b^2+c^2)^2-2a^2b^2-2b^2c^2-2c^2a^2 \\\\\n&=4-2(a^2b^2+b^2c^2+c^2a^2) \\\\\n&=4-2[(ab+bc+ca)^2-2abc(a+b+c)] \\\\\n&=4-2(\\frac{1}{4}-2\\cdot \\frac{1}{6})=\\frac{25}{6}\n\\end{aligned}\n\\end{equation}\n","tags":["ç‰›é¡¿æ’ç­‰å¼"],"categories":["æ•°å­¦","åˆä¸­"]},{"title":"DockerçŸ¥è¯†ç‚¹03","url":"/2024/05/24/DockerçŸ¥è¯†ç‚¹03/","content":"\n# å¯¼è¯»\n\n- ç¼–è¯‘ç”Ÿæˆåº”ç”¨çš„jaråŒ…\n- æ„å»ºåº”ç”¨çš„dockeré•œåƒ\n- ç¼–å†™è‡ªåŠ¨åŒ–è„šæœ¬\n- ç¼–å†™docker-compose.yaml\n\n# ç¼–è¯‘jaråŒ…\n\nä½¿ç”¨mavenæ‰“åŒ…,pomæ–‡ä»¶å¦‚ä¸‹ï¼š\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n         xmlns=\"http://maven.apache.org/POM/4.0.0\"\n         xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <groupId>fateboard</groupId>\n    <artifactId>fateboard</artifactId>\n    <version>2.1.0</version>\n\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>2.7.18</version>\n        <relativePath/>\n    </parent>\n\n    <packaging>jar</packaging>\n\n    <name>fateboard</name>\n    <description>fateboard</description>\n\n    <properties>\n        <druid.version>1.1.10</druid.version>\n<!--        <druid.version>1.1.10</druid.version>-->\n        <lombok.version>1.18.24</lombok.version>\n        <jasypt.version>2.0.0</jasypt.version>\n\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>\n        <java.version>1.8</java.version>\n        <log4j2.version>2.17.2</log4j2.version>\n        <spring.cloud-version>2021.0.3</spring.cloud-version>\n    </properties>\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n            <exclusions>\n                <exclusion>\n                    <groupId>org.springframework.boot</groupId>\n                    <artifactId>spring-boot-starter-logging</artifactId>\n                </exclusion>\n            </exclusions>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-log4j2</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework</groupId>\n            <artifactId>spring-webmvc</artifactId>\n            <version>5.3.27</version>\n            <scope>compile</scope>\n        </dependency>\n\n        <!-- https://mvnrepository.com/artifact/org.apache.commons/commons-lang3 -->\n        <dependency>\n            <groupId>org.apache.commons</groupId>\n            <artifactId>commons-lang3</artifactId>\n            <version>3.12.0</version>\n        </dependency>\n\n        <dependency>\n            <groupId>ch.ethz.ganymed</groupId>\n            <artifactId>ganymed-ssh2</artifactId>\n            <version>262</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-actuator</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>commons-fileupload</groupId>\n            <artifactId>commons-fileupload</artifactId>\n            <version>1.5</version>\n        </dependency>\n\n        <dependency>\n            <groupId>commons-io</groupId>\n            <artifactId>commons-io</artifactId>\n            <version>2.11.0</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-thymeleaf</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>com.alibaba</groupId>\n            <artifactId>fastjson</artifactId>\n            <version>1.2.83</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-websocket</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>com.google.guava</groupId>\n            <artifactId>guava</artifactId>\n            <version>32.0.1-android</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.apache.httpcomponents</groupId>\n            <artifactId>httpclient</artifactId>\n            <version>4.5.13</version>\n        </dependency>\n\n        <dependency>\n            <groupId>junit</groupId>\n            <artifactId>junit</artifactId>\n            <version>4.13.2</version>\n        </dependency>\n\n        <!-- https://mvnrepository.com/artifact/com.jcraft/jsch -->\n        <dependency>\n            <groupId>com.jcraft</groupId>\n            <artifactId>jsch</artifactId>\n            <version>0.1.55</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-test</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>com.lmax</groupId>\n            <artifactId>disruptor</artifactId>\n            <version>3.4.4</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.projectlombok</groupId>\n            <artifactId>lombok</artifactId>\n            <version>${lombok.version}</version>\n            <optional>true</optional>\n        </dependency>\n\n        <dependency>\n            <groupId>ma.glasnost.orika</groupId>\n            <artifactId>orika-core</artifactId>\n            <version>1.5.4</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.apache.ant</groupId>\n            <artifactId>ant</artifactId>\n            <version>1.10.12</version>\n        </dependency>\n\n        <dependency>\n            <groupId>javax.validation</groupId>\n            <artifactId>validation-api</artifactId>\n            <version>2.0.1.Final</version>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.cloud</groupId>\n            <artifactId>spring-cloud-starter-openfeign</artifactId>\n        </dependency>\n\n        <dependency>\n            <groupId>org.apache.curator</groupId>\n            <artifactId>curator-framework</artifactId>\n            <version>2.13.0</version>\n        </dependency>\n\n        <dependency>\n            <groupId>org.apache.curator</groupId>\n            <artifactId>curator-recipes</artifactId>\n            <version>2.13.0</version>\n\n        </dependency>\n        <dependency>\n            <groupId>org.apache.zookeeper</groupId>\n            <artifactId>zookeeper</artifactId>\n            <version>3.7.2</version>\n            <exclusions>\n                <exclusion>\n                    <groupId>org.slf4j</groupId>\n                    <artifactId>slf4j-reload4j</artifactId>\n                </exclusion>\n            </exclusions>\n        </dependency>\n\n        <dependency>\n            <groupId>com.github.ben-manes.caffeine</groupId>\n            <artifactId>caffeine</artifactId>\n            <version>2.9.3</version>\n        </dependency>\n\n    </dependencies>\n\n    <dependencyManagement>\n        <dependencies>\n            <dependency>\n                <groupId>org.apache.logging.log4j</groupId>\n                <artifactId>log4j-api</artifactId>\n                <version>${log4j2.version}</version>\n            </dependency>\n            <dependency>\n                <groupId>org.apache.logging.log4j</groupId>\n                <artifactId>log4j-core</artifactId>\n                <version>${log4j2.version}</version>\n            </dependency>\n            <dependency>\n                <groupId>org.apache.logging.log4j</groupId>\n                <artifactId>log4j-slf4j-impl</artifactId>\n                <version>${log4j2.version}</version>\n            </dependency>\n            <dependency>\n                <groupId>org.apache.logging.log4j</groupId>\n                <artifactId>log4j-jul</artifactId>\n                <version>${log4j2.version}</version>\n            </dependency>\n            <dependency>\n                <groupId>org.slf4j</groupId>\n                <artifactId>jul-to-slf4j</artifactId>\n                <version>1.7.32</version>\n            </dependency>\n            <dependency>\n                <groupId>org.yaml</groupId>\n                <artifactId>snakeyaml</artifactId>\n                <version>2.0</version>\n            </dependency>\n            <dependency>\n                <groupId>org.springframework.cloud</groupId>\n                <artifactId>spring-cloud-dependencies</artifactId>\n                <version>${spring.cloud-version}</version>\n                <type>pom</type>\n                <scope>import</scope>\n            </dependency>\n            <dependency>\n                <groupId>com.fasterxml.jackson.core</groupId>\n                <artifactId>jackson-databind</artifactId>\n                <version>2.14.0-rc3</version>\n            </dependency>\n        </dependencies>\n    </dependencyManagement>\n\n    <build>\n        <resources>\n            <resource>\n                <directory>src/main/resources</directory>\n                <includes>\n                    <include>**/*.*</include>\n                </includes>\n            </resource>\n            <resource>\n                <directory>src/main/java</directory>\n                <includes>\n                    <include>**/*.properties</include>\n                </includes>\n            </resource>\n\n            <resource>\n                <directory>src/main/lib</directory>\n                <targetPath>BOOT-INF/lib/</targetPath>\n                <includes>\n                    <include>**/*.jar</include>\n                </includes>\n            </resource>\n        </resources>\n        <extensions>\n            <extension>\n                <groupId>kr.motd.maven</groupId>\n                <artifactId>os-maven-plugin</artifactId>\n                <version>1.5.0.Final</version>\n            </extension>\n        </extensions>\n        <plugins>\n            <plugin>\n                <groupId>com.github.eirslett</groupId>\n                <artifactId>frontend-maven-plugin</artifactId>\n                <version>1.9.1</version>\n                <executions>\n                    <!-- æ£€æŸ¥æ˜¯å¦å®‰è£…node npm -->\n                    <execution>\n                        <id>install node and npm</id>\n                        <goals>\n                            <goal>install-node-and-npm</goal>\n                        </goals>\n                        <phase>generate-resources</phase>\n                    </execution>\n                    <!-- npm install -->\n                    <execution>\n                        <id>npm install</id>\n                        <goals>\n                            <goal>npm</goal>\n                        </goals>\n                        <phase>generate-resources</phase>\n                        <configuration>\n                            <arguments>install</arguments>\n                        </configuration>\n                    </execution>\n                    <!-- build -->\n                    <execution>\n                        <id>npm run build</id>\n                        <goals>\n                            <goal>npm</goal>\n                        </goals>\n                        <phase>generate-resources</phase>\n                        <configuration>\n                            <arguments>run build</arguments>\n                        </configuration>\n                    </execution>\n                </executions>\n                <configuration>\n                    <nodeVersion>v16.15.1</nodeVersion>\n                    <npmVersion>8.11.0</npmVersion>\n                    <!-- nodeå®‰è£…è·¯å¾„ -->\n                    <installDirectory>dist</installDirectory>\n                    <!-- å‰ç«¯ä»£ç è·¯å¾„ -->\n                    <workingDirectory>resources-front-end</workingDirectory>\n                </configuration>\n            </plugin>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-compiler-plugin</artifactId>\n                <configuration>\n                    <source>1.8</source>\n                    <target>1.8</target>\n                </configuration>\n            </plugin>\n            <plugin>\n                <artifactId>maven-resources-plugin</artifactId>\n                <executions>\n                    <execution> <!-- å¤åˆ¶é…ç½®æ–‡ä»¶ -->\n                        <id>copy-resources</id>\n                        <phase>compile</phase>\n                        <goals>\n                            <goal>copy-resources</goal>\n                        </goals>\n                        <configuration>\n                            <resources>\n                                <resource>\n                                    <directory>resources-front-end/packages/fate-board/dist</directory>\n                                    <includes>\n                                        <include>*</include>\n                                        <include>*/**</include>\n                                    </includes>\n                                </resource>\n                            </resources>\n                            <outputDirectory>${project.build.directory}/classes/static</outputDirectory>\n                        </configuration>\n                    </execution>\n                </executions>\n            </plugin>\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-jar-plugin</artifactId>\n                <version>3.1.1</version>\n                <configuration combine.self=\"override\">\n                    <includes>\n                        <include>**/*</include>\n                    </includes>\n                </configuration>\n            </plugin>\n\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-dependency-plugin</artifactId>\n                <version>2.10</version>\n                <executions>\n                    <execution>\n                        <id>copy-dependencies</id>\n                        <phase>package</phase>\n                        <goals>\n                            <goal>copy-dependencies</goal>\n                        </goals>\n                        <configuration>\n                            <outputDirectory>${project.build.directory}/lib</outputDirectory>\n                        </configuration>\n                    </execution>\n                </executions>\n            </plugin>\n\n            <plugin>\n                <groupId>org.apache.maven.plugins</groupId>\n                <artifactId>maven-assembly-plugin</artifactId>\n                <version>2.2.1</version>\n                <configuration>\n                    <descriptors>\n                        <descriptor>${project.basedir}/package.xml</descriptor>\n                    </descriptors>\n                    <archive>\n                        <manifest>\n                            <mainClass>org.fedai.fate.board.bootstrap.Bootstrap</mainClass>\n                        </manifest>\n                    </archive>\n                </configuration>\n                <executions>\n                    <execution>\n                        <id>make-assembly</id>\n                        <phase>package</phase>\n                        <goals>\n                            <goal>single</goal>\n                        </goals>\n                    </execution>\n                </executions>\n            </plugin>\n\n        </plugins>\n    </build>\n</project>\n\n```\n\nç¼–è¯‘æ‰“åŒ…å‘½ä»¤ï¼Œåœ¨pom.xmlåŒçº§ç›®å½•ä¸‹æ‰§è¡Œ\n\n```shell\nmvn clean package -Dmaven.test.skip=true\n```\n\n# æ„å»ºé•œåƒ\n\nåœ¨åº”ç”¨çš„æºç æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå¦‚`deploy`:\n\n```shell\nmkdir deploy\ncd deploy\n```\n\nåˆ›å»ºæ‰€éœ€è¦ç›®å½•ï¼Œæ‹·è´æ‰€éœ€çš„æ–‡ä»¶ï¼Œå¦‚jaråŒ…ï¼Œé…ç½®æ–‡ä»¶ç­‰éœ€è¦æ‰“åŒ…åˆ°é•œåƒä¸­çš„æ–‡ä»¶å¤¹/æ–‡ä»¶\n\n```shell\nmkdir conf ssh\ncp -r ../target/fateboard-2.1.0.jar ./\ncp -r ../target/lib ./\ncp -r ../src/main/resources/application.properties ./conf/\ncp -r ../src/main/resources/log4j2.xml ./conf/\ncp -r ../src/main/resources/ssh.properties ./ssh/\n```\n\nç¼–å†™Dockerfile\n\n```shell\nFROM mcr.microsoft.com/java/jre:8u192-zulu-alpine as builder\n\nMAINTAINER maodm@yunphant.com\n\nFROM mcr.microsoft.com/java/jre:8u192-zulu-alpine\nRUN apk add tzdata\n\nENV TZ=Asia/Shanghai  HOME=/yunphant JAVA_OPTS=\"-Xmx2g -Xms1g\" APP_NAME=\"fateboard\" MAIN_CLASS=\"org.fedai.fate.board.bootstrap.Bootstrap\"\n# æ—¥å¿—+åº”ç”¨é…ç½®\nENV APP_CONF=$HOME/$APP_NAME/conf/application.properties LOG_CONFIG_PATH=$HOME/$APP_NAME/conf/log4j2.xml\n\nWORKDIR $HOME\ncopy conf $HOME/$APP_NAME/conf\ncopy lib $HOME/$APP_NAME/lib\ncopy ssh $HOME/$APP_NAME/ssh\ncopy fateboard-2.1.0.jar $HOME/$APP_NAME\n\nEXPOSE 8080\n\nRUN echo \"build done\"\nCMD java -Dspring.config.location=$HOME/$APP_NAME/conf/application.properties  -Dssh_config_file=$HOME/$APP_NAME/ssh -Xmx2g -Xms1g -XX:+PrintGCDetails -XX:+PrintGCDateStamps -Xloggc:gc.log -XX:+HeapDumpOnOutOfMemoryError -jar fateboard.jar\n```\n\nç¼–è¯‘dockeré•œåƒï¼š\n\n```shell\ndocker build -t yunpcds/fateboard:2.1.0-release .\n```\n\n>  å¦‚æœæ‰§è¡ŒæˆåŠŸï¼Œå°±ä¼šåœ¨æœ¬åœ°dockerä»“åº“ä¸­ç”Ÿæˆäº†ä¸€ä¸ªdockeré•œåƒã€‚\n\n# ç¼–å†™è‡ªåŠ¨åŒ–è„šæœ¬\n\nä¸Šè¿°è¿‡ç¨‹ä½¿ç”¨ä¸€ä¸ªè„šæœ¬å®Œæˆï¼š\n\n```shell\n#!/bin/bash\n\nAPP_NAME=fateboard\nAPP_VERSION=2.1.0\nDOCKER_IMAGE_NAME=yunpcds/fateboard\nDOCKER_IMAGE_TAG=2.1.0-release\n\n# åˆ›å»ºconf ç›®å½•\nmkdir -p conf\n# åˆ›å»ºssh ç›®å½•ï¼Œç”¨äºå­˜æ”¾sshå…¬é’¥æ–‡ä»¶\nmkdir -p ssh\n\n# è¿›å…¥ä¸Šä¸€å±‚ç›®å½•\ncd ..\n\n# ç¼–è¯‘ fate-boardç”Ÿæˆ jaråŒ…\nmvn clean package -Dmaven.test.skip=true\n\n# å›åˆ°deploy ç›®å½•\ncd deploy\n\n# æ‹·è´æ‰€éœ€è¦çš„æ–‡ä»¶\ncp -r ../target/${APP_NAME}-${APP_VERSION}.jar ./\ncp -r ../target/lib ./\ncp -r ../src/main/resources/application.properties ./conf/\ncp -r ../src/main/resources/log4j2.xml ./conf/\ncp -r ../src/main/resources/ssh.properties ./ssh/\n\ndocker build -t ${DOCKER_IMAGE_NAME}:${DOCKER_IMAGE_TAG} .\n\n```\n\n# å¯åŠ¨å®¹å™¨\n\nä½¿ç”¨docker-composeä¼šç›¸åº”ç®€ä¾¿äº›ï¼Œç¼–å†™ä¸€ä¸ªdocker-compose.yamlæ–‡ä»¶\n\n```yaml\nversion: '3.8'\n\nservices:\n  fateboard:\n    image: yunpcds/fateboard:2.1.0-release\n    ports:\n      - \"8090:8080\"\n    volumes:\n      - ./conf:$APP_HOME/$APP_NAME/conf\n      - ./logs:$APP_HOME/logs\n      - /etc/localtime:/etc/localtime:ro\n    restart: always\n    command: [ \"sh\", \"-c\", \"java -Dspring.config.location=/yunphant/fateboard/conf/application.properties -Dssh_config_file=/yunphant/fateboard/ssh/ -Xmx2048m -Xms2048m -XX:+PrintGCDetails -XX:+PrintGCDateStamps -Xloggc:gc.log -XX:+HeapDumpOnOutOfMemoryError -cp /yunphant/fateboard/lib/*:/yunphant/fateboard/fateboard-2.1.0.jar org.fedai.fate.board.bootstrap.Bootstrap\" ]\n\n```\n\nå› ä¸ºåœ¨docker-compose.yamlä¸­ç”¨åˆ°äº†`$APP_HOME` å’Œ `$APP_NAME` è¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼Œè¿™æ˜¯å¯ä»¥åœ¨å®¿ä¸»æœºçš„ç¯å¢ƒå˜é‡ä¸­è®¾ç½®çš„ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ª`.env`æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­å®šä¹‰éœ€è¦ç”¨åˆ°çš„ç¯å¢ƒå˜é‡ï¼š\n\n```shell\nAPP_HOME=/yunphant\nAPP_NAME=fateboard\n```\n\nå¯åŠ¨å®¹å™¨,åœ¨docker-compose.yaml åŒçº§ç›®å½•ä¸‹æ‰§è¡Œ:\n\n```shell\ndocker-compose up -d\n```\n\n","tags":["overlay","hadoop","spark","docker compose"],"categories":["äº‘åŸç”Ÿ","åŸºç¡€è®¾æ–½"]},{"title":"12345æ¨¡å‹é€šç”¨å‹è§£æ³•","url":"/2024/05/19/12345æ¨¡å‹é€šç”¨å‹è§£æ³•/","content":"\n# 12345 æ¨¡å‹\n\nä¸€ä¸ªç›´è§’ï¼Œè¢«åˆ†æˆ3ä¸ªè§’ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯45åº¦ï¼Œå…¶å®ƒä¸¤ä¸ªè§’çš„tanå€¼ä¸º 1/2 å’Œ 1/3ã€‚è¿™3ä¸ªæ¡ä»¶æ˜¯çŸ¥äºŒæ¨ä¸€ã€‚ç›¸å½“äºä¸€ä¸ªç‰¹æ®Šå‹ï¼Œé€šè¿‡è¿™ä¸ªç‰¹æ®Šå‹ï¼Œæˆ‘ä»¬åœ¨ä¸ä½¿ç”¨é«˜ä¸­ä¸‰è§’å‡½æ•°çš„å‰æä¸‹æ¥æ¢ç©¶ä¸€ä¸‹æ›´é€šç”¨çš„è§„å¾‹ã€‚\n\n# é€šç”¨è§£1\n\n![](12345æ¨¡å‹é€šç”¨å‹è§£æ³•/001.png)\n\n\\begin{equation}\n\\begin{aligned}\n&æ€è·¯ï¼šåœ¨ç›´çº¿ADä¸Šæ‰¾åˆ°ä¸€ä¸ªç‚¹Eï¼Œä½¿|AE|=a+bã€‚Eæœ‰å¯èƒ½åœ¨Då·¦ä¾§ï¼Œä¹Ÿæœ‰å¯èƒ½åœ¨Då³ä¾§ã€‚\\\\\n&æˆ‘ä»¬åªå…³æ³¨ä¸€ç‚¹ï¼š|AE|=a+b \\\\\n&æ˜“è¯\\triangle ABG \\cong \\triangle GFH \\Rightarrow |EH|=b-a \\\\\n&å†åˆ©ç”¨\\triangle AEH \\sim \\triangle ADJï¼Œå¾—å‡º|DJ| çš„å€¼\n\\end{aligned}\n\\end{equation}\n\n# é€šç”¨è§£2\n\n![](12345æ¨¡å‹é€šç”¨å‹è§£æ³•/002.png)\n\n\n# æ€»ç»“\n\nå…¶å®æ˜¯æ„é€ äº†ä¸‰å‚ç›´æ¨¡å‹/åŠè§’æ„é€ å‡ºå…¨ç­‰ä¸‰è§’å½¢åï¼Œè¿›ä¸€æ­¥ä½¿ç”¨ç›¸ä¼¼ä¸‰è§’å‹çš„æ±‚å‡ºé¢˜ç›®æ‰€è¦æ±‚çš„çº¿æ®µé•¿ã€‚\n","tags":["å‡ ä½•æ¨¡å‹","12345æ¨¡å‹"],"categories":["æ•°å­¦","åˆä¸­"]},{"title":"å‡å€¼ä¸ç­‰å¼-002","url":"/2024/05/19/å‡å€¼ä¸ç­‰å¼-002/","content":"\n# å¼•è¨€\n\næœ¬æ–‡ä¸»è¦æè¿°å°„å½±å®šç†å’Œå‡å€¼ä¸ç­‰å¼çš„è”ç³»ï¼Œä»è€Œå¯ä»¥ä»å‡ ä½•å±‚é¢å»ç†è§£å‡å€¼ä¸ç­‰å¼è¿™æ ·çš„ä»£æ•°å¼ã€‚\n\n\n# å‡ ä½•è§†è§’\n![å‡ ä½•è§†è§’çš„å‡å€¼ä¸ç­‰å¼](å‡å€¼ä¸ç­‰å¼-002/001.png)\n\n# ä»£æ•°è§†è§’\n## äºŒå…ƒ\n\\begin{equation}\n\\sqrt{\\frac{x^2+y^2}{2}} \\geq \\frac{x+y}{2} \\geq \\sqrt{xy} \\geq \\frac{2}{\\frac{1}{x}+\\frac{1}{y}}\n\\end{equation}\n\n## nå…ƒ\n\\begin{equation}\n\\sqrt{\\frac{\\sum_{i=1}^{n}{x_{i}^2}}{n}} \\geq \\frac{\\sum_{i=1}^{n}{x_{i}}}{n} \\geq \\sqrt[n]{\\prod_{i=1}^{n} x_i} \\geq \\frac{n}{\\sum_{i=1}^{n}\\frac{1}{ x_{i}}} \n\\end{equation}","tags":["å‡å€¼ä¸ç­‰å¼","å°„å½±å®šç†"],"categories":["æ•°å­¦","åˆä¸­"]},{"title":"å‡å€¼ä¸ç­‰å¼-001","url":"/2024/05/18/å‡å€¼ä¸ç­‰å¼-001/","content":"\n# å‡å€¼ä¸ç­‰å¼\n\nå‡å€¼ä¸ç­‰å¼æ˜¯æ•°å­¦ä¸­ä¸€ç±»é‡è¦çš„ä¸ç­‰å¼ï¼Œå®ƒæè¿°äº†æ•°åˆ—æˆ–å‡½æ•°çš„å¹³å‡å€¼ä¸å…¶ä»–å€¼ä¹‹é—´çš„å…³ç³»ã€‚å¸¸è§çš„å‡å€¼ä¸ç­‰å¼åŒ…æ‹¬ç®—æœ¯å¹³å‡å€¼ä¸å°äºå‡ ä½•å¹³å‡å€¼ã€å‡ ä½•å¹³å‡å€¼ä¸å°äºè°ƒå’Œå¹³å‡å€¼ç­‰ã€‚ä¸‹é¢ç®€è¦ä»‹ç»ä¸€äº›å¸¸è§çš„å‡å€¼ä¸ç­‰å¼ï¼š\n\n## è°ƒå’Œå¹³å‡å€¼\n\n\\begin{equation} \n\tH_{n}=\\frac{n}{\\sum_{i=1}^{n}\\frac{1}{ x_{i}}}=\\frac{n}{\\frac{1}{x_{1}}+\\frac{1}{x_{2}}+\\ldots +\\frac{1}{x_{n}}}\n\\end{equation}\n\n## å‡ ä½•å¹³å‡å€¼\n\n\\begin{equation} \n\tG_{n}=\\sqrt[n]{\\prod_{i=1}^{n} x_i}=\\sqrt[n]{x_{1}x_{2}\\ldots x_{n}}\n\\end{equation}\n\n## ç®—æœ¯å¹³å‡æ•°\n\\begin{equation} \n\tA_{n}=\\frac{\\sum_{i=1}^{n}{x_{i}}}{n}=\\frac{x_{1}+x_{2}+\\ldots+x_{n}}{n}\n\\end{equation}\n\n## å¹³æ–¹å¹³å‡æ•°\n\\begin{equation} \n\tQ_{n}=\\sqrt{\\frac{\\sum_{i=1}^{n}{x_{i}^2}}{n}}=\\sqrt{\\frac{x_{1}^2+x_{2}^2+\\ldots+x_{n}^2}{n}}\n\\end{equation}\n\n## ç»“è®º\n\\begin{equation} \n\tH_{n} \\leq G_{n} \\leq A_{n} \\leq Q_{n}\n\\end{equation}","tags":["å‡å€¼ä¸ç­‰å¼"],"categories":["æ•°å­¦","åˆä¸­"]},{"title":"DockerçŸ¥è¯†ç‚¹02","url":"/2024/05/17/DockerçŸ¥è¯†ç‚¹02/","content":"\n# å‰è¨€\n\néœ€è¦æ­å»ºsparké›†ç¾¤ä»¥åŠhadoopé›†ç¾¤ï¼Œå¹¶ä¸”ä½¿å®ƒé—´ä¹‹é—´è¿›è¡Œäº¤äº’ã€‚ç›®æ ‡ï¼šç¼–å†™ä¸€ä¸ªyamlï¼Œç”¨äºä¸€é”®éƒ¨ç½²ã€‚æœ¬æ–‡å…ˆè¯•éªŒä¸€ä¸ªä¸ªéƒ¨ç½²ï¼Œæœ€ç»ˆå½¢æˆä¸€ä¸ªä¸€é”®éƒ¨ç½²çš„æ–¹æ¡ˆã€‚\n\n# å®è·µ\n\n## hadoopé›†ç¾¤å•æœºéƒ¨ç½²è¯•éªŒ\n\n1. æ‹‰å–appacheå®˜æ–¹é•œåƒ\n\n   ```she\n   docker pull apache/hadoop\n   ```\n\n2. åœ¨æœåŠ¡å™¨æœ¬åœ°ç›®å½•åˆ›å»ºæ‰€éœ€æ–‡ä»¶\n\n   - åˆ›å»º`docker-compose.yaml`æ–‡ä»¶\n\n     ```yaml\n     version: \"3\"\n     services:\n        namenode:\n           image: apache/hadoop:3\n           networks:\n             - hadoop_network\n           hostname: namenode\n           command: [\"hdfs\", \"namenode\"]\n           ports:\n             - 9870:9870\n             - 8020:8020\n           env_file:\n             - ./config\n           environment:\n               ENSURE_NAMENODE_DIR: \"/tmp/hadoop-root/dfs/name\"\n        datanode:\n           image: apache/hadoop:3\n           networks:\n             - hadoop_network\n           command: [\"hdfs\", \"datanode\"]\n           env_file:\n             - ./config\n        resourcemanager:\n           image: apache/hadoop:3\n           networks:\n             - hadoop_network\n           hostname: resourcemanager\n           command: [\"yarn\", \"resourcemanager\"]\n           ports:\n              - 8088:8088\n           env_file:\n             - ./config\n           volumes:\n             - ./test.sh:/opt/test.sh\n        nodemanager:\n           image: apache/hadoop:3\n           networks:\n             - hadoop_network\n           command: [\"yarn\", \"nodemanager\"]\n           env_file:\n             - ./config\n     networks:\n       hadoop_network:\n         name: hadoop-net\n     ```\n     \n     > è‡ªå®šä¹‰ç½‘ç»œï¼Œè¿™æ ·å®šä¹‰æ˜¯ä¼šè‡ªåŠ¨åˆ›å»ºè¿™ä¸ªç½‘ç»œçš„\n     \n     å¦‚æœç½‘ç»œå·²ç»å­˜åœ¨ï¼Œé‚£å¯ä»¥è¿™æ ·æŒ‡å®š(åœ¨åç»­æˆ‘ä»¬ä¸€é”®éƒ¨ç½²æ—¶è¿™ä¸ªå¾ˆé‡è¦ï¼Œéœ€è¦è®©æ¯ä¸ªå®¹å™¨åœ¨åŒä¸€ç½‘ç»œå†…ï¼Œ`docker stack` éƒ¨ç½²è¿˜éœ€è¦è¿™ä¸ªç½‘ç»œä¸º`overlay`ç½‘ç»œ)\n     \n     ```yaml\n     networks:\n       hadoop_network:\n         external: true\n         name: hadoop-net\n     ```\n\n   - ä¸Šè¿°æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ª`config`æ–‡ä»¶ç”¨æ¥è®¾ç½®ä¸€äº›ç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ª`config`æ–‡ä»¶\n\n     ```shell\n     CORE-SITE.XML_fs.default.name=hdfs://namenode\n     CORE-SITE.XML_fs.defaultFS=hdfs://namenode\n     HDFS-SITE.XML_dfs.namenode.rpc-address=namenode:8020\n     HDFS-SITE.XML_dfs.replication=1\n     MAPRED-SITE.XML_mapreduce.framework.name=yarn\n     MAPRED-SITE.XML_yarn.app.mapreduce.am.env=HADOOP_MAPRED_HOME=$HADOOP_HOME\n     MAPRED-SITE.XML_mapreduce.map.env=HADOOP_MAPRED_HOME=$HADOOP_HOME\n     MAPRED-SITE.XML_mapreduce.reduce.env=HADOOP_MAPRED_HOME=$HADOOP_HOME\n     YARN-SITE.XML_yarn.resourcemanager.hostname=resourcemanager\n     YARN-SITE.XML_yarn.nodemanager.pmem-check-enabled=false\n     YARN-SITE.XML_yarn.nodemanager.delete.debug-delay-sec=600\n     YARN-SITE.XML_yarn.nodemanager.vmem-check-enabled=false\n     YARN-SITE.XML_yarn.nodemanager.aux-services=mapreduce_shuffle\n     CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.maximum-applications=10000\n     CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.maximum-am-resource-percent=0.1\n     CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.resource-calculator=org.apache.hadoop.yarn.util.resource.DefaultResourceCalculator\n     CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.root.queues=default\n     CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.root.default.capacity=100\n     CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.root.default.user-limit-factor=1\n     CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.root.default.maximum-capacity=100\n     CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.root.default.state=RUNNING\n     CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.root.default.acl_submit_applications=*\n     CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.root.default.acl_administer_queue=*\n     CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.node-locality-delay=40\n     CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.queue-mappings=\n     CAPACITY-SCHEDULER.XML_yarn.scheduler.capacity.queue-mappings-override.enable=false\n     ```\n\n     > è¿™é‡Œé¢æ²¡æœ‰æŒ‡å®š`HADOOP_HOME`çš„å€¼ï¼Œéƒ¨ç½²çš„æ—¶å€™ä¼šæœ‰ä¸€ä¸ªè­¦å‘Šï¼Œä½†ä¹Ÿä¸å½±å“ä½¿ç”¨ï¼Œåæ¥æˆ‘å°±åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªå˜é‡ä½¿ç”¨å‰ï¼Œæ·»åŠ äº†ä¸€è¡Œ`HADOOP_HOME=/opt/hadoop`\n\n3. æ£€æŸ¥æ‰€éœ€æ–‡ä»¶\n\n   ```shell\n   [centos@maodaoming-1 hadoop]$ ll\n   total 8\n   -rw-rw-r--. 1 centos centos 1789 May 17 09:21 config\n   -rw-rw-r--. 1 centos centos  984 May 17 11:04 docker-compose.yaml\n   ```\n\n# spark é›†ç¾¤å•æœºéƒ¨ç½²\n\nå› ä¸ºæ˜¯æ­å»ºFATE 2.1.0 ç‰ˆæœ¬çš„sparkç¯å¢ƒï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ˜¯ä½¿ç”¨FATE-Builderæ‰“åŒ…å‡ºæ¥çš„sparké•œåƒï¼ŒåŒ…å«ï¼š\n\n```shell\nyunpcds/spark-master        2.1.0-release   115b928c3b3d   21 hours ago    4.68GB\nyunpcds/spark-worker        2.1.0-release   371c1de5aabe   21 hours ago    4.68GB\n```\n\n1. åˆ›å»º`docker-compose.yaml`æ–‡ä»¶\n\n```yaml\nversion: \"3\"\n\nservices:\n  spark-master:\n    hostname: spark-master\n    image: ${IMAGE_PREFIX}/spark-master:${IMAGE_TAG}\n    container_name: spark-master\n    restart: always\n    ports:\n      - \"8080:8080\"\n      - \"7077:7077\"\n      - \"6066:6066\"\n\n  spark-slave:\n    hostname: spark-slave\n    image: ${IMAGE_PREFIX}/spark-worker:${IMAGE_TAG}\n    container_name: spark-slave\n    restart: always\n    ports:\n      - \"8781:8081\"\n    volumes:\n      - /data/projects/:/data/projects/\n    environment:\n      SERVICE_PRECONDITION: \"spark-master:7077\"\n      EGGROLL_HOME: \"/data/projects/fate/eggroll\"\n      FATE_PROJECT_BASE: \"/data/projects/fate\"\n      VIRTUAL_ENV: \"/data/projects/python/venv\"\n      PYTHONPATH: \"/data/projects/fate/:/data/projects/fate/eggroll/python:/data/projects/fate/fate/python:/data/projects/fate/fateflow/python:/data/projects/fate/python\"\n      PATH: \"/data/projects/python/venv/bin:/opt/hadoop-3.2.3/bin:/opt/hive/bin:/opt/spark-3.1.3-bin-hadoop3.2/bin:/opt/hadoop-3.2.3/bin/:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\nnetworks:\n  spark_network:\n    name: spark-net\n```\n\n2. å˜é‡è®¾ç½®æ–‡ä»¶:<font size=5>`.env`</font>æ–‡ä»¶\n\n```shell\nIMAGE_PREFIX=yunpcds\nIMAGE_TAG=2.1.0-release\n```\n\n> è¿™é‡Œé¢çš„å˜é‡ä¼šè¢«ä¼ å…¥åˆ°`docker-compose.yaml`ä¸­å»,ä¸Šé¢çš„PYTHONPATH, PATHæ ¹æ®å®é™…æƒ…å†µå†è°ƒæ•´ï¼›è¿˜æœ‰<font size=5>volumes</font>çš„æ˜ å°„ï¼Œéœ€è¦æŠŠfateçš„ä»£ç æ‹·è´åˆ°å®¿ä¸»æœºçš„å¯¹åº”ç›®å½•`/data/projects/`\n\n3. æŸ¥çœ‹æ‰€éœ€æ–‡ä»¶\n\n   ```shell\n   [centos@maodaoming-2 spark]$ ll -a\n   total 8\n   drwxrwxr-x. 2 centos centos   45 May 17 15:33 .\n   drwxrwxr-x. 4 centos centos   33 May 17 14:38 ..\n   -rw-rw-r--. 1 centos centos 1103 May 17 14:56 docker-compose.yaml\n   -rw-rw-r--. 1 centos centos   45 May 17 14:39 .env\n   ```\n\n# ä¸€é”®éƒ¨ç½²\n\næŠŠ`docker-compose.yaml`åˆå¹¶æˆä¸€ä»½ï¼Œä½¿ç”¨docker stackéƒ¨ç½²ï¼š\n\n```yaml\nversion: \"3\"\nservices:\n  namenode:\n    image: apache/hadoop:3\n    hostname: namenode\n    command: [\"hdfs\", \"namenode\"]\n    networks:\n      - bigdata-network\n    ports:\n      - target: 9870\n        published: 9870\n        protocol: tcp\n        mode: host\n      - target: 9000\n        published: 9000\n        protocol: tcp\n        mode: host\n    env_file:\n      - ./config\n    environment:\n      ENSURE_NAMENODE_DIR: \"/tmp/hadoop-root/dfs/name\"\n    deploy:\n      endpoint_mode: dnsrr\n      placement:\n        constraints:\n          - 'node.labels.nodename == node55'\n  datanode:\n    image: apache/hadoop:3\n    command: [\"hdfs\", \"datanode\"]\n    networks:\n      - bigdata-network\n    env_file:\n      - ./config\n    ports:\n      - target: 1004\n        published: 1004\n        protocol: tcp\n        mode: host\n      - target: 1006\n        published: 1006\n        protocol: tcp\n        mode: host\n      - target: 9866\n        published: 9864\n        protocol: tcp\n        mode: host\n    deploy:\n      endpoint_mode: dnsrr\n      placement:\n        constraints:\n          - 'node.labels.nodename == node55'\n  resourcemanager:\n    image: apache/hadoop:3\n    hostname: resourcemanager\n    command: [\"yarn\", \"resourcemanager\"]\n    networks:\n      - bigdata-network\n    ports:\n      - 8088:8088\n    env_file:\n      - ./config\n    deploy:\n      placement:\n        constraints:\n          - 'node.labels.nodename == node55'\n  nodemanager:\n    image: apache/hadoop:3\n    command: [\"yarn\", \"nodemanager\"]\n    networks:\n      - bigdata-network\n    env_file:\n      - ./config\n    deploy:\n      placement:\n        constraints:\n          - 'node.labels.nodename == node55'\n\n  spark-master:\n    hostname: spark-master\n    image: ${IMAGE_PREFIX}/spark-master:${IMAGE_TAG}\n    container_name: spark-master\n    restart: always\n    networks:\n      - bigdata-network\n    ports:\n      - \"8080:8080\"\n      - \"7077:7077\"\n      - \"6066:6066\"\n    deploy:\n      placement:\n        constraints:\n          - 'node.role == manager'\n          - 'node.labels.nodename == node91'\n  spark-slave:\n    hostname: spark-worker\n    image: ${IMAGE_PREFIX}/spark-worker:${IMAGE_TAG}\n    container_name: spark-worker\n    restart: always\n    networks:\n      - bigdata-network\n    ports:\n      - \"8781:8081\"\n    volumes:\n      - /data/projects/:/data/projects/\n    environment:\n      SERVICE_PRECONDITION: \"spark-master:7077\"\n      EGGROLL_HOME: \"/data/projects/fate/eggroll\"\n      FATE_PROJECT_BASE: \"/data/projects/fate\"\n      VIRTUAL_ENV: \"/data/projects/python/venv\"\n      PYTHONPATH: \"/data/projects/fate/:/data/projects/fate/eggroll/python:/data/projects/fate/fate/python:/data/projects/fate/fateflow/python:/data/projects/fate/python\"\n      PATH: \"/data/projects/python/venv/bin:/opt/hadoop-3.2.3/bin:/opt/hive/bin:/opt/spark-3.1.3-bin-hadoop3.2/bin:/opt/hadoop-3.2.3/bin/:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\n    deploy:\n      placement:\n        constraints:\n          - 'node.role == manager'\n          - 'node.labels.nodename == node91'\nvolumes:\n  hadoop_namenode:\n  hadoop_datanode1:\n  hadoop_datanode2:\n  hadoop_datanode3:\n  hadoop_historyserver:\n  kerberos_db:\n  kerberos_keytab:\n    driver_opts:\n      type: nfs\n      o: addr=192.168.11.74,nfsvers=4,minorversion=0,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2,noresvport\n      device: :/home/centos/nfs_share/volume/bigdata/keytab\n  hive_metastore:\n  mysql_data:\n  linkis_log:\n  linkis_runtime:\nnetworks:\n  bigdata-network:\n    external: true\n    name: bigdata-network\n\n```\n\n> æ³¨æ„ï¼šæœ‰volumesæ˜ å°„çš„ä¸€å®šè¦æ³¨æ„ï¼Œå¦‚æœè·¯å¾„ä¸å­˜åœ¨å°±å¯åŠ¨å¤±è´¥\n\nå¯åŠ¨è„šæœ¬ç¼–å†™ï¼š\n\n```shell\ndocker stack rm bigdata\n\nsleep 1s\n\necho \"è¯·æ³¨æ„æ¸…ç†nodedataçš„volume!!!\"\n\n[ -f .env ] && export $(sed '/^#/d' .env)\ndocker stack deploy -c docker-stack-deploy.yaml bigdata\n```\n\nå¯åŠ¨åæ£€æŸ¥æ˜¯å¦æˆåŠŸï¼š\n\n```shell\n[centos@maodaoming-2 flow-spark-v2-env]$ docker service ls\n\ngzpqsvib86y6   bigdata_datanode          replicated   1/1        apache/hadoop:3\nproujh710xqf   bigdata_namenode          replicated   1/1        apache/hadoop:3\nfyok561q2qiv   bigdata_nodemanager       replicated   1/1        apache/hadoop:3\n72gzt56c9yrp   bigdata_resourcemanager   replicated   0/1        apache/hadoop:3                      *:8088->8088/tcp\nopo2n1jaa0bj   bigdata_spark-master      replicated   1/1        yunpcds/spark-master:2.1.0-release   *:6066->6066/tcp, *:7077->7077/tcp, *:8080->8080/tcp\nrsxhqoanjd3y   bigdata_spark-worker      replicated   1/1        yunpcds/spark-worker:2.1.0-release   *:8781->8081/tcp\nchwttx82rp8u   busybox                   replicated   1/1        busybox:latest\n```\n\nå¯ä»¥æŸ¥çœ‹åˆ°`bigdata_resourcemanager`æ˜¯å¯åŠ¨å¤±è´¥çš„ã€‚å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹æ—¥å¿—ï¼š\n\n```shell\n[centos@maodaoming-2 flow-spark-v2-env]$ docker service ps  --no-trunc bigdata_resourcemanager\n\nz8i8jbqpzz8zbmkh0w9k8i91o   bigdata_resourcemanager.1       apache/hadoop:3@sha256:af361b20bec0dfb13f03279328572ba764926e918c4fe716e197b8be2b08e37f   maodaoming-1.novalocal   Ready           Rejected 1 second ago     \"invalid mount config for type \"bind\": bind source path does not exist: /home/centos/flow-spark-v2-env/test.sh\"\nspmxmabdm0gikj33y4bxoot51    \\_ bigdata_resourcemanager.1   apache/hadoop:3@sha256:af361b20bec0dfb13f03279328572ba764926e918c4fe716e197b8be2b08e37f   maodaoming-1.novalocal   Shutdown        Rejected 6 seconds ago    \"invalid mount config for type \"bind\": bind source path does not exist: /home/centos/flow-spark-v2-env/test.sh\"\nzo68mawn5flwwejynq54iwus0    \\_ bigdata_resourcemanager.1   apache/hadoop:3@sha256:af361b20bec0dfb13f03279328572ba764926e918c4fe716e197b8be2b08e37f   maodaoming-1.novalocal   Shutdown        Rejected 11 seconds ago   \"invalid mount config for type \"bind\": bind source path does not exist: /home/centos/flow-spark-v2-env/test.sh\"\n60ew6r1iqf9wppbc3dojq0566    \\_ bigdata_resourcemanager.1   apache/hadoop:3@sha256:af361b20bec0dfb13f03279328572ba764926e918c4fe716e197b8be2b08e37f   maodaoming-1.novalocal   Shutdown        Rejected 17 seconds ago   \"invalid mount config for type \"bind\": bind source path does not exist: /home/centos/flow-spark-v2-env/test.sh\"\nnk9rzlaqqw2e1rr4ali2634mp    \\_ bigdata_resourcemanager.1   apache/hadoop:3@sha256:af361b20bec0dfb13f03279328572ba764926e918c4fe716e197b8be2b08e37f   maodaoming-1.novalocal   Shutdown        Rejected 21 seconds ago   \"invalid mount config for type \"bind\": bind source path does not exist: /home/centos/flow-spark-v2-env/test.sh\"\n```\n\n","tags":["swarm","overlay","docker stack","hadoop","spark"],"categories":["äº‘åŸç”Ÿ","åŸºç¡€è®¾æ–½"]},{"title":"vcpkgçš„ä½¿ç”¨è®°å½•","url":"/2024/04/24/vcpkgçš„ä½¿ç”¨è®°å½•/","content":"\n# å®‰è£…vcpkg\n\n## clone vcpkg\n```shell\ngit clone https://github.com/microsoft/vcpkg\n```\n\n## install vcpkg\n\n```shell\ncd vcpkg\n./bootstrap-vcpkg.sh\n```\n\n## è®¾ç½®ç¯å¢ƒå˜é‡\n\n```shell\n# vcpkg\nexport VCPKG_ROOT=~/vcpkg\nexport PATH=$PATH:$VCPKG_ROOT\nexport VCPKG_DEFAULT_TRIPLET=arm64-osx\n```\n\n> VCPKG_DEFAULT_TRIPLET è®¾ç½®äº†é»˜è®¤çš„TRIPLETï¼Œvcpkg install æ—¶å°±æ— éœ€æŒ‡å®štriplet\n\n# vcpkg install\n\n## å®‰è£…boost\n\n```shell\nvcpkg install boost\n```\n\nåœ¨æœ€åä¼šå‡ºé”™ï¼Œæœ‰è­¦å‘Šä¿¡æ¯å¦‚ä¸‹ï¼š\n\n```shell\nCMake Warning at ports/python3/portfile.cmake:7 (message):\n  python3 currently requires the following programs from the system package\n  manager:\n\n      autoconf automake autoconf-archive\n\n  On Debian and Ubuntu derivatives:\n\n      sudo apt-get install autoconf automake autoconf-archive\n\n  On recent Red Hat and Fedora derivatives:\n\n      sudo dnf install autoconf automake autoconf-archive\n\n  On Arch Linux and derivatives:\n\n      sudo pacman -S autoconf automake autoconf-archive\n\n  On Alpine:\n\n      apk add autoconf automake autoconf-archive\n\n  On macOS:\n\n      brew install autoconf automake autoconf-archive\n```\n\n> æŒ‰ç…§ä¸Šè¿°è­¦å‘Šä¿¡æ¯æ“ä½œåå†é‡æ–°æ‰§è¡Œvcpkg install boostï¼ŒæˆåŠŸ\n\n## å®‰è£…nlohmann-json\n\n```shell\nvcpkg install nlohmann-json\n```\n\n# åˆ›å»ºc++é¡¹ç›®\n\n### vcpkg åˆ›å»ºé¡¹ç›®\n\n```shell\nmkdir helloworld && cd helloworld\nvcpkg new --application\n```\n\n> ä¼šç”Ÿæˆvcpkg.jsonæ–‡ä»¶ï¼Œé¡¹ç›®ä¸­çš„ä¾èµ–åº“ä¿¡æ¯ä¼šä¿å­˜åœ¨é‡Œé¢\n\n### æ·»åŠ ä¾èµ–\n\n```shell\nvcpkg add port nlohmann-json\n```\n\næ‰§è¡Œååœ¨`vcpkg.json`æ–‡ä»¶ä¸­ä¼šæ·»åŠ è¿™ä¸ªä¾èµ–ï¼š\n\n```json\n{\n  \"dependencies\": [\n    \"nlohmann-json\"\n  ]\n}\n```\n\n## åˆ›å»º`CMakeLists.txt`æ–‡ä»¶\n\n```shell\ncmake_minimum_required(VERSION 3.10)\nproject(HelloWorld)\nadd_executable(HelloWorld helloworld.cpp)\nfind_package(nlohmann_json CONFIG REQUIRED)\ntarget_link_libraries(HelloWorld PRIVATE nlohmann_json::nlohmann_json)\n```\n\n> `CMakeLists.txt`ä¸­å¹¶æ²¡æœ‰æŒ‡å®šnlohmann_jsonåŒ…çš„è·¯å¾„ï¼Œé‚£CMakeæ€ä¹ˆæ‰¾åˆ°è¿™äº›ä¾èµ–åŒ…å‘¢ï¼Ÿé‚£å°±è¦ç”¨åˆ°`CMakePresets.json`æ–‡ä»¶\n\n## åˆ›å»º`CMakePresets.json`æ–‡ä»¶\n\n```json\n{\n  \"version\": 2,\n  \"configurePresets\": [\n    {\n      \"name\": \"default\",\n      \"generator\": \"Ninja\",\n      \"binaryDir\": \"${sourceDir}/build\",\n      \"cacheVariables\": {\n        \"CMAKE_TOOLCHAIN_FILE\": \"$env{VCPKG_ROOT}/scripts/buildsystems/vcpkg.cmake\"\n      }\n    }\n  ]\n}\n```\n\n> è¿™é‡Œå°±éœ€è¦åœ¨ç¯å¢ƒå˜é‡ä¸­è®¾ç½®`VCPKG_ROOT`\n\næœ‰äº†`CMakePresets.json`åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œä¼šå¯¹cmake build åšä¸€ä¸‹ä¸€äº›å‰ç½®çš„è®¾ç½®æ“ä½œï¼š\n\n```shell\ncmake --preset=default\n```\n\n## ç¼–è¯‘\n\n```shell\ncmake --build build\n```\n\n","tags":["boost","vcpkg","CMake"],"categories":["C++","å¼€å‘ç¯å¢ƒ"]},{"title":"æºç ç¼–è¯‘å®‰è£…nasm","url":"/2024/03/05/æºç ç¼–è¯‘å®‰è£…nasm/","content":"\n# ä»æºä»£ç ç¼–è¯‘å®‰è£… Nasm\n\n## ä¸‹è½½ Nasm æºä»£ç \n\n```shell\nwget https://www.nasm.us/pub/nasm/releasebuilds/nasm-2.15.05.tar.gz\n```\n\n## è§£å‹æºä»£ç \n\n```shell\ntar -xvzf nasm-2.15.05.tar.gz\n```\n\n## è¿›å…¥æºä»£ç ç›®å½•\n\n```shell\ncd nasm-2.15.05\n```\n\n## é…ç½®ç¼–è¯‘ç¯å¢ƒ\n\n```shell\n./configure\n```\n\n## ç¼–è¯‘å®‰è£…\n\n```shell\nmake && sudo make install\n```\n\n## éªŒè¯ Nasm ç‰ˆæœ¬\n\n```shell\nnasm --version\n```\n","tags":["nasm"],"categories":["æ±‡ç¼–"]},{"title":"DockerçŸ¥è¯†ç‚¹01","url":"/2024/02/19/DockerçŸ¥è¯†ç‚¹01/","content":"\n# åè¯\n\n| åè¯         | è¯´æ˜                                                                                                                                                                                                                                            |\n|:-----------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| Bridge ç½‘ç»œ  | 1. Bridge ç½‘ç»œæ˜¯ Docker é»˜è®¤åˆ›å»ºçš„ç½‘ç»œæ¨¡å¼ã€‚å½“æ‚¨åœ¨ Docker ä¸­åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨æ—¶ï¼Œé»˜è®¤ä¼šå°†å®¹å™¨è¿æ¥åˆ°åä¸º bridge çš„ç½‘ç»œä¸­ <br> 2. Bridge ç½‘ç»œå…è®¸å®¹å™¨ä¸å®¿ä¸»æœºä»¥åŠåŒä¸€ä¸»æœºä¸Šçš„å…¶ä»–å®¹å™¨è¿›è¡Œé€šä¿¡ï¼Œä½†é»˜è®¤æƒ…å†µä¸‹ä¸å…è®¸å®¹å™¨ä¹‹é—´è·¨ä¸»æœºé€šä¿¡ <br> 3. Bridge ç½‘ç»œä½¿ç”¨ Linux ç³»ç»Ÿä¸Šçš„æ¡¥æ¥æŠ€æœ¯ï¼Œåœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„ç½‘æ¡¥è®¾å¤‡ï¼Œç”¨äºè¿æ¥å®¹å™¨å’Œä¸»æœºçš„ç‰©ç†ç½‘ç»œæ¥å£ <br> 4. Bridge ç½‘ç»œé€‚ç”¨äºå•ä¸ªä¸»æœºä¸Šçš„å®¹å™¨é€šä¿¡ |\n| Overlay ç½‘ç»œ | 1. Overlay ç½‘ç»œç”¨äºè·¨å¤šä¸ª Docker ä¸»æœºæ„å»ºå®¹å™¨é›†ç¾¤ï¼Œå¹¶å…è®¸é›†ç¾¤ä¸­çš„å®¹å™¨ä¹‹é—´è¿›è¡Œè·¨ä¸»æœºé€šä¿¡ <br> 2. Overlay ç½‘ç»œä½¿ç”¨äº† VxLAN æŠ€æœ¯ï¼Œåœ¨ä¸åŒä¸»æœºä¸Šåˆ›å»ºè™šæ‹Ÿçš„ Overlay ç½‘ç»œï¼Œå®¹å™¨å¯ä»¥é€šè¿‡è¯¥ç½‘ç»œè¿›è¡Œé€šä¿¡ <br> 3. Overlay ç½‘ç»œé€šå¸¸ç”¨äº Docker Swarm é›†ç¾¤æˆ– Kubernetes é›†ç¾¤ä¸­ï¼Œç”¨äºæ„å»ºåˆ†å¸ƒå¼åº”ç”¨å’Œå¾®æœåŠ¡æ¶æ„ <br> 4. Overlay ç½‘ç»œé€‚ç”¨äºè·¨å¤šä¸ªä¸»æœºçš„å®¹å™¨é€šä¿¡              |\n| MTU        | æœ€å¤§ä¼ è¾“å•å…ƒMTUï¼ˆMaximum Transmission Unitï¼ŒMTUï¼‰ï¼Œæ˜¯æŒ‡ç½‘ç»œèƒ½å¤Ÿä¼ è¾“çš„æœ€å¤§æ•°æ®åŒ…å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚MTUçš„å¤§å°å†³å®šäº†å‘é€ç«¯ä¸€æ¬¡èƒ½å¤Ÿå‘é€æŠ¥æ–‡çš„æœ€å¤§å­—èŠ‚æ•°ã€‚å¦‚æœMTUè¶…è¿‡äº†æ¥æ”¶ç«¯æ‰€èƒ½å¤Ÿæ‰¿å—çš„æœ€å¤§å€¼ï¼Œæˆ–è€…æ˜¯è¶…è¿‡äº†å‘é€è·¯å¾„ä¸Šé€”ç»çš„æŸå°è®¾å¤‡æ‰€èƒ½å¤Ÿæ‰¿å—çš„æœ€å¤§å€¼ï¼Œå°±ä¼šé€ æˆæŠ¥æ–‡åˆ†ç‰‡ç”šè‡³ä¸¢å¼ƒï¼ŒåŠ é‡ç½‘ç»œä¼ è¾“çš„è´Ÿæ‹…ã€‚å¦‚æœå¤ªå°ï¼Œé‚£å®é™…ä¼ é€çš„æ•°æ®é‡å°±ä¼šè¿‡å°ï¼Œå½±å“ä¼ è¾“æ•ˆç‡ã€‚                                                |\n\n# Overlayç½‘ç»œ\n\ndocker swarmåœ¨å¯åŠ¨çš„è¿‡ç¨‹ä¸­ä¼šåˆ›å»ºä¸¤ä¸ªé»˜è®¤çš„ç½‘ç»œï¼šdocker_gwbridgeå’Œingress.\n\n- **docker_gwbridge**ï¼šé€šè¿‡è¿™ä¸ªç½‘ç»œï¼Œå®¹å™¨å¯ä»¥è¿æ¥åˆ°å®¿ä¸»æœºã€‚ï¼ˆå®ƒçš„driverå°±æ˜¯bridge)\n- **ingress**ï¼šç”±docker swarmåˆ›å»ºçš„overlayç½‘ç»œï¼Œè¿™ä¸ªç½‘ç»œç”¨äºå°†æœåŠ¡æš´éœ²ç»™å¤–éƒ¨è®¿é—®ï¼Œdocker swarmå°±æ˜¯é€šè¿‡å®ƒå®ç°çš„routing meshï¼ˆå°†å¤–éƒ¨è¯·æ±‚è·¯ç”±åˆ°ä¸åŒä¸»æœºçš„å®¹å™¨ï¼‰ã€‚\n\nä¾‹å­å¦‚ä¸‹ï¼š\n```Shell\n[centos@bd-2 ~]$ docker network ls\nNETWORK ID     NAME                           DRIVER    SCOPE\n69477a3560e9   bridge                         bridge    local\n320cd9ae8475   centos_default                 bridge    local\nd344065cc4cc   docker_gwbridge                bridge    local\nda5d24e5d251   flow-admin-backend_admin-net   bridge    local\n4d5b92424942   flow-admin-front_admin-net     bridge    local\nqqfrntz0lrex   hadoop-com                     overlay   swarm\n5cd8e1bc97a5   host                           host      local\nmtysig457puz   ingress                        overlay   swarm\n7ad98d08bd3c   none                           null      local  \n```\n\n# docker0çš„mtu\nmtuæŸ¥çœ‹\n```Shell\nifconfig | grep mtu\n```\nå¦‚æœå®¿ä¸»æœºçš„mtuæ¯”docker0çš„mtuè¿˜å°ï¼Œç½‘ç»œä¼šå­˜åœ¨é—®é¢˜ï¼Œæ‰€ä»¥æ˜¯éœ€è¦ä¿®æ”¹docker0çš„mtu\n\næˆ‘ç›´æ¥é€šè¿‡ä¿®æ”¹/etc/docker/daemon.jsonæ–‡ä»¶ï¼š\n```JSON\n{\n    \"log-driver\":\"json-file\",\n    \"log-opts\": {\"max-size\":\"200m\", \"max-file\":\"3\"},\n    \"live-restore\": false,\n    \"mtu\": 1450,\n    \"insecure-registries\":[\"192.168.10.166:88\",\"192.168.9.68\",\"192.168.11.149:8888\",\"192.168.11.168:8888\"]\n}\n```\n\né‡å¯docker\n\n```Shell\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n```\n\né‡æ–°æŸ¥çœ‹mtuï¼Œå¦‚æœdockerä¸­æ­¤æ—¶æ²¡æœ‰å®¹å™¨åœ¨è¿è¡Œï¼Œé‚£ä¼šå‘ç°docker0çš„mtuè¿˜æ˜¯åŸå…ˆçš„å€¼ã€‚è¿™é‡Œæœ‰å‘ï¼šå½“dockerä¸­æœ‰å®¹å™¨åœ¨è¿è¡Œæ—¶ï¼Œå†å»æŸ¥çœ‹docker0çš„mtuå°±ç”Ÿæ•ˆäº†ã€‚\nå¼ºè¿«ç—‡å¯ä»¥ä¿®æ”¹daemon.jsoné…ç½®ï¼Œé‡å¯dockeræœåŠ¡åï¼Œå†ä½¿ç”¨å‘½ä»¤ä¸´æ—¶ä¿®æ”¹docker0çš„mtuï¼š\n```Shell\nsudo ip link set docker0 mtu 1450\n```\n\n# Swarmé›†ç¾¤æ­å»º\nåˆå§‹åŒ–managerèŠ‚ç‚¹\n```Shell\ndocker swarm init --advertise-addr 192.168.10.91:2377\n```\næ­£å¸¸æƒ…å†µè¾“å‡ºç±»ä¼¼ä»¥ä¸‹çš„æç¤ºï¼š\n```Shell\nSwarm initialized: current node (tg66scjfm2kgw5z7pb7vpnrye) is now a manager.\n\nTo add a worker to this swarm, run the following command:\n\n    docker swarm join --token SWMTKN-1-4e22sso1h4dofwqzq25a6crgc9fzk4it6237jdd6ezuzqknsw5-79qgv3b9sc88wa8jk5etylpty 192.168.10.91:2377\n\nTo add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.\n```\n\nåç»­æƒ³è¦æŸ¥çœ‹æ€ä¹ˆåŠ å…¥åˆ°swarmé›†ç¾¤ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤:\n```Shell\n# è·å–ManagerèŠ‚ç‚¹åŠ å…¥å‘½ä»¤\ndocker swarm join-token manager\n\n# è·å–WorkerèŠ‚ç‚¹åŠ å…¥å‘½ä»¤\ndocker swarm join-token worker\n```\n\nå¯ä»¥åˆ°workèŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼š\n```Shell\ndocker swarm join --token SWMTKN-1-4e22sso1h4dofwqzq25a6crgc9fzk4it6237jdd6ezuzqknsw5-79qgv3b9sc88wa8jk5etylpty 192.168.10.91:2377\n\n```\n\nå¦‚æœæ˜¯å¤šmanagerçš„è¯ï¼Œå¯ä»¥åœ¨å…¶å®ƒmanagerèŠ‚ç‚¹æ‰§è¡Œï¼š\n```Shell\ndocker swarm join --token SWMTKN-1-4e22sso1h4dofwqzq25a6crgc9fzk4it6237jdd6ezuzqknsw5-2ccx8qd17rc0ydci0kcw9qfy2 192.168.10.91:2377\n```\n\n> è¿™é‡Œæœ‰å‘ï¼Œå°±æ˜¯dockerçš„daemon.jsonä¸­é…ç½®çš„mtuï¼Œå¯¹äºswarmçš„overlayç½‘ç»œæ˜¯ä¸èµ·ä½œç”¨çš„ã€‚\n\nä¿®æ”¹overlayç½‘ç»œçš„mtuå’Œeth0,docker0çš„mtuä¿æŒä¸€è‡´\n1. åœ¨managerèŠ‚ç‚¹ä¸­å…ˆè·å–å­ç½‘ä¿¡æ¯\n    ```Shell\n    docker network inspect -f '{{json .IPAM}}' docker_gwbridge\n    ```\n   è¿”å›ï¼š\n    ```Shell\n    {\"Driver\":\"default\",\"Options\":null,\"Config\":[{\"Subnet\":\"172.18.0.0/16\",\"Gateway\":\"172.18.0.1\"}]} \n    ```\n2. managerèŠ‚ç‚¹é€€å‡ºswarmé›†ç¾¤(è‡ªå®šä¹‰docker_gwbridgeç½‘ç»œï¼Œåˆ™å¿…é¡»åœ¨å°† Docker ä¸»æœºåŠ å…¥ swarm ä¹‹å‰æˆ–æš‚æ—¶ä» swarm ä¸­ç§»é™¤åè¿›è¡Œ)\n    ```Shell\n    docker swarm leave --force\n    ```\n3. managerèŠ‚ç‚¹åœæ‰dockeræœåŠ¡\n    ```Shell\n    sudo systemctl stop docker.service\n    ```\n4. managerèŠ‚ç‚¹ä¸­åˆ æ‰è™šæ‹Ÿç½‘å¡docker_gwbridge\n    ```Shell\n    sudo ip link set docker_gwbridge down\n    sudo ip link del dev docker_gwbridge\n    ```\n5. managerèŠ‚ç‚¹ä¸­å¯åŠ¨docker\n    ```Shell\n    sudo systemctl start docker.service\n    ```\n6. managerèŠ‚ç‚¹ä¸­é‡å»ºdocker_gwbridgeï¼ˆè¿™ä¸€æ­¥ç”¨åˆ°äº†ç¬¬1æ­¥è·å–çš„å­ç½‘ä¿¡æ¯ä»¥åŠè®¾ç½®æˆ‘ä»¬è¦çš„mtuå€¼ï¼‰\n    ```Shell\n    docker network rm docker_gwbridge\n    docker network create \\\n      --subnet 172.18.0.0/16 \\\n      --gateway 172.18.0.1 \\\n      --opt com.docker.network.bridge.name=docker_gwbridge \\\n      --opt com.docker.network.bridge.enable_icc=false \\\n      --opt com.docker.network.bridge.enable_ip_masquerade=true \\\n      --opt com.docker.network.driver.mtu=1450 \\\n      docker_gwbridge\n    ```\n   **å†åˆ°workèŠ‚ç‚¹ä¸Šæ‰§è¡Œç›¸åŒçš„å‘½ä»¤æ‰§è¡Œ1~6æ­¥éª¤**å®Œæˆdocker_gwbridgeç½‘ç»œçš„è‡ªå®šä¹‰åˆ›å»º\n\n7. managerèŠ‚ç‚¹ä¸­æŸ¥çœ‹ingressç½‘ç»œä¿¡æ¯\n   ```Shell\n   docker network inspect -f '{{json .IPAM}}' ingress\n   ```\n   è¿”å›\n   ```Shell\n   {\"Driver\":\"default\",\"Options\":null,\"Config\":[{\"Subnet\":\"10.0.0.0/24\",\"Gateway\":\"10.0.0.1\"}]}\n   ```\n8. managerèŠ‚ç‚¹ä¸­åˆ é™¤ingress network\n   ```Shell\n   docker network rm ingress\n   ```\n   > è¿™ä¸€æ­¥ä¼šæœ‰ä¸ªè­¦å‘Š\n\n   ```Shell\n   WARNING! Before removing the routing-mesh network, make sure all the nodes in your swarm run the same docker engine version. Otherwise, removal may not be effective and functionality of newly create ingress networks will be impaired.\n   ```\n   > æ‰€ä»¥swarmä¸­çš„èŠ‚ç‚¹çš„dockerç‰ˆæœ¬æœ€å¥½ä¿æŒä¸€è‡´\n\n9. managerèŠ‚ç‚¹ä¸­é‡å»ºingress(è®°å¾—ä½¿ç”¨ä¹‹å‰æŸ¥çœ‹çš„ingressç½‘ç»œä¸­çš„å­ç½‘ä»¥åŠç½‘å…³ï¼Œmtuè‡ªå®šä¹‰ä¿®æ”¹)\n   ```Shell\n   docker network create \\\n     --driver overlay \\\n     --ingress \\\n     --subnet=10.0.0.0/24 \\\n     --gateway=10.0.0.1 \\\n     --opt com.docker.network.driver.mtu=1450 \\\n     ingress\n   ```\n\n10. ç„¶åå°±æ˜¯å…¶å®ƒçš„managerèŠ‚ç‚¹/workerèŠ‚ç‚¹çš„åŠ å…¥äº†\n   > **æ³¨æ„ï¼šæ–°æœºå™¨åœ¨joinåˆ°swarmä¹‹å‰ï¼Œå¾—å…ˆé‡å»ºdocker_gwbridge(mtuå¾—ä¿æŒä¸€è‡´ï¼‰**\n\n11. éªŒè¯mtuæ˜¯å¦éƒ½æŒ‰æˆ‘ä»¬å®šä¹‰çš„ä¿®æ”¹äº†\n      å¯åŠ¨ä¸€ä¸ªswarm service\n   ```Shell\n   docker service create -td --name busybox busybox\n   ```\n   æŸ¥çœ‹mtu\n   ```Shell\n   ifconfig | grep mtu\n   ```\n   è¿”å›\n   ```Shell\n   docker0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1450\n   docker_gwbridge: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1450\n   eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1450\n   lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536\n   veth21384b6: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1450\n   veth41d39c5: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1450\n   ```\n\n","tags":["swarm","docker","mtu","bridge","overlay","network"],"categories":["äº‘åŸç”Ÿ","åŸºç¡€è®¾æ–½"]},{"title":"nfså…±äº«ç›®å½•","url":"/2024/02/18/nfså…±äº«ç›®å½•/","content":"\n# nfs æœåŠ¡\n\n1. å®‰è£… NFS æœåŠ¡å™¨è½¯ä»¶åŒ…ï¼šé¦–å…ˆï¼Œåœ¨ Fedora ç³»ç»Ÿä¸Šå®‰è£… NFS æœåŠ¡å™¨è½¯ä»¶åŒ…ã€‚NFS æœåŠ¡å™¨è½¯ä»¶åŒ…é€šå¸¸æ˜¯`nfs-utils`ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š\n    ```Shell\n    sudo dnf install nfs-utils\n    \n    ```\n\n2. é…ç½®`NFS`æœåŠ¡å™¨ï¼š`NFS` æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶æ˜¯`/etc/exports`ï¼Œä½ éœ€è¦ç¼–è¾‘è¿™ä¸ªæ–‡ä»¶æ¥æŒ‡å®šè¦å…±äº«çš„ç›®å½•å’Œç›¸å…³çš„å…±äº«é€‰é¡¹ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨`vi`æˆ–è€…å…¶ä»–æ–‡æœ¬ç¼–è¾‘å™¨æ¥ç¼–è¾‘`/etc/exports`æ–‡ä»¶ï¼š\n\n    ```Shell\n    sudo vi /etc/exports\n    ```\n\n   åœ¨æ‰“å¼€çš„æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥æ·»åŠ ç±»ä¼¼å¦‚ä¸‹çš„è¡Œæ¥æŒ‡å®šå…±äº«çš„ç›®å½•å’Œç›¸å…³é€‰é¡¹ï¼š\n    ```Shell\n    /home/maodaoming/nfs_share/volume *(rw,sync,no_root_squash,no_subtree_check,insecure)\n    ```\n   è¿™è¡Œè¡¨ç¤ºå°† /home/maodaoming/nfs_share/volume ç›®å½•å…±äº«ç»™æ‰€æœ‰å®¢æˆ·ç«¯,è¿˜å®šä¹‰äº†ç›¸åº”çš„æƒé™\n\n3. é‡è½½ NFS æœåŠ¡å™¨é…ç½®ï¼šç¼–è¾‘å®Œæˆ /etc/exports æ–‡ä»¶åï¼Œä½ éœ€è¦é‡æ–°åŠ è½½ NFS æœåŠ¡å™¨é…ç½®ä½¿ä¹‹ç”Ÿæ•ˆã€‚ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥é‡æ–°åŠ è½½ï¼š\n    ```Shell\n    sudo exportfs -r\n    ```\n   è¿™ä¸ªå‘½ä»¤ä¼šé‡æ–°åŠ è½½ /etc/exports æ–‡ä»¶ä¸­çš„é…ç½®ï¼Œå¹¶ä½¿æ–°çš„å…±äº«ç›®å½•ç”Ÿæ•ˆã€‚\n\n4. å¯åŠ¨ NFS æœåŠ¡å™¨ï¼šä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ NFS æœåŠ¡å™¨ï¼š\n    ```Shell\n    sudo systemctl start nfs-server\n    ```\n5. è®¾ç½®å¼€æœºå¯åŠ¨\n    ```Shell\n    sudo systemctl enable nfs-server\n    ```\n\n# å®¢æˆ·ç«¯\n\n1. åˆ›å»ºæœ¬åœ°æŒ‚è½½ç‚¹ï¼šåœ¨ macOS ä¸Šåˆ›å»ºä¸€ä¸ªæœ¬åœ°ç›®å½•ï¼Œç”¨äºæŒ‚è½½ NFS å…±äº«ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åœ¨ macOS ä¸Šåˆ›å»ºä¸€ä¸ªåä¸º /mnt/nfs_share çš„ç›®å½•ï¼š\n    ```Shell\n    sudo mkdir -p /mnt/nfs_share\n    ```\n2. æŒ‚è½½ NFS å…±äº«ï¼šä½¿ç”¨ mount å‘½ä»¤æŒ‚è½½ NFS å…±äº«ã€‚ä½ éœ€è¦æŒ‡å®š NFS æœåŠ¡å™¨çš„ IP åœ°å€ï¼ˆæˆ–ä¸»æœºåï¼‰ä»¥åŠå…±äº«çš„è¿œç¨‹ç›®å½•å’Œæœ¬åœ°æŒ‚è½½ç‚¹ã€‚ä¾‹å¦‚ï¼š\n    ```Shell\n    sudo mount -t nfs <NFSæœåŠ¡å™¨IP>:/home/maodaoming/nfs_share/volume /mnt/nfs_share\n    ```\n\n3. ~~å¸è½½æŒ‚è½½ç‚¹~~\n    ```Shell\n    sudo umount /mnt/nfs_share\n    ```\n\n","tags":["nfs"],"categories":["Linux"]},{"title":"FlinkåŸç†ä¸å®ç°:Windowæœºåˆ¶","url":"/2023/12/14/Flink-åŸç†ä¸å®ç°-Window-æœºåˆ¶/","content":"\n# ç®€ä»‹\n\nFlink è®¤ä¸º Batch æ˜¯ Streaming çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œæ‰€ä»¥ Flink åº•å±‚å¼•æ“æ˜¯ä¸€ä¸ªæµå¼å¼•æ“ï¼Œåœ¨ä¸Šé¢å®ç°äº†æµå¤„ç†å’Œæ‰¹å¤„ç†ã€‚è€Œçª—å£ï¼ˆwindowï¼‰å°±æ˜¯ä» Streaming åˆ° Batch çš„ä¸€ä¸ªæ¡¥æ¢ã€‚Flink æä¾›äº†éå¸¸å®Œå–„çš„çª—å£æœºåˆ¶ï¼Œè¿™æ˜¯æˆ‘è®¤ä¸ºçš„ Flink æœ€å¤§çš„äº®ç‚¹ä¹‹ä¸€ï¼ˆå…¶ä»–çš„äº®ç‚¹åŒ…æ‹¬æ¶ˆæ¯ä¹±åºå¤„ç†ï¼Œå’Œ checkpoint æœºåˆ¶ï¼‰ã€‚æœ¬æ–‡æˆ‘ä»¬å°†ä»‹ç»æµå¼å¤„ç†ä¸­çš„çª—å£æ¦‚å¿µï¼Œä»‹ç» Flink å†…å»ºçš„ä¸€äº›çª—å£å’Œ Window APIï¼Œæœ€åè®¨è®ºä¸‹çª—å£åœ¨åº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ã€‚\n\n\n# ä»€ä¹ˆæ˜¯ Window\n\nåœ¨æµå¤„ç†åº”ç”¨ä¸­ï¼Œæ•°æ®æ˜¯è¿ç»­ä¸æ–­çš„ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¯èƒ½ç­‰åˆ°æ‰€æœ‰æ•°æ®éƒ½åˆ°äº†æ‰å¼€å§‹å¤„ç†ã€‚å½“ç„¶æˆ‘ä»¬å¯ä»¥æ¯æ¥ä¸€ä¸ªæ¶ˆæ¯å°±å¤„ç†ä¸€æ¬¡ï¼Œä½†æ˜¯æœ‰æ—¶æˆ‘ä»¬éœ€è¦åšä¸€äº›èšåˆç±»çš„å¤„ç†ï¼Œä¾‹å¦‚ï¼šåœ¨è¿‡å»çš„1åˆ†é’Ÿå†…æœ‰å¤šå°‘ç”¨æˆ·ç‚¹å‡»äº†æˆ‘ä»¬çš„ç½‘é¡µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¿…é¡»å®šä¹‰ä¸€ä¸ªçª—å£ï¼Œç”¨æ¥æ”¶é›†æœ€è¿‘ä¸€åˆ†é’Ÿå†…çš„æ•°æ®ï¼Œå¹¶å¯¹è¿™ä¸ªçª—å£å†…çš„æ•°æ®è¿›è¡Œè®¡ç®—ã€‚\n\nçª—å£å¯ä»¥æ˜¯æ—¶é—´é©±åŠ¨çš„ï¼ˆTime Windowï¼Œä¾‹å¦‚ï¼šæ¯30ç§’é’Ÿï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯æ•°æ®é©±åŠ¨çš„ï¼ˆCount Windowï¼Œä¾‹å¦‚ï¼šæ¯ä¸€ç™¾ä¸ªå…ƒç´ ï¼‰ã€‚ä¸€ç§ç»å…¸çš„çª—å£åˆ†ç±»å¯ä»¥åˆ†æˆï¼šç¿»æ»šçª—å£ï¼ˆTumbling Windowï¼Œæ— é‡å ï¼‰ï¼Œæ»šåŠ¨çª—å£ï¼ˆSliding Windowï¼Œæœ‰é‡å ï¼‰ï¼Œå’Œä¼šè¯çª—å£ï¼ˆSession Windowï¼Œæ´»åŠ¨é—´éš™ï¼‰ã€‚\n\næˆ‘ä»¬ä¸¾ä¸ªå…·ä½“çš„åœºæ™¯æ¥å½¢è±¡åœ°ç†è§£ä¸åŒçª—å£çš„æ¦‚å¿µã€‚å‡è®¾ï¼Œæ·˜å®ç½‘ä¼šè®°å½•æ¯ä¸ªç”¨æˆ·æ¯æ¬¡è´­ä¹°çš„å•†å“ä¸ªæ•°ï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯ç»Ÿè®¡ä¸åŒçª—å£ä¸­ç”¨æˆ·è´­ä¹°å•†å“çš„æ€»æ•°ã€‚ä¸‹å›¾ç»™å‡ºäº†å‡ ç§ç»å…¸çš„çª—å£åˆ‡åˆ†æ¦‚è¿°å›¾ï¼š\n\n![çª—å£åˆ‡åˆ†æ¦‚è¿°å›¾](./Flink-åŸç†ä¸å®ç°-Window-æœºåˆ¶/Snipaste_2023-12-14_11-17-27.png)\n\nä¸Šå›¾ä¸­ï¼Œraw data stream ä»£è¡¨ç”¨æˆ·çš„è´­ä¹°è¡Œä¸ºæµï¼Œåœˆä¸­çš„æ•°å­—ä»£è¡¨è¯¥ç”¨æˆ·æœ¬æ¬¡è´­ä¹°çš„å•†å“ä¸ªæ•°ï¼Œäº‹ä»¶æ˜¯æŒ‰æ—¶é—´åˆ†å¸ƒçš„ï¼Œæ‰€ä»¥å¯ä»¥çœ‹å‡ºäº‹ä»¶ä¹‹é—´æ˜¯æœ‰time gapçš„ã€‚Flink æä¾›äº†ä¸Šå›¾ä¸­æ‰€æœ‰çš„çª—å£ç±»å‹ï¼Œä¸‹é¢æˆ‘ä»¬ä¼šé€ä¸€è¿›è¡Œä»‹ç»ã€‚\n\n\n# Time Window\n\nå°±å¦‚åå­—æ‰€è¯´çš„ï¼ŒTime Window æ˜¯æ ¹æ®æ—¶é—´å¯¹æ•°æ®æµè¿›è¡Œåˆ†ç»„çš„ã€‚è¿™é‡Œæˆ‘ä»¬æ¶‰åŠåˆ°äº†æµå¤„ç†ä¸­çš„æ—¶é—´é—®é¢˜ï¼Œæ—¶é—´é—®é¢˜å’Œæ¶ˆæ¯ä¹±åºé—®é¢˜æ˜¯ç´§å¯†å…³è”çš„ï¼Œè¿™æ˜¯æµå¤„ç†ä¸­ç°å­˜çš„éš¾é¢˜ä¹‹ä¸€ï¼Œæˆ‘ä»¬å°†åœ¨åç»­çš„ EventTime å’Œæ¶ˆæ¯ä¹±åºå¤„ç† ä¸­å¯¹è¿™éƒ¨åˆ†é—®é¢˜è¿›è¡Œæ·±å…¥æ¢è®¨ã€‚è¿™é‡Œæˆ‘ä»¬åªéœ€è¦çŸ¥é“ Flink æå‡ºäº†ä¸‰ç§æ—¶é—´çš„æ¦‚å¿µï¼Œåˆ†åˆ«æ˜¯event timeï¼ˆäº‹ä»¶æ—¶é—´ï¼šäº‹ä»¶å‘ç”Ÿæ—¶çš„æ—¶é—´ï¼‰ï¼Œingestion timeï¼ˆæ‘„å–æ—¶é—´ï¼šäº‹ä»¶è¿›å…¥æµå¤„ç†ç³»ç»Ÿçš„æ—¶é—´ï¼‰ï¼Œprocessing timeï¼ˆå¤„ç†æ—¶é—´ï¼šæ¶ˆæ¯è¢«è®¡ç®—å¤„ç†çš„æ—¶é—´ï¼‰ã€‚Flink ä¸­çª—å£æœºåˆ¶å’Œæ—¶é—´ç±»å‹æ˜¯å®Œå…¨è§£è€¦çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å½“éœ€è¦æ”¹å˜æ—¶é—´ç±»å‹æ—¶ä¸éœ€è¦æ›´æ”¹çª—å£é€»è¾‘ç›¸å…³çš„ä»£ç ã€‚\n\n## Tumbling Time Window\n\nå¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬éœ€è¦ç»Ÿè®¡æ¯ä¸€åˆ†é’Ÿä¸­ç”¨æˆ·è´­ä¹°çš„å•†å“çš„æ€»æ•°ï¼Œéœ€è¦å°†ç”¨æˆ·çš„è¡Œä¸ºäº‹ä»¶æŒ‰æ¯ä¸€åˆ†é’Ÿè¿›è¡Œåˆ‡åˆ†ï¼Œè¿™ç§åˆ‡åˆ†è¢«æˆä¸ºç¿»æ»šæ—¶é—´çª—å£ï¼ˆTumbling Time Windowï¼‰ã€‚ç¿»æ»šçª—å£èƒ½å°†æ•°æ®æµåˆ‡åˆ†æˆä¸é‡å çš„çª—å£ï¼Œæ¯ä¸€ä¸ªäº‹ä»¶åªèƒ½å±äºä¸€ä¸ªçª—å£ã€‚é€šè¿‡ä½¿ç”¨ DataStream APIï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®ç°ï¼š\n\n```scala\n// Stream of (userId, buyCnt)\nval buyCnts: DataStream[(Int, Int)] = ...\n\nval tumblingCnts: DataStream[(Int, Int)] = buyCnts\n  // key stream by userId\n  .keyBy(0) \n  // tumbling time window of 1 minute length\n  .timeWindow(Time.minutes(1))\n  // compute sum over buyCnt\n  .sum(1)\n```\n\n## Sliding Time Window\n\nä½†æ˜¯å¯¹äºæŸäº›åº”ç”¨ï¼Œå®ƒä»¬éœ€è¦çš„çª—å£æ˜¯ä¸é—´æ–­çš„ï¼Œéœ€è¦å¹³æ»‘åœ°è¿›è¡Œçª—å£èšåˆã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æ¯30ç§’è®¡ç®—ä¸€æ¬¡æœ€è¿‘ä¸€åˆ†é’Ÿç”¨æˆ·è´­ä¹°çš„å•†å“æ€»æ•°ã€‚è¿™ç§çª—å£æˆ‘ä»¬ç§°ä¸ºæ»‘åŠ¨æ—¶é—´çª—å£ï¼ˆSliding Time Windowï¼‰ã€‚åœ¨æ»‘çª—ä¸­ï¼Œä¸€ä¸ªå…ƒç´ å¯ä»¥å¯¹åº”å¤šä¸ªçª—å£ã€‚é€šè¿‡ä½¿ç”¨ DataStream APIï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®ç°ï¼š\n\n```scala\nval slidingCnts: DataStream[(Int, Int)] = buyCnts\n  .keyBy(0) \n  // sliding time window of 1 minute length and 30 secs trigger interval\n  .timeWindow(Time.minutes(1), Time.seconds(30))\n  .sum(1)\n```\n\n# Count Window\n\nCount Window æ˜¯æ ¹æ®å…ƒç´ ä¸ªæ•°å¯¹æ•°æ®æµè¿›è¡Œåˆ†ç»„çš„ã€‚\n\n## Tumbling Count Window\n\nå½“æˆ‘ä»¬æƒ³è¦æ¯100ä¸ªç”¨æˆ·è´­ä¹°è¡Œä¸ºäº‹ä»¶ç»Ÿè®¡è´­ä¹°æ€»æ•°ï¼Œé‚£ä¹ˆæ¯å½“çª—å£ä¸­å¡«æ»¡100ä¸ªå…ƒç´ äº†ï¼Œå°±ä¼šå¯¹çª—å£è¿›è¡Œè®¡ç®—ï¼Œè¿™ç§çª—å£æˆ‘ä»¬ç§°ä¹‹ä¸ºç¿»æ»šè®¡æ•°çª—å£ï¼ˆTumbling Count Windowï¼‰ï¼Œä¸Šå›¾æ‰€ç¤ºçª—å£å¤§å°ä¸º3ä¸ªã€‚é€šè¿‡ä½¿ç”¨ DataStream APIï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å®ç°ï¼š\n\n```scala\n// Stream of (userId, buyCnts)\nval buyCnts: DataStream[(Int, Int)] = ...\n\nval tumblingCnts: DataStream[(Int, Int)] = buyCnts\n  // key stream by sensorId\n  .keyBy(0)\n  // tumbling count window of 100 elements size\n  .countWindow(100)\n  // compute the buyCnt sum \n  .sum(1)\n```\n\n## Sliding Count Window\n\nå½“ç„¶Count Window ä¹Ÿæ”¯æŒ Sliding Windowï¼Œè™½åœ¨ä¸Šå›¾ä¸­æœªæè¿°å‡ºæ¥ï¼Œä½†å’ŒSliding Time Windowå«ä¹‰æ˜¯ç±»ä¼¼çš„ï¼Œä¾‹å¦‚æ¯10ä¸ªå…ƒç´ è®¡ç®—ä¸€æ¬¡æœ€è¿‘100ä¸ªå…ƒç´ çš„æ€»å’Œï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ã€‚\n\n```scala\nval slidingCnts: DataStream[(Int, Int)] = vehicleCnts\n  .keyBy(0)\n  // sliding count window of 100 elements size and 10 elements trigger interval\n  .countWindow(100, 10)\n  .sum(1)\n```\n\n# Session Window\n\nåœ¨è¿™ç§ç”¨æˆ·äº¤äº’äº‹ä»¶æµä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„æ˜¯å°†äº‹ä»¶èšåˆåˆ°ä¼šè¯çª—å£ä¸­ï¼ˆä¸€æ®µç”¨æˆ·æŒç»­æ´»è·ƒçš„å‘¨æœŸï¼‰ï¼Œç”±éæ´»è·ƒçš„é—´éš™åˆ†éš”å¼€ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå°±æ˜¯éœ€è¦è®¡ç®—æ¯ä¸ªç”¨æˆ·åœ¨æ´»è·ƒæœŸé—´æ€»å…±è´­ä¹°çš„å•†å“æ•°é‡ï¼Œå¦‚æœç”¨æˆ·30ç§’æ²¡æœ‰æ´»åŠ¨åˆ™è§†ä¸ºä¼šè¯æ–­å¼€ï¼ˆå‡è®¾raw data streamæ˜¯å•ä¸ªç”¨æˆ·çš„è´­ä¹°è¡Œä¸ºæµï¼‰ã€‚Session Window çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n\n```scala\n// Stream of (userId, buyCnts)\nval buyCnts: DataStream[(Int, Int)] = ...\n    \nval sessionCnts: DataStream[(Int, Int)] = vehicleCnts\n    .keyBy(0)\n    // session window based on a 30 seconds session gap interval \n    .window(ProcessingTimeSessionWindows.withGap(Time.seconds(30)))\n    .sum(1)\n```\n\nä¸€èˆ¬è€Œè¨€ï¼Œwindow æ˜¯åœ¨æ— é™çš„æµä¸Šå®šä¹‰äº†ä¸€ä¸ªæœ‰é™çš„å…ƒç´ é›†åˆã€‚è¿™ä¸ªé›†åˆå¯ä»¥æ˜¯åŸºäºæ—¶é—´çš„ï¼Œå…ƒç´ ä¸ªæ•°çš„ï¼Œæ—¶é—´å’Œä¸ªæ•°ç»“åˆçš„ï¼Œä¼šè¯é—´éš™çš„ï¼Œæˆ–è€…æ˜¯è‡ªå®šä¹‰çš„ã€‚Flink çš„ DataStream API æä¾›äº†ç®€æ´çš„ç®—å­æ¥æ»¡è¶³å¸¸ç”¨çš„çª—å£æ“ä½œï¼ŒåŒæ—¶æä¾›äº†é€šç”¨çš„çª—å£æœºåˆ¶æ¥å…è®¸ç”¨æˆ·è‡ªå·±å®šä¹‰çª—å£åˆ†é…é€»è¾‘ã€‚ä¸‹é¢æˆ‘ä»¬ä¼šå¯¹ Flink çª—å£ç›¸å…³çš„ API è¿›è¡Œå‰–æã€‚\n\n# å‰–æ Window API\n\nå¾—ç›Šäº Flink Window API æ¾è€¦åˆè®¾è®¡ï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸çµæ´»åœ°å®šä¹‰ç¬¦åˆç‰¹å®šä¸šåŠ¡çš„çª—å£ã€‚Flink ä¸­å®šä¹‰ä¸€ä¸ªçª—å£ä¸»è¦éœ€è¦ä»¥ä¸‹ä¸‰ä¸ªç»„ä»¶ã€‚\n\n- Window Assignerï¼šç”¨æ¥å†³å®šæŸä¸ªå…ƒç´ è¢«åˆ†é…åˆ°å“ªä¸ª/å“ªäº›çª—å£ä¸­å»ã€‚\n\n  å¦‚ä¸‹ç±»å›¾å±•ç¤ºäº†ç›®å‰å†…ç½®å®ç°çš„ Window Assignersï¼š\n\n  ![WindowAssigners](./Flink-åŸç†ä¸å®ç°-Window-æœºåˆ¶/WindowAssigners.png)\n\n- Triggerï¼šè§¦å‘å™¨ã€‚å†³å®šäº†ä¸€ä¸ªçª—å£ä½•æ—¶èƒ½å¤Ÿè¢«è®¡ç®—æˆ–æ¸…é™¤ï¼Œæ¯ä¸ªçª—å£éƒ½ä¼šæ‹¥æœ‰ä¸€ä¸ªè‡ªå·±çš„Triggerã€‚\n\n  å¦‚ä¸‹ç±»å›¾å±•ç¤ºäº†ç›®å‰å†…ç½®å®ç°çš„ Triggersï¼š\n  ![Triggers](./Flink-åŸç†ä¸å®ç°-Window-æœºåˆ¶/Triggers.png)\n\n- Evictorï¼šå¯ä»¥è¯‘ä¸ºâ€œé©±é€è€…â€ã€‚åœ¨Triggerè§¦å‘ä¹‹åï¼Œåœ¨çª—å£è¢«å¤„ç†ä¹‹å‰ï¼ŒEvictorï¼ˆå¦‚æœæœ‰Evictorçš„è¯ï¼‰ä¼šç”¨æ¥å‰”é™¤çª—å£ä¸­ä¸éœ€è¦çš„å…ƒç´ ï¼Œç›¸å½“äºä¸€ä¸ªfilterã€‚\n\n  å¦‚ä¸‹ç±»å›¾å±•ç¤ºäº†ç›®å‰å†…ç½®å®ç°çš„ Evictorsï¼š\n  ![Evictors](./Flink-åŸç†ä¸å®ç°-Window-æœºåˆ¶/Evictors.png)\n\nä¸Šè¿°ä¸‰ä¸ªç»„ä»¶çš„ä¸åŒå®ç°çš„ä¸åŒç»„åˆï¼Œå¯ä»¥å®šä¹‰å‡ºéå¸¸å¤æ‚çš„çª—å£ã€‚Flink ä¸­å†…ç½®çš„çª—å£ä¹Ÿéƒ½æ˜¯åŸºäºè¿™ä¸‰ä¸ªç»„ä»¶æ„æˆçš„ï¼Œå½“ç„¶å†…ç½®çª—å£æœ‰æ—¶å€™æ— æ³•è§£å†³ç”¨æˆ·ç‰¹æ®Šçš„éœ€æ±‚ï¼Œæ‰€ä»¥ Flink ä¹Ÿæš´éœ²äº†è¿™äº›çª—å£æœºåˆ¶çš„å†…éƒ¨æ¥å£ä¾›ç”¨æˆ·å®ç°è‡ªå®šä¹‰çš„çª—å£ã€‚ä¸‹é¢æˆ‘ä»¬å°†åŸºäºè¿™ä¸‰è€…æ¢è®¨çª—å£çš„å®ç°æœºåˆ¶ã€‚\n\n\n# Window çš„å®ç°\n\nä¸‹å›¾æè¿°äº† Flink çš„çª—å£æœºåˆ¶ä»¥åŠå„ç»„ä»¶ä¹‹é—´æ˜¯å¦‚ä½•ç›¸äº’å·¥ä½œçš„ã€‚\n\n![ç»„ä»¶äº¤äº’](./Flink-åŸç†ä¸å®ç°-Window-æœºåˆ¶/ç»„ä»¶äº¤äº’.png)\n\né¦–å…ˆä¸Šå›¾ä¸­çš„ç»„ä»¶éƒ½ä½äºä¸€ä¸ªç®—å­ï¼ˆwindow operatorï¼‰ä¸­ï¼Œæ•°æ®æµæºæºä¸æ–­åœ°è¿›å…¥ç®—å­ï¼Œæ¯ä¸€ä¸ªåˆ°è¾¾çš„å…ƒç´ éƒ½ä¼šè¢«äº¤ç»™ WindowAssignerã€‚WindowAssigner ä¼šå†³å®šå…ƒç´ è¢«æ”¾åˆ°å“ªä¸ªæˆ–å“ªäº›çª—å£ï¼ˆwindowï¼‰ï¼Œå¯èƒ½ä¼šåˆ›å»ºæ–°çª—å£ã€‚å› ä¸ºä¸€ä¸ªå…ƒç´ å¯ä»¥è¢«æ”¾å…¥å¤šä¸ªçª—å£ä¸­ï¼Œæ‰€ä»¥åŒæ—¶å­˜åœ¨å¤šä¸ªçª—å£æ˜¯å¯èƒ½çš„ã€‚æ³¨æ„ï¼ŒWindowæœ¬èº«åªæ˜¯ä¸€ä¸ªIDæ ‡è¯†ç¬¦ï¼Œå…¶å†…éƒ¨å¯èƒ½å­˜å‚¨äº†ä¸€äº›å…ƒæ•°æ®ï¼Œå¦‚TimeWindowä¸­æœ‰å¼€å§‹å’Œç»“æŸæ—¶é—´ï¼Œä½†æ˜¯å¹¶ä¸ä¼šå­˜å‚¨çª—å£ä¸­çš„å…ƒç´ ã€‚çª—å£ä¸­çš„å…ƒç´ å®é™…å­˜å‚¨åœ¨ Key/Value State ä¸­ï¼Œkeyä¸ºWindowï¼Œvalueä¸ºå…ƒç´ é›†åˆï¼ˆæˆ–èšåˆå€¼ï¼‰ã€‚ä¸ºäº†ä¿è¯çª—å£çš„å®¹é”™æ€§ï¼Œè¯¥å®ç°ä¾èµ–äº† Flink çš„ State æœºåˆ¶ï¼ˆå‚è§ [state æ–‡æ¡£](https://ci.apache.org/projects/flink/flink-docs-master/apis/streaming/state.html?spm=a2c6h.12873639.article-detail.8.571d3dd5xKjhTf)ï¼‰ã€‚\n\n\næ¯ä¸€ä¸ªçª—å£éƒ½æ‹¥æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„ Triggerï¼ŒTriggerä¸Šä¼šæœ‰å®šæ—¶å™¨ï¼Œç”¨æ¥å†³å®šä¸€ä¸ªçª—å£ä½•æ—¶èƒ½å¤Ÿè¢«è®¡ç®—æˆ–æ¸…é™¤ã€‚æ¯å½“æœ‰å…ƒç´ åŠ å…¥åˆ°è¯¥çª—å£ï¼Œæˆ–è€…ä¹‹å‰æ³¨å†Œçš„å®šæ—¶å™¨è¶…æ—¶äº†ï¼Œé‚£ä¹ˆTriggeréƒ½ä¼šè¢«è°ƒç”¨ã€‚Triggerçš„è¿”å›ç»“æœå¯ä»¥æ˜¯ continueï¼ˆä¸åšä»»ä½•æ“ä½œï¼‰ï¼Œfireï¼ˆå¤„ç†çª—å£æ•°æ®ï¼‰ï¼Œpurgeï¼ˆç§»é™¤çª—å£å’Œçª—å£ä¸­çš„æ•°æ®ï¼‰ï¼Œæˆ–è€… fire + purgeã€‚ä¸€ä¸ªTriggerçš„è°ƒç”¨ç»“æœåªæ˜¯fireçš„è¯ï¼Œé‚£ä¹ˆä¼šè®¡ç®—çª—å£å¹¶ä¿ç•™çª—å£åŸæ ·ï¼Œä¹Ÿå°±æ˜¯è¯´çª—å£ä¸­çš„æ•°æ®ä»ç„¶ä¿ç•™ä¸å˜ï¼Œç­‰å¾…ä¸‹æ¬¡Trigger fireçš„æ—¶å€™å†æ¬¡æ‰§è¡Œè®¡ç®—ã€‚ä¸€ä¸ªçª—å£å¯ä»¥è¢«é‡å¤è®¡ç®—å¤šæ¬¡ç›´åˆ°å®ƒè¢« purge äº†ã€‚åœ¨purgeä¹‹å‰ï¼Œçª—å£ä¼šä¸€ç›´å ç”¨ç€å†…å­˜ã€‚\n\nå½“Trigger fireäº†ï¼Œçª—å£ä¸­çš„å…ƒç´ é›†åˆå°±ä¼šäº¤ç»™Evictorï¼ˆå¦‚æœæŒ‡å®šäº†çš„è¯ï¼‰ã€‚Evictor ä¸»è¦ç”¨æ¥éå†çª—å£ä¸­çš„å…ƒç´ åˆ—è¡¨ï¼Œå¹¶å†³å®šæœ€å…ˆè¿›å…¥çª—å£çš„å¤šå°‘ä¸ªå…ƒç´ éœ€è¦è¢«ç§»é™¤ã€‚å‰©ä½™çš„å…ƒç´ ä¼šäº¤ç»™ç”¨æˆ·æŒ‡å®šçš„å‡½æ•°è¿›è¡Œçª—å£çš„è®¡ç®—ã€‚å¦‚æœæ²¡æœ‰ Evictor çš„è¯ï¼Œçª—å£ä¸­çš„æ‰€æœ‰å…ƒç´ ä¼šä¸€èµ·äº¤ç»™å‡½æ•°è¿›è¡Œè®¡ç®—ã€‚\n\nè®¡ç®—å‡½æ•°æ”¶åˆ°äº†çª—å£çš„å…ƒç´ ï¼ˆå¯èƒ½ç»è¿‡äº† Evictor çš„è¿‡æ»¤ï¼‰ï¼Œå¹¶è®¡ç®—å‡ºçª—å£çš„ç»“æœå€¼ï¼Œå¹¶å‘é€ç»™ä¸‹æ¸¸ã€‚çª—å£çš„ç»“æœå€¼å¯ä»¥æ˜¯ä¸€ä¸ªä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªã€‚DataStream API ä¸Šå¯ä»¥æ¥æ”¶ä¸åŒç±»å‹çš„è®¡ç®—å‡½æ•°ï¼ŒåŒ…æ‹¬é¢„å®šä¹‰çš„sum(),min(),max()ï¼Œè¿˜æœ‰ ReduceFunctionï¼ŒFoldFunctionï¼Œè¿˜æœ‰WindowFunctionã€‚WindowFunction æ˜¯æœ€é€šç”¨çš„è®¡ç®—å‡½æ•°ï¼Œå…¶ä»–çš„é¢„å®šä¹‰çš„å‡½æ•°åŸºæœ¬éƒ½æ˜¯åŸºäºè¯¥å‡½æ•°å®ç°çš„ã€‚\n\nFlink å¯¹äºä¸€äº›èšåˆç±»çš„çª—å£è®¡ç®—ï¼ˆå¦‚sum,minï¼‰åšäº†ä¼˜åŒ–ï¼Œå› ä¸ºèšåˆç±»çš„è®¡ç®—ä¸éœ€è¦å°†çª—å£ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½ä¿å­˜ä¸‹æ¥ï¼Œåªéœ€è¦ä¿å­˜ä¸€ä¸ªresultå€¼å°±å¯ä»¥äº†ã€‚æ¯ä¸ªè¿›å…¥çª—å£çš„å…ƒç´ éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡èšåˆå‡½æ•°å¹¶ä¿®æ”¹resultå€¼ã€‚è¿™æ ·å¯ä»¥å¤§å¤§é™ä½å†…å­˜çš„æ¶ˆè€—å¹¶æå‡æ€§èƒ½ã€‚ä½†æ˜¯å¦‚æœç”¨æˆ·å®šä¹‰äº† Evictorï¼Œåˆ™ä¸ä¼šå¯ç”¨å¯¹èšåˆçª—å£çš„ä¼˜åŒ–ï¼Œå› ä¸º Evictor éœ€è¦éå†çª—å£ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå¿…é¡»è¦å°†çª—å£ä¸­æ‰€æœ‰å…ƒç´ éƒ½å­˜ä¸‹æ¥ã€‚\n\n# æºç åˆ†æ\n\nä¸Šè¿°çš„ä¸‰ä¸ªç»„ä»¶æ„æˆäº† Flink çš„çª—å£æœºåˆ¶ã€‚ä¸ºäº†æ›´æ¸…æ¥šåœ°æè¿°çª—å£æœºåˆ¶ï¼Œä»¥åŠè§£å¼€ä¸€äº›ç–‘æƒ‘ï¼ˆæ¯”å¦‚ purge å’Œ Evictor çš„åŒºåˆ«å’Œç”¨é€”ï¼‰ï¼Œæˆ‘ä»¬å°†ä¸€æ­¥æ­¥åœ°è§£é‡Š Flink å†…ç½®çš„ä¸€äº›çª—å£ï¼ˆTime Windowï¼ŒCount Windowï¼ŒSession Windowï¼‰æ˜¯å¦‚ä½•å®ç°çš„ã€‚\n\n## Count Window å®ç°\n\nCount Window æ˜¯ä½¿ç”¨ä¸‰ç»„ä»¶çš„å…¸èŒƒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ KeyedStream ä¸Šåˆ›å»º Count Windowï¼Œå…¶æºç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\n// tumbling count window\npublic WindowedStream<T, KEY, GlobalWindow> countWindow(long size) {\n    return window(GlobalWindows.create())  // create window stream using GlobalWindows\n        .trigger(PurgingTrigger.of(CountTrigger.of(size))); // trigger is window size\n}\n// sliding count window\npublic WindowedStream<T, KEY, GlobalWindow> countWindow(long size, long slide) {\n    return window(GlobalWindows.create())\n        .evictor(CountEvictor.of(size))  // evictor is window size\n        .trigger(CountTrigger.of(slide)); // trigger is slide size\n}\n```\n\nç¬¬ä¸€ä¸ªå‡½æ•°æ˜¯ç”³è¯·ç¿»æ»šè®¡æ•°çª—å£ï¼Œå‚æ•°ä¸ºçª—å£å¤§å°ã€‚ç¬¬äºŒä¸ªå‡½æ•°æ˜¯ç”³è¯·æ»‘åŠ¨è®¡æ•°çª—å£ï¼Œå‚æ•°åˆ†åˆ«ä¸ºçª—å£å¤§å°å’Œæ»‘åŠ¨å¤§å°ã€‚å®ƒä»¬éƒ½æ˜¯åŸºäº GlobalWindows è¿™ä¸ª WindowAssigner æ¥åˆ›å»ºçš„çª—å£ï¼Œè¯¥assignerä¼šå°†æ‰€æœ‰å…ƒç´ éƒ½åˆ†é…åˆ°åŒä¸€ä¸ªglobal windowä¸­ï¼Œæ‰€æœ‰GlobalWindowsçš„è¿”å›å€¼ä¸€ç›´æ˜¯ GlobalWindow å•ä¾‹ã€‚åŸºæœ¬ä¸Šè‡ªå®šä¹‰çš„çª—å£éƒ½ä¼šåŸºäºè¯¥assignerå®ç°ã€‚\n\nç¿»æ»šè®¡æ•°çª—å£å¹¶ä¸å¸¦evictorï¼Œåªæ³¨å†Œäº†ä¸€ä¸ªtriggerã€‚è¯¥triggeræ˜¯å¸¦purgeåŠŸèƒ½çš„ CountTriggerã€‚ä¹Ÿå°±æ˜¯è¯´æ¯å½“çª—å£ä¸­çš„å…ƒç´ æ•°é‡è¾¾åˆ°äº† window-sizeï¼Œtriggerå°±ä¼šè¿”å›fire+purgeï¼Œçª—å£å°±ä¼šæ‰§è¡Œè®¡ç®—å¹¶æ¸…ç©ºçª—å£ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œå†æ¥ç€å‚¨å¤‡æ–°çš„å…ƒç´ ã€‚ä»è€Œå®ç°äº†tumblingçš„çª—å£ä¹‹é—´æ— é‡å ã€‚\n\næ»‘åŠ¨è®¡æ•°çª—å£çš„å„çª—å£ä¹‹é—´æ˜¯æœ‰é‡å çš„ï¼Œä½†æˆ‘ä»¬ç”¨çš„ GlobalWindows assinger ä»å§‹è‡³ç»ˆåªæœ‰ä¸€ä¸ªçª—å£ï¼Œä¸åƒ sliding time assigner å¯ä»¥åŒæ—¶å­˜åœ¨å¤šä¸ªçª—å£ã€‚æ‰€ä»¥triggerç»“æœä¸èƒ½å¸¦purgeï¼Œä¹Ÿå°±æ˜¯è¯´è®¡ç®—å®Œçª—å£åçª—å£ä¸­çš„æ•°æ®è¦ä¿ç•™ä¸‹æ¥ï¼ˆä¾›ä¸‹ä¸ªæ»‘çª—ä½¿ç”¨ï¼‰ã€‚å¦å¤–ï¼Œtriggerçš„é—´éš”æ˜¯slide-sizeï¼Œevictorçš„ä¿ç•™çš„å…ƒç´ ä¸ªæ•°æ˜¯window-sizeã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªæ»‘åŠ¨é—´éš”å°±è§¦å‘ä¸€æ¬¡çª—å£è®¡ç®—ï¼Œå¹¶ä¿ç•™ä¸‹æœ€æ–°è¿›å…¥çª—å£çš„window-sizeä¸ªå…ƒç´ ï¼Œå‰”é™¤æ—§å…ƒç´ ã€‚\n\nå‡è®¾æœ‰ä¸€ä¸ªæ»‘åŠ¨è®¡æ•°çª—å£ï¼Œæ¯2ä¸ªå…ƒç´ è®¡ç®—ä¸€æ¬¡æœ€è¿‘4ä¸ªå…ƒç´ çš„æ€»å’Œï¼Œé‚£ä¹ˆçª—å£å·¥ä½œç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n![çª—å£å·¥ä½œç¤ºæ„å›¾](./Flink-åŸç†ä¸å®ç°-Window-æœºåˆ¶/çª—å£å·¥ä½œç¤ºæ„å›¾.png)\n\nå›¾ä¸­æ‰€ç¤ºçš„å„ä¸ªçª—å£é€»è¾‘ä¸Šæ˜¯ä¸åŒçš„çª—å£ï¼Œä½†åœ¨ç‰©ç†ä¸Šæ˜¯åŒä¸€ä¸ªçª—å£ã€‚è¯¥æ»‘åŠ¨è®¡æ•°çª—å£ï¼Œtriggerçš„è§¦å‘æ¡ä»¶æ˜¯å…ƒç´ ä¸ªæ•°è¾¾åˆ°2ä¸ªï¼ˆæ¯è¿›å…¥2ä¸ªå…ƒç´ å°±ä¼šè§¦å‘ä¸€æ¬¡ï¼‰ï¼Œevictorä¿ç•™çš„å…ƒç´ ä¸ªæ•°æ˜¯4ä¸ªï¼Œæ¯æ¬¡è®¡ç®—å®Œçª—å£æ€»å’Œåä¼šä¿ç•™å‰©ä½™çš„å…ƒç´ ã€‚æ‰€ä»¥ç¬¬ä¸€æ¬¡è§¦å‘triggeræ˜¯å½“å…ƒç´ 5è¿›å…¥ï¼Œç¬¬ä¸‰æ¬¡è§¦å‘triggeræ˜¯å½“å…ƒç´ 2è¿›å…¥ï¼Œå¹¶é©±é€5å’Œ2ï¼Œè®¡ç®—å‰©ä½™çš„4ä¸ªå…ƒç´ çš„æ€»å’Œï¼ˆ22ï¼‰å¹¶å‘é€å‡ºå»ï¼Œä¿ç•™ä¸‹2,4,9,7å…ƒç´ ä¾›ä¸‹ä¸ªé€»è¾‘çª—å£ä½¿ç”¨ã€‚\n\n## Time Window å®ç°\n\nåŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ KeyedStream ä¸Šç”³è¯· Time Windowï¼Œå…¶æºç å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```java\n// tumbling time window\npublic WindowedStream<T, KEY, TimeWindow> timeWindow(Time size) {\n    if (environment.getStreamTimeCharacteristic() == TimeCharacteristic.ProcessingTime) {\n        return window(TumblingProcessingTimeWindows.of(size));\n    } else {\n        return window(TumblingEventTimeWindows.of(size));\n    }\n}\n// sliding time window\npublic WindowedStream<T, KEY, TimeWindow> timeWindow(Time size, Time slide) {\n    if (environment.getStreamTimeCharacteristic() == TimeCharacteristic.ProcessingTime) {\n        return window(SlidingProcessingTimeWindows.of(size, slide));\n    } else {\n        return window(SlidingEventTimeWindows.of(size, slide));\n    }\n}\n```\n\nåœ¨æ–¹æ³•ä½“å†…éƒ¨ä¼šæ ¹æ®å½“å‰ç¯å¢ƒæ³¨å†Œçš„æ—¶é—´ç±»å‹ï¼Œä½¿ç”¨ä¸åŒçš„WindowAssigneråˆ›å»ºwindowã€‚å¯ä»¥çœ‹åˆ°ï¼ŒEventTimeå’ŒIngestTimeéƒ½ä½¿ç”¨äº†XXXEventTimeWindowsè¿™ä¸ªassignerï¼Œå› ä¸ºEventTimeå’ŒIngestTimeåœ¨åº•å±‚çš„å®ç°ä¸Šåªæ˜¯åœ¨Sourceå¤„ä¸ºRecordæ‰“æ—¶é—´æˆ³çš„å®ç°ä¸åŒï¼Œåœ¨window operatorä¸­çš„å¤„ç†é€»è¾‘æ˜¯ä¸€æ ·çš„ã€‚\n\nè¿™é‡Œæˆ‘ä»¬ä¸»è¦åˆ†æsliding process time windowï¼Œå¦‚ä¸‹æ˜¯ç›¸å…³æºç ï¼š\n\n```java\npublic class SlidingProcessingTimeWindows extends WindowAssigner<Object, TimeWindow> {\n    private static final long serialVersionUID = 1L;\n\n    private final long size;\n\n    private final long slide;\n\n    private SlidingProcessingTimeWindows(long size, long slide) {\n        this.size = size;\n        this.slide = slide;\n    }\n\n    @Override\n    public Collection<TimeWindow> assignWindows(Object element, long timestamp) {\n        timestamp = System.currentTimeMillis();\n        List<TimeWindow> windows = new ArrayList<>((int) (size / slide));\n        // å¯¹é½æ—¶é—´æˆ³\n        long lastStart = timestamp - timestamp % slide;\n        for (long start = lastStart;\n            start > timestamp - size;\n            start -= slide) {\n            // å½“å‰æ—¶é—´æˆ³å¯¹åº”äº†å¤šä¸ªwindow\n            windows.add(new TimeWindow(start, start + size));\n        }\n        return windows;\n    }\n    ...\n}\npublic class ProcessingTimeTrigger extends Trigger<Object, TimeWindow> {\n    @Override\n    // æ¯ä¸ªå…ƒç´ è¿›å…¥çª—å£éƒ½ä¼šè°ƒç”¨è¯¥æ–¹æ³•\n    public TriggerResult onElement(Object element, long timestamp, TimeWindow window, TriggerContext ctx) {\n        // æ³¨å†Œå®šæ—¶å™¨ï¼Œå½“ç³»ç»Ÿæ—¶é—´åˆ°è¾¾window end timestampæ—¶ä¼šå›è°ƒè¯¥triggerçš„onProcessingTimeæ–¹æ³•\n        ctx.registerProcessingTimeTimer(window.getEnd());\n        return TriggerResult.CONTINUE;\n    }\n\n    @Override\n    // è¿”å›ç»“æœè¡¨ç¤ºæ‰§è¡Œçª—å£è®¡ç®—å¹¶æ¸…ç©ºçª—å£\n    public TriggerResult onProcessingTime(long time, TimeWindow window, TriggerContext ctx) {\n        return TriggerResult.FIRE_AND_PURGE;\n    }\n    ...\n}\n```\n\né¦–å…ˆï¼ŒSlidingProcessingTimeWindowsä¼šå¯¹æ¯ä¸ªè¿›å…¥çª—å£çš„å…ƒç´ æ ¹æ®ç³»ç»Ÿæ—¶é—´åˆ†é…åˆ°(size / slide)ä¸ªä¸åŒçš„çª—å£ï¼Œå¹¶ä¼šåœ¨æ¯ä¸ªçª—å£ä¸Šæ ¹æ®çª—å£ç»“æŸæ—¶é—´æ³¨å†Œä¸€ä¸ªå®šæ—¶å™¨ï¼ˆç›¸åŒçª—å£åªä¼šæ³¨å†Œä¸€ä»½ï¼‰ï¼Œå½“å®šæ—¶å™¨è¶…æ—¶æ—¶æ„å‘³ç€è¯¥çª—å£å®Œæˆäº†ï¼Œè¿™æ—¶ä¼šå›è°ƒå¯¹åº”çª—å£çš„Triggerçš„onProcessingTimeæ–¹æ³•ï¼Œè¿”å›FIRE_AND_PURGEï¼Œä¹Ÿå°±æ˜¯ä¼šæ‰§è¡Œçª—å£è®¡ç®—å¹¶æ¸…ç©ºçª—å£ã€‚æ•´ä¸ªè¿‡ç¨‹ç¤ºæ„å›¾å¦‚ä¸‹ï¼š\n\n![ç¤ºæ„å›¾](./Flink-åŸç†ä¸å®ç°-Window-æœºåˆ¶/202312141604.png)\n\n\nå¦‚ä¸Šå›¾æ‰€ç¤ºæ¨ªè½´ä»£è¡¨æ—¶é—´æˆ³ï¼ˆä¸ºç®€åŒ–é—®é¢˜ï¼Œæ—¶é—´æˆ³ä»0å¼€å§‹ï¼‰ï¼Œç¬¬ä¸€æ¡recordä¼šè¢«åˆ†é…åˆ°[-5,5)å’Œ[0,10)ä¸¤ä¸ªçª—å£ä¸­ï¼Œå½“ç³»ç»Ÿæ—¶é—´åˆ°5æ—¶ï¼Œå°±ä¼šè®¡ç®—[-5,5)çª—å£ä¸­çš„æ•°æ®ï¼Œå¹¶å°†ç»“æœå‘é€å‡ºå»ï¼Œæœ€åæ¸…ç©ºçª—å£ä¸­çš„æ•°æ®ï¼Œé‡Šæ”¾è¯¥çª—å£èµ„æºã€‚\n\n","tags":["Flink","window"],"categories":["å¤§æ•°æ®","Flink"]},{"title":"Stormã€Sparkä¸Flinkå¯¹æ¯”","url":"/2023/12/06/Stormã€Sparkä¸Flinkå¯¹æ¯”/","content":"\n# å¼•è¨€\n\nApache Flink(ä»¥ä¸‹ç®€ç§°flink) æ˜¯ä¸€ä¸ªæ—¨åœ¨æä¾›â€˜ä¸€ç«™å¼â€™ çš„åˆ†å¸ƒå¼å¼€æºæ•°æ®å¤„ç†æ¡†æ¶ã€‚å’ŒSparkçš„ç›®æ ‡ä¸€æ ·ï¼Œéƒ½å¸Œæœ›æä¾›ä¸€ä¸ªç»Ÿä¸€åŠŸèƒ½çš„è®¡ç®—å¹³å°ç»™ç”¨æˆ·ã€‚è™½ç„¶ç›®æ ‡éå¸¸ç±»ä¼¼ï¼Œä½†æ˜¯flinkåœ¨å®ç°ä¸Šå’Œsparkå­˜åœ¨ç€å¾ˆå¤§çš„åŒºåˆ«ï¼Œflinkæ˜¯ä¸€ä¸ªé¢å‘æµçš„å¤„ç†æ¡†æ¶ï¼Œè¾“å…¥åœ¨flinkä¸­æ˜¯æ— ç•Œçš„ï¼Œæµæ•°æ®æ˜¯flinkä¸­çš„å¤´ç­‰å…¬æ°‘ã€‚è¿™æ–¹é¢flinkå’Œstormæœ‰å‡ åˆ†ç›¸ä¼¼ã€‚é‚£ä¹ˆæœ‰sparkå’Œstormè¿™æ ·æˆç†Ÿçš„è®¡ç®—æ¡†æ¶å­˜åœ¨ï¼Œä¸ºä»€ä¹ˆflinkè¿˜èƒ½å æœ‰ä¸€å¸­ä¹‹åœ°å‘¢ï¼Ÿä»Šå¤©æˆ‘ä»¬å°±ä»æµå¤„ç†çš„è§’åº¦å°†flinkå’Œè¿™ä¸¤ä¸ªæ¡†æ¶è¿›è¡Œä¸€äº›åˆ†æå’Œæ¯”è¾ƒã€‚\n\n# åè¯è§£æ\n\n| åè¯     | è¯´æ˜ | ä¸¾ä¾‹    |\n|----------|-----|---------------|\n| æ— è¾¹ç•Œæ•°æ®    | æ— è¾¹ç•Œæ•°æ®é€šå¸¸æŒ‡çš„æ˜¯æ— é™æŒç»­ç”Ÿæˆçš„æ•°æ®æµï¼Œæ²¡æœ‰æ˜ç¡®å®šä¹‰çš„ç»ˆç‚¹ã€‚è¿™æ ·çš„æ•°æ®æµå¯èƒ½æ˜¯å®æ—¶ç”Ÿæˆçš„äº‹ä»¶ã€ä¼ æ„Ÿå™¨æ•°æ®ã€æ—¥å¿—è®°å½•ç­‰ï¼Œå®ƒä»¬æºæºä¸æ–­åœ°äº§ç”Ÿï¼Œæ²¡æœ‰å›ºå®šçš„ç»“æŸç‚¹ã€‚  | å®æ—¶ä¼ æ„Ÿå™¨æ•°æ®ï¼Œå¦‚æ¸©åº¦ä¼ æ„Ÿå™¨ã€ç½‘ç»œæ—¥å¿—ï¼Œç”¨æˆ·ç‚¹å‡»äº‹ä»¶æµç­‰ã€‚è¿™äº›æ•°æ®æ˜¯æŒç»­ä¸æ–­ç”Ÿæˆçš„ï¼Œæµå¼å¤„ç†ç³»ç»Ÿéœ€è¦å®æ—¶å¤„ç†å¹¶é€‚åº”æ–°çš„æ•°æ®äº§ç”Ÿã€‚      |\n| æœ‰è¾¹ç•Œæ•°æ®      | æœ‰è¾¹ç•Œæ•°æ®æ˜¯æœ‰æ˜ç¡®å®šä¹‰çš„å¼€å§‹å’Œç»“æŸç‚¹çš„æ•°æ®é›†ã€‚è¿™æ ·çš„æ•°æ®é›†åœ¨æŸä¸€æ—¶åˆ»æ˜¯å®Œæ•´çš„ï¼Œä¸å†å‘ç”Ÿå˜åŒ–ã€‚ä¼ ç»Ÿçš„æ‰¹å¤„ç†ä»»åŠ¡å°±æ˜¯å¯¹æœ‰è¾¹ç•Œæ•°æ®è¿›è¡Œå¤„ç†çš„å…¸å‹ä¾‹å­ã€‚  | å…³ç³»æ•°æ®åº“ä¸­çš„è¡¨ã€å­˜å‚¨åœ¨æ–‡ä»¶ä¸­çš„æ•°æ®é›†ç­‰ã€‚è¿™äº›æ•°æ®é›†åœ¨æŸä¸€æ—¶åˆ»æ˜¯å®Œæ•´çš„ï¼Œå¯ä»¥é€šè¿‡ä¸€æ¬¡æ€§åŠ è½½åˆ°å†…å­˜ä¸­è¿›è¡Œæ‰¹å¤„ç†åˆ†æã€‚ |\n| Exactly-Once è¯­ä¹‰  |  ç²¾ç¡®ä¸€æ¬¡ï¼ˆExactly-Onceï¼‰å¤„ç†è¯­ä¹‰ï¼Œç¡®ä¿åœ¨å‡ºç°æ•…éšœæˆ–æ¢å¤æ—¶ä¸ä¼šä¸¢å¤±æˆ–é‡å¤å¤„ç†äº‹ä»¶ã€‚è¿™æ˜¯ä¿è¯æ•°æ®å¤„ç†çš„ä¸€è‡´æ€§çš„é‡è¦ç‰¹æ€§ã€‚ |       |\n| æœ‰çŠ¶æ€è®¡ç®— | æœ‰çŠ¶æ€çš„è®¡ç®—æŒ‡èƒ½å¤Ÿå¤„ç†å…·æœ‰è®°å¿†å’Œä¸Šä¸‹æ–‡å…³è”çš„è®¡ç®—ä»»åŠ¡ã€‚è¿™å¯¹äºå¤„ç†äº‹ä»¶åºåˆ—ã€å®æ—¶èšåˆå’Œå¤æ‚çš„æ¨¡å¼åŒ¹é…éå¸¸æœ‰ç”¨ã€‚ |\n| Sink | Sinkæ˜¯Flinkä¸­ä¸€ç§ç”¨äºå°†æ•°æ®ä»æµå¤„ç†åº”ç”¨ç¨‹åºå‘é€åˆ°å¤–éƒ¨ç³»ç»Ÿçš„ç»„ä»¶ï¼Œç”¨äºå®šä¹‰æ•°æ®çš„æœ€ç»ˆç›®çš„åœ° | File Sinkï¼ˆæ–‡ä»¶è¾“å‡ºï¼‰; Kafka Sink; Elasticsearch Sink; JDBC Sink; Custom Sink; |\n\n# æµæ¡†æ¶åŸºäºçš„å®ç°æ–¹å¼\n\næœ¬æ–‡æ¶‰åŠçš„æµæ¡†æ¶åŸºäºçš„å®ç°æ–¹å¼åˆ†ä¸ºä¸¤å¤§ç±»ã€‚\n\n- ç¬¬ä¸€ç±»æ˜¯Native Streamingï¼Œè¿™ç±»å¼•æ“ä¸­æ‰€æœ‰çš„dataåœ¨åˆ°æ¥çš„æ—¶å€™å°±ä¼šè¢«ç«‹å³å¤„ç†ï¼Œä¸€æ¡æ¥ç€ä¸€æ¡ï¼ˆHINTï¼š ç‹­éš˜çš„æ¥è¯´æ˜¯ä¸€æ¡æ¥ç€ä¸€æ¡ï¼Œä½†æµå¼•æ“æœ‰æ—¶ä¼šä¸ºæé«˜æ€§èƒ½ç¼“å­˜ä¸€å°éƒ¨åˆ†dataç„¶åä¸€æ¬¡æ€§å¤„ç†ï¼‰ï¼Œå…¶ä¸­çš„ä»£è¡¨å°±æ˜¯stormå’Œflinkã€‚\n\n- ç¬¬äºŒç±»åˆ™æ˜¯åŸºäºMicro-batchï¼Œæ•°æ®æµè¢«åˆ‡åˆ†ä¸ºä¸€ä¸ªä¸€ä¸ªå°çš„æ‰¹æ¬¡ï¼Œ ç„¶åå†é€ä¸ªè¢«å¼•æ“å¤„ç†ã€‚è¿™äº›batchä¸€èˆ¬æ˜¯ä»¥æ—¶é—´ä¸ºå•ä½è¿›è¡Œåˆ‡åˆ†ï¼Œå•ä½ä¸€èˆ¬æ˜¯â€˜ç§’â€˜ï¼Œå…¶ä¸­çš„å…¸å‹ä»£è¡¨åˆ™æ˜¯sparkäº†ï¼Œä¸è®ºæ˜¯è€çš„spark DStreamè¿˜æ˜¯2.0ä»¥åæ¨å‡ºçš„spark structured streamingéƒ½æ˜¯è¿™æ ·çš„å¤„ç†æœºåˆ¶ï¼›å¦å¤–ä¸€ä¸ªåŸºäºMicro-batchå®ç°çš„å°±æ˜¯storm tridentï¼Œå®ƒæ˜¯å¯¹stormçš„æ›´é«˜å±‚çš„æŠ½è±¡ï¼Œå› ä¸ºä»¥batchä¸ºå•ä½ï¼Œæ‰€ä»¥storm tridentçš„ä¸€äº›å¤„ç†å˜å¾—ç®€å•ä¸”é«˜æ•ˆã€‚\n\n![åˆ†ç±»](./Stormã€Sparkä¸Flinkå¯¹æ¯”/Snipaste_2023-12-06_17-54-25.png)\n\n\n# æµæ¡†æ¶æ¯”è¾ƒçš„å…³é”®æŒ‡æ ‡\n\nä»æµå¤„ç†çš„è§’åº¦å°†flinkä¸sparkå’Œstormè¿™ä¸¤ä¸ªæ¡†æ¶è¿›è¡Œæ¯”è¾ƒï¼Œä¼šä¸»è¦å…³æ³¨ä»¥ä¸‹å‡ ç‚¹ï¼Œåç»­çš„å¯¹æ¯”ä¹Ÿä¸»è¦åŸºäºè¿™å‡ ç‚¹å±•å¼€ï¼š\n\n- åŠŸèƒ½æ€§ï¼ˆFunctionalityï¼‰- æ˜¯å¦èƒ½å¾ˆå¥½è§£å†³æµå¤„ç†åŠŸèƒ½ä¸Šçš„ç—›ç‚¹ , æ¯”å¦‚event timeå’Œout of order dataã€‚\n\n- å®¹é”™æ€§ï¼ˆFault Toleranceï¼‰ - åœ¨failureä¹‹åèƒ½å¦æ¢å¤åˆ°æ•…éšœä¹‹å‰çš„çŠ¶æ€ï¼Œå¹¶è¾“å‡ºä¸€è‡´çš„ç»“æœï¼›æ­¤å¤–å®¹é”™çš„ä»£ä»·ä¹Ÿæ˜¯è¶Šä½è¶Šå¥½ï¼Œå› ä¸ºå…¶ç›´æ¥å½±å“æ€§èƒ½ã€‚\n\n- ååé‡(throughputs)& å»¶æ—¶(latency) - æ€§èƒ½ç›¸å…³çš„æŒ‡æ ‡ï¼Œé«˜ååå’Œä½å»¶è¿ŸæŸç§æ„ä¹‰ä¸Šæ˜¯ä¸å¯å…¼å¾—çš„ï¼Œä½†å¥½çš„æµå¼•æ“åº”èƒ½å…¼é¡¾é«˜åå&ä½å»¶æ—¶ã€‚\n\n\n# åŠŸèƒ½æ€§\n\n## å„ç±»æ—¶é—´çš„å®šä¹‰\n[flinkæ–‡æ¡£ä¸­å…³äºå„ç§æ—¶é—´çš„å®šä¹‰](https://nightlies.apache.org/flink/flink-docs-release-1.2/dev/event_time.html)\n- Event time: æŒ‡æ•°æ®æˆ–äº‹ä»¶çœŸæ­£å‘ç”Ÿæ—¶é—´ï¼Œæ¯”å¦‚ç”¨æˆ·ç‚¹å‡»ç½‘é¡µæ—¶äº§ç”Ÿä¸€æ¡ç‚¹å‡»äº‹ä»¶çš„æ•°æ®ï¼Œç‚¹å‡»æ—¶é—´å°±æ˜¯è¿™æ¡æ•°æ®å›ºæœ‰çš„Event timeã€‚ç†è§£ä¸ºæ¯ä¸ªå•ç‹¬äº‹ä»¶åœ¨å…¶äº§ç”Ÿè®¾å¤‡ä¸Šå‘ç”Ÿçš„æ—¶é—´ã€‚\n- Processing time: æŒ‡è®¡ç®—æ¡†æ¶å¤„ç†è¿™æ¡æ•°æ®çš„æ—¶é—´\n- Ingestion Time: æ‘„å…¥æ—¶é—´æ˜¯äº‹ä»¶è¿›å…¥ Flink çš„æ—¶é—´ã€‚\n\n    ![æ—¶é’Ÿ](./Stormã€Sparkä¸Flinkå¯¹æ¯”/times_clocks.svg)\n\n    spark DStreamå’Œstorm 1.0ä»¥å‰ç‰ˆæœ¬å¾€å¾€éƒ½æŠ˜ä¸­åœ°ä½¿ç”¨processing timeæ¥è¿‘ä¼¼åœ°å®ç°event timeç›¸å…³çš„ä¸šåŠ¡ã€‚æ˜¾ç„¶ï¼Œä½¿ç”¨processing timeæ¨¡æ‹Ÿevent timeå¿…ç„¶ä¼šäº§ç”Ÿä¸€äº›è¯¯å·®ï¼Œ ç‰¹åˆ«æ˜¯åœ¨äº§ç”Ÿæ•°æ®å †ç§¯çš„æ—¶å€™ï¼Œè¯¯å·®åˆ™æ›´æ˜æ˜¾ï¼Œç”šè‡³å¯¼è‡´è®¡ç®—ç»“æœä¸å¯ç”¨ã€‚\n\n    åœ¨ä½¿ç”¨event timeæ—¶ï¼Œè‡ªç„¶è€Œç„¶éœ€è¦è§£å†³ç”±ç½‘ç»œå»¶è¿Ÿç­‰å› ç´ å¯¼è‡´çš„è¿Ÿåˆ°æˆ–è€…ä¹±åºæ•°æ®çš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ sparkã€stormåŠflinkéƒ½å‚è€ƒ[streaming 102](https://www.oreilly.com/radar/the-world-beyond-batch-streaming-102/)å¼•å…¥äº†watermarkå’Œlatenessçš„æ¦‚å¿µã€‚\n\n- watermark: æ˜¯å¼•æ“å¤„ç†äº‹ä»¶çš„æ—¶é—´è¿›åº¦ï¼Œä»£è¡¨ä¸€ç§çŠ¶æ€ï¼Œä¸€èˆ¬éšç€æ•°æ®ä¸­çš„event timeçš„å¢é•¿è€Œå¢é•¿ã€‚æ¯”å¦‚ watermark(t)ä»£è¡¨æ•´ä¸ªæµçš„event timeå¤„ç†è¿›åº¦å·²ç»åˆ°è¾¾tï¼Œ æ—¶é—´æ˜¯æœ‰åºçš„ï¼Œé‚£ä¹ˆstreamingä¸åº”è¯¥ä¼šå†æ”¶åˆ°timestamp tâ€™ < tçš„æ•°æ®ï¼Œè€Œåªä¼šæ¥å—åˆ°timestamp tâ€™ >= tçš„æ•°æ®ã€‚ å¦‚æœæ”¶åˆ°ä¸€æ¡timestamp tâ€™ < tçš„æ•°æ®ï¼Œ é‚£ä¹ˆå°±è¯´æ˜è¿™æ¡æ•°æ®æ˜¯è¿Ÿåˆ°çš„ã€‚\n\n- lateness: è¡¨ç¤ºå¯ä»¥å®¹å¿è¿Ÿåˆ°çš„ç¨‹åº¦ï¼Œåœ¨latenesså¯å®¹å¿èŒƒå›´å†…çš„æ•°æ®è¿˜ä¼šå‚ä¸è®¡ç®—ï¼Œè¶…è¿‡çš„ä¼šè¢«ä¸¢å¼ƒã€‚\n\n## çª—å£æ“ä½œ\n\n### spark structured streaming å’Œflinkå¯¹event timeå¤„ç†æœºåˆ¶çš„æ¯”è¾ƒ\n\n- Flink\n  \n  é¦–å…ˆï¼Œæˆ‘ä»¬ç»“åˆå›¾æ¥çœ‹flinkï¼Œ æ—¶é—´è½´ä»å·¦å¾€å³å¢å¤§ã€‚å½“watermark WMå¤„äºæ—¶ é—´çª—å£åŒºé—´å†…æ—¶ï¼Œå³WM âˆˆ [start, end] , event timeè½åœ¨çª—å£èŒƒå›´å†…çš„ä»»ä½•ä¹±åºæ•°æ®éƒ½ä¼šè¢«æ¥å—ï¼›éšç€WMçš„å¢é•¿å¹¶è¶…è¿‡äº†çª—å£çš„ç»“æŸæ—¶é—´ï¼Œä½†è¿˜æœªè¶…è¿‡å¯å®¹å¿çš„latenessæ—¶é—´èŒƒå›´ï¼Œå³WM âˆˆ (window_end,window_end+ lateness]ï¼Œ è¿™æ—¶ä¹±åºæ•°æ®ä»ç„¶å¯ä»¥è¢«æ¥å—ï¼› åªæœ‰å½“WMè¶…è¿‡ window_end+lateness, å³WM âˆˆ (window_end+ lateness, âˆ)ï¼Œ è¿Ÿåˆ°çš„æ•°æ®å°†ä¼šè¢«ä¸¢å¼ƒã€‚\n\n  ![handle-late-records](./Stormã€Sparkä¸Flinkå¯¹æ¯”/handle-late-records.jpg)\n\n  fiinkä¸­watermarkçš„è®¡ç®—ä¹Ÿæ¯”è¾ƒçµæ´»ï¼Œå¯ä»¥é€‰æ‹©build-inçš„ï¼ˆå¦‚æœ€å¤§æ—¶é—´æˆ³ï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç»§æ‰¿æ¥å£è‡ªå®šä¹‰å®ç°ã€‚æ­¤å¤–ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©å‘¨æœŸæ€§æ›´æ–°æˆ–è€…äº‹ä»¶è§¦å‘æ›´æ–°watermarkã€‚\n\n- Spark\n  \n  é¦–å…ˆ,sparkä¸­watermarkæ˜¯é€šè¿‡ä¸Šä¸€ä¸ªbatchæœ€å¤§çš„timestampå†å‡å»latenesså¾—åˆ°çš„ï¼Œå³watermark = Max(last batch timestamps) - latenessã€‚å½“æ•°æ®çš„event timeå¤§äºwatermarkæ—¶ï¼Œæ•°æ®ä¼šè¢«æ¥å—ï¼Œå¦åˆ™ä¸è®ºè¿™æ¡æ•°æ®å±äºå“ªä¸ªçª—å£éƒ½ä¼šè¢«ä¸¢å¼ƒã€‚ç»†èŠ‚è¯·å‚è€ƒ[Window Operations on Event Time](https://spark.apache.org/docs/latest/structured-streaming-programming-guide.html#window-operations-on-event-time)\n\nä¸‹é¢æ¥æ¯”è¾ƒä¸€ä¸‹ä¸¤è€…å®ç°ç»†èŠ‚ä¸Šçš„ä¸åŒï¼š\n\n- latenesså®šä¹‰: åœ¨sparkä¸­ï¼Œè¿Ÿåˆ°è¢«å®šä¹‰ä¸ºdataçš„event timeå’Œwatermarkçš„æ¯”è¾ƒç»“æœï¼Œå½“dataçš„event time < watermarkæ—¶ï¼Œdataè¢«ä¸¢å¼ƒï¼›flinkä¸­åªæœ‰åœ¨watermark > window_end + latenessçš„æ—¶å€™ï¼Œdataæ‰ä¼šè¢«ä¸¢å¼ƒã€‚\n\n- watermarkæ›´æ–°: sparkä¸­watermarkæ˜¯ä¸Šä¸ªbatchä¸­çš„max event timeï¼Œå­˜åœ¨å»¶è¿Ÿï¼›è€Œåœ¨flinkä¸­æ˜¯å¯ä»¥åšåˆ°æ¯æ¡æ•°æ®åŒæ­¥æ›´æ–°watermarkã€‚\n\n- windowè§¦å‘: flinkä¸­windowè®¡ç®—ä¼šè§¦å‘ä¸€æ¬¡æˆ–å¤šæ¬¡ï¼Œç¬¬ä¸€æ¬¡åœ¨watermark >= window_endåç«‹åˆ»è§¦å‘ï¼ˆmain fireï¼‰ï¼Œæ¥ç€ä¼šåœ¨è¿Ÿåˆ°æ•°æ®åˆ°æ¥åè¿›è¡Œå¢é‡è§¦å‘ã€‚sparkåªä¼šåœ¨watermarkï¼ˆåŒ…å«latenessï¼‰è¿‡äº†window_endä¹‹åæ‰ä¼šè§¦å‘ï¼Œè™½ç„¶è®¡ç®—ç»“æœä¸€æ¬¡æ€§æ­£ç¡®ï¼Œä½†è§¦å‘æ¯”flinkèµ·ç å¤šäº†ä¸€ä¸ªlatenessçš„å»¶è¿Ÿã€‚\n\nä¸Šé¢ä¸‰ç‚¹å¯è§flinkåœ¨è®¾è®¡event timeå¤„ç†æ¨¡å‹è¿˜æ˜¯è¾ƒä¼˜çš„ï¼šwatermarkçš„è®¡ç®—å®æ—¶æ€§é«˜ï¼Œè¾“å‡ºå»¶è¿Ÿä½ï¼Œè€Œä¸”æ¥å—è¿Ÿåˆ°æ•°æ®æ²¡æœ‰sparké‚£ä¹ˆå—é™ã€‚\n\n### SQL APIæ–¹é¢çš„å¯¹æ¯”\n\nå¾…ç»­ï¼Œç½‘ä¸Šèµ„æ–™éƒ½æ˜¯è¾ƒè€ç‰ˆæœ¬çš„æ¯”å¯¹ï¼Œä¸å¤ªå‡†ç¡®ï¼Œç­‰è‡ªå·±å®è·µè¿‡å†æ¥æ€»ç»“å§\n\n### Kafka é›†æˆ\n\nå¾…ç»­\n\n### é™æ€æ•°æ®æ“ä½œ\n\nå¾…ç»­\n\n# ååé‡\n\nå¾…ç»­\n\n# æ€»ç»“\n\nå¾…ç»­","tags":["Flink","Spark","Storm"],"categories":["å¤§æ•°æ®","Flink"]},{"title":"æœºå™¨å­¦ä¹ åŸºç¡€-æ¦‚ç‡å’Œå‘ç”Ÿæ¯”ä»¥åŠLogit","url":"/2023/10/31/æœºå™¨å­¦ä¹ åŸºç¡€-æ¦‚ç‡å’Œå‘ç”Ÿæ¯”ä»¥åŠLogit/","content":"\n\n---\n\næ¦‚ç‡æ˜¯æœºå™¨å­¦ä¹ ä¸­æœ€å¸¸è§çš„æ¦‚å¿µï¼Œåœ¨åˆ†ç±»ç®—æ³•(Classification)ä¸­ç»å¸¸å‡ºç°ï¼Œè€ŒLogitä¹Ÿæ˜¯é€»è¾‘å›å½’ï¼ˆLogistic Regressionï¼‰ä¸­çš„é‡è¦æ¦‚å¿µï¼Œæœ¬æ–‡å°†æ€»ç»“æ¦‚ç‡ï¼ˆProbabilityï¼‰ï¼Œå‘ç”Ÿæ¯”ï¼ˆOddsï¼‰å’ŒLogitï¼ˆlog(odds)ï¼‰ä¹‹é—´çš„å…³ç³»ã€‚\n\n## æ¦‚ç‡ï¼Œå‘ç”Ÿæ¯”ä¸Logitçš„å®šä¹‰\n\n### æ¦‚ç‡\n\næ¦‚ç‡æ˜¯æŒ‡ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿçš„å¯èƒ½æ€§ï¼Œå‡è®¾ä¸€ä¸ªè¢‹å­é‡Œæœ‰è‹¥å¹²çº¢çƒå’Œè“çƒï¼Œç”¨Pæ¥è¡¨ç¤ºæ¦‚ç‡ã€‚\n\n$P_{æŠ½åˆ°çº¢çƒ}=\\frac{çº¢çƒæ•°}{æ€»ä¸ªæ•°}$\n\n### å‘ç”Ÿæ¯”\n\nå‘ç”Ÿæ¯”æŒ‡ä¸€ä»¶äº‹å‘ç”Ÿä¸å…¶ä¸å‘ç”Ÿçš„æ¦‚ç‡ä¹‹æ¯”ï¼ŒåŒæ ·ä»¥çº¢çƒå’Œç¯®çƒä¸ºä¾‹ï¼Œç”¨Oddsæ¥è¡¨ç¤ºæ¦‚ç‡ï¼Œåˆ™ï¼š\n\n$Odds_{æŠ½åˆ°çº¢çƒ}=\\frac {P_{æŠ½åˆ°çº¢çƒ}}{1-P_{æŠ½åˆ°çº¢çƒ}}$\n\n### Logit\n\nLogitæ˜¯ç»™å‘ç”Ÿæ¯”å–å¯¹æ•°ï¼Œå³log(Odds)ï¼Œå…¶ä¸­logæ˜¯è‡ªç„¶å¯¹æ•°ï¼Œä»¥çº¢çƒç¯®çƒä¸ºä¾‹ï¼Œå…¶å…¬å¼ä¸º:\n\n$Logit=log(\\frac {P_{æŠ½åˆ°çº¢çƒ}}{1-P_{æŠ½åˆ°çº¢çƒ}})$\n\n## æ¦‚ç‡å‘ç”Ÿæ¯”ä¸Logitçš„å…³ç³»\n\næ¦‚ç‡ä¸å‘ç”Ÿæ¯”çš„å…³ç³»è¾ƒä¸ºç®€å•ï¼Œ æ¦‚ç‡æ˜¯æŒ‡äº‹ä»¶å‘ç”Ÿçš„å¯èƒ½æ€§ï¼Œè€Œå‘ç”Ÿæ¯”æ˜¯æŒ‡è¯¥äº‹ä»¶å‘ç”Ÿä¸ä¸å‘ç”Ÿçš„æ¦‚ç‡ä¹‹æ¯”ã€‚ä½†å‘ç”Ÿæ¯”ä¸Logitçš„å…³ç³»å°±å¹¶æ²¡æœ‰é‚£ä¹ˆç›´è§‚äº†ï¼Œä»å…¬å¼ä¸Šæˆ‘ä»¬ç¡®å®å¯ä»¥çŸ¥é“Logitå°±æ˜¯log(å‘ç”Ÿæ¯”),**ä½†æˆ‘ä»¬è¯¥å¦‚ä½•ç†è§£è¿™ä¸€å®šä¹‰å‘¢ï¼Ÿ**\n\né€šè¿‡ä¸‹é¢çš„å›¾è¡¨ä¸éš¾å‘ç°ï¼Œæ¦‚ç‡ä¸å‘ç”Ÿæ¯”æœ‰ä»¥ä¸‹å…³ç³»ï¼š\n\n1. æ¦‚ç‡å–å€¼ä¸º(0,1)ï¼Œå‘ç”Ÿæ¯”å–å€¼ä¸º(0,Inf)\n2. å½“æ¦‚ç‡ä¸º0.5æ—¶ï¼Œå‘ç”Ÿæ¯”ä¸º1ï¼Œå³äº‹ä»¶å‘ç”Ÿä¸ä¸å‘ç”Ÿçš„æ¦‚ç‡ç›¸åŒã€‚\n3. å½“æ¦‚ç‡å°äº0.5æ—¶ï¼Œå‘ç”Ÿæ¯”å–å€¼èŒƒå›´ä¸º(0,1)ï¼Œå½“æ¦‚ç‡å¤§äº0.5æ—¶ï¼Œå‘ç”Ÿæ¯”å–å€¼èŒƒå›´ä¸º(1,Inf)\n4. å½“æ¦‚ç‡å¤§äºæˆ–å°äº0.5æ—¶ï¼Œå‘ç”Ÿæ¯”çš„å–å€¼èŒƒå›´å¹¶ä¸å¯¹ç§°ã€‚\n\nå‘ç”Ÿæ¯”çš„ä¸å¯¹ç§°æ€§ï¼Œæ—¶å¸¸ä¼šå¸¦æ¥ä¸€äº›å›°æ‰°ï¼Œæ¯”å¦‚ï¼š\n\n- æ¦‚ç‡ä¸º0.3å’Œ0.7æ—¶ï¼Œè¿™ä¸¤ä¸ªæ¦‚ç‡çš„å‡å€¼æ˜¯0.5ï¼Œä»–ä»¬æ˜¯â€œå¯¹ç§°â€çš„ï¼›ä½†è¿™ä¸¤ä¸ªæ¦‚ç‡çš„å‘ç”Ÿæ¯”å´åˆ†åˆ«æ˜¯0.429å’Œ2.333,è¿™ä½¿æˆ‘ä»¬å¾ˆéš¾ç›´è§‚åœ°æ„Ÿå—åˆ°ä»–ä»¬çš„å¯¹ç§°å…³ç³»ã€‚\n- å½“æ¦‚ç‡ä»0.1å¢åŠ åˆ°0.2ï¼Œæ—¶ï¼Œå‘ç”Ÿæ¯”å¢åŠ äº†0.139ï¼›å½“æ¦‚ç‡ä»0.8å¢åŠ åˆ°0.9æ—¶ï¼Œå‘ç”Ÿæ¯”å´å¢åŠ äº†5ï¼Œè™½ç„¶æ¦‚ç‡çš„å¢é‡ç›¸åŒï¼Œä½†å‘ç”Ÿæ¯”çš„å¢é‡å´å¤§å¤§çš„ä¸åŒã€‚\n\nè€ŒLogitå°±èƒ½æœ‰æ•ˆåœ°è§£å†³å‘ç”Ÿæ¯”å¸¦æ¥çš„å›°æƒ‘ï¼š\n\n- æ¦‚ç‡ä¸º0.3å’Œ0.7æ—¶ï¼ŒLogitåˆ†åˆ«ä¸º-0.847å’Œ0.847ï¼Œè¿™ä¸¤ä¸ªå€¼å…³äº0å¯¹ç§°,å› æ­¤æˆ‘ä»¬çŸ¥é“è¿™ä¸¤Logitå€¼å¯¹åº”çš„å‘ç”Ÿæ¯”æ˜¯å¯¹ç§°çš„ã€‚\n- å½“æ¦‚ç‡ä»0.2å‡å°‘è‡³0.1æ—¶ï¼ŒLogitçš„å¢é‡æ˜¯-0.811ï¼›å½“æ¦‚ç‡ä»0.8å¢åŠ åˆ°0.9æ—¶ï¼ŒLogitçš„å¢é‡ä¹Ÿæ˜¯0.811ï¼Œæˆ‘ä»¬å¯ä»¥ç›´è§‚åœ°æ„Ÿå—åˆ°å‘ç”Ÿæ¯”å¢é‡ä¹Ÿæ˜¯å¯¹ç§°çš„ã€‚\n- å½“å‘ç”Ÿæ¯”ä¸º1æ—¶ï¼ŒLogitä¸º0ï¼›å½“å‘ç”Ÿæ¯”å°äºæˆ–å¤§äº1æ—¶ï¼ŒLogitå–å€¼èŒƒå›´ä¸º(-Inf,0)å’Œ(0,Inf).å–å€¼èŒƒå›´å¯¹ç§°ã€‚\n\nä¸‹è¡¨åˆ—å‡ºäº†å½“æ¦‚ç‡å–ä¸åŒå€¼æ—¶ï¼Œå‘ç”Ÿæ¯”å’ŒLogitä¹‹é—´çš„å…³ç³»ï¼š\n\n| | Probability | Odds | Logit |\n| -- | -- | -- | -- |\n| 0 | 0.0001 | 0.00010001 | -9.21024 |\n| 1 | 0.001 | 0.001001 | -6.90675 |\n| 2 | 0.01 | 0.010101 | -4.59512 |\n| 3 | 0.1 | 0.111111 | -2.19722 |\n| 4 | 0.2 | 0.25 | -1.38629 |\n| 5 | 0.3 | 0.428571 | -0.847298 |\n| 6 | 0.4 | 0.666667 | -0.405465 |\n| 7 | 0.5 | 1 | 0 |\n| 8 | 0.6 | 1.5 | 0.405465 |\n| 9 | 0.7 | 2.33333 | 0.847298 |\n| 10| 0.8 | 4 | 1.38629 |\n| 11| 0.9 | 9 | 2.19722 |\n| 12| 0.99 | 9 | 4.59512 |\n| 13| 0.999 | 999 | 6.90675 |\n| 14| 0.9999 | 9999 | 9.21024 |\n\nç”¨å›¾å½¢è¡¨ç¤ºï¼Œä¸‰è€…å…³ç³»å¦‚ä¸‹ï¼Œå…¶ä¸­xè½´ä¸ºæ¦‚ç‡ï¼Œä¸¤æ¡æ›²çº¿åˆ†åˆ«ä¸ºå‘ç”Ÿæ¯”å’ŒLogitï¼Œä¸ºäº†è®©å›¾å½¢æ›´åŠ å¥½çœ‹ï¼Œæ¦‚ç‡åªå–äº†[0.1, 0.9]è¿™ä¸€éƒ¨åˆ†ï¼š\n\n![æ¦‚ç‡å’Œå‘ç”Ÿæ¯”ä»¥åŠLogit](./æœºå™¨å­¦ä¹ åŸºç¡€-æ¦‚ç‡å’Œå‘ç”Ÿæ¯”ä»¥åŠLogit/æ¦‚ç‡-å‘ç”Ÿæ¯”-Logit.jpg)\n\n## å°ç»“\n\nç”±äºé€»è¾‘å›å½’æ¨¡å‹çš„éœ€æ±‚ï¼Œæˆ‘ä»¬å¼•å…¥äº†å‘ç”Ÿæ¯”è¿™ä¸€æ¦‚å¿µï¼Œä½†å‘ç”Ÿæ¯”æœ¬èº«çš„ä¸å¯¹ç§°æ€§è®©æˆ‘ä»¬éš¾ä»¥ç›´è§‚åœ°æ¯”è¾ƒå‘ç”Ÿæ¯”ï¼Œå› æ­¤æˆ‘ä»¬å¼•å…¥äº†Logitè¿™ä¸€æ¦‚å¿µã€‚**Logitèµ‹äºˆäº†å‘ç”Ÿæ¯”æ›´å¼ºçš„â€å¯¹ç§°â€œæ€§**ï¼Œè®©æˆ‘ä»¬æ›´å®¹æ˜“æ¯”è¾ƒä¸åŒå‘ç”Ÿæ¯”ä¹‹é—´çš„å…³ç³»ã€‚\n","tags":["æœºå™¨å­¦ä¹ ","å‘ç”Ÿæ¯”","Logit"],"categories":["è”é‚¦å­¦ä¹ ","æœºå™¨å­¦ä¹ åŸºç¡€"]},{"title":"PySparkåŸºç¡€","url":"/2023/10/26/PySparkåŸºç¡€001/","content":"\n# ç®€ä»‹\nPySparkæ˜¯Pythonè°ƒç”¨Sparkçš„æ¥å£ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨Python APIçš„æ–¹å¼æ¥ç¼–å†™Sparkç¨‹åºï¼Œå®ƒæ”¯æŒäº†å¤§å¤šæ•°çš„SparkåŠŸèƒ½ï¼Œæ¯”å¦‚SparkDataFrameã€Spark SQLã€Streamingã€MLlibç­‰ç­‰ã€‚\n\n# åŸºç¡€æ¦‚å¿µ\n## RDD\nRDDçš„å…¨ç§°æ˜¯Resilient Distributed Datasetsï¼Œè¿™æ˜¯Sparkçš„ä¸€ç§æ•°æ®æŠ½è±¡é›†åˆï¼Œå®ƒå¯ä»¥è¢«æ‰§è¡Œåœ¨åˆ†å¸ƒå¼çš„é›†ç¾¤ä¸Šè¿›è¡Œå„ç§æ“ä½œï¼Œè€Œä¸”æœ‰è¾ƒå¼ºçš„å®¹é”™æœºåˆ¶ã€‚RDDå¯ä»¥è¢«åˆ†ä¸ºè‹¥å¹²ä¸ªåˆ†åŒºï¼Œæ¯ä¸€ä¸ªåˆ†åŒºå°±æ˜¯ä¸€ä¸ªæ•°æ®é›†ç‰‡æ®µï¼Œä»è€Œå¯ä»¥æ”¯æŒåˆ†å¸ƒå¼è®¡ç®—ã€‚\n\n## RDDè¿è¡Œæ—¶ç›¸å…³çš„å…³é”®åè¯\nç®€å•æ¥è¯´å¯ä»¥æœ‰Clientã€Jobã€Masterã€Workerã€Driverã€Stageã€Taskä»¥åŠExecutorï¼Œè¿™å‡ ä¸ªä¸œè¥¿åœ¨è°ƒä¼˜çš„æ—¶å€™ä¹Ÿä¼šç»å¸¸é‡åˆ°çš„ã€‚\n\n- Client: æŒ‡çš„æ˜¯å®¢æˆ·ç«¯è¿›ç¨‹ï¼Œä¸»è¦è´Ÿè´£æäº¤jobåˆ°Masterï¼›\n- Job: Jobæ¥è‡ªäºæˆ‘ä»¬ç¼–å†™çš„ç¨‹åºï¼ŒApplicationåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªjobï¼ŒjobåŒ…å«å„ç§RDDæ“ä½œï¼›\n- Master: æŒ‡çš„æ˜¯Standaloneæ¨¡å¼ä¸­çš„ä¸»æ§èŠ‚ç‚¹ï¼Œè´Ÿè´£æ¥æ”¶æ¥è‡ªClientçš„jobï¼Œå¹¶ç®¡ç†ç€workerï¼Œå¯ä»¥ç»™workeråˆ†é…ä»»åŠ¡å’Œèµ„æºï¼ˆä¸»è¦æ˜¯dirverå’Œexecutorèµ„æºï¼‰ï¼›\n- Worker: æŒ‡çš„æ˜¯Standaloneæ¨¡å¼ä¸­çš„slaveèŠ‚ç‚¹ï¼Œè´Ÿè´£ç®¡ç†æœ¬èŠ‚ç‚¹çš„èµ„æºï¼ŒåŒæ—¶å—Masterç®¡ç†ï¼Œéœ€è¦å®šæœŸç»™Masterå›æŠ¥heartbeatï¼ˆå¿ƒè·³ï¼‰ï¼Œå¯åŠ¨Driverå’ŒExecutorï¼›\n- Driver: æŒ‡çš„æ˜¯jobï¼ˆä½œä¸šï¼‰çš„ä¸»è¿›ç¨‹ï¼Œä¸€èˆ¬æ¯ä¸ªSparkä½œä¸šéƒ½ä¼šæœ‰ä¸€ä¸ªDriverè¿›ç¨‹ï¼Œè´Ÿè´£æ•´ä¸ªä½œä¸šçš„è¿è¡Œï¼ŒåŒ…æ‹¬jobçš„è§£æã€Stageçš„ç”Ÿæˆã€è°ƒåº¦Taskåˆ°Executorä¸Šå»æ‰§è¡Œï¼›\n- Stage: ä¸­æ–‡åæ˜¯ï¼šé˜¶æ®µï¼Œæ˜¯Jobçš„åŸºæœ¬è°ƒåº¦å•ä½ï¼Œå› ä¸ºæ¯ä¸ªJobä¼šåˆ†æˆè‹¥å¹²ç»„Taskï¼Œæ¯ç»„taskå°±è¢«ç§°ä¸ºStageï¼›\n- Task: ä»»åŠ¡ï¼ŒæŒ‡çš„æ˜¯ç›´æ¥è¿è¡Œåœ¨executorä¸Šçš„ä¸œè¥¿ï¼Œæ˜¯executorä¸Šçš„ä¸€ä¸ªçº¿ç¨‹ï¼›\n- Executor: æŒ‡çš„æ˜¯æ‰§è¡Œå™¨ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯çœŸæ­£æ‰§è¡Œä»»åŠ¡çš„åœ°æ–¹äº†ï¼Œä¸€ä¸ªé›†ç¾¤å¯ä»¥è¢«é…ç½®è‹¥å¹²ä¸ªExecutorï¼Œæ¯ä¸ªExecutoræ¥æ”¶æ¥è‡ªDriverçš„Taskï¼Œå¹¶æ‰§è¡Œå®ƒï¼ˆå¯åŒæ—¶æ‰§è¡Œå¤šä¸ªTaskï¼‰ã€‚\n\n## DAG\nå…¨ç§°æ˜¯Directed Acyclic Graph, ä¸­æ–‡åæ˜¯ï¼šæœ‰å‘æ— ç¯å›¾ã€‚Sparkå°±æ˜¯å€Ÿç”¨äº†DAGå¯¹RDDä¹‹é—´çš„å…³ç³»è¿›è¡Œäº†å»ºæ¨¡ï¼Œç”¨æ¥æè¿°RDDä¹‹é—´çš„å› æœä¾èµ–å…³ç³»ã€‚å› ä¸ºåœ¨ä¸€ä¸ªSparkä½œä¸šè°ƒåº¦ä¸­ï¼Œå¤šä¸ªä½œä¸šä»»åŠ¡ä¹‹é—´ä¹Ÿæ˜¯ç›¸äº’ä¾èµ–çš„ï¼Œæœ‰äº›ä»»åŠ¡éœ€è¦åœ¨ä¸€äº›ä»»åŠ¡æ‰§è¡Œå®Œæˆäº†æ‰å¯ä»¥æ‰§è¡Œçš„ã€‚åœ¨Sparkè°ƒåº¦ä¸­å°±æ˜¯æœ‰DAGschedulerï¼Œå®ƒè´Ÿè´£å°†jobåˆ†æˆè‹¥å¹²ç»„Taskç»„æˆçš„Stageã€‚\n![DAG](./PySparkåŸºç¡€001/dag.jpg)\n\n## Sparkè¿è¡Œæ¨¡å¼\nä¸»è¦æœ‰localæ¨¡å¼ã€Standaloneæ¨¡å¼ã€Mesosæ¨¡å¼ã€YARNæ¨¡å¼ã€‚\n- Standalone:  ç‹¬ç«‹æ¨¡å¼ï¼ŒSpark åŸç”Ÿçš„ç®€å•é›†ç¾¤ç®¡ç†å™¨ï¼Œ è‡ªå¸¦å®Œæ•´çš„æœåŠ¡ï¼Œ å¯å•ç‹¬éƒ¨ç½²åˆ°ä¸€ä¸ªé›†ç¾¤ä¸­ï¼Œæ— éœ€ä¾èµ–ä»»ä½•å…¶ä»–èµ„æºç®¡ç†ç³»ç»Ÿï¼Œ ä½¿ç”¨ Standalone å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ­å»ºä¸€ä¸ªé›†ç¾¤ï¼Œä¸€èˆ¬åœ¨å…¬å¸å†…éƒ¨æ²¡æœ‰æ­å»ºå…¶ä»–èµ„æºç®¡ç†æ¡†æ¶çš„æ—¶å€™æ‰ä¼šä½¿ç”¨ã€‚\n- Mesos: ä¸€ä¸ªå¼ºå¤§çš„åˆ†å¸ƒå¼èµ„æºç®¡ç†æ¡†æ¶ï¼Œå®ƒå…è®¸å¤šç§ä¸åŒçš„æ¡†æ¶éƒ¨ç½²åœ¨å…¶ä¸Šï¼ŒåŒ…æ‹¬ yarnï¼Œç”±äºmesosè¿™ç§æ–¹å¼ç›®å‰åº”ç”¨çš„æ¯”è¾ƒå°‘ã€‚\n- YARN: ç»Ÿä¸€çš„èµ„æºç®¡ç†æœºåˆ¶ï¼Œ åœ¨ä¸Šé¢å¯ä»¥è¿è¡Œå¤šå¥—è®¡ç®—æ¡†æ¶ï¼Œ å¦‚map reduceã€storm ç­‰ï¼Œ æ ¹æ® driver åœ¨é›†ç¾¤ä¸­çš„ä½ç½®ä¸åŒï¼Œåˆ†ä¸º yarn client å’Œ yarn clusterã€‚\nå®é™…ä¸ŠSparkå†…éƒ¨ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·æµ‹è¯•ï¼Œè‡ªèº«ä¹Ÿæä¾›äº†ä¸€äº›éƒ¨ç½²æ¨¡å¼ã€‚ç”±äºåœ¨å®é™…å·¥å‚ç¯å¢ƒä¸‹ä½¿ç”¨çš„ç»å¤§å¤šæ•°çš„é›†ç¾¤ç®¡ç†å™¨æ˜¯ Hadoop YARNï¼Œå› æ­¤æˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹æ˜¯ Hadoop YARN æ¨¡å¼ä¸‹çš„ Spark é›†ç¾¤éƒ¨ç½²ã€‚\n\nSpark çš„è¿è¡Œæ¨¡å¼å–å†³äºä¼ é€’ç»™ SparkContext çš„ MASTER ç¯å¢ƒå˜é‡çš„å€¼ï¼Œ ä¸ªåˆ«æ¨¡å¼è¿˜éœ€è¦è¾…åŠ©çš„ç¨‹åºæ¥å£æ¥é…åˆä½¿ç”¨ï¼Œç›®å‰æ”¯æŒçš„ Master å­—ç¬¦ä¸²åŠ URL åŒ…æ‹¬ï¼š\n\n| Master URL | Meaning |\n| -- | -- |\n| local | åœ¨æœ¬åœ°è¿è¡Œï¼Œåªæœ‰ä¸€ä¸ªå·¥ä½œè¿›ç¨‹ï¼Œæ— å¹¶è¡Œè®¡ç®—èƒ½åŠ› |\n| local[K] | åœ¨æœ¬åœ°è¿è¡Œï¼Œåªæœ‰Kä¸ªå·¥ä½œè¿›ç¨‹ï¼Œé€šå¸¸è®¾ç½®Kä¸ºæœºå™¨çš„CPUæ ¸å¿ƒæ•°é‡ |\n| local[*] | åœ¨æœ¬åœ°è¿è¡Œï¼Œå·¥ä½œè¿›ç¨‹æ•°é‡ç­‰äºæœºå™¨çš„CPUæ ¸å¿ƒæ•°é‡ |\n| spark://host:port | ä»¥ Standalone æ¨¡å¼è¿è¡Œï¼Œè¿™æ˜¯ Spark è‡ªèº«æä¾›çš„é›†ç¾¤è¿è¡Œæ¨¡å¼ï¼Œé»˜è®¤ç«¯å£å·: 7077 |\n| mesos://host:port | åœ¨ Mesos é›†ç¾¤ä¸Šè¿è¡Œï¼ŒDriver è¿›ç¨‹å’Œ Worker è¿›ç¨‹è¿è¡Œåœ¨ Mesos é›†ç¾¤ä¸Šï¼Œéƒ¨ç½²æ¨¡å¼å¿…é¡»ä½¿ç”¨å›ºå®šå€¼:--deploy-mode cluster |\n| yarn-client | åœ¨ Yarn é›†ç¾¤ä¸Šè¿è¡Œï¼ŒDriver è¿›ç¨‹åœ¨æœ¬åœ°ï¼Œ Work è¿›ç¨‹åœ¨ Yarn é›†ç¾¤ä¸Šï¼Œ éƒ¨ç½²æ¨¡å¼å¿…é¡»ä½¿ç”¨å›ºå®šå€¼:--deploy-modeclientã€‚Yarn é›†ç¾¤åœ°å€å¿…é¡»åœ¨HADOOP_CONF_DIRorYARN_CONF_DIR å˜é‡é‡Œå®šä¹‰ã€‚|\n| yarn-cluster | yarn-cluster æ•ˆç‡æ¯”yarn-clienté«˜ã€‚åœ¨ Yarn é›†ç¾¤ä¸Šè¿è¡Œï¼ŒDriver è¿›ç¨‹åœ¨ Yarn é›†ç¾¤ä¸Šï¼ŒWork è¿›ç¨‹ä¹Ÿåœ¨ Yarn é›†ç¾¤ä¸Šï¼Œéƒ¨ç½²æ¨¡å¼å¿…é¡»ä½¿ç”¨å›ºå®šå€¼:--deploy-mode clusterã€‚Yarn é›†ç¾¤åœ°å€å¿…é¡»åœ¨HADOOP_CONF_DIR or YARN_CONF_DIR å˜é‡é‡Œå®šä¹‰ã€‚|\n\n**ç”¨æˆ·åœ¨æäº¤ä»»åŠ¡ç»™ Spark å¤„ç†æ—¶ï¼Œä»¥ä¸‹ä¸¤ä¸ªå‚æ•°å…±åŒå†³å®šäº† Spark çš„è¿è¡Œæ–¹å¼ã€‚**\n\n- master MASTER_URL: å†³å®šäº† Spark ä»»åŠ¡æäº¤ç»™å“ªç§é›†ç¾¤å¤„ç†ã€‚\n- deploy-mode DEPLOY_MODE: å†³å®šäº† Driver çš„è¿è¡Œæ–¹å¼ï¼Œå¯é€‰å€¼ä¸º Client\næˆ–è€… Clusterã€‚\n\n### Standaloneæ¨¡å¼è¿è¡Œæœºåˆ¶\n\nStandalone é›†ç¾¤æœ‰å››ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ï¼š\n\n1. Driverï¼š æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œæˆ‘ä»¬ç¼–å†™çš„ Spark åº”ç”¨ç¨‹åºå°±è¿è¡Œåœ¨ Driver ä¸Šï¼Œ ç”±Driver è¿›ç¨‹æ‰§è¡Œï¼›\n2. Masterï¼šæ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸»è¦è´Ÿè´£èµ„æºçš„è°ƒåº¦å’Œåˆ†é…ï¼Œå¹¶è¿›è¡Œé›†ç¾¤çš„ç›‘æ§ç­‰èŒè´£ï¼›\n3. Workerï¼šæ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ª Worker è¿è¡Œåœ¨é›†ç¾¤ä¸­çš„ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œä¸»è¦è´Ÿè´£ä¸¤ä¸ªèŒè´£ï¼Œä¸€ä¸ªæ˜¯ç”¨è‡ªå·±çš„å†…å­˜å­˜å‚¨ RDD çš„æŸä¸ªæˆ–æŸäº› partitionï¼›å¦ä¸€ä¸ªæ˜¯å¯åŠ¨å…¶ä»–è¿›ç¨‹å’Œçº¿ç¨‹ï¼ˆExecutorï¼‰ ï¼Œå¯¹ RDD ä¸Šçš„ partition è¿›è¡Œå¹¶è¡Œçš„å¤„ç†å’Œè®¡ç®—ã€‚\n4. Executorï¼šæ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œ ä¸€ä¸ª Worker ä¸Šå¯ä»¥è¿è¡Œå¤šä¸ª Executorï¼Œ Executor é€šè¿‡å¯åŠ¨å¤šä¸ªçº¿ç¨‹ï¼ˆtaskï¼‰æ¥æ‰§è¡Œå¯¹ RDD çš„ partition è¿›è¡Œå¹¶è¡Œè®¡ç®—ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œæˆ‘ä»¬å¯¹ RDD å®šä¹‰çš„ä¾‹å¦‚ mapã€flatMapã€reduce ç­‰ç®—å­æ“ä½œã€‚\n\n#### Standalone Clientæ¨¡å¼\n\nåœ¨ Standalone Client æ¨¡å¼ä¸‹ï¼ŒDriver åœ¨ä»»åŠ¡æäº¤çš„æœ¬åœ°æœºå™¨ä¸Šè¿è¡Œï¼ŒDriver å¯åŠ¨åå‘ Master æ³¨å†Œåº”ç”¨ç¨‹åºï¼ŒMaster æ ¹æ® submit è„šæœ¬çš„èµ„æºéœ€æ±‚æ‰¾åˆ°å†…éƒ¨èµ„æºè‡³å°‘å¯ä»¥å¯åŠ¨ä¸€ä¸ª Executor çš„æ‰€æœ‰ Workerï¼Œç„¶ååœ¨è¿™äº› Worker ä¹‹é—´åˆ†é… Executorï¼ŒWorker ä¸Šçš„ Executor å¯åŠ¨åä¼šå‘ Driver åå‘æ³¨å†Œï¼Œæ‰€æœ‰çš„ Executor æ³¨å†Œå®Œæˆåï¼ŒDriver å¼€å§‹æ‰§è¡Œ main å‡½æ•°ï¼Œä¹‹åæ‰§è¡Œåˆ° Action ç®—å­æ—¶ï¼Œå¼€å§‹åˆ’åˆ† stageï¼Œæ¯ä¸ª stage ç”Ÿæˆå¯¹åº”çš„ taskSetï¼Œä¹‹åå°† task åˆ†å‘åˆ°å„ä¸ª Executor ä¸Šæ‰§è¡Œã€‚\n\n#### Standalone Clusteræ¨¡å¼\n\nåœ¨ Standalone Cluster æ¨¡å¼ä¸‹ï¼Œä»»åŠ¡æäº¤åï¼ŒMaster ä¼šæ‰¾åˆ°ä¸€ä¸ª Worker å¯åŠ¨ Driverè¿›ç¨‹ï¼Œ Driver å¯åŠ¨åå‘ Master æ³¨å†Œåº”ç”¨ç¨‹åºï¼Œ Master æ ¹æ® submit è„šæœ¬çš„èµ„æºéœ€æ±‚æ‰¾åˆ°å†…éƒ¨èµ„æºè‡³å°‘å¯ä»¥å¯åŠ¨ä¸€ä¸ª Executor çš„æ‰€æœ‰ Workerï¼Œç„¶ååœ¨è¿™äº› Worker ä¹‹é—´åˆ†é… Executorï¼ŒWorker ä¸Šçš„ Executor å¯åŠ¨åä¼šå‘ Driver åå‘æ³¨å†Œï¼Œæ‰€æœ‰çš„ Executor æ³¨å†Œå®Œæˆåï¼ŒDriver å¼€å§‹æ‰§è¡Œ main å‡½æ•°ï¼Œä¹‹åæ‰§è¡Œåˆ° Action ç®—å­æ—¶ï¼Œå¼€å§‹åˆ’åˆ† stageï¼Œæ¯ä¸ª stage ç”Ÿæˆå¯¹åº”çš„ taskSetï¼Œä¹‹åå°† task åˆ†å‘åˆ°å„ä¸ª Executor ä¸Šæ‰§è¡Œã€‚\n\n> æ³¨æ„ï¼Œ Standalone çš„ä¸¤ç§æ¨¡å¼ä¸‹ï¼ˆ client/clusterï¼‰ï¼Œ Master åœ¨æ¥åˆ° Driver æ³¨å†Œ\nSpark åº”ç”¨ç¨‹åºçš„è¯·æ±‚åï¼Œä¼šè·å–å…¶æ‰€ç®¡ç†çš„å‰©ä½™èµ„æºèƒ½å¤Ÿå¯åŠ¨ä¸€ä¸ª Executor çš„æ‰€æœ‰ Workerï¼Œ ç„¶ååœ¨è¿™äº› Worker ä¹‹é—´åˆ†å‘ Executorï¼Œæ­¤æ—¶çš„åˆ†å‘åªè€ƒè™‘ Worker ä¸Šçš„èµ„æºæ˜¯å¦è¶³å¤Ÿä½¿ç”¨ï¼Œç›´åˆ°å½“å‰åº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰ Executor éƒ½åˆ†é…å®Œæ¯•ï¼Œ Executor åå‘æ³¨å†Œå®Œæ¯•åï¼ŒDriver å¼€å§‹æ‰§è¡Œ main ç¨‹åºã€‚\n\n### YARNæ¨¡å¼è¿è¡Œæœºåˆ¶\n\n#### YARN Clientæ¨¡å¼\n\n1. Driveråœ¨ä»»åŠ¡æäº¤çš„æœ¬åœ°æœºå™¨ä¸Šè¿è¡Œï¼ŒDriverå¯åŠ¨åä¼šå’ŒResourceManageré€šè®¯ç”³è¯·å¯åŠ¨ApplicationMasterï¼›\n2. éšåResourceManageråˆ†é…Containerï¼Œåœ¨åˆé€‚çš„NodeManagerä¸Šå¯åŠ¨ApplicationMasterï¼Œæ­¤æ—¶çš„ApplicationMasterçš„åŠŸèƒ½ç›¸å½“äºä¸€ä¸ªExecutorLaucherï¼Œåªè´Ÿè´£å‘ResourceManagerç”³ è¯·Executorå†…å­˜ï¼›\n3. ResourceManageræ¥åˆ°ApplicationMasterçš„èµ„æºç”³è¯·åä¼šåˆ†é…Containerï¼Œç„¶åApplicationMasteråœ¨èµ„æºåˆ†é…æŒ‡å®šçš„NodeManagerä¸Šå¯åŠ¨Executorè¿›ç¨‹ï¼›\n4. Executorè¿›ç¨‹å¯åŠ¨åä¼šå‘Driveråå‘æ³¨å†Œï¼ŒExecutorå…¨éƒ¨æ³¨å†Œå®ŒæˆåDriverå¼€å§‹æ‰§è¡Œmainå‡½æ•°ï¼›\n5. ä¹‹åæ‰§è¡Œåˆ°Actionç®—å­æ—¶ï¼Œè§¦å‘ä¸€ä¸ªJobï¼Œå¹¶æ ¹æ®å®½ä¾èµ–å¼€å§‹åˆ’åˆ†Stageï¼Œæ¯ä¸ªStageç”Ÿæˆå¯¹åº”çš„TaskSetï¼Œä¹‹åå°†Taskåˆ†å‘åˆ°å„ä¸ªExecutorä¸Šæ‰§è¡Œã€‚\n\n![yarn-clientæ¨¡å¼](./PySparkåŸºç¡€001/yarn-client.png)\n\n#### YARN Cluster æ¨¡å¼\n\n1. ä»»åŠ¡æäº¤åä¼šå’ŒResourceManageré€šè®¯ç”³è¯·å¯åŠ¨ApplicationMaster;\n2. éšåResourceManageråˆ†é…Containerï¼Œåœ¨åˆé€‚çš„NodeManagerä¸Šå¯åŠ¨ApplicationMasterï¼Œæ­¤æ—¶çš„ApplicationMasterå°±æ˜¯Driverï¼›\n3. Driverå¯åŠ¨åå‘ResourceManagerç”³è¯·Executorå†…å­˜ï¼ŒResourceManageræ¥åˆ°ApplicationMasterçš„èµ„æºç”³è¯·åä¼šåˆ†é…Container,ç„¶ååœ¨åˆé€‚çš„NodeManagerä¸Šå¯åŠ¨Executorè¿›ç¨‹;\n4. Executorè¿›ç¨‹å¯åŠ¨åä¼šå‘Driveråå‘æ³¨å†Œ;\n5. Executorå…¨éƒ¨æ³¨å†Œå®ŒæˆåDriverå¼€å§‹æ‰§è¡Œmainå‡½æ•°ï¼Œä¹‹åæ‰§è¡Œåˆ°Actionç®—å­æ—¶ï¼Œè§¦å‘ä¸€ä¸ªjobï¼Œå¹¶æ ¹æ®å®½ä¾èµ–å¼€å§‹åˆ’åˆ†stageï¼Œæ¯ä¸ªstageç”Ÿæˆå¯¹åº”çš„taskSetï¼Œä¹‹åå°†taskåˆ†å‘åˆ°å„ä¸ªExecutorä¸Šæ‰§è¡Œ;\n\n![yarn-clusteræ¨¡å¼](./PySparkåŸºç¡€001/yarn-cluster.jpg)\n\n\n## Shuffleæ“ä½œæ˜¯ä»€ä¹ˆ\n\nShuffleæŒ‡çš„æ˜¯æ•°æ®ä»Mapç«¯åˆ°Reduceç«¯çš„æ•°æ®ä¼ è¾“è¿‡ç¨‹ï¼ŒShuffleæ€§èƒ½çš„é«˜ä½ä¼šç›´æ¥å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚å› ä¸ºReduce taskéœ€è¦è·¨èŠ‚ç‚¹å»æ‹‰åˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹ä¸Šçš„Map taskè®¡ç®—ç»“æœï¼Œè¿™ä¸€ä¸ªè¿‡ç¨‹æ˜¯éœ€è¦æœ‰ç£ç›˜IOæ¶ˆè€—ä»¥åŠæ•°æ®ç½‘ç»œä¼ è¾“çš„æ¶ˆè€—çš„ï¼Œæ‰€ä»¥éœ€è¦æ ¹æ®å®é™…æ•°æ®æƒ…å†µè¿›è¡Œé€‚å½“è°ƒæ•´ã€‚å¦å¤–ï¼ŒShuffleå¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯Mapé˜¶æ®µçš„æ•°æ®å‡†å¤‡ä¸Reduceé˜¶æ®µçš„æ•°æ®æ‹·è´å¤„ç†ï¼Œåœ¨Mapç«¯æˆ‘ä»¬å«Shuffle Writeï¼Œåœ¨Reduceç«¯æˆ‘ä»¬å«Shuffle Readã€‚\n\n## ä»€ä¹ˆæ˜¯æƒ°æ€§æ‰§è¡Œ\n\nè¿™æ˜¯RDDçš„ä¸€ä¸ªç‰¹æ€§ï¼Œåœ¨RDDä¸­çš„ç®—å­å¯ä»¥åˆ†ä¸ºTransformç®—å­å’ŒActionç®—å­ï¼Œå…¶ä¸­Transformç®—å­çš„æ“ä½œéƒ½ä¸ä¼šçœŸæ­£æ‰§è¡Œï¼Œåªä¼šè®°å½•ä¸€ä¸‹ä¾èµ–å…³ç³»ï¼Œç›´åˆ°é‡è§äº†Actionç®—å­ï¼Œåœ¨è¿™ä¹‹å‰çš„æ‰€æœ‰Transformæ“ä½œæ‰ä¼šè¢«è§¦å‘è®¡ç®—ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„æƒ°æ€§æ‰§è¡Œã€‚å…·ä½“å“ªäº›æ˜¯Transformå’ŒActionç®—å­ï¼Œå¯ä»¥çœ‹ä¸‹ä¸€èŠ‚ã€‚\n\n## å¸¸ç”¨å‡½æ•°\n\nå¸¸ç”¨çš„ç®—å­å¤§æ¦‚å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š\n\n### Transformations\n\n- map\n- flatmap\n- filter\n- distinct\n- reduceByKey\n- mapPartitions\n- sortBy\n\n### Actions\n\n- collect\n- collectAsMap\n- reduce\n- countByKey/countByValue\n- take\n- first\n\n### ä»£ç ç¤ºä¾‹\n\n```python\nimport os\nimport pyspark\nfrom pyspark import SparkContext, SparkConf\n\nconf = SparkConf().setAppName(\"test_spark_app\").setMaster(\"local[4]\")\nsc = SparkContext(conf=conf)\n\n# ä½¿ç”¨ parallelizeæ–¹æ³•ç›´æ¥å®ä¾‹åŒ–ä¸€ä¸ªRDD\nrdd = sc.parallelize(range(1,11),4) # è¿™é‡Œçš„ 4 æŒ‡çš„æ˜¯åˆ†åŒºæ•°é‡\nrdd.take(100)\n# [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\n\n\n\"\"\"\n----------------------------------------------\n                Transformç®—å­è§£æ\n----------------------------------------------\n\"\"\"\n# ä»¥ä¸‹çš„æ“ä½œç”±äºæ˜¯Transformæ“ä½œï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨æœ€ååŠ ä¸Šä¸€ä¸ªcollectç®—å­ç”¨æ¥è§¦å‘è®¡ç®—ã€‚\n# 1. map: å’Œpythonå·®ä¸å¤šï¼Œmapè½¬æ¢å°±æ˜¯å¯¹æ¯ä¸€ä¸ªå…ƒç´ è¿›è¡Œä¸€ä¸ªæ˜ å°„\nrdd = sc.parallelize(range(1, 11), 4)\nrdd_map = rdd.map(lambda x: x*2)\nprint(\"åŸå§‹æ•°æ®ï¼š\", rdd.collect())\nprint(\"æ‰©å¤§2å€ï¼š\", rdd_map.collect())\n# åŸå§‹æ•°æ®ï¼š [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\n# æ‰©å¤§2å€ï¼š [2, 4, 6, 8, 10, 12, 14, 16, 18, 20]\n\n# 2. flatMap: è¿™ä¸ªç›¸æ¯”äºmapå¤šä¸€ä¸ªflatï¼ˆå‹å¹³ï¼‰æ“ä½œï¼Œé¡¾åæ€ä¹‰å°±æ˜¯è¦æŠŠé«˜ç»´çš„æ•°ç»„å˜æˆä¸€ç»´\nrdd2 = sc.parallelize([\"hello SamShare\", \"hello PySpark\"])\nprint(\"åŸå§‹æ•°æ®ï¼š\", rdd2.collect())\nprint(\"ç›´æ¥splitä¹‹åçš„mapç»“æœï¼š\", rdd2.map(lambda x: x.split(\" \")).collect())\nprint(\"ç›´æ¥splitä¹‹åçš„flatMapç»“æœï¼š\", rdd2.flatMap(lambda x: x.split(\" \")).collect())\n# ç›´æ¥splitä¹‹åçš„mapç»“æœï¼š [['hello', 'SamShare'], ['hello', 'PySpark']]\n# ç›´æ¥splitä¹‹åçš„flatMapç»“æœï¼š ['hello', 'SamShare', 'hello', 'PySpark']\n\n# 3. filter: è¿‡æ»¤æ•°æ®\nrdd = sc.parallelize(range(1, 11), 4)\nprint(\"åŸå§‹æ•°æ®ï¼š\", rdd.collect())\nprint(\"è¿‡æ»¤å¥‡æ•°ï¼š\", rdd.filter(lambda x: x % 2 == 0).collect())\n# åŸå§‹æ•°æ®ï¼š [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\n# è¿‡æ»¤å¥‡æ•°ï¼š [2, 4, 6, 8, 10]\n\n# 4. distinct: å»é‡å…ƒç´ \nrdd = sc.parallelize([2, 2, 4, 8, 8, 8, 8, 16, 32, 32])\nprint(\"åŸå§‹æ•°æ®ï¼š\", rdd.collect())\nprint(\"å»é‡æ•°æ®ï¼š\", rdd.distinct().collect())\n# åŸå§‹æ•°æ®ï¼š [2, 2, 4, 8, 8, 8, 8, 16, 32, 32]\n# å»é‡æ•°æ®ï¼š [4, 8, 16, 32, 2]\n\n# 5. reduceByKey: æ ¹æ®keyæ¥æ˜ å°„æ•°æ®\nfrom operator import add\nrdd = sc.parallelize([(\"a\", 1), (\"b\", 1), (\"a\", 1)])\nprint(\"åŸå§‹æ•°æ®ï¼š\", rdd.collect())\nprint(\"åŸå§‹æ•°æ®ï¼š\", rdd.reduceByKey(add).collect())\n# åŸå§‹æ•°æ®ï¼š [('a', 1), ('b', 1), ('a', 1)]\n# åŸå§‹æ•°æ®ï¼š [('b', 1), ('a', 2)]\n\n# 6. mapPartitions: æ ¹æ®åˆ†åŒºå†…çš„æ•°æ®è¿›è¡Œæ˜ å°„æ“ä½œ\n# æŠŠæ•°æ®é›†å‘æˆä¸¤ä¸ªåˆ†åŒºï¼Œåœ¨åˆ†åŒºå†…è¿›è¡Œæ±‚å’Œæ“ä½œ\nrdd = sc.parallelize([1, 2, 3, 4], 2)\ndef f(iterator):\n    yield sum(iterator)\nprint(rdd.collect())\nprint(rdd.mapPartitions(f).collect())\n# [1, 2, 3, 4]\n# [3, 7]\n\n# 7. sortBy: æ ¹æ®è§„åˆ™è¿›è¡Œæ’åº\ntmp = [('a', 1), ('b', 2), ('1', 3), ('d', 4), ('2', 5)]\nprint(sc.parallelize(tmp).sortBy(lambda x: x[0]).collect())\nprint(sc.parallelize(tmp).sortBy(lambda x: x[1]).collect())\n# [('1', 3), ('2', 5), ('a', 1), ('b', 2), ('d', 4)]\n# [('a', 1), ('b', 2), ('1', 3), ('d', 4), ('2', 5)]\n\n# 8. subtract: æ•°æ®é›†ç›¸å‡, Return each value in self that is not contained in other.\nx = sc.parallelize([(\"a\", 1), (\"b\", 4), (\"b\", 5), (\"a\", 3)])\ny = sc.parallelize([(\"a\", 3), (\"c\", None)])\nprint(sorted(x.subtract(y).collect()))\n# [('a', 1), ('b', 4), ('b', 5)]\n\n# 9. union: åˆå¹¶ä¸¤ä¸ªRDD\nrdd = sc.parallelize([1, 1, 2, 3])\nprint(rdd.union(rdd).collect())\n# [1, 1, 2, 3, 1, 1, 2, 3]\n\n# 10. intersection: å–ä¸¤ä¸ªRDDçš„äº¤é›†ï¼ŒåŒæ—¶æœ‰å»é‡çš„åŠŸæ•ˆ\nrdd1 = sc.parallelize([1, 10, 2, 3, 4, 5, 2, 3])\nrdd2 = sc.parallelize([1, 6, 2, 3, 7, 8])\nprint(rdd1.intersection(rdd2).collect())\n# [1, 2, 3]\n\n# 11. cartesian: ç”Ÿæˆç¬›å¡å°”ç§¯\nrdd = sc.parallelize([1, 2])\nprint(sorted(rdd.cartesian(rdd).collect()))\n# [(1, 1), (1, 2), (2, 1), (2, 2)]\n\n# 12. zip: æ‹‰é“¾åˆå¹¶ï¼Œéœ€è¦ä¸¤ä¸ªRDDå…·æœ‰ç›¸åŒçš„é•¿åº¦ä»¥åŠåˆ†åŒºæ•°é‡\nx = sc.parallelize(range(0, 5))\ny = sc.parallelize(range(1000, 1005))\nprint(x.collect())\nprint(y.collect())\nprint(x.zip(y).collect())\n# [0, 1, 2, 3, 4]\n# [1000, 1001, 1002, 1003, 1004]\n# [(0, 1000), (1, 1001), (2, 1002), (3, 1003), (4, 1004)]\n\n# 13. zipWithIndex: å°†RDDå’Œä¸€ä¸ªä»0å¼€å§‹çš„é€’å¢åºåˆ—æŒ‰ç…§æ‹‰é“¾æ–¹å¼è¿æ¥ã€‚\nrdd_name = sc.parallelize([\"LiLei\", \"Hanmeimei\", \"Lily\", \"Lucy\", \"Ann\", \"Dachui\", \"RuHua\"])\nrdd_index = rdd_name.zipWithIndex()\nprint(rdd_index.collect())\n# [('LiLei', 0), ('Hanmeimei', 1), ('Lily', 2), ('Lucy', 3), ('Ann', 4), ('Dachui', 5), ('RuHua', 6)]\n\n# 14. groupByKey: æŒ‰ç…§keyæ¥èšåˆæ•°æ®\nrdd = sc.parallelize([(\"a\", 1), (\"b\", 1), (\"a\", 1)])\nprint(rdd.collect())\nprint(sorted(rdd.groupByKey().mapValues(len).collect()))\nprint(sorted(rdd.groupByKey().mapValues(list).collect()))\n# [('a', 1), ('b', 1), ('a', 1)]\n# [('a', 2), ('b', 1)]\n# [('a', [1, 1]), ('b', [1])]\n\n# 15. sortByKey:\ntmp = [('a', 1), ('b', 2), ('1', 3), ('d', 4), ('2', 5)]\nprint(sc.parallelize(tmp).sortByKey(True, 1).collect())\n# [('1', 3), ('2', 5), ('a', 1), ('b', 2), ('d', 4)]\n\n# 16. join:\nx = sc.parallelize([(\"a\", 1), (\"b\", 4)])\ny = sc.parallelize([(\"a\", 2), (\"a\", 3)])\nprint(sorted(x.join(y).collect()))\n# [('a', (1, 2)), ('a', (1, 3))]\n\n# 17. leftOuterJoin/rightOuterJoin\nx = sc.parallelize([(\"a\", 1), (\"b\", 4)])\ny = sc.parallelize([(\"a\", 2)])\nprint(sorted(x.leftOuterJoin(y).collect()))\n# [('a', (1, 2)), ('b', (4, None))]\n\n\"\"\"\n----------------------------------------------\n                Actionç®—å­è§£æ\n----------------------------------------------\n\"\"\"\n# 1. collect: æŒ‡çš„æ˜¯æŠŠæ•°æ®éƒ½æ±‡é›†åˆ°driverç«¯ï¼Œä¾¿äºåç»­çš„æ“ä½œ\nrdd = sc.parallelize(range(0, 5))\nrdd_collect = rdd.collect()\nprint(rdd_collect)\n# [0, 1, 2, 3, 4]\n\n# 2. first: å–ç¬¬ä¸€ä¸ªå…ƒç´ \nsc.parallelize([2, 3, 4]).first()\n# 2\n\n# 3. collectAsMap: è½¬æ¢ä¸ºdictï¼Œä½¿ç”¨è¿™ä¸ªè¦æ³¨æ„äº†ï¼Œä¸è¦å¯¹å¤§æ•°æ®ç”¨ï¼Œä¸ç„¶å…¨éƒ¨è½½å…¥åˆ°driverç«¯ä¼šçˆ†å†…å­˜\nm = sc.parallelize([(1, 2), (3, 4)]).collectAsMap()\nm\n# {1: 2, 3: 4}\n\n# 4. reduce: é€æ­¥å¯¹ä¸¤ä¸ªå…ƒç´ è¿›è¡Œæ“ä½œ\nrdd = sc.parallelize(range(10),5)\nprint(rdd.reduce(lambda x,y:x+y))\n# 45\n\n# 5. countByKey/countByValue:\nrdd = sc.parallelize([(\"a\", 1), (\"b\", 1), (\"a\", 1)])\nprint(sorted(rdd.countByKey().items()))\nprint(sorted(rdd.countByValue().items()))\n# [('a', 2), ('b', 1)]\n# [(('a', 1), 2), (('b', 1), 1)]\n\n# 6. take: ç›¸å½“äºå–å‡ ä¸ªæ•°æ®åˆ°driverç«¯\nrdd = sc.parallelize([(\"a\", 1), (\"b\", 1), (\"a\", 1)])\nprint(rdd.take(5))\n# [('a', 1), ('b', 1), ('a', 1)]\n\n# 7. saveAsTextFile: ä¿å­˜rddæˆtextæ–‡ä»¶åˆ°æœ¬åœ°\ntext_file_path = \"./data/rdd\"\nshutil.rmtree(text_file_path, True)\nrdd = sc.parallelize(range(5))\nrdd.saveAsTextFile(text_file_path)\n\n# 8. takeSample: éšæœºå–æ•°\nrdd = sc.textFile(\"./samples/zipcodes.csv\", 4)  # è¿™é‡Œçš„ 4 æŒ‡çš„æ˜¯åˆ†åŒºæ•°é‡\nrdd_sample = rdd.takeSample(True, 2, 0)  # withReplacement å‚æ•°1ï¼šä»£è¡¨æ˜¯å¦æ˜¯æœ‰æ”¾å›æŠ½æ ·\nprint(rdd_sample)\n\n# 9. foreach: å¯¹æ¯ä¸€ä¸ªå…ƒç´ æ‰§è¡ŒæŸç§æ“ä½œï¼Œä¸ç”Ÿæˆæ–°çš„RDD\nrdd = sc.parallelize(range(10), 5)\naccum = sc.accumulator(0)\nrdd.foreach(lambda x: accum.add(x))\nprint(accum.value)\n\n```\n\n## Spark SQLä½¿ç”¨\n\nåœ¨è®²Spark SQLå‰ï¼Œå…ˆè§£é‡Šä¸‹è¿™ä¸ªæ¨¡å—ã€‚è¿™ä¸ªæ¨¡å—æ˜¯Sparkä¸­ç”¨æ¥å¤„ç†ç»“æ„åŒ–æ•°æ®çš„ï¼Œæä¾›ä¸€ä¸ªå«SparkDataFrameçš„ä¸œè¥¿å¹¶ä¸”è‡ªåŠ¨è§£æä¸ºåˆ†å¸ƒå¼SQLæŸ¥è¯¢æ•°æ®ã€‚ç”¨è¿‡Pythonçš„Pandasåº“ï¼Œä¹Ÿå¤§è‡´äº†è§£äº†DataFrameï¼Œè¿™ä¸ªå…¶å®å’Œå®ƒæ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œåªæ˜¯è°ƒç”¨çš„APIå¯èƒ½æœ‰äº›ä¸åŒç½¢äº†ã€‚\n\næˆ‘ä»¬é€šè¿‡ä½¿ç”¨Spark SQLæ¥å¤„ç†æ•°æ®ï¼Œä¼šè®©æˆ‘ä»¬æ›´åŠ ç†Ÿæ‚‰ï¼Œæ¯”å¦‚å¯ä»¥ç”¨SQLè¯­å¥ã€ç”¨SparkDataFrameçš„APIæˆ–è€…Datasets APIï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§éœ€æ±‚éšå¿ƒè½¬æ¢ï¼Œé€šè¿‡SparkDataFrame API å’Œ SQL å†™çš„é€»è¾‘ï¼Œä¼šè¢«Sparkä¼˜åŒ–å™¨Catalystè‡ªåŠ¨ä¼˜åŒ–æˆRDDã€‚\n\n## åˆ›å»ºSparkDataFrame\n\nå¼€å§‹è®²SparkDataFrameï¼Œæˆ‘ä»¬å…ˆå­¦ä¹ ä¸‹å‡ ç§åˆ›å»ºçš„æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ä½¿ç”¨RDDæ¥åˆ›å»ºã€ä½¿ç”¨pandasçš„DataFrameæ¥åˆ›å»ºã€ä½¿ç”¨Listæ¥åˆ›å»ºã€è¯»å–æ•°æ®æ–‡ä»¶æ¥åˆ›å»ºã€é€šè¿‡è¯»å–æ•°æ®åº“æ¥åˆ›å»ºã€‚\n\n### ä½¿ç”¨RDDæ¥åˆ›å»º\n\nä¸»è¦ä½¿ç”¨RDDçš„toDFæ–¹æ³•\n\n```python\nrdd = sc.parallelize([(\"Sam\", 28, 88), (\"Flora\", 28, 90), (\"Run\", 1, 60)])\ndf = rdd.toDF([\"name\", \"age\", \"score\"])\ndf.show()\ndf.printSchema()\n\n# +-----+---+-----+\n# | name|age|score|\n# +-----+---+-----+\n# |  Sam| 28|   88|\n# |Flora| 28|   90|\n# |  Run|  1|   60|\n# +-----+---+-----+\n# root\n#  |-- name: string (nullable = true)\n#  |-- age: long (nullable = true)\n#  |-- score: long (nullable = true)\n```\n\n### ä½¿ç”¨pandasçš„DataFrameæ¥åˆ›å»º\n\n```python\ndf = pd.DataFrame([['Sam', 28, 88], ['Flora', 28, 90], ['Run', 1, 60]],\n                  columns=['name', 'age', 'score'])\nprint(\">> æ‰“å°DataFrame:\")\nprint(df)\nprint(\"\\n\")\nSpark_df = spark.createDataFrame(df)\nprint(\">> æ‰“å°SparkDataFrame:\")\nSpark_df.show()\n# >> æ‰“å°DataFrame:\n#     name  age  score\n# 0    Sam   28     88\n# 1  Flora   28     90\n# 2    Run    1     60\n# >> æ‰“å°SparkDataFrame:\n# +-----+---+-----+\n# | name|age|score|\n# +-----+---+-----+\n# |  Sam| 28|   88|\n# |Flora| 28|   90|\n# |  Run|  1|   60|\n# +-----+---+-----+\n```\n\n### ä½¿ç”¨Listæ¥åˆ›å»º\n\n```python\nlist_values = [['Sam', 28, 88], ['Flora', 28, 90], ['Run', 1, 60]]\nSpark_df = spark.createDataFrame(list_values, ['name', 'age', 'score'])\nSpark_df.show()\n# +-----+---+-----+\n# | name|age|score|\n# +-----+---+-----+\n# |  Sam| 28|   88|\n# |Flora| 28|   90|\n# |  Run|  1|   60|\n# +-----+---+-----+\n```\n\n### è¯»å–æ•°æ®æ–‡ä»¶æ¥åˆ›å»º\n\n```python\n# CSVæ–‡ä»¶\ndf = spark.read.option(\"header\", \"true\") \\\n    .option(\"inferSchema\", \"true\") \\\n    .option(\"delimiter\", \",\") \\\n    .csv(\"./samples/breast_homo_test.csv\")\ndf.show(5)\ndf.printSchema()\n\n# jsonæ–‡ä»¶\ndf = spark.read.json(\"./samples/zipcodes.json\")\ndf.show(5)\ndf.printSchema()\n\ndf = spark.read.option(\"multiline\", \"true\").json(\"./samples/multiline-zipcode.json\")\ndf.show(5)\ndf.printSchema()\n```\n\n### é€šè¿‡è¯»å–æ•°æ®åº“æ¥åˆ›å»º\n\n```python\n# è¯»å–hiveæ•°æ®\nspark.sql(\"CREATE TABLE IF NOT EXISTS src (key INT, value STRING) USING hive\")\nspark.sql(\"LOAD DATA LOCAL INPATH 'data/kv1.txt' INTO TABLE src\")\ndf = spark.sql(\"SELECT key, value FROM src WHERE key < 10 ORDER BY key\")\ndf.show(5)\n\n# è¯»å–mysqlæ•°æ®\nurl = \"jdbc:mysql://localhost:3306/test\"\ndf = spark.read.format(\"jdbc\") \\\n .option(\"url\", url) \\\n .option(\"dbtable\", \"runoob_tbl\") \\\n .option(\"user\", \"root\") \\\n .option(\"password\", \"8888\") \\\n .load()\\\ndf.show()\n```\n\n## å¸¸ç”¨çš„SparkDataFrame API\n\nè¿™é‡Œæˆ‘å¤§æ¦‚æ˜¯åˆ†æˆäº†å‡ éƒ¨åˆ†æ¥çœ‹è¿™äº›APIsï¼Œåˆ†åˆ«æ˜¯æŸ¥çœ‹DataFrameçš„APIsã€ç®€å•å¤„ç†DataFrameçš„APIsã€DataFrameçš„åˆ—æ“ä½œAPIsã€DataFrameçš„ä¸€äº›æ€è·¯å˜æ¢æ“ä½œAPIsã€DataFrameçš„ä¸€äº›ç»Ÿè®¡æ“ä½œAPIsï¼Œè¿™æ ·å­ä¹Ÿæœ‰åŠ©äºæˆ‘ä»¬äº†è§£è¿™äº›APIçš„åŠŸèƒ½ï¼Œä»¥åé‡è§å®é™…é—®é¢˜çš„æ—¶å€™å¯ä»¥è§£å†³ã€‚\n\né¦–å…ˆæˆ‘ä»¬è¿™å°èŠ‚å…¨å±€ç”¨åˆ°çš„æ•°æ®é›†å¦‚ä¸‹ï¼š\n\n```python\nfrom pyspark.sql import functions as F\nfrom pyspark.sql import SparkSession\n# SparkSQLçš„è®¸å¤šåŠŸèƒ½å°è£…åœ¨SparkSessionçš„æ–¹æ³•æ¥å£ä¸­, SparkContextåˆ™ä¸è¡Œçš„ã€‚\nspark = SparkSession.builder \\\n    .appName(\"test_spark_app\") \\\n    .config(\"master\", \"local[4]\") \\\n    .enableHiveSupport() \\\n    .getOrCreate()\nsc = spark.sparkContext\n\n# åˆ›å»ºä¸€ä¸ªSparkDataFrame\nrdd = sc.parallelize([(\"Sam\", 28, 88, \"M\"),\n                      (\"Flora\", 28, 90, \"F\"),\n                      (\"Run\", 1, 60, None),\n                      (\"Peter\", 55, 100, \"M\"),\n                      (\"Mei\", 54, 95, \"F\")])\ndf = rdd.toDF([\"name\", \"age\", \"score\", \"sex\"])\ndf.show()\ndf.printSchema()\n\n# +-----+---+-----+----+\n# | name|age|score| sex|\n# +-----+---+-----+----+\n# |  Sam| 28|   88|   M|\n# |Flora| 28|   90|   F|\n# |  Run|  1|   60|null|\n# |Peter| 55|  100|   M|\n# |  Mei| 54|   95|   F|\n# +-----+---+-----+----+\n# root\n#  |-- name: string (nullable = true)\n#  |-- age: long (nullable = true)\n#  |-- score: long (nullable = true)\n#  |-- sex: string (nullable = true)\n```\n\n### æŸ¥çœ‹DataFrameçš„APIs\n\n```python\n# DataFrame.collect\n# ä»¥åˆ—è¡¨å½¢å¼è¿”å›è¡Œ\ndf.collect()\n# [Row(name='Sam', age=28, score=88, sex='M'),\n# Row(name='Flora', age=28, score=90, sex='F'),\n# Row(name='Run', age=1, score=60, sex=None),\n# Row(name='Peter', age=55, score=100, sex='M'),\n# Row(name='Mei', age=54, score=95, sex='F')]\n\n# DataFrame.count\ndf.count()\n# 5\n\n# DataFrame.columns\ndf.columns\n# ['name', 'age', 'score', 'sex']\n\n# DataFrame.dtypes\ndf.dtypes\n# [('name', 'string'), ('age', 'bigint'), ('score', 'bigint'), ('sex', 'string')]\n\n# DataFrame.describe\n# è¿”å›åˆ—çš„åŸºç¡€ç»Ÿè®¡ä¿¡æ¯\ndf.describe(['age']).show()\n# +-------+------------------+\n# |summary|               age|\n# +-------+------------------+\n# |  count|                 5|\n# |   mean|              33.2|\n# | stddev|22.353970564532826|\n# |    min|                 1|\n# |    max|                55|\n# +-------+------------------+\ndf.describe().show()\n# +-------+-----+------------------+------------------+----+\n# |summary| name|               age|             score| sex|\n# +-------+-----+------------------+------------------+----+\n# |  count|    5|                 5|                 5|   4|\n# |   mean| null|              33.2|              86.6|null|\n# | stddev| null|22.353970564532826|15.582040944625966|null|\n# |    min|Flora|                 1|                60|   F|\n# |    max|  Sam|                55|               100|   M|\n# +-------+-----+------------------+------------------+----+\n\n# DataFrame.select\n# é€‰å®šæŒ‡å®šåˆ—å¹¶æŒ‰ç…§ä¸€å®šé¡ºåºå‘ˆç°\ndf.select(\"sex\", \"score\").show()\n\n# DataFrame.first\n# DataFrame.head\n# æŸ¥çœ‹ç¬¬1æ¡æ•°æ®\ndf.first()\n# Row(name='Sam', age=28, score=88, sex='M')\ndf.head(1)\n# [Row(name='Sam', age=28, score=88, sex='M')]\n\n\n# DataFrame.freqItems\n# æŸ¥çœ‹æŒ‡å®šåˆ—çš„æšä¸¾å€¼\ndf.freqItems([\"age\",\"sex\"]).show()\n# +---------------+-------------+\n# |  age_freqItems|sex_freqItems|\n# +---------------+-------------+\n# |[55, 1, 28, 54]|      [M, F,]|\n# +---------------+-------------+\n\n# DataFrame.summary\ndf.summary().show()\n# +-------+-----+------------------+------------------+----+\n# |summary| name|               age|             score| sex|\n# +-------+-----+------------------+------------------+----+\n# |  count|    5|                 5|                 5|   4|\n# |   mean| null|              33.2|              86.6|null|\n# | stddev| null|22.353970564532826|15.582040944625966|null|\n# |    min|Flora|                 1|                60|   F|\n# |    25%| null|                28|                88|null|\n# |    50%| null|                28|                90|null|\n# |    75%| null|                54|                95|null|\n# |    max|  Sam|                55|               100|   M|\n# +-------+-----+------------------+------------------+----+\n\n# DataFrame.sample\n# æŒ‰ç…§ä¸€å®šè§„åˆ™ä»dféšæœºæŠ½æ ·æ•°æ®\ndf.sample(0.5).show()\n# +-----+---+-----+----+\n# | name|age|score| sex|\n# +-----+---+-----+----+\n# |  Sam| 28|   88|   M|\n# |  Run|  1|   60|null|\n# |Peter| 55|  100|   M|\n# +-----+---+-----+----+\n```\n\n### ç®€å•å¤„ç†DataFrameçš„APIs\n\n```python\n# DataFrame.distinct\n# å¯¹æ•°æ®é›†è¿›è¡Œå»é‡\ndf.distinct().show()\n\n# DataFrame.dropDuplicates\n# å¯¹æŒ‡å®šåˆ—å»é‡\ndf.dropDuplicates([\"sex\"]).show()\n# +-----+---+-----+----+\n# | name|age|score| sex|\n# +-----+---+-----+----+\n# |Flora| 28|   90|   F|\n# |  Run|  1|   60|null|\n# |  Sam| 28|   88|   M|\n# +-----+---+-----+----+\n\n# DataFrame.exceptAll\n# DataFrame.subtract\n# æ ¹æ®æŒ‡å®šçš„dfå¯¹dfè¿›è¡Œå»é‡\ndf1 = spark.createDataFrame(\n        [(\"a\", 1), (\"a\", 1), (\"b\",  3), (\"c\", 4)], [\"C1\", \"C2\"])\ndf2 = spark.createDataFrame([(\"a\", 1), (\"b\", 3)], [\"C1\", \"C2\"])\ndf3 = df1.exceptAll(df2)  # æ²¡æœ‰å»é‡çš„åŠŸæ•ˆ\ndf4 = df1.subtract(df2)  # æœ‰å»é‡çš„å¥‡æ•ˆ\ndf1.show()\ndf2.show()\ndf3.show()\ndf4.show()\n# +---+---+\n# | C1| C2|\n# +---+---+\n# |  a|  1|\n# |  a|  1|\n# |  b|  3|\n# |  c|  4|\n# +---+---+\n# +---+---+\n# | C1| C2|\n# +---+---+\n# |  a|  1|\n# |  b|  3|\n# +---+---+\n# +---+---+\n# | C1| C2|\n# +---+---+\n# |  a|  1|\n# |  c|  4|\n# +---+---+\n# +---+---+\n# | C1| C2|\n# +---+---+\n# |  c|  4|\n# +---+---+\n\n# DataFrame.intersectAll\n# è¿”å›ä¸¤ä¸ªDataFrameçš„äº¤é›†\ndf1 = spark.createDataFrame(\n        [(\"a\", 1), (\"a\", 1), (\"b\",  3), (\"c\", 4)], [\"C1\", \"C2\"])\ndf2 = spark.createDataFrame([(\"a\", 1), (\"b\", 4)], [\"C1\", \"C2\"])\ndf1.intersectAll(df2).show()\n# +---+---+\n# | C1| C2|\n# +---+---+\n# |  a|  1|\n# +---+---+\n\n# DataFrame.drop\n# ä¸¢å¼ƒæŒ‡å®šåˆ—\ndf.drop('age').show()\n\n# DataFrame.withColumn\n# æ–°å¢åˆ—\ndf1 = df.withColumn(\"birth_year\", 2021 - df.age)\ndf1.show()\n# +-----+---+-----+----+----------+\n# | name|age|score| sex|birth_year|\n# +-----+---+-----+----+----------+\n# |  Sam| 28|   88|   M|      1993|\n# |Flora| 28|   90|   F|      1993|\n# |  Run|  1|   60|null|      2020|\n# |Peter| 55|  100|   M|      1966|\n# |  Mei| 54|   95|   F|      1967|\n# +-----+---+-----+----+----------+\n\n# DataFrame.withColumnRenamed\n# é‡å‘½ååˆ—å\ndf1 = df.withColumnRenamed(\"sex\", \"gender\")\ndf1.show()\n# +-----+---+-----+------+\n# | name|age|score|gender|\n# +-----+---+-----+------+\n# |  Sam| 28|   88|     M|\n# |Flora| 28|   90|     F|\n# |  Run|  1|   60|  null|\n# |Peter| 55|  100|     M|\n# |  Mei| 54|   95|     F|\n# +-----+---+-----+------+\n\n\n# DataFrame.dropna\n# ä¸¢å¼ƒç©ºå€¼ï¼ŒDataFrame.dropna(how='any', thresh=None, subset=None)\ndf.dropna(how='all', subset=['sex']).show()\n# +-----+---+-----+---+\n# | name|age|score|sex|\n# +-----+---+-----+---+\n# |  Sam| 28|   88|  M|\n# |Flora| 28|   90|  F|\n# |Peter| 55|  100|  M|\n# |  Mei| 54|   95|  F|\n# +-----+---+-----+---+\n\n# DataFrame.fillna\n# ç©ºå€¼å¡«å……æ“ä½œ\ndf1 = spark.createDataFrame(\n        [(\"a\", None), (\"a\", 1), (None,  3), (\"c\", 4)], [\"C1\", \"C2\"])\n# df2 = df1.na.fill({\"C1\": \"d\", \"C2\": 99})\ndf2 = df1.fillna({\"C1\": \"d\", \"C2\": 99})\ndf1.show()\ndf2.show()\n\n# DataFrame.filter\n# æ ¹æ®æ¡ä»¶è¿‡æ»¤\ndf.filter(df.age>50).show()\n# +-----+---+-----+---+\n# | name|age|score|sex|\n# +-----+---+-----+---+\n# |Peter| 55|  100|  M|\n# |  Mei| 54|   95|  F|\n# +-----+---+-----+---+\ndf.where(df.age==28).show()\n# +-----+---+-----+---+\n# | name|age|score|sex|\n# +-----+---+-----+---+\n# |  Sam| 28|   88|  M|\n# |Flora| 28|   90|  F|\n# +-----+---+-----+---+\ndf.filter(\"age<18\").show()\n# +----+---+-----+----+\n# |name|age|score| sex|\n# +----+---+-----+----+\n# | Run|  1|   60|null|\n# +----+---+-----+----+\n\n\n# DataFrame.join\n# è¿™ä¸ªä¸ç”¨å¤šè§£é‡Šäº†ï¼Œç›´æ¥ä¸Šæ¡ˆä¾‹æ¥çœ‹çœ‹å…·ä½“çš„è¯­æ³•å³å¯ï¼ŒDataFrame.join(other, on=None, how=None)\ndf1 = spark.createDataFrame(\n        [(\"a\", 1), (\"d\", 1), (\"b\",  3), (\"c\", 4)], [\"id\", \"num1\"])\ndf2 = spark.createDataFrame([(\"a\", 1), (\"b\", 3)], [\"id\", \"num2\"])\ndf1.join(df2, df1.id == df2.id, 'left').select(df1.id.alias(\"df1_id\"),\n                                               df1.num1.alias(\"df1_num\"),\n                                               df2.num2.alias(\"df2_num\")\n                                               ).sort([\"df1_id\"], ascending=False)\\\n    .show()\n\n\n# DataFrame.agg(*exprs)\n# èšåˆæ•°æ®ï¼Œå¯ä»¥å†™å¤šä¸ªèšåˆæ–¹æ³•ï¼Œå¦‚æœä¸å†™groupByçš„è¯å°±æ˜¯å¯¹æ•´ä¸ªDFè¿›è¡Œèšåˆ\n# DataFrame.alias\n# è®¾ç½®åˆ—æˆ–è€…DataFrameåˆ«å\n# DataFrame.groupBy\n# æ ¹æ®æŸå‡ åˆ—è¿›è¡Œèšåˆï¼Œå¦‚æœ‰å¤šåˆ—ç”¨åˆ—è¡¨å†™åœ¨ä¸€èµ·ï¼Œå¦‚ df.groupBy([\"sex\", \"age\"])\ndf.groupBy(\"sex\").agg(F.min(df.age).alias(\"æœ€å°å¹´é¾„\"),\n                      F.expr(\"avg(age)\").alias(\"å¹³å‡å¹´é¾„\"),\n                      F.expr(\"collect_list(name)\").alias(\"å§“åé›†åˆ\")\n                      ).show()\n# +----+--------+--------+------------+\n# | sex|æœ€å°å¹´é¾„|å¹³å‡å¹´é¾„|    å§“åé›†åˆ|\n# +----+--------+--------+------------+\n# |   F|      28|    41.0|[Flora, Mei]|\n# |null|       1|     1.0|       [Run]|\n# |   M|      28|    41.5|[Sam, Peter]|\n# +----+--------+--------+------------+\n\n\n# DataFrame.foreach\n# å¯¹æ¯ä¸€è¡Œè¿›è¡Œå‡½æ•°æ–¹æ³•çš„åº”ç”¨\ndef f(person):\n    print(person.name)\ndf.foreach(f)\n# Peter\n# Run\n# Sam\n# Flora\n# Mei\n\n# DataFrame.replace\n# ä¿®æ”¹dfé‡Œçš„æŸäº›å€¼\ndf1 = df.na.replace({\"M\": \"Male\", \"F\": \"Female\"})\ndf1.show()\n\n# DataFrame.union\n# ç›¸å½“äºSQLé‡Œçš„union allæ“ä½œ\ndf1 = spark.createDataFrame(\n        [(\"a\", 1), (\"d\", 1), (\"b\",  3), (\"c\", 4)], [\"id\", \"num\"])\ndf2 = spark.createDataFrame([(\"a\", 1), (\"b\", 3)], [\"id\", \"num\"])\ndf1.union(df2).show()\ndf1.unionAll(df2).show()\n# è¿™é‡Œunionæ²¡æœ‰å»é‡ï¼Œä¸çŸ¥é“ä¸ºå•¥ï¼Œæœ‰çŸ¥é“çš„æœ‹å‹éº»çƒ¦è§£é‡Šä¸‹ï¼Œè°¢è°¢äº†ã€‚\n# +---+---+\n# | id|num|\n# +---+---+\n# |  a|  1|\n# |  d|  1|\n# |  b|  3|\n# |  c|  4|\n# |  a|  1|\n# |  b|  3|\n# +---+---+\n\n# DataFrame.unionByName\n# æ ¹æ®åˆ—åæ¥è¿›è¡Œåˆå¹¶æ•°æ®é›†\ndf1 = spark.createDataFrame([[1, 2, 3]], [\"col0\", \"col1\", \"col2\"])\ndf2 = spark.createDataFrame([[4, 5, 6]], [\"col1\", \"col2\", \"col0\"])\ndf1.unionByName(df2).show()\n# +----+----+----+\n# |col0|col1|col2|\n# +----+----+----+\n# |   1|   2|   3|\n# |   6|   4|   5|\n# +----+----+----+\n```\n\n### DataFrameçš„åˆ—æ“ä½œAPIs\n\nè¿™é‡Œä¸»è¦é’ˆå¯¹çš„æ˜¯åˆ—è¿›è¡Œæ“ä½œï¼Œæ¯”å¦‚è¯´é‡å‘½åã€æ’åºã€ç©ºå€¼åˆ¤æ–­ã€ç±»å‹åˆ¤æ–­ç­‰\n\n```python\nColumn.alias(*alias, **kwargs)  # é‡å‘½ååˆ—å\nColumn.asc()  # æŒ‰ç…§åˆ—è¿›è¡Œå‡åºæ’åº\nColumn.desc()  # æŒ‰ç…§åˆ—è¿›è¡Œé™åºæ’åº\nColumn.astype(dataType)  # ç±»å‹è½¬æ¢\nColumn.cast(dataType)  # å¼ºåˆ¶è½¬æ¢ç±»å‹\nColumn.between(lowerBound, upperBound)  # è¿”å›å¸ƒå°”å€¼ï¼Œæ˜¯å¦åœ¨æŒ‡å®šåŒºé—´èŒƒå›´å†…\nColumn.contains(other)  # æ˜¯å¦åŒ…å«æŸä¸ªå…³é”®è¯\nColumn.endswith(other)  # ä»¥ä»€ä¹ˆç»“æŸçš„å€¼ï¼Œå¦‚ df.filter(df.name.endswith('ice')).collect()\nColumn.isNotNull()  # ç­›é€‰éç©ºçš„è¡Œ\nColumn.isNull()\nColumn.isin(*cols)  # è¿”å›åŒ…å«æŸäº›å€¼çš„è¡Œ df[df.name.isin(\"Bob\", \"Mike\")].collect()\nColumn.like(other)  # è¿”å›å«æœ‰å…³é”®è¯çš„è¡Œ\nColumn.when(condition, value)  # ç»™Trueçš„èµ‹å€¼\nColumn.otherwise(value)  # ä¸whenæ­é…ä½¿ç”¨ï¼Œdf.select(df.name, F.when(df.age > 3, 1).otherwise(0)).show()\nColumn.rlike(other)  # å¯ä»¥ä½¿ç”¨æ­£åˆ™çš„åŒ¹é… df.filter(df.name.rlike('ice$')).collect()\nColumn.startswith(other)  # df.filter(df.name.startswith('Al')).collect()\nColumn.substr(startPos, length)  # df.select(df.name.substr(1, 3).alias(\"col\")).collect()\n```\n\n### DataFrameçš„ä¸€äº›æ€è·¯å˜æ¢æ“ä½œAPIs\n\n```python\n# DataFrame.createOrReplaceGlobalTempView\n# DataFrame.dropGlobalTempView\n# åˆ›å»ºå…¨å±€çš„è¯•å›¾ï¼Œæ³¨å†Œåå¯ä»¥ä½¿ç”¨sqlè¯­å¥æ¥è¿›è¡Œæ“ä½œï¼Œç”Ÿå‘½å‘¨æœŸå–å†³äºSpark applicationæœ¬èº«\ndf.createOrReplaceGlobalTempView(\"people\")\nspark.sql(\"select * from global_temp.people where sex = 'M' \").show()\n# +-----+---+-----+---+\n# | name|age|score|sex|\n# +-----+---+-----+---+\n# |  Sam| 28|   88|  M|\n# |Peter| 55|  100|  M|\n# +-----+---+-----+---+\n\n# DataFrame.createOrReplaceTempView\n# DataFrame.dropTempView\n# åˆ›å»ºæœ¬åœ°ä¸´æ—¶è¯•å›¾ï¼Œç”Ÿå‘½å‘¨æœŸå–å†³äºç”¨æ¥åˆ›å»ºæ­¤æ•°æ®é›†çš„SparkSession\ndf.createOrReplaceTempView(\"tmp_people\")\nspark.sql(\"select * from tmp_people where sex = 'F' \").show()\n# +-----+---+-----+---+\n# | name|age|score|sex|\n# +-----+---+-----+---+\n# |Flora| 28|   90|  F|\n# |  Mei| 54|   95|  F|\n# +-----+---+-----+---+\n\n# DataFrame.cache\\DataFrame.persist\n# å¯ä»¥æŠŠä¸€äº›æ•°æ®æ”¾å…¥ç¼“å­˜ä¸­ï¼Œdefault storage level (MEMORY_AND_DISK).\ndf.cache()\ndf.persist()\ndf.unpersist()\n\n# DataFrame.crossJoin\n# è¿”å›ä¸¤ä¸ªDataFrameçš„ç¬›å¡å°”ç§¯å…³è”çš„DataFrame\ndf1 = df.select(\"name\", \"sex\")\ndf2 = df.select(\"name\", \"sex\")\ndf3 = df1.crossJoin(df2)\nprint(\"è¡¨1çš„è®°å½•æ•°\", df1.count())\nprint(\"è¡¨2çš„è®°å½•æ•°\", df2.count())\nprint(\"ç¬›å¡å°”ç§¯åçš„è®°å½•æ•°\", df3.count())\n# è¡¨1çš„è®°å½•æ•° 5\n# è¡¨2çš„è®°å½•æ•° 5\n# ç¬›å¡å°”ç§¯åçš„è®°å½•æ•° 25\n\n# DataFrame.toPandas\n# æŠŠSparkDataFrameè½¬ä¸º Pandasçš„DataFrame\ndf.toPandas()\n\n# DataFrame.rdd\n# æŠŠSparkDataFrameè½¬ä¸ºrddï¼Œè¿™æ ·å­å¯ä»¥ç”¨rddçš„è¯­æ³•æ¥æ“ä½œæ•°æ®\ndf.rdd\n```\n\n### DataFrameçš„ä¸€äº›ç»Ÿè®¡æ“ä½œAPIs\n\n```python\n# DataFrame.cov\n# è®¡ç®—æŒ‡å®šä¸¤åˆ—çš„æ ·æœ¬åæ–¹å·®\ndf.cov(\"age\", \"score\")\n# 324.59999999999997\n\n# DataFrame.corr\n# è®¡ç®—æŒ‡å®šä¸¤åˆ—çš„ç›¸å…³ç³»æ•°ï¼ŒDataFrame.corr(col1, col2, method=None)ï¼Œç›®å‰methodåªæ”¯æŒPearsonç›¸å…³ç³»æ•°\ndf.corr(\"age\", \"score\", method=\"pearson\")\n# 0.9319004030498815\n\n# DataFrame.cube\n# åˆ›å»ºå¤šç»´åº¦èšåˆçš„ç»“æœï¼Œé€šå¸¸ç”¨äºåˆ†ææ•°æ®ï¼Œæ¯”å¦‚æˆ‘ä»¬æŒ‡å®šä¸¤ä¸ªåˆ—è¿›è¡Œèšåˆï¼Œæ¯”å¦‚nameå’Œageï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°è¿”å›çš„èšåˆç»“æœä¼š\n# groupby(\"name\", \"age\")\n# groupby(\"name\")\n# groupby(\"age\")\n# groupby(all)\n# å››ä¸ªèšåˆç»“æœçš„union all çš„ç»“æœ\n\ndf1 = df.filter(df.name != \"Run\")\nprint(df1.show())\ndf1.cube(\"name\", \"sex\").count().show()\n# +-----+---+-----+---+\n# | name|age|score|sex|\n# +-----+---+-----+---+\n# |  Sam| 28|   88|  M|\n# |Flora| 28|   90|  F|\n# |Peter| 55|  100|  M|\n# |  Mei| 54|   95|  F|\n# +-----+---+-----+---+\n# cube èšåˆä¹‹åçš„ç»“æœ\n# +-----+----+-----+\n# | name| sex|count|\n# +-----+----+-----+\n# | null|   F|    2|\n# | null|null|    4|\n# |Flora|null|    1|\n# |Peter|null|    1|\n# | null|   M|    2|\n# |Peter|   M|    1|\n# |  Sam|   M|    1|\n# |  Sam|null|    1|\n# |  Mei|   F|    1|\n# |  Mei|null|    1|\n# |Flora|   F|    1|\n# +-----+----+-----+\n```\n\n## ä¿å­˜æ•°æ®/å†™å…¥æ•°æ®åº“\n\nè¿™é‡Œçš„ä¿å­˜æ•°æ®ä¸»è¦æ˜¯ä¿å­˜åˆ°Hiveä¸­çš„æ —å­ï¼Œä¸»è¦åŒ…æ‹¬äº†overwriteã€appendç­‰æ–¹å¼ã€‚\n\n### å½“ç»“æœé›†ä¸ºSparkDataFrameçš„æ—¶å€™\n\n```python\nimport pandas as pd\nfrom datetime import datetime\nfrom pyspark import SparkConf\nfrom pyspark import SparkContext\nfrom pyspark.sql import HiveContext\n\nconf = SparkConf()\\\n      .setAppName(\"test\")\\\n      .set(\"hive.exec.dynamic.partition.mode\", \"nonstrict\") # åŠ¨æ€å†™å…¥hiveåˆ†åŒºè¡¨\nsc = SparkContext(conf=conf)\nhc = HiveContext(sc)\nsc.setLogLevel(\"ERROR\")\n    \nlist_values = [['Sam', 28, 88], ['Flora', 28, 90], ['Run', 1, 60]]\nSpark_df = spark.createDataFrame(list_values, ['name', 'age', 'score'])\nprint(Spark_df.show())\nsave_table = \"tmp.samshare_pyspark_savedata\"\n\n# æ–¹å¼1:ç›´æ¥å†™å…¥åˆ°Hive\nSpark_df.write.format(\"hive\").mode(\"overwrite\").saveAsTable(save_table) # æˆ–è€…æ”¹æˆappendæ¨¡å¼\nprint(datetime.now().strftime(\"%y/%m/%d %H:%M:%S\"), \"æµ‹è¯•æ•°æ®å†™å…¥åˆ°è¡¨\" + save_table)\n\n# æ–¹å¼2:æ³¨å†Œä¸ºä¸´æ—¶è¡¨ï¼Œä½¿ç”¨SparkSQLæ¥å†™å…¥åˆ†åŒºè¡¨\nSpark_df.createOrReplaceTempView(\"tmp_table\")\nwrite_sql = \"\"\"\ninsert overwrite table {0} partitions (pt_date='{1}')\nselect * from tmp_table\n\"\"\".format(save_table, \"20210520\")\nhc.sql(write_sql)\nprint(datetime.now().strftime(\"%y/%m/%d %H:%M:%S\"), \"æµ‹è¯•æ•°æ®å†™å…¥åˆ°è¡¨\" + save_table)\n```\n\n### å½“ç»“æœé›†ä¸ºPythonçš„DataFrameçš„æ—¶å€™\n\nå¦‚æœæ˜¯Pythonçš„DataFrameï¼Œæˆ‘ä»¬å°±éœ€è¦å¤šåšä¸€æ­¥æŠŠå®ƒè½¬æ¢ä¸ºSparkDataFrameï¼Œå…¶ä½™æ“ä½œå°±ä¸€æ ·äº†ã€‚\n\n```python\nimport pandas as pd\nfrom datetime import datetime\nfrom pyspark import SparkConf\nfrom pyspark import SparkContext\nfrom pyspark.sql import HiveContext\n\nconf = SparkConf()\\\n      .setAppName(\"test\")\\\n      .set(\"hive.exec.dynamic.partition.mode\", \"nonstrict\") # åŠ¨æ€å†™å…¥hiveåˆ†åŒºè¡¨\nsc = SparkContext(conf=conf)\nhc = HiveContext(sc)\nsc.setLogLevel(\"ERROR\")\n    \nresult_df = pd.DataFrame([1,2,3], columns=['a'])\nsave_table = \"tmp.samshare_pyspark_savedata\"\n\n# è·å–DataFrameçš„schema\nc1 = list(result_df.columns)\n# è½¬ä¸ºSparkDataFrame\nresult = hc.createDataFrame(result_df.astype(str), c1)\nresult.write.format(\"hive\").mode(\"overwrite\").saveAsTable(save_table) # æˆ–è€…æ”¹æˆappendæ¨¡å¼\nprint(datetime.now().strftime(\"%y/%m/%d %H:%M:%S\"), \"æµ‹è¯•æ•°æ®å†™å…¥åˆ°è¡¨\" + save_table)\n```\n\n## Spark è°ƒä¼˜æ€è·¯\n\n![è°ƒä¼˜](./PySparkåŸºç¡€001/è°ƒä¼˜æ€ç»´å¯¼å›¾.jpg)\n\n### å¼€å‘ä¹ æƒ¯ä¼˜åŒ–\n\n#### å°½å¯èƒ½ä½¿ç”¨åŒä¸€RDDï¼Œé¿å…é‡å¤åˆ›å»ºï¼Œå¹¶ä¸”é€‚å½“æŒä¹…åŒ–æ•°æ®\n\nè¿™ç§å¼€å‘ä¹ æƒ¯æ˜¯éœ€è¦æˆ‘ä»¬å¯¹äºå³å°†è¦å¼€å‘çš„åº”ç”¨é€»è¾‘æœ‰æ¯”è¾ƒæ·±åˆ»çš„æ€è€ƒï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡code reviewæ¥å‘ç°çš„ï¼Œè®²ç™½äº†å°±æ˜¯è¦è®°å¾—æˆ‘ä»¬åˆ›å»ºè¿‡å•¥æ•°æ®é›†ï¼Œå¯ä»¥å¤ç”¨çš„å°½é‡å¹¿æ’­ï¼ˆbroadcastï¼‰ä¸‹ï¼Œèƒ½å¾ˆå¥½æå‡æ€§èƒ½ã€‚\n\n```python\n# æœ€ä½çº§å†™æ³•ï¼Œç›¸åŒæ•°æ®é›†é‡å¤åˆ›å»ºã€‚\nrdd1 = sc.textFile(\"./test/data/hello_samshare.txt\", 4) # è¿™é‡Œçš„ 4 æŒ‡çš„æ˜¯åˆ†åŒºæ•°é‡\nrdd2 = sc.textFile(\"./test/data/hello_samshare.txt\", 4) # è¿™é‡Œçš„ 4 æŒ‡çš„æ˜¯åˆ†åŒºæ•°é‡\nprint(rdd1.take(10))\nprint(rdd2.map(lambda x:x[0:1]).take(10))\n\n# ç¨å¾®è¿›é˜¶ä¸€äº›ï¼Œå¤ç”¨ç›¸åŒæ•°æ®é›†ï¼Œä½†å› ä¸­é—´ç»“æœæ²¡æœ‰ç¼“å­˜ï¼Œæ•°æ®ä¼šé‡å¤è®¡ç®—\nrdd1 = sc.textFile(\"./test/data/hello_samshare.txt\", 4) # è¿™é‡Œçš„ 4 æŒ‡çš„æ˜¯åˆ†åŒºæ•°é‡\nprint(rdd1.take(10))\nprint(rdd1.map(lambda x:x[0:1]).take(10))\n\n# ç›¸å¯¹æ¯”è¾ƒé«˜æ•ˆï¼Œä½¿ç”¨ç¼“å­˜æ¥æŒä¹…åŒ–æ•°æ®\nrdd = sc.parallelize(range(1, 11), 4).cache()  # æˆ–è€…persist()\nrdd_map = rdd.map(lambda x: x*2)\nrdd_reduce = rdd.reduce(lambda x, y: x+y)\nprint(rdd_map.take(10))\nprint(rdd_reduce)\n```\n\nä¸‹é¢æˆ‘ä»¬å°±æ¥å¯¹æ¯”ä¸€ä¸‹ä½¿ç”¨ç¼“å­˜èƒ½ç»™æˆ‘ä»¬çš„Sparkç¨‹åºå¸¦æ¥å¤šå¤§çš„æ•ˆç‡æå‡å§ï¼Œæˆ‘ä»¬å…ˆæ„é€ ä¸€ä¸ªç¨‹åºè¿è¡Œæ—¶é•¿æµ‹é‡å™¨ã€‚\n\n```python\nimport time\n# ç»Ÿè®¡ç¨‹åºè¿è¡Œæ—¶é—´\ndef time_me(info=\"used\"):\n    def _time_me(fn):\n        @functools.wraps(fn)\n        def _wrapper(*args, **kwargs):\n            start = time.time()\n            fn(*args, **kwargs)\n            print(\"%s %s %s\" % (fn.__name__, info, time.time() - start), \"second\")\n        return _wrapper\n    return _time_me\n```\n\nä¸‹é¢æˆ‘ä»¬è¿è¡Œä¸‹é¢çš„ä»£ç ï¼Œçœ‹ä¸‹ä½¿ç”¨äº†cacheå¸¦æ¥çš„æ•ˆç‡æå‡ï¼š\n\n```python\n@time_me()\ndef test(types=0):\n    if types == 1:\n        print(\"ä½¿ç”¨æŒä¹…åŒ–ç¼“å­˜\")\n        rdd = sc.parallelize(range(1, 10000000), 4)\n        rdd1 = rdd.map(lambda x: x*x + 2*x + 1).cache()  # æˆ–è€… persist(StorageLevel.MEMORY_AND_DISK_SER)\n        print(rdd1.take(10))\n        rdd2 = rdd1.reduce(lambda x, y: x+y)\n        rdd3 = rdd1.reduce(lambda x, y: x + y)\n        rdd4 = rdd1.reduce(lambda x, y: x + y)\n        rdd5 = rdd1.reduce(lambda x, y: x + y)\n        print(rdd5)\n    else:\n        print(\"ä¸ä½¿ç”¨æŒä¹…åŒ–ç¼“å­˜\")\n        rdd = sc.parallelize(range(1, 10000000), 4)\n        rdd1 = rdd.map(lambda x: x * x + 2 * x + 1)\n        print(rdd1.take(10))\n        rdd2 = rdd1.reduce(lambda x, y: x + y)\n        rdd3 = rdd1.reduce(lambda x, y: x + y)\n        rdd4 = rdd1.reduce(lambda x, y: x + y)\n        rdd5 = rdd1.reduce(lambda x, y: x + y)\n        print(rdd5)\n\n        \ntest()   # ä¸ä½¿ç”¨æŒä¹…åŒ–ç¼“å­˜\ntime.sleep(10)\ntest(1)  # ä½¿ç”¨æŒä¹…åŒ–ç¼“å­˜\n# output:\n# ä½¿ç”¨æŒä¹…åŒ–ç¼“å­˜\n# [4, 9, 16, 25, 36, 49, 64, 81, 100, 121]\n# 333333383333334999999\n# test used 26.36529278755188 second\n# ä½¿ç”¨æŒä¹…åŒ–ç¼“å­˜\n# [4, 9, 16, 25, 36, 49, 64, 81, 100, 121]\n# 333333383333334999999\n# test used 17.49532413482666 second\n```\n\nå› ä¸ºæˆ‘ä»¬çš„ä»£ç æ˜¯éœ€è¦é‡å¤è°ƒç”¨RDD1çš„ï¼Œå½“æ²¡æœ‰å¯¹RDD1è¿›è¡ŒæŒä¹…åŒ–çš„æ—¶å€™ï¼Œæ¯æ¬¡å½“å®ƒè¢«actionç®—å­æ¶ˆè´¹äº†ä¹‹åï¼Œå°±é‡Šæ”¾äº†ï¼Œç­‰ä¸‹ä¸€ä¸ªç®—å­è®¡ç®—çš„æ—¶å€™è¦ç”¨ï¼Œå°±ä»å¤´å¼€å§‹è®¡ç®—ä¸€ä¸‹RDD1ã€‚ä»£ç ä¸­éœ€è¦é‡å¤è°ƒç”¨RDD1 äº”æ¬¡ï¼Œæ‰€ä»¥æ²¡æœ‰ç¼“å­˜çš„è¯ï¼Œå·®ä¸å¤šæ¯æ¬¡éƒ½è¦6ç§’ï¼Œæ€»å…±éœ€è¦è€—æ—¶26ç§’å·¦å³ï¼Œä½†æ˜¯ï¼Œåšäº†ç¼“å­˜ï¼Œæ¯æ¬¡å°±åªéœ€è¦3sä¸åˆ°ï¼Œæ€»å…±éœ€è¦è€—æ—¶17ç§’å·¦å³ã€‚\n\nå¦å¤–ï¼Œè¿™é‡Œéœ€è¦æåŠä¸€ä¸‹ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œé‚£å°±æ˜¯æŒä¹…åŒ–çš„çº§åˆ«ï¼Œä¸€èˆ¬cacheçš„è¯å°±æ˜¯æ”¾å…¥å†…å­˜ä¸­ï¼Œå°±æ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ï¼Œéœ€è¦è®²ä¸€ä¸‹çš„å°±æ˜¯å¦å¤–ä¸€ä¸ª persist()ï¼Œå®ƒçš„æŒä¹…åŒ–çº§åˆ«æ˜¯å¯ä»¥è¢«æˆ‘ä»¬æ‰€é…ç½®çš„ï¼š\n| å­˜å‚¨çº§åˆ« | è¯´æ˜ |\n| -- | -- |\n| MEMORY_ONLY | ä½¿ç”¨æœªåºåˆ—åŒ–çš„Javaå¯¹è±¡æ ¼å¼ï¼Œå°†æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚å¦‚æœå†…å­˜ä¸å¤Ÿå­˜æ”¾æ‰€æœ‰çš„æ•°æ®ï¼Œåˆ™æ•°æ®å¯èƒ½å°±ä¸ä¼šè¿›è¡ŒæŒä¹…åŒ–ã€‚é‚£ä¹ˆä¸‹æ¬¡å¯¹è¿™ä¸ªRDDæ‰§è¡Œç®—å­æ“ä½œæ—¶ï¼Œé‚£äº›æ²¡æœ‰è¢«æŒä¹…åŒ–çš„æ•°æ®ï¼Œéœ€è¦ä»æºå¤´å¤„é‡æ–°è®¡ç®—ä¸€éã€‚è¿™æ˜¯é»˜è®¤çš„æŒä¹…åŒ–ç­–ç•¥ï¼Œä½¿ç”¨cache()æ–¹æ³•æ—¶ï¼Œå®é™…å°±æ˜¯ä½¿ç”¨çš„è¿™ç§æŒä¹…åŒ–ç­–ç•¥ã€‚ |\n| MEMORY_AND_DISK | ä½¿ç”¨æœªåºåˆ—åŒ–çš„Javaå¯¹è±¡æ ¼å¼ï¼Œä¼˜å…ˆå°è¯•å°†æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚å¦‚æœå†…å­˜ä¸å¤Ÿå­˜æ”¾æ‰€æœ‰çš„æ•°æ®ï¼Œä¼šå°†æ•°æ®å†™å…¥ç£ç›˜æ–‡ä»¶ä¸­ï¼Œä¸‹æ¬¡å¯¹è¿™ä¸ªRDDæ‰§è¡Œç®—å­æ—¶ï¼ŒæŒä¹…åŒ–åœ¨ç£ç›˜æ–‡ä»¶ä¸­çš„æ•°æ®ä¼šè¢«è¯»å–å‡ºæ¥ä½¿ç”¨ã€‚ |\n| MEMORY_ONLY_SER | åŸºæœ¬å«ä¹‰åŒMEMORY_ONLYã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œä¼šå°†RDDä¸­çš„æ•°æ®è¿›è¡Œåºåˆ—åŒ–ï¼ŒRDDçš„æ¯ä¸ªpartitionä¼šè¢«åºåˆ—åŒ–æˆä¸€ä¸ªå­—èŠ‚æ•°ç»„ã€‚è¿™ç§æ–¹å¼æ›´åŠ èŠ‚çœå†…å­˜ï¼Œä»è€Œå¯ä»¥é¿å…æŒä¹…åŒ–çš„æ•°æ®å ç”¨è¿‡å¤šå†…å­˜å¯¼è‡´é¢‘ç¹GCã€‚ |\n| MEMORY_AND_DISK_SER | åŸºæœ¬å«ä¹‰åŒMEMORY_AND_DISKã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œä¼šå°†RDDä¸­çš„æ•°æ®è¿›è¡Œåºåˆ—åŒ–ï¼ŒRDDçš„æ¯ä¸ªpartitionä¼šè¢«åºåˆ—åŒ–æˆä¸€ä¸ªå­—èŠ‚æ•°ç»„ã€‚è¿™ç§æ–¹å¼æ›´åŠ èŠ‚çœå†…å­˜ï¼Œä»è€Œå¯ä»¥é¿å…æŒä¹…åŒ–çš„æ•°æ®å ç”¨è¿‡å¤šå†…å­˜å¯¼è‡´é¢‘ç¹GCã€‚|\n| DISK_ONLY | ä½¿ç”¨æœªåºåˆ—åŒ–çš„Javaå¯¹è±¡æ ¼å¼ï¼Œå°†æ•°æ®å…¨éƒ¨å†™å…¥ç£ç›˜æ–‡ä»¶ä¸­ã€‚ |\n| MEMORY_ONLY_2ï¼ŒMEMORY_AND_DISK_2ï¼Œç­‰ç­‰ | å¯¹äºä¸Šè¿°ä»»æ„ä¸€ç§æŒä¹…åŒ–ç­–ç•¥ï¼Œå¦‚æœåŠ ä¸Šåç¼€_2ï¼Œä»£è¡¨çš„æ˜¯å°†æ¯ä¸ªæŒä¹…åŒ–çš„æ•°æ®ï¼Œéƒ½å¤åˆ¶ä¸€ä»½å‰¯æœ¬ï¼Œå¹¶å°†å‰¯æœ¬ä¿å­˜åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šã€‚è¿™ç§åŸºäºå‰¯æœ¬çš„æŒä¹…åŒ–æœºåˆ¶ä¸»è¦ç”¨äºè¿›è¡Œå®¹é”™ã€‚å‡å¦‚æŸä¸ªèŠ‚ç‚¹æŒ‚æ‰ï¼ŒèŠ‚ç‚¹çš„å†…å­˜æˆ–ç£ç›˜ä¸­çš„æŒä¹…åŒ–æ•°æ®ä¸¢å¤±äº†ï¼Œé‚£ä¹ˆåç»­å¯¹RDDè®¡ç®—æ—¶è¿˜å¯ä»¥ä½¿ç”¨è¯¥æ•°æ®åœ¨å…¶ä»–èŠ‚ç‚¹ä¸Šçš„å‰¯æœ¬ã€‚å¦‚æœæ²¡æœ‰å‰¯æœ¬çš„è¯ï¼Œå°±åªèƒ½å°†è¿™äº›æ•°æ®ä»æºå¤´å¤„é‡æ–°è®¡ç®—ä¸€éäº†ã€‚ |\n\n#### å°½é‡é¿å…ä½¿ç”¨ä½æ€§èƒ½ç®—å­\n\nshuffleç±»ç®—å­ç®—æ˜¯ä½æ€§èƒ½ç®—å­çš„ä¸€ç§ä»£è¡¨ï¼Œå¦‚æœæœ‰å¯èƒ½çš„è¯ï¼Œè¦å°½é‡é¿å…ä½¿ç”¨shuffleç±»ç®—å­ã€‚å› ä¸ºSparkä½œä¸šè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ€æ¶ˆè€—æ€§èƒ½çš„åœ°æ–¹å°±æ˜¯shuffleè¿‡ç¨‹ã€‚shuffleè¿‡ç¨‹ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å°†åˆ†å¸ƒåœ¨é›†ç¾¤ä¸­å¤šä¸ªèŠ‚ç‚¹ä¸Šçš„åŒä¸€ä¸ªkeyï¼Œæ‹‰å–åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè¿›è¡Œèšåˆæˆ–joinç­‰æ“ä½œã€‚æ¯”å¦‚reduceByKeyã€joinç­‰ç®—å­ï¼Œéƒ½ä¼šè§¦å‘shuffleæ“ä½œã€‚\n\nshuffleè¿‡ç¨‹ä¸­ï¼Œå„ä¸ªèŠ‚ç‚¹ä¸Šçš„ç›¸åŒkeyéƒ½ä¼šå…ˆå†™å…¥æœ¬åœ°ç£ç›˜æ–‡ä»¶ä¸­ï¼Œç„¶åå…¶ä»–èŠ‚ç‚¹éœ€è¦é€šè¿‡ç½‘ç»œä¼ è¾“æ‹‰å–å„ä¸ªèŠ‚ç‚¹ä¸Šçš„ç£ç›˜æ–‡ä»¶ä¸­çš„ç›¸åŒkeyã€‚è€Œä¸”ç›¸åŒkeyéƒ½æ‹‰å–åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œèšåˆæ“ä½œæ—¶ï¼Œè¿˜æœ‰å¯èƒ½ä¼šå› ä¸ºä¸€ä¸ªèŠ‚ç‚¹ä¸Šå¤„ç†çš„keyè¿‡å¤šï¼Œå¯¼è‡´å†…å­˜ä¸å¤Ÿå­˜æ”¾ï¼Œè¿›è€Œæº¢å†™åˆ°ç£ç›˜æ–‡ä»¶ä¸­ã€‚å› æ­¤åœ¨shuffleè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå¤§é‡çš„ç£ç›˜æ–‡ä»¶è¯»å†™çš„IOæ“ä½œï¼Œä»¥åŠæ•°æ®çš„ç½‘ç»œä¼ è¾“æ“ä½œã€‚ç£ç›˜IOå’Œç½‘ç»œæ•°æ®ä¼ è¾“ä¹Ÿæ˜¯shuffleæ€§èƒ½è¾ƒå·®çš„ä¸»è¦åŸå› ã€‚\n\nå› æ­¤åœ¨æˆ‘ä»¬çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œèƒ½é¿å…åˆ™å°½å¯èƒ½é¿å…ä½¿ç”¨reduceByKeyã€joinã€distinctã€repartitionç­‰ä¼šè¿›è¡Œshuffleçš„ç®—å­ï¼Œå°½é‡ä½¿ç”¨mapç±»çš„éshuffleç®—å­ã€‚è¿™æ ·çš„è¯ï¼Œæ²¡æœ‰shuffleæ“ä½œæˆ–è€…ä»…æœ‰è¾ƒå°‘shuffleæ“ä½œçš„Sparkä½œä¸šï¼Œå¯ä»¥å¤§å¤§å‡å°‘æ€§èƒ½å¼€é”€ã€‚\n\n###### Broadcastä¸mapè¿›è¡Œjoinä»£ç ç¤ºä¾‹\n\n```scala\n// ä¼ ç»Ÿçš„joinæ“ä½œä¼šå¯¼è‡´shuffleæ“ä½œã€‚\n// å› ä¸ºä¸¤ä¸ªRDDä¸­ï¼Œç›¸åŒçš„keyéƒ½éœ€è¦é€šè¿‡ç½‘ç»œæ‹‰å–åˆ°ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œç”±ä¸€ä¸ªtaskè¿›è¡Œjoinæ“ä½œã€‚\nval rdd3 = rdd1.join(rdd2)\n\n// Broadcast+mapçš„joinæ“ä½œï¼Œä¸ä¼šå¯¼è‡´shuffleæ“ä½œã€‚\n// ä½¿ç”¨Broadcastå°†ä¸€ä¸ªæ•°æ®é‡è¾ƒå°çš„RDDä½œä¸ºå¹¿æ’­å˜é‡ã€‚\nval rdd2Data = rdd2.collect()\nval rdd2DataBroadcast = sc.broadcast(rdd2Data)\n\n// åœ¨rdd1.mapç®—å­ä¸­ï¼Œå¯ä»¥ä»rdd2DataBroadcastä¸­ï¼Œè·å–rdd2çš„æ‰€æœ‰æ•°æ®ã€‚\n// ç„¶åè¿›è¡Œéå†ï¼Œå¦‚æœå‘ç°rdd2ä¸­æŸæ¡æ•°æ®çš„keyä¸rdd1çš„å½“å‰æ•°æ®çš„keyæ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆå°±åˆ¤å®šå¯ä»¥è¿›è¡Œjoinã€‚\n// æ­¤æ—¶å°±å¯ä»¥æ ¹æ®è‡ªå·±éœ€è¦çš„æ–¹å¼ï¼Œå°†rdd1å½“å‰æ•°æ®ä¸rdd2ä¸­å¯ä»¥è¿æ¥çš„æ•°æ®ï¼Œæ‹¼æ¥åœ¨ä¸€èµ·ï¼ˆStringæˆ–Tupleï¼‰ã€‚\nval rdd3 = rdd1.map(rdd2DataBroadcast...)\n\n// æ³¨æ„ï¼Œä»¥ä¸Šæ“ä½œï¼Œå»ºè®®ä»…ä»…åœ¨rdd2çš„æ•°æ®é‡æ¯”è¾ƒå°‘ï¼ˆæ¯”å¦‚å‡ ç™¾Mï¼Œæˆ–è€…ä¸€ä¸¤Gï¼‰çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚\n// å› ä¸ºæ¯ä¸ªExecutorçš„å†…å­˜ä¸­ï¼Œéƒ½ä¼šé©»ç•™ä¸€ä»½rdd2çš„å…¨é‡æ•°æ®ã€‚\n\n```\n\n```python\n# åŸåˆ™2ï¼šå°½é‡é¿å…ä½¿ç”¨ä½æ€§èƒ½ç®—å­\nrdd1 = sc.parallelize([('A1', 211), ('A1', 212), ('A2', 22), ('A4', 24), ('A5', 25)])\nrdd2 = sc.parallelize([('A1', 11), ('A2', 12), ('A3', 13), ('A4', 14)])\n# ä½æ•ˆçš„å†™æ³•ï¼Œä¹Ÿæ˜¯ä¼ ç»Ÿçš„å†™æ³•ï¼Œç›´æ¥join\nrdd_join = rdd1.join(rdd2)\nprint(rdd_join.collect())\n# [('A4', (24, 14)), ('A2', (22, 12)), ('A1', (211, 11)), ('A1', (212, 11))]\nrdd_left_join = rdd1.leftOuterJoin(rdd2)\nprint(rdd_left_join.collect())\n# [('A4', (24, 14)), ('A2', (22, 12)), ('A5', (25, None)), ('A1', (211, 11)), ('A1', (212, 11))]\nrdd_full_join = rdd1.fullOuterJoin(rdd2)\nprint(rdd_full_join.collect())\n# [('A4', (24, 14)), ('A3', (None, 13)), ('A2', (22, 12)), ('A5', (25, None)), ('A1', (211, 11)), ('A1', (212, 11))]\n\n# é«˜æ•ˆçš„å†™æ³•ï¼Œä½¿ç”¨å¹¿æ’­+mapæ¥å®ç°ç›¸åŒæ•ˆæœ\n# tips1: è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”¨æ¥broadcastçš„RDDä¸å¯ä»¥å¤ªå¤§ï¼Œæœ€å¥½ä¸è¦è¶…è¿‡1G\n# tips2: è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”¨æ¥broadcastçš„RDDä¸å¯ä»¥æœ‰é‡å¤çš„keyçš„\nrdd1 = sc.parallelize([('A1', 11), ('A2', 12), ('A3', 13), ('A4', 14)])\nrdd2 = sc.parallelize([('A1', 211), ('A1', 212), ('A2', 22), ('A4', 24), ('A5', 25)])\n\n# step1ï¼š å…ˆå°†å°è¡¨è¿›è¡Œå¹¿æ’­ï¼Œä¹Ÿå°±æ˜¯collectåˆ°driverç«¯ï¼Œç„¶åå¹¿æ’­åˆ°æ¯ä¸ªExecutorä¸­å»ã€‚\nrdd_small_bc = sc.broadcast(rdd1.collect())\n\n# step2ï¼šä»Executorä¸­è·å–å­˜å…¥å­—å…¸ä¾¿äºåç»­mapæ“ä½œ\nrdd_small_dict = dict(rdd_small_bc.value)\n\n# step3ï¼šå®šä¹‰joinæ–¹æ³•\ndef broadcast_join(line, rdd_small_dict, join_type):\n    k = line[0]\n    v = line[1]\n    small_table_v = rdd_small_dict[k] if k in rdd_small_dict else None\n    if join_type == 'join':\n        return (k, (v, small_table_v)) if k in rdd_small_dict else None\n    elif join_type == 'left_join':\n        return (k, (v, small_table_v if small_table_v is not None else None))\n    else:\n        print(\"not support join type!\")\n\n# step4ï¼šä½¿ç”¨ map å®ç° ä¸¤ä¸ªè¡¨joinçš„åŠŸèƒ½\nrdd_join = rdd2.map(lambda line: broadcast_join(line, rdd_small_dict, \"join\")).filter(lambda line: line is not None)\nrdd_left_join = rdd2.map(lambda line: broadcast_join(line, rdd_small_dict, \"left_join\")).filter(lambda line: line is not None)\nprint(rdd_join.collect())\nprint(rdd_left_join.collect())\n# [('A1', (211, 11)), ('A1', (212, 11)), ('A2', (22, 12)), ('A4', (24, 14))]\n# [('A1', (211, 11)), ('A1', (212, 11)), ('A2', (22, 12)), ('A4', (24, 14)), ('A5', (25, None))]\n```\n\nä¸Šé¢çš„RDD joinè¢«æ”¹å†™ä¸º broadcast+mapçš„PySparkç‰ˆæœ¬å®ç°ï¼Œä¸è¿‡é‡Œé¢æœ‰ä¸¤ä¸ªç‚¹éœ€è¦æ³¨æ„ï¼š\n\n- tips1: ç”¨æ¥broadcastçš„RDDä¸å¯ä»¥å¤ªå¤§ï¼Œæœ€å¥½ä¸è¦è¶…è¿‡1G\n- tips2: ç”¨æ¥broadcastçš„RDDä¸å¯ä»¥æœ‰é‡å¤çš„keyçš„\n\n#### ä½¿ç”¨map-sideé¢„èšåˆçš„shuffleæ“ä½œ\n\nå¦‚æœå› ä¸ºä¸šåŠ¡éœ€è¦ï¼Œä¸€å®šè¦ä½¿ç”¨shuffleæ“ä½œï¼Œæ— æ³•ç”¨mapç±»çš„ç®—å­æ¥æ›¿ä»£ï¼Œé‚£ä¹ˆå°½é‡ä½¿ç”¨å¯ä»¥map-sideé¢„èšåˆçš„ç®—å­ã€‚\n\næ‰€è°“çš„map-sideé¢„èšåˆï¼Œè¯´çš„æ˜¯åœ¨æ¯ä¸ªèŠ‚ç‚¹æœ¬åœ°å¯¹ç›¸åŒçš„keyè¿›è¡Œä¸€æ¬¡èšåˆæ“ä½œï¼Œç±»ä¼¼äºMapReduceä¸­çš„æœ¬åœ°combinerã€‚map-sideé¢„èšåˆä¹‹åï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ¬åœ°å°±åªä¼šæœ‰ä¸€æ¡ç›¸åŒçš„keyï¼Œå› ä¸ºå¤šæ¡ç›¸åŒçš„keyéƒ½è¢«èšåˆèµ·æ¥äº†ã€‚å…¶ä»–èŠ‚ç‚¹åœ¨æ‹‰å–æ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„ç›¸åŒkeyæ—¶ï¼Œå°±ä¼šå¤§å¤§å‡å°‘éœ€è¦æ‹‰å–çš„æ•°æ®æ•°é‡ï¼Œä»è€Œä¹Ÿå°±å‡å°‘äº†ç£ç›˜IOä»¥åŠç½‘ç»œä¼ è¾“å¼€é”€ã€‚é€šå¸¸æ¥è¯´ï¼Œåœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œå»ºè®®ä½¿ç”¨reduceByKeyæˆ–è€…aggregateByKeyç®—å­æ¥æ›¿ä»£æ‰groupByKeyç®—å­ã€‚å› ä¸ºreduceByKeyå’ŒaggregateByKeyç®—å­éƒ½ä¼šä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„å‡½æ•°å¯¹æ¯ä¸ªèŠ‚ç‚¹æœ¬åœ°çš„ç›¸åŒkeyè¿›è¡Œé¢„èšåˆã€‚è€ŒgroupByKeyç®—å­æ˜¯ä¸ä¼šè¿›è¡Œé¢„èšåˆçš„ï¼Œå…¨é‡çš„æ•°æ®ä¼šåœ¨é›†ç¾¤çš„å„ä¸ªèŠ‚ç‚¹ä¹‹é—´åˆ†å‘å’Œä¼ è¾“ï¼Œæ€§èƒ½ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå·®ã€‚\n\næ¯”å¦‚ä¸‹ä¸¤å¹…å›¾ï¼Œå°±æ˜¯å…¸å‹çš„ä¾‹å­ï¼Œåˆ†åˆ«åŸºäºreduceByKeyå’ŒgroupByKeyè¿›è¡Œå•è¯è®¡æ•°ã€‚å…¶ä¸­ç¬¬ä¸€å¼ å›¾æ˜¯groupByKeyçš„åŸç†å›¾ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ²¡æœ‰è¿›è¡Œä»»ä½•æœ¬åœ°èšåˆæ—¶ï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¼šåœ¨é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´ä¼ è¾“ï¼›ç¬¬äºŒå¼ å›¾æ˜¯reduceByKeyçš„åŸç†å›¾ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ¬åœ°çš„ç›¸åŒkeyæ•°æ®ï¼Œéƒ½è¿›è¡Œäº†é¢„èšåˆï¼Œç„¶åæ‰ä¼ è¾“åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šè¿›è¡Œå…¨å±€èšåˆã€‚\n\n![groupByKeyåŸç†](./PySparkåŸºç¡€001/map-side-shuffle0.png)\n![reduceByKeyåŸç†](./PySparkåŸºç¡€001/map-side-shuffle1.png)\n\n#### å°½é‡ä½¿ç”¨é«˜æ€§èƒ½ç®—å­\n\né™¤äº†shuffleç›¸å…³çš„ç®—å­æœ‰ä¼˜åŒ–åŸåˆ™ä¹‹å¤–ï¼Œå…¶ä»–çš„ç®—å­ä¹Ÿéƒ½æœ‰ç€ç›¸åº”çš„ä¼˜åŒ–åŸåˆ™ã€‚\n\n##### ä½¿ç”¨reduceByKey/aggregateByKeyæ›¿ä»£groupByKey\n\nè¯¦æƒ…è§ï¼šä½¿ç”¨map-sideé¢„èšåˆçš„shuffleæ“ä½œã€‚\n\n##### ä½¿ç”¨mapPartitionsæ›¿ä»£æ™®é€šmap\n\nmapPartitionsç±»çš„ç®—å­ï¼Œä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¼šå¤„ç†ä¸€ä¸ªpartitionæ‰€æœ‰çš„æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨å¤„ç†ä¸€æ¡ï¼Œæ€§èƒ½ç›¸å¯¹æ¥è¯´ä¼šé«˜ä¸€äº›ã€‚ä½†æ˜¯æœ‰çš„æ—¶å€™ï¼Œä½¿ç”¨mapPartitionsä¼šå‡ºç°OOMï¼ˆå†…å­˜æº¢å‡ºï¼‰çš„é—®é¢˜ã€‚å› ä¸ºå•æ¬¡å‡½æ•°è°ƒç”¨å°±è¦å¤„ç†æ‰ä¸€ä¸ªpartitionæ‰€æœ‰çš„æ•°æ®ï¼Œå¦‚æœå†…å­˜ä¸å¤Ÿï¼Œåƒåœ¾å›æ”¶æ—¶æ˜¯æ— æ³•å›æ”¶æ‰å¤ªå¤šå¯¹è±¡çš„ï¼Œå¾ˆå¯èƒ½å‡ºç°OOMå¼‚å¸¸ã€‚æ‰€ä»¥ä½¿ç”¨è¿™ç±»æ“ä½œæ—¶è¦æ…é‡ï¼\n\n##### ä½¿ç”¨foreachPartitionsæ›¿ä»£foreach\n\nåŸç†ç±»ä¼¼äºâ€œä½¿ç”¨mapPartitionsæ›¿ä»£mapâ€ï¼Œä¹Ÿæ˜¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨å¤„ç†ä¸€ä¸ªpartitionçš„æ‰€æœ‰æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨å¤„ç†ä¸€æ¡æ•°æ®ã€‚åœ¨å®è·µä¸­å‘ç°ï¼ŒforeachPartitionsç±»çš„ç®—å­ï¼Œå¯¹æ€§èƒ½çš„æå‡è¿˜æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚æ¯”å¦‚åœ¨foreachå‡½æ•°ä¸­ï¼Œå°†RDDä¸­æ‰€æœ‰æ•°æ®å†™MySQLï¼Œé‚£ä¹ˆå¦‚æœæ˜¯æ™®é€šçš„foreachç®—å­ï¼Œå°±ä¼šä¸€æ¡æ•°æ®ä¸€æ¡æ•°æ®åœ°å†™ï¼Œæ¯æ¬¡å‡½æ•°è°ƒç”¨å¯èƒ½å°±ä¼šåˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¿æ¥ï¼Œæ­¤æ—¶å°±åŠ¿å¿…ä¼šé¢‘ç¹åœ°åˆ›å»ºå’Œé”€æ¯æ•°æ®åº“è¿æ¥ï¼Œæ€§èƒ½æ˜¯éå¸¸ä½ä¸‹ï¼›ä½†æ˜¯å¦‚æœç”¨foreachPartitionsç®—å­ä¸€æ¬¡æ€§å¤„ç†ä¸€ä¸ªpartitionçš„æ•°æ®ï¼Œé‚£ä¹ˆå¯¹äºæ¯ä¸ªpartitionï¼Œåªè¦åˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¿æ¥å³å¯ï¼Œç„¶åæ‰§è¡Œæ‰¹é‡æ’å…¥æ“ä½œï¼Œæ­¤æ—¶æ€§èƒ½æ˜¯æ¯”è¾ƒé«˜çš„ã€‚å®è·µä¸­å‘ç°ï¼Œå¯¹äº1ä¸‡æ¡å·¦å³çš„æ•°æ®é‡å†™MySQLï¼Œæ€§èƒ½å¯ä»¥æå‡30%ä»¥ä¸Šã€‚\n\n##### ä½¿ç”¨filterä¹‹åè¿›è¡Œcoalesceæ“ä½œ\n\né€šå¸¸å¯¹ä¸€ä¸ªRDDæ‰§è¡Œfilterç®—å­è¿‡æ»¤æ‰RDDä¸­è¾ƒå¤šæ•°æ®åï¼ˆæ¯”å¦‚30%ä»¥ä¸Šçš„æ•°æ®ï¼‰ï¼Œå»ºè®®ä½¿ç”¨coalesceç®—å­ï¼Œæ‰‹åŠ¨å‡å°‘RDDçš„partitionæ•°é‡ï¼Œå°†RDDä¸­çš„æ•°æ®å‹ç¼©åˆ°æ›´å°‘çš„partitionä¸­å»ã€‚å› ä¸ºfilterä¹‹åï¼ŒRDDçš„æ¯ä¸ªpartitionä¸­éƒ½ä¼šæœ‰å¾ˆå¤šæ•°æ®è¢«è¿‡æ»¤æ‰ï¼Œæ­¤æ—¶å¦‚æœç…§å¸¸è¿›è¡Œåç»­çš„è®¡ç®—ï¼Œå…¶å®æ¯ä¸ªtaskå¤„ç†çš„partitionä¸­çš„æ•°æ®é‡å¹¶ä¸æ˜¯å¾ˆå¤šï¼Œæœ‰ä¸€ç‚¹èµ„æºæµªè´¹ï¼Œè€Œä¸”æ­¤æ—¶å¤„ç†çš„taskè¶Šå¤šï¼Œå¯èƒ½é€Ÿåº¦åè€Œè¶Šæ…¢ã€‚å› æ­¤ç”¨coalesceå‡å°‘partitionæ•°é‡ï¼Œå°†RDDä¸­çš„æ•°æ®å‹ç¼©åˆ°æ›´å°‘çš„partitionä¹‹åï¼Œåªè¦ä½¿ç”¨æ›´å°‘çš„taskå³å¯å¤„ç†å®Œæ‰€æœ‰çš„partitionã€‚åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå¯¹äºæ€§èƒ½çš„æå‡ä¼šæœ‰ä¸€å®šçš„å¸®åŠ©ã€‚\n\n##### ä½¿ç”¨repartitionAndSortWithinPartitionsæ›¿ä»£repartitionä¸sortç±»æ“ä½œ\n\nrepartitionAndSortWithinPartitionsæ˜¯Sparkå®˜ç½‘æ¨èçš„ä¸€ä¸ªç®—å­ï¼Œå®˜æ–¹å»ºè®®ï¼Œå¦‚æœéœ€è¦åœ¨repartitioné‡åˆ†åŒºä¹‹åï¼Œè¿˜è¦è¿›è¡Œæ’åºï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨repartitionAndSortWithinPartitionsç®—å­ã€‚å› ä¸ºè¯¥ç®—å­å¯ä»¥ä¸€è¾¹è¿›è¡Œé‡åˆ†åŒºçš„shuffleæ“ä½œï¼Œä¸€è¾¹è¿›è¡Œæ’åºã€‚shuffleä¸sortä¸¤ä¸ªæ“ä½œåŒæ—¶è¿›è¡Œï¼Œæ¯”å…ˆshuffleå†sortæ¥è¯´ï¼Œæ€§èƒ½å¯èƒ½æ˜¯è¦é«˜çš„ã€‚\n\n#### å¹¿æ’­å¤§å˜é‡\n\næœ‰æ—¶åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¼šé‡åˆ°éœ€è¦åœ¨ç®—å­å‡½æ•°ä¸­ä½¿ç”¨å¤–éƒ¨å˜é‡çš„åœºæ™¯ï¼ˆå°¤å…¶æ˜¯å¤§å˜é‡ï¼Œæ¯”å¦‚100Mä»¥ä¸Šçš„å¤§é›†åˆï¼‰ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±åº”è¯¥ä½¿ç”¨Sparkçš„å¹¿æ’­ï¼ˆBroadcastï¼‰åŠŸèƒ½æ¥æå‡æ€§èƒ½ã€‚\n\nåœ¨ç®—å­å‡½æ•°ä¸­ä½¿ç”¨åˆ°å¤–éƒ¨å˜é‡æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒSparkä¼šå°†è¯¥å˜é‡å¤åˆ¶å¤šä¸ªå‰¯æœ¬ï¼Œé€šè¿‡ç½‘ç»œä¼ è¾“åˆ°taskä¸­ï¼Œæ­¤æ—¶æ¯ä¸ªtaskéƒ½æœ‰ä¸€ä¸ªå˜é‡å‰¯æœ¬ã€‚å¦‚æœå˜é‡æœ¬èº«æ¯”è¾ƒå¤§çš„è¯ï¼ˆæ¯”å¦‚100Mï¼Œç”šè‡³1Gï¼‰ï¼Œé‚£ä¹ˆå¤§é‡çš„å˜é‡å‰¯æœ¬åœ¨ç½‘ç»œä¸­ä¼ è¾“çš„æ€§èƒ½å¼€é”€ï¼Œä»¥åŠåœ¨å„ä¸ªèŠ‚ç‚¹çš„Executorä¸­å ç”¨è¿‡å¤šå†…å­˜å¯¼è‡´çš„é¢‘ç¹GCï¼Œéƒ½ä¼šæå¤§åœ°å½±å“æ€§èƒ½ã€‚\n\nå› æ­¤å¯¹äºä¸Šè¿°æƒ…å†µï¼Œå¦‚æœä½¿ç”¨çš„å¤–éƒ¨å˜é‡æ¯”è¾ƒå¤§ï¼Œå»ºè®®ä½¿ç”¨Sparkçš„å¹¿æ’­åŠŸèƒ½ï¼Œå¯¹è¯¥å˜é‡è¿›è¡Œå¹¿æ’­ã€‚å¹¿æ’­åçš„å˜é‡ï¼Œä¼šä¿è¯æ¯ä¸ªExecutorçš„å†…å­˜ä¸­ï¼Œåªé©»ç•™ä¸€ä»½å˜é‡å‰¯æœ¬ï¼Œè€ŒExecutorä¸­çš„taskæ‰§è¡Œæ—¶å…±äº«è¯¥Executorä¸­çš„é‚£ä»½å˜é‡å‰¯æœ¬ã€‚è¿™æ ·çš„è¯ï¼Œå¯ä»¥å¤§å¤§å‡å°‘å˜é‡å‰¯æœ¬çš„æ•°é‡ï¼Œä»è€Œå‡å°‘ç½‘ç»œä¼ è¾“çš„æ€§èƒ½å¼€é”€ï¼Œå¹¶å‡å°‘å¯¹Executorå†…å­˜çš„å ç”¨å¼€é”€ï¼Œé™ä½GCçš„é¢‘ç‡ã€‚\n\n##### pythonç¤ºä¾‹\n\n```python\n# åŸåˆ™4ï¼šå¹¿æ’­å¤§å˜é‡\nrdd1 = sc.parallelize([('A1', 11), ('A2', 12), ('A3', 13), ('A4', 14)])\nrdd1_broadcast = sc.broadcast(rdd1.collect())\nprint(rdd1.collect())\nprint(rdd1_broadcast.value)\n# [('A1', 11), ('A2', 12), ('A3', 13), ('A4', 14)]\n# [('A1', 11), ('A2', 12), ('A3', 13), ('A4', 14)]\n```\n\n##### scalaç¤ºä¾‹\n\n```scala\n// ä»¥ä¸‹ä»£ç åœ¨ç®—å­å‡½æ•°ä¸­ï¼Œä½¿ç”¨äº†å¤–éƒ¨çš„å˜é‡ã€‚\n// æ­¤æ—¶æ²¡æœ‰åšä»»ä½•ç‰¹æ®Šæ“ä½œï¼Œæ¯ä¸ªtaskéƒ½ä¼šæœ‰ä¸€ä»½list1çš„å‰¯æœ¬ã€‚\nval list1 = ...\nrdd1.map(list1...)\n\n// ä»¥ä¸‹ä»£ç å°†list1å°è£…æˆäº†Broadcastç±»å‹çš„å¹¿æ’­å˜é‡ã€‚\n// åœ¨ç®—å­å‡½æ•°ä¸­ï¼Œä½¿ç”¨å¹¿æ’­å˜é‡æ—¶ï¼Œé¦–å…ˆä¼šåˆ¤æ–­å½“å‰taskæ‰€åœ¨Executorå†…å­˜ä¸­ï¼Œæ˜¯å¦æœ‰å˜é‡å‰¯æœ¬ã€‚\n// å¦‚æœæœ‰åˆ™ç›´æ¥ä½¿ç”¨ï¼›å¦‚æœæ²¡æœ‰åˆ™ä»Driveræˆ–è€…å…¶ä»–ExecutorèŠ‚ç‚¹ä¸Šè¿œç¨‹æ‹‰å–ä¸€ä»½æ”¾åˆ°æœ¬åœ°Executorå†…å­˜ä¸­ã€‚\n// æ¯ä¸ªExecutorå†…å­˜ä¸­ï¼Œå°±åªä¼šé©»ç•™ä¸€ä»½å¹¿æ’­å˜é‡å‰¯æœ¬ã€‚\nval list1 = ...\nval list1Broadcast = sc.broadcast(list1)\nrdd1.map(list1Broadcast...)\n```\n\n#### ä½¿ç”¨Kryoä¼˜åŒ–åºåˆ—åŒ–æ€§èƒ½\n\nåœ¨Sparkä¸­ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªåœ°æ–¹æ¶‰åŠåˆ°äº†åºåˆ—åŒ–ï¼š\n\n- åœ¨ç®—å­å‡½æ•°ä¸­ä½¿ç”¨åˆ°å¤–éƒ¨å˜é‡æ—¶ï¼Œè¯¥å˜é‡ä¼šè¢«åºåˆ—åŒ–åè¿›è¡Œç½‘ç»œä¼ è¾“ï¼ˆè§ï¼šå¹¿æ’­å¤§å˜é‡â€ä¸­çš„è®²è§£ï¼‰ã€‚\n- å°†è‡ªå®šä¹‰çš„ç±»å‹ä½œä¸ºRDDçš„æ³›å‹ç±»å‹æ—¶ï¼ˆæ¯”å¦‚JavaRDDï¼ŒStudentæ˜¯è‡ªå®šä¹‰ç±»å‹ï¼‰ï¼Œæ‰€æœ‰è‡ªå®šä¹‰ç±»å‹å¯¹è±¡ï¼Œéƒ½ä¼šè¿›è¡Œåºåˆ—åŒ–ã€‚å› æ­¤è¿™ç§æƒ…å†µä¸‹ï¼Œä¹Ÿè¦æ±‚è‡ªå®šä¹‰çš„ç±»å¿…é¡»å®ç°Serializableæ¥å£ã€‚\n- ä½¿ç”¨å¯åºåˆ—åŒ–çš„æŒä¹…åŒ–ç­–ç•¥æ—¶ï¼ˆæ¯”å¦‚MEMORY_ONLY_SERï¼‰ï¼ŒSparkä¼šå°†RDDä¸­çš„æ¯ä¸ªpartitionéƒ½åºåˆ—åŒ–æˆä¸€ä¸ªå¤§çš„å­—èŠ‚æ•°ç»„ã€‚\n\nå¯¹äºè¿™ä¸‰ç§å‡ºç°åºåˆ—åŒ–çš„åœ°æ–¹ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥é€šè¿‡ä½¿ç”¨Kryoåºåˆ—åŒ–ç±»åº“ï¼Œæ¥ä¼˜åŒ–åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ€§èƒ½ã€‚Sparké»˜è®¤ä½¿ç”¨çš„æ˜¯Javaçš„åºåˆ—åŒ–æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯ObjectOutputStream/ObjectInputStream APIæ¥è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚ä½†æ˜¯SparkåŒæ—¶æ”¯æŒä½¿ç”¨Kryoåºåˆ—åŒ–åº“ï¼ŒKryoåºåˆ—åŒ–ç±»åº“çš„æ€§èƒ½æ¯”Javaåºåˆ—åŒ–ç±»åº“çš„æ€§èƒ½è¦é«˜å¾ˆå¤šã€‚å®˜æ–¹ä»‹ç»ï¼ŒKryoåºåˆ—åŒ–æœºåˆ¶æ¯”Javaåºåˆ—åŒ–æœºåˆ¶ï¼Œæ€§èƒ½é«˜10å€å·¦å³ã€‚Sparkä¹‹æ‰€ä»¥é»˜è®¤æ²¡æœ‰ä½¿ç”¨Kryoä½œä¸ºåºåˆ—åŒ–ç±»åº“ï¼Œæ˜¯å› ä¸ºKryoè¦æ±‚æœ€å¥½è¦æ³¨å†Œæ‰€æœ‰éœ€è¦è¿›è¡Œåºåˆ—åŒ–çš„è‡ªå®šä¹‰ç±»å‹ï¼Œå› æ­¤å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œè¿™ç§æ–¹å¼æ¯”è¾ƒéº»çƒ¦ã€‚\n\nä»¥ä¸‹æ˜¯ä½¿ç”¨Kryoçš„ä»£ç ç¤ºä¾‹ï¼Œæˆ‘ä»¬åªè¦è®¾ç½®åºåˆ—åŒ–ç±»ï¼Œå†æ³¨å†Œè¦åºåˆ—åŒ–çš„è‡ªå®šä¹‰ç±»å‹å³å¯ï¼ˆæ¯”å¦‚ç®—å­å‡½æ•°ä¸­ä½¿ç”¨åˆ°çš„å¤–éƒ¨å˜é‡ç±»å‹ã€ä½œä¸ºRDDæ³›å‹ç±»å‹çš„è‡ªå®šä¹‰ç±»å‹ç­‰ï¼‰ï¼š\n\n```scala\n// åˆ›å»ºSparkConfå¯¹è±¡ã€‚\nval conf = new SparkConf().setMaster(...).setAppName(...)\n// è®¾ç½®åºåˆ—åŒ–å™¨ä¸ºKryoSerializerã€‚\nconf.set(\"spark.serializer\", \"org.apache.spark.serializer.KryoSerializer\")\n// æ³¨å†Œè¦åºåˆ—åŒ–çš„è‡ªå®šä¹‰ç±»å‹ã€‚\nconf.registerKryoClasses(Array(classOf[MyClass1], classOf[MyClass2]))\n```\n\n#### Sparkä½œä¸šåŸºæœ¬åŸç†\n\nå¦‚æœè¦è¿›è¡Œèµ„æºè°ƒä¼˜ï¼Œæˆ‘ä»¬å°±å¿…é¡»å…ˆçŸ¥é“Sparkè¿è¡Œçš„æœºåˆ¶ä¸æµç¨‹ã€‚\n\n![Sparkä½œä¸šåŸºæœ¬è¿è¡ŒåŸç†](./PySparkåŸºç¡€001/Sparkä½œä¸šåŸºæœ¬åŸç†.png)\n\nè¯¦ç»†åŸç†è§ä¸Šå›¾ã€‚æˆ‘ä»¬ä½¿ç”¨spark-submitæäº¤ä¸€ä¸ªSparkä½œä¸šä¹‹åï¼Œè¿™ä¸ªä½œä¸šå°±ä¼šå¯åŠ¨ä¸€ä¸ªå¯¹åº”çš„Driverè¿›ç¨‹ã€‚æ ¹æ®ä½ ä½¿ç”¨çš„éƒ¨ç½²æ¨¡å¼ï¼ˆdeploy-modeï¼‰ä¸åŒï¼ŒDriverè¿›ç¨‹å¯èƒ½åœ¨æœ¬åœ°å¯åŠ¨ï¼Œä¹Ÿå¯èƒ½åœ¨é›†ç¾¤ä¸­æŸä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šå¯åŠ¨ã€‚Driverè¿›ç¨‹æœ¬èº«ä¼šæ ¹æ®æˆ‘ä»¬è®¾ç½®çš„å‚æ•°ï¼Œå æœ‰ä¸€å®šæ•°é‡çš„å†…å­˜å’ŒCPU coreã€‚è€ŒDriverè¿›ç¨‹è¦åšçš„ç¬¬ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯å‘é›†ç¾¤ç®¡ç†å™¨ï¼ˆå¯ä»¥æ˜¯Spark Standaloneé›†ç¾¤ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–çš„èµ„æºç®¡ç†é›†ç¾¤ï¼‰ç”³è¯·è¿è¡ŒSparkä½œä¸šéœ€è¦ä½¿ç”¨çš„èµ„æºï¼Œè¿™é‡Œçš„èµ„æºæŒ‡çš„å°±æ˜¯Executorè¿›ç¨‹ã€‚YARNé›†ç¾¤ç®¡ç†å™¨ä¼šæ ¹æ®æˆ‘ä»¬ä¸ºSparkä½œä¸šè®¾ç½®çš„èµ„æºå‚æ•°ï¼Œåœ¨å„ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šï¼Œå¯åŠ¨ä¸€å®šæ•°é‡çš„Executorè¿›ç¨‹ï¼Œæ¯ä¸ªExecutorè¿›ç¨‹éƒ½å æœ‰ä¸€å®šæ•°é‡çš„å†…å­˜å’ŒCPU coreã€‚\n\nåœ¨ç”³è¯·åˆ°äº†ä½œä¸šæ‰§è¡Œæ‰€éœ€çš„èµ„æºä¹‹åï¼ŒDriverè¿›ç¨‹å°±ä¼šå¼€å§‹è°ƒåº¦å’Œæ‰§è¡Œæˆ‘ä»¬ç¼–å†™çš„ä½œä¸šä»£ç äº†ã€‚Driverè¿›ç¨‹ä¼šå°†æˆ‘ä»¬ç¼–å†™çš„Sparkä½œä¸šä»£ç åˆ†æ‹†ä¸ºå¤šä¸ªstageï¼Œæ¯ä¸ªstageæ‰§è¡Œä¸€éƒ¨åˆ†ä»£ç ç‰‡æ®µï¼Œå¹¶ä¸ºæ¯ä¸ªstageåˆ›å»ºä¸€æ‰¹taskï¼Œç„¶åå°†è¿™äº›taskåˆ†é…åˆ°å„ä¸ªExecutorè¿›ç¨‹ä¸­æ‰§è¡Œã€‚**taskæ˜¯æœ€å°çš„è®¡ç®—å•å…ƒï¼Œè´Ÿè´£æ‰§è¡Œä¸€æ¨¡ä¸€æ ·çš„è®¡ç®—é€»è¾‘ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„æŸä¸ªä»£ç ç‰‡æ®µï¼‰ï¼Œåªæ˜¯æ¯ä¸ªtaskå¤„ç†çš„æ•°æ®ä¸åŒè€Œå·²ã€‚**ä¸€ä¸ªstageçš„æ‰€æœ‰taskéƒ½æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œä¼šåœ¨å„ä¸ªèŠ‚ç‚¹æœ¬åœ°çš„ç£ç›˜æ–‡ä»¶ä¸­å†™å…¥è®¡ç®—ä¸­é—´ç»“æœï¼Œç„¶åDriverå°±ä¼šè°ƒåº¦è¿è¡Œä¸‹ä¸€ä¸ªstageã€‚ä¸‹ä¸€ä¸ªstageçš„taskçš„è¾“å…¥æ•°æ®å°±æ˜¯ä¸Šä¸€ä¸ªstageè¾“å‡ºçš„ä¸­é—´ç»“æœã€‚å¦‚æ­¤å¾ªç¯å¾€å¤ï¼Œç›´åˆ°å°†æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ä»£ç é€»è¾‘å…¨éƒ¨æ‰§è¡Œå®Œï¼Œå¹¶ä¸”è®¡ç®—å®Œæ‰€æœ‰çš„æ•°æ®ï¼Œå¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœä¸ºæ­¢ã€‚\n\n**Sparkæ˜¯æ ¹æ®shuffleç±»ç®—å­æ¥è¿›è¡Œstageçš„åˆ’åˆ†ã€‚**å¦‚æœæˆ‘ä»¬çš„ä»£ç ä¸­æ‰§è¡Œäº†æŸä¸ªshuffleç±»ç®—å­ï¼ˆæ¯”å¦‚reduceByKeyã€joinç­‰ï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨è¯¥ç®—å­å¤„ï¼Œåˆ’åˆ†å‡ºä¸€ä¸ªstageç•Œé™æ¥ã€‚å¯ä»¥å¤§è‡´ç†è§£ä¸ºï¼Œshuffleç®—å­æ‰§è¡Œä¹‹å‰çš„ä»£ç ä¼šè¢«åˆ’åˆ†ä¸ºä¸€ä¸ªstageï¼Œshuffleç®—å­æ‰§è¡Œä»¥åŠä¹‹åçš„ä»£ç ä¼šè¢«åˆ’åˆ†ä¸ºä¸‹ä¸€ä¸ªstageã€‚å› æ­¤ä¸€ä¸ªstageåˆšå¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼Œ**å®ƒçš„æ¯ä¸ªtaskå¯èƒ½éƒ½ä¼šä»ä¸Šä¸€ä¸ªstageçš„taskæ‰€åœ¨çš„èŠ‚ç‚¹ï¼Œå»é€šè¿‡ç½‘ç»œä¼ è¾“æ‹‰å–éœ€è¦è‡ªå·±å¤„ç†çš„æ‰€æœ‰keyï¼Œç„¶åå¯¹æ‹‰å–åˆ°çš„æ‰€æœ‰ç›¸åŒçš„keyä½¿ç”¨æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ç®—å­å‡½æ•°æ‰§è¡Œèšåˆæ“ä½œï¼ˆæ¯”å¦‚reduceByKey()ç®—å­æ¥æ”¶çš„å‡½æ•°ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯shuffleã€‚**\n\nå½“æˆ‘ä»¬åœ¨ä»£ç ä¸­æ‰§è¡Œäº†cache/persistç­‰æŒä¹…åŒ–æ“ä½œæ—¶ï¼Œæ ¹æ®æˆ‘ä»¬é€‰æ‹©çš„æŒä¹…åŒ–çº§åˆ«çš„ä¸åŒï¼Œæ¯ä¸ªtaskè®¡ç®—å‡ºæ¥çš„æ•°æ®ä¹Ÿä¼šä¿å­˜åˆ°Executorè¿›ç¨‹çš„å†…å­˜æˆ–è€…æ‰€åœ¨èŠ‚ç‚¹çš„ç£ç›˜æ–‡ä»¶ä¸­ã€‚\n\nå› æ­¤Executorçš„å†…å­˜ä¸»è¦åˆ†ä¸ºä¸‰å—ï¼š\n\n- ç¬¬ä¸€å—æ˜¯è®©taskæ‰§è¡Œæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ä»£ç æ—¶ä½¿ç”¨ï¼Œé»˜è®¤æ˜¯å Executoræ€»å†…å­˜çš„20%ï¼›\n- ç¬¬äºŒå—æ˜¯è®©taské€šè¿‡shuffleè¿‡ç¨‹æ‹‰å–äº†ä¸Šä¸€ä¸ªstageçš„taskçš„è¾“å‡ºåï¼Œè¿›è¡Œèšåˆç­‰æ“ä½œæ—¶ä½¿ç”¨ï¼Œé»˜è®¤ä¹Ÿæ˜¯å Executoræ€»å†…å­˜çš„20%ï¼›\n- ç¬¬ä¸‰å—æ˜¯è®©RDDæŒä¹…åŒ–æ—¶ä½¿ç”¨ï¼Œé»˜è®¤å Executoræ€»å†…å­˜çš„60%ã€‚\n\ntaskçš„æ‰§è¡Œé€Ÿåº¦æ˜¯è·Ÿæ¯ä¸ªExecutorè¿›ç¨‹çš„CPU coreæ•°é‡æœ‰ç›´æ¥å…³ç³»çš„ã€‚ä¸€ä¸ªCPU coreåŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªçº¿ç¨‹ã€‚è€Œæ¯ä¸ªExecutorè¿›ç¨‹ä¸Šåˆ†é…åˆ°çš„å¤šä¸ªtaskï¼Œéƒ½æ˜¯ä»¥æ¯ä¸ªtaskä¸€æ¡çº¿ç¨‹çš„æ–¹å¼ï¼Œå¤šçº¿ç¨‹å¹¶å‘è¿è¡Œçš„ã€‚å¦‚æœCPU coreæ•°é‡æ¯”è¾ƒå……è¶³ï¼Œè€Œä¸”åˆ†é…åˆ°çš„taskæ•°é‡æ¯”è¾ƒåˆç†ï¼Œé‚£ä¹ˆé€šå¸¸æ¥è¯´ï¼Œå¯ä»¥æ¯”è¾ƒå¿«é€Ÿå’Œé«˜æ•ˆåœ°æ‰§è¡Œå®Œè¿™äº›taskçº¿ç¨‹ã€‚\n\nä»¥ä¸Šå°±æ˜¯Sparkä½œä¸šçš„åŸºæœ¬è¿è¡ŒåŸç†çš„è¯´æ˜ï¼Œå¤§å®¶å¯ä»¥ç»“åˆä¸Šå›¾æ¥ç†è§£ã€‚ç†è§£ä½œä¸šåŸºæœ¬åŸç†ï¼Œæ˜¯æˆ‘ä»¬è¿›è¡Œèµ„æºå‚æ•°è°ƒä¼˜çš„åŸºæœ¬å‰æã€‚\n\n#### èµ„æºå‚æ•°è°ƒä¼˜\n\näº†è§£å®Œäº†Sparkä½œä¸šè¿è¡Œçš„åŸºæœ¬åŸç†ä¹‹åï¼Œå¯¹èµ„æºç›¸å…³çš„å‚æ•°å°±å®¹æ˜“ç†è§£äº†ã€‚æ‰€è°“çš„Sparkèµ„æºå‚æ•°è°ƒä¼˜ï¼Œå…¶å®ä¸»è¦å°±æ˜¯å¯¹Sparkè¿è¡Œè¿‡ç¨‹ä¸­å„ä¸ªä½¿ç”¨èµ„æºçš„åœ°æ–¹ï¼Œé€šè¿‡è°ƒèŠ‚å„ç§å‚æ•°ï¼Œæ¥ä¼˜åŒ–èµ„æºä½¿ç”¨çš„æ•ˆç‡ï¼Œä»è€Œæå‡Sparkä½œä¸šçš„æ‰§è¡Œæ€§èƒ½ã€‚ä»¥ä¸‹å‚æ•°å°±æ˜¯Sparkä¸­ä¸»è¦çš„èµ„æºå‚æ•°ï¼Œæ¯ä¸ªå‚æ•°éƒ½å¯¹åº”ç€ä½œä¸šè¿è¡ŒåŸç†ä¸­çš„æŸä¸ªéƒ¨åˆ†ï¼Œæˆ‘ä»¬åŒæ—¶ä¹Ÿç»™å‡ºäº†ä¸€ä¸ªè°ƒä¼˜çš„å‚è€ƒå€¼ã€‚\n\n##### num-executors\n\n- å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®Sparkä½œä¸šæ€»å…±è¦ç”¨å¤šå°‘ä¸ªExecutorè¿›ç¨‹æ¥æ‰§è¡Œã€‚Driveråœ¨å‘YARNé›†ç¾¤ç®¡ç†å™¨ç”³è¯·èµ„æºæ—¶ï¼ŒYARNé›†ç¾¤ç®¡ç†å™¨ä¼šå°½å¯èƒ½æŒ‰ç…§ä½ çš„è®¾ç½®æ¥åœ¨é›†ç¾¤çš„å„ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šï¼Œå¯åŠ¨ç›¸åº”æ•°é‡çš„Executorè¿›ç¨‹ã€‚è¿™ä¸ªå‚æ•°éå¸¸ä¹‹é‡è¦ï¼Œå¦‚æœä¸è®¾ç½®çš„è¯ï¼Œé»˜è®¤åªä¼šç»™ä½ å¯åŠ¨å°‘é‡çš„Executorè¿›ç¨‹ï¼Œæ­¤æ—¶ä½ çš„Sparkä½œä¸šçš„è¿è¡Œé€Ÿåº¦æ˜¯éå¸¸æ…¢çš„ã€‚\n- å‚æ•°è°ƒä¼˜å»ºè®®ï¼šæ¯ä¸ªSparkä½œä¸šçš„è¿è¡Œä¸€èˆ¬è®¾ç½®`50~100`ä¸ªå·¦å³çš„Executorè¿›ç¨‹æ¯”è¾ƒåˆé€‚ï¼Œè®¾ç½®å¤ªå°‘æˆ–å¤ªå¤šçš„Executorè¿›ç¨‹éƒ½ä¸å¥½ã€‚è®¾ç½®çš„å¤ªå°‘ï¼Œæ— æ³•å……åˆ†åˆ©ç”¨é›†ç¾¤èµ„æºï¼›è®¾ç½®çš„å¤ªå¤šçš„è¯ï¼Œå¤§éƒ¨åˆ†é˜Ÿåˆ—å¯èƒ½æ— æ³•ç»™äºˆå……åˆ†çš„èµ„æºã€‚\n\n##### executor-memory\n\n- å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®æ¯ä¸ªExecutorè¿›ç¨‹çš„å†…å­˜ã€‚Executorå†…å­˜çš„å¤§å°ï¼Œå¾ˆå¤šæ—¶å€™ç›´æ¥å†³å®šäº†Sparkä½œä¸šçš„æ€§èƒ½ï¼Œè€Œä¸”è·Ÿå¸¸è§çš„JVM OOMå¼‚å¸¸ï¼Œä¹Ÿæœ‰ç›´æ¥çš„å…³è”ã€‚\n- å‚æ•°è°ƒä¼˜å»ºè®®ï¼šæ¯ä¸ªExecutorè¿›ç¨‹çš„å†…å­˜è®¾ç½®`4G~8G`è¾ƒä¸ºåˆé€‚ã€‚ä½†æ˜¯è¿™åªæ˜¯ä¸€ä¸ªå‚è€ƒå€¼ï¼Œå…·ä½“çš„è®¾ç½®è¿˜æ˜¯å¾—æ ¹æ®ä¸åŒéƒ¨é—¨çš„èµ„æºé˜Ÿåˆ—æ¥å®šã€‚å¯ä»¥çœ‹çœ‹è‡ªå·±å›¢é˜Ÿçš„èµ„æºé˜Ÿåˆ—çš„æœ€å¤§å†…å­˜é™åˆ¶æ˜¯å¤šå°‘ï¼Œnum-executorsä¹˜ä»¥executor-memoryï¼Œæ˜¯ä¸èƒ½è¶…è¿‡é˜Ÿåˆ—çš„æœ€å¤§å†…å­˜é‡çš„ã€‚æ­¤å¤–ï¼Œå¦‚æœä½ æ˜¯è·Ÿå›¢é˜Ÿé‡Œå…¶ä»–äººå…±äº«è¿™ä¸ªèµ„æºé˜Ÿåˆ—ï¼Œé‚£ä¹ˆç”³è¯·çš„å†…å­˜é‡æœ€å¥½ä¸è¦è¶…è¿‡èµ„æºé˜Ÿåˆ—æœ€å¤§æ€»å†…å­˜çš„`1/3~1/2`ï¼Œé¿å…ä½ è‡ªå·±çš„Sparkä½œä¸šå ç”¨äº†é˜Ÿåˆ—æ‰€æœ‰çš„èµ„æºï¼Œå¯¼è‡´åˆ«çš„åŒå­¦çš„ä½œä¸šæ— æ³•è¿è¡Œã€‚\n\n##### executor-cores\n\n- å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®æ¯ä¸ªExecutorè¿›ç¨‹çš„CPU coreæ•°é‡ã€‚è¿™ä¸ªå‚æ•°å†³å®šäº†æ¯ä¸ªExecutorè¿›ç¨‹å¹¶è¡Œæ‰§è¡Œtaskçº¿ç¨‹çš„èƒ½åŠ›ã€‚å› ä¸ºæ¯ä¸ªCPU coreåŒä¸€æ—¶é—´åªèƒ½æ‰§è¡Œä¸€ä¸ªtaskçº¿ç¨‹ï¼Œå› æ­¤æ¯ä¸ªExecutorè¿›ç¨‹çš„CPU coreæ•°é‡è¶Šå¤šï¼Œè¶Šèƒ½å¤Ÿå¿«é€Ÿåœ°æ‰§è¡Œå®Œåˆ†é…ç»™è‡ªå·±çš„æ‰€æœ‰taskçº¿ç¨‹ã€‚\n- å‚æ•°è°ƒä¼˜å»ºè®®ï¼šExecutorçš„CPU coreæ•°é‡è®¾ç½®ä¸º`2~4`ä¸ªè¾ƒä¸ºåˆé€‚ã€‚åŒæ ·å¾—æ ¹æ®ä¸åŒéƒ¨é—¨çš„èµ„æºé˜Ÿåˆ—æ¥å®šï¼Œå¯ä»¥çœ‹çœ‹è‡ªå·±çš„èµ„æºé˜Ÿåˆ—çš„æœ€å¤§CPU coreé™åˆ¶æ˜¯å¤šå°‘ï¼Œå†ä¾æ®è®¾ç½®çš„Executoræ•°é‡ï¼Œæ¥å†³å®šæ¯ä¸ªExecutorè¿›ç¨‹å¯ä»¥åˆ†é…åˆ°å‡ ä¸ªCPU coreã€‚åŒæ ·å»ºè®®ï¼Œå¦‚æœæ˜¯è·Ÿä»–äººå…±äº«è¿™ä¸ªé˜Ÿåˆ—ï¼Œé‚£ä¹ˆnum-executors * executor-coresä¸è¦è¶…è¿‡é˜Ÿåˆ—æ€»CPU coreçš„`1/3~1/2`å·¦å³æ¯”è¾ƒåˆé€‚ï¼Œä¹Ÿæ˜¯é¿å…å½±å“å…¶å®ƒä¸šåŠ¡çš„ä½œä¸šè¿è¡Œã€‚\n\n##### driver-memory\n\n- å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®Driverè¿›ç¨‹çš„å†…å­˜ã€‚\n- å‚æ•°è°ƒä¼˜å»ºè®®ï¼šDriverçš„å†…å­˜é€šå¸¸æ¥è¯´ä¸è®¾ç½®ï¼Œæˆ–è€…è®¾ç½®1Gå·¦å³åº”è¯¥å°±å¤Ÿäº†ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨collectç®—å­å°†RDDçš„æ•°æ®å…¨éƒ¨æ‹‰å–åˆ°Driverä¸Šè¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆå¿…é¡»ç¡®ä¿Driverçš„å†…å­˜è¶³å¤Ÿå¤§ï¼Œå¦åˆ™ä¼šå‡ºç°OOMå†…å­˜æº¢å‡ºçš„é—®é¢˜ã€‚\n\n##### spark.default.parallelism\n\n- å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®æ¯ä¸ªstageçš„é»˜è®¤taskæ•°é‡ã€‚è¿™ä¸ªå‚æ•°æä¸ºé‡è¦ï¼Œå¦‚æœä¸è®¾ç½®å¯èƒ½ä¼šç›´æ¥å½±å“ä½ çš„Sparkä½œä¸šæ€§èƒ½ã€‚\n- å‚æ•°è°ƒä¼˜å»ºè®®ï¼šSparkä½œä¸šçš„é»˜è®¤taskæ•°é‡ä¸º`500~1000`ä¸ªè¾ƒä¸ºåˆé€‚ã€‚å¾ˆå¤šåŒå­¦å¸¸çŠ¯çš„ä¸€ä¸ªé”™è¯¯å°±æ˜¯ä¸å»è®¾ç½®è¿™ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šå¯¼è‡´Sparkè‡ªå·±æ ¹æ®åº•å±‚HDFSçš„blockæ•°é‡æ¥è®¾ç½®taskçš„æ•°é‡ï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªHDFS blockå¯¹åº”ä¸€ä¸ªtaskã€‚é€šå¸¸æ¥è¯´ï¼ŒSparké»˜è®¤è®¾ç½®çš„æ•°é‡æ˜¯åå°‘çš„ï¼ˆæ¯”å¦‚å°±å‡ åä¸ªtaskï¼‰ï¼Œå¦‚æœtaskæ•°é‡åå°‘çš„è¯ï¼Œå°±ä¼šå¯¼è‡´ä½ å‰é¢è®¾ç½®å¥½çš„Executorçš„å‚æ•°éƒ½å‰åŠŸå°½å¼ƒã€‚è¯•æƒ³ä¸€ä¸‹ï¼Œæ— è®ºä½ çš„Executorè¿›ç¨‹æœ‰å¤šå°‘ä¸ªï¼Œå†…å­˜å’ŒCPUæœ‰å¤šå¤§ï¼Œä½†æ˜¯taskåªæœ‰1ä¸ªæˆ–è€…10ä¸ªï¼Œé‚£ä¹ˆ90%çš„Executorè¿›ç¨‹å¯èƒ½æ ¹æœ¬å°±æ²¡æœ‰taskæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ç™½ç™½æµªè´¹äº†èµ„æºï¼å› æ­¤Sparkå®˜ç½‘å»ºè®®çš„è®¾ç½®åŸåˆ™æ˜¯ï¼Œè®¾ç½®è¯¥å‚æ•°ä¸ºnum-executors * executor-coresçš„`2~3`å€è¾ƒä¸ºåˆé€‚ï¼Œæ¯”å¦‚Executorçš„æ€»CPU coreæ•°é‡ä¸º300ä¸ªï¼Œé‚£ä¹ˆè®¾ç½®1000ä¸ªtaskæ˜¯å¯ä»¥çš„ï¼Œæ­¤æ—¶å¯ä»¥å……åˆ†åœ°åˆ©ç”¨Sparké›†ç¾¤çš„èµ„æºã€‚\n\n##### spark.storage.memoryFraction\n\n- å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®RDDæŒä¹…åŒ–æ•°æ®åœ¨Executorå†…å­˜ä¸­èƒ½å çš„æ¯”ä¾‹ï¼Œé»˜è®¤æ˜¯0.6ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé»˜è®¤Executor 60%çš„å†…å­˜ï¼Œå¯ä»¥ç”¨æ¥ä¿å­˜æŒä¹…åŒ–çš„RDDæ•°æ®ã€‚æ ¹æ®ä½ é€‰æ‹©çš„ä¸åŒçš„æŒä¹…åŒ–ç­–ç•¥ï¼Œå¦‚æœå†…å­˜ä¸å¤Ÿæ—¶ï¼Œå¯èƒ½æ•°æ®å°±ä¸ä¼šæŒä¹…åŒ–ï¼Œæˆ–è€…æ•°æ®ä¼šå†™å…¥ç£ç›˜ã€‚\n- å‚æ•°è°ƒä¼˜å»ºè®®ï¼šå¦‚æœSparkä½œä¸šä¸­ï¼Œæœ‰è¾ƒå¤šçš„RDDæŒä¹…åŒ–æ“ä½œï¼Œè¯¥å‚æ•°çš„å€¼å¯ä»¥é€‚å½“æé«˜ä¸€äº›ï¼Œä¿è¯æŒä¹…åŒ–çš„æ•°æ®èƒ½å¤Ÿå®¹çº³åœ¨å†…å­˜ä¸­ã€‚é¿å…å†…å­˜ä¸å¤Ÿç¼“å­˜æ‰€æœ‰çš„æ•°æ®ï¼Œå¯¼è‡´æ•°æ®åªèƒ½å†™å…¥ç£ç›˜ä¸­ï¼Œé™ä½äº†æ€§èƒ½ã€‚ä½†æ˜¯å¦‚æœSparkä½œä¸šä¸­çš„shuffleç±»æ“ä½œæ¯”è¾ƒå¤šï¼Œè€ŒæŒä¹…åŒ–æ“ä½œæ¯”è¾ƒå°‘ï¼Œé‚£ä¹ˆè¿™ä¸ªå‚æ•°çš„å€¼é€‚å½“é™ä½ä¸€äº›æ¯”è¾ƒåˆé€‚ã€‚æ­¤å¤–ï¼Œå¦‚æœå‘ç°ä½œä¸šç”±äºé¢‘ç¹çš„gcå¯¼è‡´è¿è¡Œç¼“æ…¢ï¼ˆé€šè¿‡spark web uiå¯ä»¥è§‚å¯Ÿåˆ°ä½œä¸šçš„gcè€—æ—¶ï¼‰ï¼Œæ„å‘³ç€taskæ‰§è¡Œç”¨æˆ·ä»£ç çš„å†…å­˜ä¸å¤Ÿç”¨ï¼Œé‚£ä¹ˆåŒæ ·å»ºè®®è°ƒä½è¿™ä¸ªå‚æ•°çš„å€¼ã€‚\n\n##### spark.shuffle.memoryFraction\n\n- å‚æ•°è¯´æ˜ï¼šè¯¥å‚æ•°ç”¨äºè®¾ç½®shuffleè¿‡ç¨‹ä¸­ä¸€ä¸ªtaskæ‹‰å–åˆ°ä¸Šä¸ªstageçš„taskçš„è¾“å‡ºåï¼Œè¿›è¡Œèšåˆæ“ä½œæ—¶èƒ½å¤Ÿä½¿ç”¨çš„Executorå†…å­˜çš„æ¯”ä¾‹ï¼Œé»˜è®¤æ˜¯0.2ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒExecutoré»˜è®¤åªæœ‰20%çš„å†…å­˜ç”¨æ¥è¿›è¡Œè¯¥æ“ä½œã€‚shuffleæ“ä½œåœ¨è¿›è¡Œèšåˆæ—¶ï¼Œå¦‚æœå‘ç°ä½¿ç”¨çš„å†…å­˜è¶…å‡ºäº†è¿™ä¸ª20%çš„é™åˆ¶ï¼Œé‚£ä¹ˆå¤šä½™çš„æ•°æ®å°±ä¼šæº¢å†™åˆ°ç£ç›˜æ–‡ä»¶ä¸­å»ï¼Œæ­¤æ—¶å°±ä¼šæå¤§åœ°é™ä½æ€§èƒ½ã€‚\n- å‚æ•°è°ƒä¼˜å»ºè®®ï¼šå¦‚æœSparkä½œä¸šä¸­çš„RDDæŒä¹…åŒ–æ“ä½œè¾ƒå°‘ï¼Œshuffleæ“ä½œè¾ƒå¤šæ—¶ï¼Œå»ºè®®é™ä½æŒä¹…åŒ–æ“ä½œçš„å†…å­˜å æ¯”ï¼Œæé«˜shuffleæ“ä½œçš„å†…å­˜å æ¯”æ¯”ä¾‹ï¼Œé¿å…shuffleè¿‡ç¨‹ä¸­æ•°æ®è¿‡å¤šæ—¶å†…å­˜ä¸å¤Ÿç”¨ï¼Œå¿…é¡»æº¢å†™åˆ°ç£ç›˜ä¸Šï¼Œé™ä½äº†æ€§èƒ½ã€‚æ­¤å¤–ï¼Œå¦‚æœå‘ç°ä½œä¸šç”±äºé¢‘ç¹çš„gcå¯¼è‡´è¿è¡Œç¼“æ…¢ï¼Œæ„å‘³ç€taskæ‰§è¡Œç”¨æˆ·ä»£ç çš„å†…å­˜ä¸å¤Ÿç”¨ï¼Œé‚£ä¹ˆåŒæ ·å»ºè®®è°ƒä½è¿™ä¸ªå‚æ•°çš„å€¼ã€‚\n\n>èµ„æºå‚æ•°çš„è°ƒä¼˜ï¼Œæ²¡æœ‰ä¸€ä¸ªå›ºå®šçš„å€¼ï¼Œéœ€è¦åŒå­¦ä»¬æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µï¼ˆåŒ…æ‹¬Sparkä½œä¸šä¸­çš„shuffleæ“ä½œæ•°é‡ã€RDDæŒä¹…åŒ–æ“ä½œæ•°é‡ä»¥åŠspark web uiä¸­æ˜¾ç¤ºçš„ä½œä¸šgcæƒ…å†µï¼‰ï¼ŒåŒæ—¶å‚è€ƒæœ¬ç¯‡æ–‡ç« ä¸­ç»™å‡ºçš„åŸç†ä»¥åŠè°ƒä¼˜å»ºè®®ï¼Œåˆç†åœ°è®¾ç½®ä¸Šè¿°å‚æ•°ã€‚\n\n#### èµ„æºå‚æ•°å‚è€ƒç¤ºä¾‹\n\nä»¥ä¸‹æ˜¯ä¸€ä»½spark-submitå‘½ä»¤çš„ç¤ºä¾‹ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒä¸€ä¸‹ï¼Œå¹¶æ ¹æ®è‡ªå·±çš„å®é™…æƒ…å†µè¿›è¡Œè°ƒèŠ‚ï¼š\n\n```shell\n./bin/spark-submit \\\n  --master yarn-cluster \\\n  --num-executors 100 \\\n  --executor-memory 6G \\\n  --executor-cores 4 \\\n  --driver-memory 1G \\\n  --conf spark.default.parallelism=1000 \\\n  --conf spark.storage.memoryFraction=0.5 \\\n  --conf spark.shuffle.memoryFraction=0.3 \\\n```\n\n","tags":["Spark","å¤§æ•°æ®"],"categories":["å¤§æ•°æ®","Spark"]},{"title":"Sparkéƒ¨ç½²æ¨¡å¼","url":"/2023/10/19/Sparkéƒ¨ç½²æ¨¡å¼/","content":"\n# ç®€ä»‹\n\n`Spark Application`æäº¤è¿è¡Œæ—¶çš„éƒ¨ç½²æ¨¡å¼`Deploy Mode`ï¼Œè¡¨ç¤ºçš„æ˜¯`Driver Program`è¿è¡Œçš„åœ°æ–¹ã€‚\n- `client`:Driver Program è¿è¡Œåœ¨`æäº¤åº”ç”¨çš„Client`ä¸Š\n- `cluster`:è¦ä¹ˆå°±æ˜¯é›†ç¾¤ä¸­ä»èŠ‚ç‚¹`(Standaloneï¼šWorkerï¼ŒYARNï¼šNodeManager)`ã€‚\n\né»˜è®¤å€¼ä¸º`client`ï¼Œå½“åœ¨å®é™…çš„å¼€å‘ç¯å¢ƒä¸­ï¼Œå°¤å…¶æ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œä½¿ç”¨`cluster`éƒ¨ç½²æ¨¡å¼æäº¤åº”ç”¨è¿è¡Œã€‚\n\n# Client æ¨¡å¼\n\nä»¥`Spark Application`è¿è¡Œåˆ°`Standalone`é›†ç¾¤ä¸Šä¸ºä¾‹ï¼Œå‰é¢æäº¤è¿è¡Œåœ†å‘¨ç‡PIæˆ–è€…è¯é¢‘ç»Ÿè®¡`WordCountç¨‹åº`æ—¶ï¼Œé»˜è®¤ `DeployMode`ä¸º`Client`ï¼Œè¡¨ç¤ºåº”ç”¨`Driver Program`è¿è¡Œåœ¨æäº¤åº”ç”¨çš„`Client ä¸»æœº`ä¸Šï¼ˆå¯åŠ¨ JVM Process è¿›ç¨‹ï¼‰ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š\n![Clientæ¨¡å¼](./Sparkéƒ¨ç½²æ¨¡å¼/Deploy-Mode-Client.jpg)\n\n# Cluster æ¨¡å¼\n\nå¦‚æœé‡‡ç”¨clusteræ¨¡å¼è¿è¡Œåº”ç”¨ï¼Œåº”ç”¨Driver Programè¿è¡Œåœ¨é›†ç¾¤ä»èŠ‚ç‚¹WorkeræŸå°æœºå™¨ä¸Šï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š\n![Clusteræ¨¡å¼](./Sparkéƒ¨ç½²æ¨¡å¼/Deploy-Mode-Cluster.jpg)\n\n\n```scala\npackage cn.kaizi.spark\n\nimport org.apache.spark.rdd.RDD\nimport org.apache.spark.{SparkConf, SparkContext}\n\n\n/**\n * åŸºäºScalaè¯­è¨€ä½¿ç”¨SparkCoreç¼–ç¨‹å®ç°è¯é¢‘ç»Ÿè®¡ï¼šWordCount\n * ä»HDFSä¸Šè¯»å–æ•°æ®ï¼Œç»Ÿè®¡WordCountï¼Œå°†ç»“æœä¿å­˜åˆ°HDFSä¸Š\n **/\n\nobject SparkWordCount {\n\n  // TODO: å½“åº”ç”¨è¿è¡Œåœ¨é›†ç¾¤ä¸Šçš„æ—¶å€™ï¼ŒMAINå‡½æ•°å°±æ˜¯Driver Programï¼Œå¿…é¡»åˆ›å»ºSparkContextå¯¹è±¡\n  def main(args: Array[String]): Unit = {\n    // åˆ›å»ºSparkConfå¯¹è±¡ï¼Œè®¾ç½®åº”ç”¨çš„é…ç½®ä¿¡æ¯ï¼Œæ¯”å¦‚åº”ç”¨åç§°å’Œåº”ç”¨è¿è¡Œæ¨¡å¼\n    val sparkConf: SparkConf = new SparkConf()\n      .setMaster(\"local[2]\")  // è®¾ç½®è¿è¡Œæœ¬åœ°æ¨¡å¼\n      .setAppName(\"SparkWordCount\")\n    // æ„å»ºSparkContextä¸Šä¸‹æ–‡å®ä¾‹å¯¹è±¡ï¼Œè¯»å–æ•°æ®å’Œè°ƒåº¦Jobæ‰§è¡Œ\n    val sc: SparkContext = new SparkContext(sparkConf)\n\n    // ************ç¬¬ä¸€æ­¥ã€è¯»å–æ•°æ®:åœ¨Sparkçš„Executorä¸­æ‰§è¡Œ***************\n    // å°è£…åˆ°RDDé›†åˆï¼Œè®¤ä¸ºåˆ—è¡¨List\n    val inputRDD: RDD[String] = sc.textFile(\"/datas/wordcount.data\")\n    // ***************************************************************\n\n    // ************ç¬¬äºŒæ­¥ã€å¤„ç†æ•°æ®:åœ¨Sparkçš„Executorä¸­æ‰§è¡Œ***************\n    // è°ƒç”¨RDDä¸­å‡½æ•°ï¼Œè®¤ä¸ºè°ƒç”¨åˆ—è¡¨ä¸­çš„å‡½æ•°\n    // a. æ¯è¡Œæ•°æ®åˆ†å‰²ä¸ºå•è¯\n    val wordsRDD = inputRDD.flatMap(line => line.split(\"\\\\s+\"))\n    // b. è½¬æ¢ä¸ºäºŒå…ƒç»„ï¼Œè¡¨ç¤ºæ¯ä¸ªå•è¯å‡ºç°ä¸€æ¬¡\n    val tuplesRDD: RDD[(String, Int)] = wordsRDD.map(word => (word, 1))\n    // c. æŒ‰ç…§Keyåˆ†ç»„èšåˆ\n    val wordCountsRDD: RDD[(String, Int)] = tuplesRDD.reduceByKey((tmp, item) => tmp + item)\n    // ***************************************************************\n\n    // ************ç¬¬ä¸‰æ­¥ã€è¾“å‡ºæ•°æ®:åœ¨Sparkçš„Executorä¸­æ‰§è¡Œ****************\n    wordCountsRDD.foreach(println)\n    // ä¿å­˜åˆ°ä¸ºå­˜å‚¨ç³»ç»Ÿï¼Œæ¯”å¦‚HDFS\n    wordCountsRDD.saveAsTextFile(s\"/datas/swc-output-${System.currentTimeMillis()}\")\n    // ***************************************************************\n\n    // ä¸ºäº†æµ‹è¯•ï¼Œçº¿ç¨‹ä¼‘çœ ï¼ŒæŸ¥çœ‹WEB UIç•Œé¢\n    Thread.sleep(10000000)\n    // TODOï¼šåº”ç”¨ç¨‹åºè¿è¡Œæ¥æ”¶ï¼Œå…³é—­èµ„æº\n    sc.stop()\n  }\n}\n\n```\n\n> mainæ–¹æ³•ä¸­ä¸€å¼€å§‹çš„åˆ›å»ºSparkContextå¯¹è±¡å’Œæœ€åçš„å…³é—­SparkContextèµ„æºï¼Œéƒ½æ˜¯åœ¨Driver Programä¸­æ‰§è¡Œçš„ï¼Œä»£ç ä¸­çš„ç¬¬ä¸€æ­¥åŠ è½½æ•°æ®ã€ç¬¬äºŒæ­¥å¤„ç†æ•°æ®ã€ç¬¬ä¸‰æ­¥è¾“å‡ºæ•°æ®éƒ½æ˜¯åœ¨Executorä¸Šæ‰§è¡Œã€‚\n\nç»¼ä¸Šæ‰€è¿°Spark Applicationä¸­Jobæ‰§è¡Œæœ‰ä¸¤ä¸ªä¸»è¦ç‚¹ï¼š\n- RDDè¾“å‡ºå‡½æ•°åˆ†ç±»ä¸¤ç±»\n    - ç¬¬ä¸€ç±»ï¼šè¿”å›å€¼ç»™`Driver Progam`ï¼Œæ¯”å¦‚`count`ã€`first`ã€`take`ã€`collect`ç­‰\n    - ç¬¬äºŒç±»ï¼šæ²¡æœ‰è¿”å›å€¼ï¼Œæ¯”å¦‚ç›´æ¥æ‰“å°ç»“æœã€ä¿å­˜è‡³å¤–éƒ¨å­˜å‚¨ç³»ç»Ÿï¼ˆHDFSæ–‡ä»¶ï¼‰ç­‰\n- åœ¨`Job`ä¸­ä»è¯»å–æ•°æ®å°è£…ä¸º`RDD`å’Œä¸€åˆ‡`RDDè°ƒç”¨æ–¹æ³•`éƒ½æ˜¯åœ¨`Executor`ä¸­æ‰§è¡Œï¼Œå…¶ä»–ä»£ç éƒ½æ˜¯åœ¨`Driver Program`ä¸­æ‰§è¡Œ\n    - `SparkContext`åˆ›å»ºä¸å…³é—­ã€å…¶ä»–å˜é‡åˆ›å»ºç­‰åœ¨`Driver Program`ä¸­æ‰§è¡Œ\n    - `RDDè°ƒç”¨å‡½æ•°`éƒ½æ˜¯åœ¨Executorsä¸­æ‰§è¡Œ\n\n\n# Clientæ¨¡å¼å’ŒClusteræ¨¡å¼çš„åŒºåˆ«\n\nClusterå’ŒClientæ¨¡å¼æœ€æœ¬è´¨çš„åŒºåˆ«æ˜¯ï¼šDriverç¨‹åºè¿è¡Œåœ¨å“ªé‡Œã€‚\n- clusteræ¨¡å¼ï¼šç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨è¯¥æ¨¡å¼\n  - Driverç¨‹åºåœ¨YARNé›†ç¾¤å½“ä¸­\n  - åº”ç”¨çš„è¿è¡Œç»“æœä¸èƒ½åœ¨å®¢æˆ·ç«¯æ˜¾ç¤º\n- clientæ¨¡å¼ï¼šå­¦ä¹ æµ‹è¯•æ—¶ä½¿ç”¨ï¼ˆä¹Ÿä¸ä¸€å®šï¼Œä¸ªäººè§‰å¾—ç”Ÿäº§ç¯å¢ƒä¹Ÿå¯ä»¥ç”¨ï¼‰\n  - Driverè¿è¡Œåœ¨Clientä¸Šçš„SparkSubmitè¿›ç¨‹ä¸­\n  - åº”ç”¨ç¨‹åºè¿è¡Œç»“æœä¼šåœ¨å®¢æˆ·ç«¯æ˜¾ç¤º\n\n\n","tags":["Spark","å¤§æ•°æ®"],"categories":["å¤§æ•°æ®","Spark"]},{"title":"Linuxç³»ç»Ÿä¸­Pycharmç•Œé¢æ˜¾ç¤ºé—®é¢˜","url":"/2023/08/06/Linuxç³»ç»Ÿä¸­Pycharmç•Œé¢æ˜¾ç¤ºé—®é¢˜/","content":"\n# å‰è¨€\næ‰“å¼€`Pycharm`ï¼Œæ¿€æ´»ç•Œé¢ä¸­çš„ä¸­æ–‡æ˜¾ç¤ºä¸äº†ï¼Œå› ä¸ºç¼ºå°‘äº†å­—ä½“ï¼Œ`æ–‡æ³‰é©¿æ­£é»‘`ï¼Œæˆ‘ç”¨çš„æ˜¯`Fedora`ï¼Œè®°å½•ä¸€ä¸‹`Fedora`ä¸‹å®‰è£…`æ–‡æ³‰é©¿æ­£é»‘`è¿™ä¸ªå­—ä½“\n\n# å®‰è£…`æ–‡æ³‰é©¿æ­£é»‘`\n## å®‰è£…\n```shell\nsudo dnf install -y wqy-zenhei-fonts\n```\n> ä¹Ÿå¯ä»¥ä½¿ç”¨`Fedora`çš„è½¯ä»¶åŒ…ç®¡ç†å™¨å®‰è£…`ttf-wqy-zenhei`å­—ä½“åŒ…\n\n## åˆ·æ–°å­—ä½“\n```shell\nfc-cache -f -v\n```\n\n## éªŒè¯\n```shell\nfc-list | grep \"æ–‡æ³‰é©¿æ­£é»‘\"\n```\n\n","categories":["Linux"]},{"title":"Pythonä¸­çš„argså’Œkwargså‚æ•°","url":"/2023/07/14/Pythonä¸­çš„argså’Œkwargså‚æ•°/","content":"# *args && **kwargs\nåœ¨Pythoné¡¹ç›®çš„ä»£ç ä¸­ç»å¸¸ä¼šè§åˆ°è¿™ä¸¤ä¸ªè¯ args å’Œ kwargsï¼Œå‰é¢é€šå¸¸è¿˜ä¼šåŠ ä¸Šä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªæ˜Ÿå·ã€‚å…¶å®è¿™åªæ˜¯ç¼–ç¨‹äººå‘˜çº¦å®šçš„å˜é‡åå­—ï¼Œargs æ˜¯ arguments çš„ç¼©å†™ï¼Œè¡¨ç¤ºä½ç½®å‚æ•°ï¼›kwargs æ˜¯ keyword arguments çš„ç¼©å†™ï¼Œè¡¨ç¤ºå…³é”®å­—å‚æ•°ã€‚è¿™å…¶å®å°±æ˜¯ Python ä¸­å¯å˜å‚æ•°çš„ä¸¤ç§å½¢å¼ï¼Œå¹¶ä¸” *args å¿…é¡»æ”¾åœ¨ **kwargs çš„å‰é¢ï¼Œå› ä¸ºä½ç½®å‚æ•°åœ¨å…³é”®å­—å‚æ•°çš„å‰é¢ã€‚\n\n# åœ¨å‡½æ•°å®šä¹‰ä¸­çš„ç”¨æ³•\n\n## *argsçš„ç”¨æ³•\n*argså°±æ˜¯å°±æ˜¯ä¼ é€’ä¸€ä¸ªå¯å˜å‚æ•°åˆ—è¡¨ç»™å‡½æ•°å®å‚ï¼Œè¿™ä¸ªå‚æ•°åˆ—è¡¨çš„æ•°ç›®æœªçŸ¥ï¼Œç”šè‡³é•¿åº¦å¯ä»¥ä¸º0ã€‚ä¸‹é¢è¿™æ®µä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨args\n```python\ndef test_args(first, *args):\n    print('Required argument: ', first)\n    print(type(args))\n    for v in args:\n        print ('Optional argument: ', v)\n\ntest_args(1, 2, 3, 4)\n```\nç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¿…é¡»è¦ä¼ å…¥çš„å‚æ•°ï¼Œæ‰€ä»¥ä½¿ç”¨äº†ç¬¬ä¸€ä¸ªå½¢å‚ï¼Œè€Œåé¢ä¸‰ä¸ªå‚æ•°åˆ™ä½œä¸ºå¯å˜å‚æ•°åˆ—è¡¨ä¼ å…¥äº†å®å‚ï¼Œå¹¶ä¸”æ˜¯ä½œä¸ºå…ƒç»„tupleæ¥ä½¿ç”¨çš„ã€‚ä»£ç çš„è¿è¡Œç»“æœå¦‚ä¸‹:\n```\nRequired argument:  1\n<class 'tuple'>\nOptional argument:  2\nOptional argument:  3\nOptional argument:  4\n```\n\n## **kwargsç”¨æ³•\n**kwargsåˆ™æ˜¯å°†ä¸€ä¸ªå¯å˜çš„å…³é”®å­—å‚æ•°çš„å­—å…¸ä¼ ç»™å‡½æ•°å®å‚ï¼ŒåŒæ ·å‚æ•°åˆ—è¡¨é•¿åº¦å¯ä»¥ä¸º0æˆ–ä¸ºå…¶ä»–å€¼ã€‚ä¸‹é¢è¿™æ®µä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨kwargsï¼š\n```python\ndef test_kwargs(first, *args, **kwargs):\n   print('Required argument: ', first)\n   print(type(kwargs))\n   for v in args:\n      print ('Optional argument (args): ', v)\n   for k, v in kwargs.items():\n      print ('Optional argument %s (kwargs): %s' % (k, v))\n\ntest_kwargs(1, 2, 3, 4, k1=5, k2=6)\n```\næ­£å¦‚å‰é¢æ‰€è¯´çš„ï¼Œargsç±»å‹æ˜¯ä¸€ä¸ªtupleï¼Œè€Œkwargsåˆ™æ˜¯ä¸€ä¸ªå­—å…¸dictï¼Œå¹¶ä¸”argsåªèƒ½ä½äºkwargsçš„å‰é¢ã€‚ä»£ç çš„è¿è¡Œç»“æœå¦‚ä¸‹:\n```\nRequired argument:  1\n<class 'dict'>\nOptional argument (args):  2\nOptional argument (args):  3\nOptional argument (args):  4\nOptional argument k2 (kwargs): 6\nOptional argument k1 (kwargs): 5\n```\n\n# è°ƒç”¨å‡½æ•°ä¸­çš„ç”¨æ³•\nargså’Œkwargsä¸ä»…å¯ä»¥åœ¨å‡½æ•°å®šä¹‰ä¸­ä½¿ç”¨ï¼Œè¿˜å¯ä»¥åœ¨å‡½æ•°è°ƒç”¨ä¸­ä½¿ç”¨ã€‚åœ¨è°ƒç”¨æ—¶ä½¿ç”¨å°±ç›¸å½“äºpackï¼ˆæ‰“åŒ…ï¼‰å’Œunpackï¼ˆè§£åŒ…ï¼‰ï¼Œç±»ä¼¼äºå…ƒç»„çš„æ‰“åŒ…å’Œè§£åŒ…ã€‚\n\né¦–å…ˆæ¥çœ‹ä¸€ä¸‹ä½¿ç”¨argsæ¥è§£åŒ…è°ƒç”¨å‡½æ•°çš„ä»£ç ï¼š\n```python\ndef test_args_kwargs(arg1, arg2, arg3):\n    print(\"arg1:\", arg1)\n    print(\"arg2:\", arg2)\n    print(\"arg3:\", arg3)\n\nargs = (\"two\", 3, 5)\ntest_args_kwargs(*args)\n\n```\nè¾“å‡ºï¼š\n```\narg1: two\narg2: 3\narg3: 5\n```\n> å°†å…ƒç»„è§£åŒ…åä¼ ç»™å¯¹åº”çš„å®å‚ï¼Œkwargsçš„ç”¨æ³•ä¸å…¶ç±»ä¼¼ã€‚\n\n```python\nkwargs = {\"arg3\": 3, \"arg2\": \"two\", \"arg1\": 5}\ntest_args_kwargs(**kwargs)\n```\nè¾“å‡ºï¼š\n```\narg1: 5\narg2: two\narg3: 3\n```\n\n# æ€»ç»“\nargså’Œkwargsç»„åˆèµ·æ¥å¯ä»¥ä¼ å…¥ä»»æ„çš„å‚æ•°ï¼Œè¿™åœ¨å‚æ•°æœªçŸ¥çš„æƒ…å†µä¸‹æ˜¯å¾ˆæœ‰æ•ˆçš„ï¼ŒåŒæ—¶åŠ å¼ºäº†å‡½æ•°çš„å¯æ‹“å±•æ€§ã€‚","tags":["args","kwargs"],"categories":["Python","åŸºç¡€"]},{"title":"Pythonä¸­è£…é¥°å™¨çš„wrapsçš„ä½œç”¨","url":"/2023/07/14/Pythonä¸­è£…é¥°å™¨çš„wrapsçš„ä½œç”¨/","content":"\n# è£…é¥°å™¨\n`Python`è£…é¥°å™¨`decorator`åœ¨å®ç°çš„æ—¶å€™ï¼Œè¢«è£…é¥°åçš„å‡½æ•°å…¶å®å·²ç»æ˜¯å¦å¤–ä¸€ä¸ªå‡½æ•°äº†ï¼ˆå‡½æ•°åç­‰å‡½æ•°å±æ€§ä¼šå‘ç”Ÿæ”¹å˜ï¼‰ï¼Œå°±ç›¸å½“äºäº§ç”Ÿäº†`å‰¯ä½œç”¨`ï¼Œ`Python`çš„`functools`åŒ…ä¸­æä¾›äº†ä¸€ä¸ªå«`wraps`çš„`decorator`æ¥æ¶ˆé™¤è¿™æ ·çš„`å‰¯ä½œç”¨`ã€‚å†™ä¸€ä¸ª`decorator`çš„æ—¶å€™ï¼Œæœ€å¥½åœ¨å®ç°ä¹‹å‰åŠ ä¸Š`functools`çš„`wrap`ï¼Œå®ƒèƒ½ä¿ç•™åŸæœ‰å‡½æ•°çš„`__name__`å’Œ`__doc__`ã€‚\n\n# ç¤ºä¾‹1ï¼ˆå‰¯ä½œç”¨ï¼‰\n```python\ndef my_decorator(func):\n    def wrapper(*args, **kwargs):\n        \"\"\"decorator\"\"\"\n        print('Calling decorated function...')\n        return func(*args, **kwargs)\n\n    return wrapper\n\n\n@my_decorator\ndef example():\n    \"\"\"DocString\"\"\"\n    print('Called example function.')\n\n\nprint(example.__name__, example.__doc__)\n\nif __name__ == '__main__':\n    example()\n\n```\n> æ‰“å°ç°æ¥çš„æ˜¯ï¼šwrapper decorator è€Œä¸æ˜¯ example DocString\n\n# ç¤ºä¾‹2ï¼ˆæ¶ˆé™¤å‰¯ä½œç”¨ï¼‰\n```python\nfrom functools import wraps\n\n\ndef my_decorator(func):\n    @wraps(func)\n    def wrapper(*args, **kwargs):\n        \"\"\"Decorator\"\"\"\n        print('Calling decorated function...')\n        return func(*args, **kwargs)\n\n    return wrapper\n\n\n@my_decorator\ndef example():\n    \"\"\"DocString\"\"\"\n    print('Called example function')\n\n\nif __name__ == '__main__':\n    example()\n\n```\n\n> æ— æ¯’å‰¯ä½œç”¨, è¿™å°±æ˜¯`@wraps`çš„ä½œç”¨","categories":["Python","åŸºç¡€"]},{"title":"æ€ä¹ˆæŠŠK8Sä¸­éƒ¨ç½²çš„æœåŠ¡ç«¯å£æ˜ å°„å‡ºæ¥","url":"/2023/06/30/æ€ä¹ˆæŠŠK8Sä¸­éƒ¨ç½²çš„æœåŠ¡ç«¯å£æ˜ å°„å‡ºæ¥/","content":"1. ä¿®æ”¹fate-10001å‘½åç©ºé—´ä¸‹çš„mysqlçš„ç«¯å£æ˜ å°„æ¨¡å¼\n   - å…ˆæŸ¥çœ‹fate-10001ä¸‹æœ‰å“ªäº›æœåŠ¡\n   ```shell\n   kubectl get svc -n fate-10001\n   ```\n    ```\n    NAME                 TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)                               AGE\n    spark-master         ClusterIP      None            <none>          8080/TCP,7077/TCP,6066/TCP            16d\n    fateflow             ClusterIP      None            <none>          9360/TCP,9380/TCP                     16d\n    spark-worker-1       ClusterIP      None            <none>          8081/TCP                              16d\n    fateflow-client      ClusterIP      10.43.80.240    <none>          9360/TCP,9380/TCP                     16d\n    datanode             ClusterIP      10.43.247.69    <none>          9000/TCP,9864/TCP                     16d\n    frontend             NodePort       10.43.24.110    <none>          8080:31925/TCP,8443:31194/TCP         16d\n    notebook             ClusterIP      10.43.41.5      <none>          20000/TCP                             16d\n    fateboard            ClusterIP      10.43.3.44      <none>          8080/TCP                              16d\n    namenode             ClusterIP      10.43.146.160   <none>          9000/TCP,9870/TCP                     16d\n    pulsar               ClusterIP      10.43.42.170    <none>          6650/TCP,6651/TCP,8080/TCP,8081/TCP   16d\n    postgres             ClusterIP      10.43.182.72    <none>          5432/TCP                              16d\n    mysql                ClusterIP      10.43.42.233    <none>          3306/TCP                              16d\n    nginx                NodePort       10.43.101.234   <none>          9300:31960/TCP,9310:32603/TCP         16d\n    spark-client         ClusterIP      10.43.69.60     <none>          8080/TCP,7077/TCP,6066/TCP            16d\n    site-portal-server   ClusterIP      10.43.237.196   <none>          8080/TCP,8443/TCP                     16d\n    pulsar-public-tls    LoadBalancer   10.43.144.61    192.168.11.71   6651:32593/TCP                        16d\n    ```\n    > æ³¨æ„msyql çš„type æ˜¯ ClusterIPï¼Œè¿™æ ·å°±åªèƒ½è¢«k8sé›†ç¾¤å†…éƒ¨è®¿é—®è€Œä¸èƒ½è¢«å¤–éƒ¨è®¿é—®åˆ°ï¼Œæ‰€ä»¥è¿™é‡Œè¦æŠŠå®ƒæ”¹ä¸ºNodePortæ¨¡å¼\n\n    - ä¿®æ”¹mysqlçš„type\n    ```shell\n    kubectl edit svc mysql -n fate-10001\n    ```\n\n    ```yaml\n    apiVersion: v1\n    kind: Service\n    metadata:\n    annotations:\n        meta.helm.sh/release-name: party10001\n        meta.helm.sh/release-namespace: fate-10001\n    creationTimestamp: \"2023-06-13T05:46:12Z\"\n    labels:\n        app.kubernetes.io/managed-by: Helm\n        chart: fate\n        cluster: fate\n        fateMoudle: mysql\n        heritage: Helm\n        name: party10001\n        owner: kubefate\n        partyId: \"10001\"\n        release: party10001\n    name: mysql\n    namespace: fate-10001\n    resourceVersion: \"33441\"\n    uid: 08d5e8fe-7853-4f85-b17c-9315afdd6055\n    spec:\n    clusterIP: 10.43.42.233\n    clusterIPs:\n    - 10.43.42.233\n    internalTrafficPolicy: Cluster\n    ipFamilies:\n    - IPv4\n    ipFamilyPolicy: SingleStack\n    ports:\n    - name: tcp-mysql\n        port: 3306\n        protocol: TCP\n        targetPort: 3306\n    selector:\n        fateMoudle: mysql\n        name: party10001\n        partyId: \"10001\"\n    sessionAffinity: None\n    type: ClusterIP\n    status:\n    loadBalancer: {}\n    ```\n    ä¿®æ”¹åçš„å†…å®¹ä¸ºï¼š\n    ```yaml\n    apiVersion: v1\n    kind: Service\n    metadata:\n    annotations:\n        meta.helm.sh/release-name: party10001\n        meta.helm.sh/release-namespace: fate-10001\n    creationTimestamp: \"2023-06-13T05:46:12Z\"\n    labels:\n        app.kubernetes.io/managed-by: Helm\n        chart: fate\n        cluster: fate\n        fateMoudle: mysql\n        heritage: Helm\n        name: party10001\n        owner: kubefate\n        partyId: \"10001\"\n        release: party10001\n    name: mysql\n    namespace: fate-10001\n    resourceVersion: \"33441\"\n    uid: 08d5e8fe-7853-4f85-b17c-9315afdd6055\n    spec:\n    clusterIP: 10.43.42.233\n    clusterIPs:\n    - 10.43.42.233\n    internalTrafficPolicy: Cluster\n    externalTrafficPolicy: Cluster\n    ipFamilies:\n    - IPv4\n    ipFamilyPolicy: SingleStack\n    ports:\n    - name: tcp-mysql\n        port: 3306\n        protocol: TCP\n        targetPort: 3306\n        nodePort: 31306\n    selector:\n        fateMoudle: mysql\n        name: party10001\n        partyId: \"10001\"\n    sessionAffinity: None\n    type: NodePort\n    status:\n    loadBalancer: {}\n    ```","tags":["k8s","ç«¯å£æ˜ å°„"],"categories":["äº‘åŸç”Ÿ","åŸºç¡€è®¾æ–½"]},{"title":"vimå¸¸ç”¨æ’ä»¶çš„ä½¿ç”¨å¤‡å¿˜å½•","url":"/2023/06/16/vimå¸¸ç”¨æ’ä»¶çš„ä½¿ç”¨å¤‡å¿˜å½•/","content":"\n\n# `vim-surround` çš„ç”¨æ³•\n- `cs'\"`ç”¨åŒå¼•å·æ›¿æ¢å•å¼•å·\n- `cs\"'`ç”¨å•å¼•å·æ›¿æ¢åŒå¼•å·\n- `ysiw<q>`ç»™å½“å‰å•è¯åŠ ä¸Šæ ‡ç­¾`<q>`\n- `cst\"`ç”¨åŒå¼•å·æ›¿æ¢å½“å‰çš„æ ‡ç­¾\n- `ds'`åˆ é™¤å•å¼•å·\n- `ysiw]`åœ¨å½“å‰å•è¯å¤–åŠ ä¸Šæ–¹æ‹¬å·\n- `yss]`åœ¨å½“å‰å¥å­å¤„åŠ ä¸Šæ–¹æ‹¬å·  \n\n# vimç¼–è¾‘`markdown`åœ¨æµè§ˆå™¨ä¸­é¢„è§ˆæ•ˆæœ\n- å®‰è£…`coc-nvim`æ’ä»¶\n- ä½¿ç”¨`coc-nvim`æ’ä»¶å®‰è£…`coc-markdown`æ’ä»¶\n- ä½¿ç”¨`:CocCommand markdown-preview-enhanced.openPreview`å‘½ä»¤åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€é¢„è§ˆ\n\n# `coc-vim`çš„ä½¿ç”¨\n- å¯ä»¥å…ˆå®‰è£…ä¸€ä¸ª`coc-marketplace`æ’ä»¶:`:CocInstall coc-marketplace`\n- `CocList marketplace`åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„æ’ä»¶\n- åœ¨é€‰ä¸­çš„æ’ä»¶ä¸Šå¯ä»¥ä½¿ç”¨`tab`æ¥è¿›è¡Œ`install`,`uninstall`,`homepage`ç­‰åŠ¨ä½œ\n\n# `vim-easy-align`çš„ä½¿ç”¨\n\n```\n  Lorem   = ipsum\n  dolor   = sit\n   amet  += consectetur == adipiscing\n   elit  -= sed           != do\neiusmod   = tempor        = incididunt\n     ut &&= labore\n```\n- normalæ¨¡å¼ä¸‹ï¼š`gaip`\n  - `=`Around the 1st occurrentces\n  - `2=`Around the 2nd occurrences\n  - `*=`Around all occurrences\n  - `**=`Left/Right alternating alignment around all occurrences\n  - `<Enter>`Switching between left/right/center alignment modes\n\n- `visual line` æ¨¡å¼: `vip`\n  - `ga`è¿›å…¥`easyalign`æ¨¡å¼\n  - `<Enter>` åˆ‡æ¢å¯¹é½æ¨¡å¼\n  - è¾“å…¥`å¯¹é½ç›®æ ‡å­—ç¬¦`, å†`<Space>` å®Œæˆå¯¹é½æ“ä½œ\n\n# `nerdtree`çš„ä½¿ç”¨\n- `j`, `k` åœ¨ç›®å½•ä¸‹ä¸Šç§»åŠ¨\n- `o`å±•å¼€ç›®å½•æˆ–æ‰“å¼€æ–‡ä»¶ï¼Œç„¦ç‚¹ä¼šè·‘åˆ°å³ä¾§æ–‡ä»¶è§†å›¾ä¸­\n- `ctrl + w + h`å¯ä»¥è®©ç„¦ç‚¹ä»æ–‡ä»¶ä¸­å›åˆ°å·¦ä¾§ç›®å½•è§†å›¾ä¸­\n- `:NERDTreeToggle`å‘½ä»¤æ˜¯`NERDTree`æ‰“å¼€æˆ–å…³é—­çš„å¼€å…³,åœ¨`.vimrc`ä¸­è®¾ç½®å¿«æ·é”®æŠŠå®ƒç”¨`F3`æ¥æ§åˆ¶\n    ```shell\n    \" è®¾ç½®NerdTree\n    map <F3> :NERDTreeMirror<CR>\n    map <F3> :NERDTreeToggle<CR>\n    ```\n# `TagBar`çš„ä½¿ç”¨\n- `:TagbarToggle`\n","tags":["vim","plugin"],"categories":["Linux"]},{"title":"k8sä¸­configMapç¼–è¾‘ç¤ºä¾‹","url":"/2023/06/14/k8sä¸­configMapç¼–è¾‘ç¤ºä¾‹/","content":"\n# èƒŒæ™¯\néƒ¨ç½²åœ¨k3sä¸­çš„ä¸€ä¸ªåº”ç”¨ï¼Œåœ¨å‰ç«¯é¡µé¢ä¸­ä¸Šä¼ æ–‡ä»¶ï¼Œå‡ºç°æŠ¥é”™ï¼Œæç¤ºæ˜¯æ–‡ä»¶å¤ªå¤§ã€‚éœ€è¦ä¿®æ”¹nginxé…ç½®æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è¿™ä¸ªåº”ç”¨éƒ¨ç½²åœ¨fate-10000å‘½åç©ºé—´ä¸‹\n\n# è§£å†³\n- æŸ¥çœ‹ä¸€ä¸‹fate-10000è¿™ä¸ªå‘½åç©ºé—´\n  ```shell\n  kubectl get all  -n fate-10000\n  ```\n  ![æŸ¥çœ‹å‘½åç©ºé—´](k8sä¸­configMapç¼–è¾‘ç¤ºä¾‹/fate-10000.jpg)\n\n- å…ˆæŸ¥çœ‹ä¸€ä¸‹`site-portal`å‰ç«¯`pod`çš„æè¿°ä¿¡æ¯ï¼šä¾‹å­ä¸­ä¸º`fate-10000`å‘½åç©ºé—´ä¸‹çš„`frontend-85b6fdffc4-4lkpc`\n  ```shell\n  kubectl describe pod frontend-85b6fdffc4-4lkpc -n fate-10000\n  ```\n  ![frontendæè¿°ä¿¡æ¯](k8sä¸­configMapç¼–è¾‘ç¤ºä¾‹/frontend.jpg)\n> æ³¨æ„å›¾ä¸­nginxçš„é…ç½®æ–‡ä»¶ä¼šä»nginx-conf-httpsä¸­è·å–ä¸€äº›è¿ç»´è‡ªå®šä¹‰çš„é…ç½®ï¼Œnginx-conf-httpæ˜¯ä¸€ä¸ªconfigMap, configMapçš„ä½œç”¨æˆ‘ç†è§£çš„å°±æ˜¯ç»™è¿ç»´äººå‘˜åæœŸåŠ¨æ€å»ä¿®æ”¹é…ç½®ï¼Œpodä»configMapä¸­è·å–è¿™äº›è‡ªå®šä¹‰çš„å€¼åå°±è¾¾åˆ°äº†åŠ¨æ€ä¿®æ”¹é…ç½®çš„ç›®çš„ï¼Œå½“ç„¶configMapä¿®æ”¹åï¼Œç›¸å…³çš„podéœ€è¦é‡å¯\n\n- æŸ¥çœ‹å‘½åç©ºé—´ä¸‹çš„configMap\n  ```shell\n  kubectl get cm -n fate-10000\n  ```\n  ![configMap](k8sä¸­configMapç¼–è¾‘ç¤ºä¾‹/get-cm.jpg)\n\n- ç¼–è¾‘configMapä¸­çš„å†…å®¹\n  ```shell\n  kubectl edit cm nginx-conf-https -n fate-10000\n  ```\n  ![ç¼–è¾‘configMap](k8sä¸­configMapç¼–è¾‘ç¤ºä¾‹/edit-cm.jpg)\n\n- è·å–deployment\n  ```shell\n  kubectl get deploy -n fate-10000\n  ```\n  ![deployment](k8sä¸­configMapç¼–è¾‘ç¤ºä¾‹/deployment.jpg)\n\n- ç”¨å¦å¤–ä¸€ç§æ–¹å¼ç¡®è®¤æŸä¸ªpodæ˜¯å¦å’ŒæŸä¸ªconfigMapæœ‰å…³è”\n  ```shell\n  kubectl get deploy frontend -n fate-10000 -o yaml\n  ```\n  è¿”å›å¦‚ä¸‹ï¼š\n   ```yaml\n   apiVersion: apps/v1\n   kind: Deployment\n   metadata:\n   annotations:\n      deployment.kubernetes.io/revision: \"2\"\n      meta.helm.sh/release-name: party10000\n      meta.helm.sh/release-namespace: fate-10000\n   creationTimestamp: \"2023-06-14T01:09:35Z\"\n   generation: 2\n   labels:\n      app.kubernetes.io/managed-by: Helm\n      chart: fate\n      cluster: fate\n      fateMoudle: frontend\n      heritage: Helm\n      name: party10000\n      owner: kubefate\n      partyId: \"10000\"\n      release: party10000\n   name: frontend\n   namespace: fate-10000\n   resourceVersion: \"319024\"\n   uid: e62cf903-86b2-4799-96e1-f366ed4e3395\n   spec:\n   progressDeadlineSeconds: 600\n   replicas: 1\n   revisionHistoryLimit: 10\n   selector:\n      matchLabels:\n         fateMoudle: frontend\n         name: party10000\n         partyId: \"10000\"\n   strategy:\n      type: Recreate\n   template:\n      metadata:\n         annotations:\n         kubectl.kubernetes.io/restartedAt: \"2023-06-14T10:41:20+08:00\"\n         creationTimestamp: null\n         labels:\n         chart: fate\n         cluster: fate\n         fateMoudle: frontend\n         heritage: Helm\n         name: party10000\n         owner: kubefate\n         partyId: \"10000\"\n         release: party10000\n      spec:\n         containers:\n         - env:\n         - name: SITEPORTAL_SERVER_HOST\n            value: site-portal-server\n         image: federatedai/site-portal-frontend:v0.3.0\n         imagePullPolicy: IfNotPresent\n         name: frontend\n         ports:\n         - containerPort: 8443\n            protocol: TCP\n         resources: {}\n         terminationMessagePath: /dev/termination-log\n         terminationMessagePolicy: File\n         volumeMounts:\n         - mountPath: /var/lib/site-portal/cert\n            name: site-portal-cert\n         - mountPath: /etc/nginx/conf.d/nginx.conf.template\n            name: nginx-conf-https\n            subPath: nginx.conf.template\n         dnsPolicy: ClusterFirst\n         restartPolicy: Always\n         schedulerName: default-scheduler\n         securityContext: {}\n         serviceAccount: default\n         serviceAccountName: default\n         terminationGracePeriodSeconds: 30\n         volumes:\n         - name: site-portal-cert\n         secret:\n            defaultMode: 420\n            secretName: site-portal-cert\n         - configMap:\n            defaultMode: 420\n            name: nginx-conf-https\n         name: nginx-conf-https\n   status:\n   availableReplicas: 1\n   conditions:\n   - lastTransitionTime: \"2023-06-14T02:41:23Z\"\n      lastUpdateTime: \"2023-06-14T02:41:23Z\"\n      message: Deployment has minimum availability.\n      reason: MinimumReplicasAvailable\n      status: \"True\"\n      type: Available\n   - lastTransitionTime: \"2023-06-14T01:09:35Z\"\n      lastUpdateTime: \"2023-06-14T02:41:23Z\"\n      message: ReplicaSet \"frontend-85b6fdffc4\" has successfully progressed.\n      reason: NewReplicaSetAvailable\n      status: \"True\"\n      type: Progressing\n   observedGeneration: 2\n   readyReplicas: 1\n   replicas: 1\n   updatedReplicas: 1\n   ```\n  > æ³¨æ„çœ‹å…¶ä¸­çš„ configMap, å°±æ˜¯: nginx-conf-httpsï¼Œæ‰€ä»¥è¯´æ˜æˆ‘ä»¬å¯ä»¥å»æ”¹nginx-config-httpsè¿™ä¸ªconfigMapä¸­çš„å€¼ï¼Œä¿®æ”¹ä¼šä½œç”¨äºfrontend\n\n- ç¼–è¾‘configMap\n```shell\nkubectl edit cm nginx-conf-https -n fate-10000\n```\nä¸Šè¿°å‘½ä»¤ä¼šä½¿ç”¨nanoæ‰“å¼€configMap,å¯ä»¥å¯¹configMapè¿›è¡Œç¼–è¾‘\n![ç¼–è¾‘configMap](k8sä¸­configMapç¼–è¾‘ç¤ºä¾‹/edit-cm.jpg)\n\n- é‡å¯frontend\n```shell\nkubectl rollout restart deployment/frontend -n fate-10000\n```\n> æ³¨æ„è¿™ä¸ªå‘½ä»¤ä¸­çš„ `deployment/frontend`, å‘½ä»¤ä¸­éœ€è¦æœ‰`deployment/`åŠ åœ¨å‰é¢","tags":["configMap"],"categories":["äº‘åŸç”Ÿ","åŸºç¡€è®¾æ–½"]},{"title":"ABYå¼€æºæ¡†æ¶ç¼–è¯‘","url":"/2023/06/11/ABYå¼€æºæ¡†æ¶ç¼–è¯‘/","content":"\n# ABYå¼€æºæ¡†æ¶\n[ABYå¼€æºæ¡†æ¶](https://github.com/encryptogroup/ABY)\n\n# ç¼–è¯‘å‡†å¤‡\n\n- cmake\n\n  ```shell\n  sudo dnf install cmake\n  ```\n  \n- C Development Tools and Libraries\n\n  ```shell\n  sudo dnf group install \"C Development Tools and Libraries\" \"Development Tools\"\n  ```\n- boost\n\n  ```shell\n  sudo dnf install boost-devel\n  ```\n  \n- libgmp\n\n  ```shell\n  sudo dnf install gmp-devel\n  ```\n  \n- libssl\n\n  ```shell\n  sudo dnf install openssl-devel\n  ```\n\n# ç¼–è¯‘\n\n- git clone\n\n  ```shell\n  git clone https://github.com/encryptogroup/ABY.git\n  ```\n  \n- cd\n\n  ```shell\n  cd ABY/\n  ```\n- mkdir\n\n  ```shell\n  mkdir build && cd build\n  ```\n  \n- cmake && make && make install\n\n  ```shell\n  cmake .. -DCMAKE_INSTALL_PREFIX=\"\"\n  make\n  make DESTDIR=~/path/to/aby/prefix install\n  ```\n  \n  or\n\n  ```shell\n  cmake .. -DCMAKE_INSTALL_PREFIX=~/path/to/aby/prefix\n  make\n  make install\n  ```\n  \n> è¿™ä¸€æ­¥æˆ‘å‡ºé”™äº†ã€‚ç¼–è¯‘æŠ¥é”™æ–‡ä»¶ï¼š`ABY/extern/ENCRYPTO_utils/src/ENCRYPTO_utils/channel.cpp`\n> é”™è¯¯åŸå› å°±æ˜¯ç¼ºå°‘äº†`#include <cstdlib>`,å¼•å…¥å¤´æ–‡ä»¶åå°±å¥½äº†\n\n# ç¼–è¯‘é€‰é¡¹\n\n```shell\ncmake .. -DCMAKE_BUILD_TYPE=Release\n# or\ncmake .. -DCMAKE_BUILD_TYPE=Debug\n```\n\n","tags":["fedora","cmake","boost"]},{"title":"æ‰‹åŠ¨éƒ¨ç½²KubeFate","url":"/2023/06/09/æ‰‹åŠ¨éƒ¨ç½²KubeFate/","content":"\n# ä¾èµ–çš„è½¯ä»¶ç¯å¢ƒ\n- k8sï¼šæˆ‘ä½¿ç”¨çš„æ˜¯k3s\n- ingress-nginx\n- æ‹‰å–KubeFateçš„ä»£ç å¹¶ç¼–è¯‘ç”Ÿæˆkubefateå¯æ‰§è¡Œæ–‡ä»¶ï¼š\n```shell\ngit clone https://github.com/FederatedAI/KubeFATE.git\ncd kubefate\nmake\n```\n> å®˜æ–¹æ–‡æ¡£æœ‰æ¨èç‰ˆæœ¬ï¼Œæˆ‘æ²¡å»ç®¡å®ƒ\n\n# åˆ›å»ºk8sæœåŠ¡çš„å¸å·ä»¥åŠnamespaceç­‰\nåœ¨`KubeFATE/k8s-deploy`ç›®å½•ä¸‹ï¼Œæœ‰ä¸ª`rbac-config.yaml`æ–‡ä»¶ï¼Œé‡Œé¢æœ‰å®šä¹‰äº†å¸å·ï¼Œå‘½åç©ºé—´ç­‰å†…å®¹ï¼š\n```yaml\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: kube-fate\n  labels:\n    name: kube-fate\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kubefate-admin\n  namespace: kube-fate\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: kubefate\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: kubefate-role\nsubjects:\n  - kind: ServiceAccount\n    name: kubefate-admin\n    namespace: kube-fate\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: kubefate-secret\n  namespace: kube-fate\ntype: Opaque\nstringData:\n  kubefateUsername: admin\n  kubefatePassword: admin\n  mariadbUsername: kubefate\n  mariadbPassword: kubefate\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: kubefate-role\n  namespace: kube-fate\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - namespaces\n  - configmaps\n  - services\n  - secrets\n  - persistentvolumeclaims\n  - serviceaccounts\n  verbs:\n  - get\n  - list\n  - create\n  - delete\n  - update\n  - patch\n- apiGroups:\n  - \"\"\n  resources:\n  - pods\n  - pods/log\n  - nodes\n  verbs:\n  - get\n  - list\n- apiGroups:\n  - apps\n  resources:\n  - deployments\n  - statefulsets\n  - deployments/status\n  - statefulsets/status\n  verbs:\n  - get\n  - list\n  - create\n  - delete\n  - update\n  - patch\n- apiGroups:\n  - networking.k8s.io\n  resources:\n  - ingresses\n  verbs:\n  - get\n  - list\n  - create\n  - delete\n  - update\n  - patch\n- apiGroups:\n  - networking.istio.io\n  resources:\n  - gateways\n  - virtualservices\n  verbs:\n  - get\n  - create\n  - delete\n  - update\n  - patch\n- apiGroups:\n  - rbac.authorization.k8s.io\n  resources:\n  - roles\n  - rolebindings\n  verbs:\n  - get\n  - create\n  - delete\n  - update\n  - patch\n- apiGroups:\n    - batch\n  resources:\n    - jobs\n  verbs:\n    - get\n    - list\n    - create\n    - delete\n    - update\n    - patch\n```\n> å¦‚æœéœ€è¦ä¿®æ”¹ç”¨æˆ·åå¯†ç ä¹‹ç±»çš„ï¼Œå¯ä»¥æŸ¥çœ‹ä¸Šè¿°yamlä¸­çš„é…ç½®è‡ªè¡Œä¿®æ”¹\n\nåœ¨`KubeFATE/k8s-deploy`ç›®å½•ä¸‹æ‰§è¡Œï¼š\n```shell\nsudo kubectl apply -f ./rbac-config.yaml\n```\n\n# å‡†å¤‡åŸŸååŠéƒ¨ç½²KubeFATEæœåŠ¡\nå› ä¸ºKubeFATEæœåŠ¡å‘å¤–æš´éœ²RESTful APIsï¼Œæ‰€ä»¥ç³»ç»Ÿç®¡ç†å‘˜éœ€è¦ä¸ºæ­¤å‡†å¤‡åŸŸåçš„DNSè§£æã€‚åœ¨æˆ‘ä»¬çš„é…ç½®æ ·ä¾‹é‡Œï¼Œä½¿ç”¨`example.com`ä½œä¸ºåŸŸåï¼ˆéœ€è¦ä¿®æ”¹æˆçœŸå®åŸŸåï¼Œä½†æ˜¯ä¸ºäº†å­¦ä¹ æ­å»ºå°±æ— æ‰€è°“äº†ï¼‰ã€‚åŒæ—¶ï¼Œç³»ç»Ÿç®¡ç†å‘˜éœ€è¦ä¸ºæ¯ä¸ªFATEé›†ç¾¤åˆ›å»ºä¸€ä¸ª`namespace`ï¼Œè­¬å¦‚`party_id`ä¸º`9999`çš„FATEé›†ç¾¤ï¼Œåˆ›å»ºä¸€ä¸ª`fate-9999`çš„`namespace`ï¼Œç„¶åè¿›è¡Œé…é¢æ§åˆ¶ã€‚\n\n```shell\nkubectl apply -f ./kubefate.yaml\nkubectl create namespace fate-9999\n```\n\nåç»­å†æ‰§è¡Œï¼š\n```shell\nsudo kubectl get ingress -A\n```\nå¯ä»¥çœ‹åˆ°è¿”å›ç±»ä¼¼äºä»¥ä¸‹ä¿¡æ¯ï¼š\n```shell\nNAMESPACE   NAME       CLASS   HOSTS         ADDRESS       PORTS   AGE\nkube-fate   kubefate   nginx   example.com   10.43.62.61   80      12m\n```\n> ADDRESS 10.43.62.61 æ·»åŠ è‡³/etc/hostsä¸­\n```shell\nsudo vim /etc/hosts\n```\n```\n10.43.62.61 example.com\n```\n\næŸ¥çœ‹ingress-nginxå‘½åç©ºé—´ä¸‹çš„æœåŠ¡ï¼š\n```shell\nsudo kubectl get svc -n ingress-nginx\n```\n\nå¯ä»¥çœ‹åˆ°è¿”å›ç±»ä¼¼äºä»¥ä¸‹ä¿¡æ¯ï¼š\n```shell\nNAME                                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE\ningress-nginx-controller-admission   ClusterIP   10.43.169.125   <none>        443/TCP                      4d\ningress-nginx-controller             NodePort    10.43.62.61     <none>        80:31683/TCP,443:31292/TCP   4d\n```\n\n```shell\nsudo kubectl get svc -n kube-fate\n```\nè¿”å›ç±»ä¼¼ä»¥ä¸‹ä¿¡æ¯ï¼š\n```shell\nNAME       TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE\nmariadb    ClusterIP   10.43.128.75   <none>        3306/TCP   33m\nkubefate   ClusterIP   10.43.235.20   <none>        8080/TCP   33m\n```\n\nå®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œdockerå®¹å™¨çš„å¯åŠ¨æƒ…å†µæŸ¥çœ‹ä¸€ä¸‹ï¼š\n```shell\nsudo docker ps \n```\nè¿”å›ç±»ä¼¼äºä»¥ä¸‹ä¿¡æ¯ï¼š\n```shell\nCONTAINER ID   IMAGE                        COMMAND                   CREATED          STATUS          PORTS     NAMES\n5ece9858fd52   93aad7121ec0                 \"/kubefate service\"       11 minutes ago   Up 11 minutes             k8s_kubefate_kubefate-74897fc6d7-zrcqf_kube-fate_d221b8f5-b6f1-4861-9281-5561f01875f3_2\n116bb9217b97   9a79847e85fb                 \"docker-entrypoint.sâ€¦\"   12 minutes ago   Up 12 minutes             k8s_mariadb_mariadb-7456b6c968-b9zlx_kube-fate_2b1ac004-4155-4b11-bb3f-afd91e0563d2_0\n5d13492b8755   rancher/mirrored-pause:3.6   \"/pause\"                  12 minutes ago   Up 12 minutes             k8s_POD_mariadb-7456b6c968-b9zlx_kube-fate_2b1ac004-4155-4b11-bb3f-afd91e0563d2_0\n05635a80430c   rancher/mirrored-pause:3.6   \"/pause\"                  12 minutes ago   Up 12 minutes             k8s_POD_kubefate-74897fc6d7-zrcqf_kube-fate_d221b8f5-b6f1-4861-9281-5561f01875f3_0\n```\n> è‡³æ­¤ï¼ŒFATEçš„åå°æœåŠ¡å·²ç»éƒ¨ç½²å®Œæˆ\n\n# å‡†å¤‡FATEçš„å®‰è£…é…ç½®æ–‡ä»¶å¹¶éƒ¨ç½²FATE\nå½“ç³»ç»Ÿç®¡ç†å‘˜æˆåŠŸéƒ¨ç½²äº†`KubeFATE`æœåŠ¡ï¼Œå¹¶å‡†å¤‡å¥½æ–°çš„FATEé›†ç¾¤`namespace`ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥æ ¹æ®è¿™äº›ä¿¡æ¯å¼€å§‹éƒ¨ç½²FATEé›†ç¾¤ã€‚`config.yaml`æ˜¯ä½¿ç”¨`KubeFATE`å‘½ä»¤è¡Œçš„é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«`KubeFATE`æœåŠ¡çš„è®¿é—®ç”¨æˆ·åå¯†ç ï¼Œä»¥åŠ`log`é…ç½®ï¼Œ`åŸŸå`ã€‚\n\n```yaml\nlog:\n  level: info\nuser:\n  username: admin\n  password: admin\n\nserviceurl: example.com\nsafeconnect: false\n```\n\n| åå­— | ç§ç±» | æè¿° |\n| -- | -- | -- |\n| log | scalars | å‘½ä»¤è¡Œçš„æ—¥å¿—çº§åˆ«ã€‚è®¾ç½®æˆdebugçº§åˆ«å¯ä»¥çœ‹åˆ°RESTé€šä¿¡ä¿¡æ¯ |\n| user | mappings | KubeFATEçš„è®¤è¯ç”¨æˆ·åï¼Œå¯†ç  |\n| serviceurl | scalars | KubeFATEæœåŠ¡ä½¿ç”¨çš„åŸŸå |\n| safeconnect | scalars | æ˜¯å¦ä½¿ç”¨httpsè®¿é—®KubeFATEæœåŠ¡ä½¿ç”¨çš„åŸŸå;[å‚è€ƒ](https://github.com/FederatedAI/KubeFATE/blob/master/docs/configurations/kubefate_service_tls_enable.md) |\n\næ ·ä¾‹é‡Œé¢åŒ…å«äº†`cluster.yaml`, æ˜¯FATEçš„éƒ¨ç½²è®¡åˆ’ï¼Œæ›´å¤šè‡ªå®šä¹‰å†…å®¹å‚è€ƒï¼š[FATE Cluster Configuration Guild](https://github.com/FederatedAI/KubeFATE/blob/master/docs/configurations/FATE_cluster_configuration.md)\n\nå› ä¸ºæˆ‘æ˜¯è¦éƒ¨ç½²`Spark`ä½œä¸ºè®¡ç®—å¼•æ“ï¼›`Pulsar`ä½œä¸ºé€šè®¯ç»„ä»¶çš„æ¶æ„ï¼›æ‰€ä»¥é€‰æ‹©çš„æ˜¯æ ·ä¾‹é‡Œé¢çš„`cluster-spark-pulsar.yaml`\n> ä¸ºäº†é¿å…ç”±äºç½‘ç»œåŸå› æ‹‰å–dockeré•œåƒå¤±è´¥ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸‹`cluster-spark-pulsar.yaml'ä¸­çš„`registry`\n\n```\nregistry: \"hub.c.163.com/federatedai\"\n```\n\nä½¿ç”¨`kubefate`æ¥å®‰è£…é›†ç¾¤, åœ¨`k8s-deploy`ç›®å½•ä¸‹çš„`bin`ç›®å½•ä¸‹ï¼ˆä¹‹å‰`make`ç¼–è¯‘ç”Ÿæˆï¼‰ï¼š\n```shell\nkubefate cluster install -f ./cluster-spark-pulsar.yaml\n```\n```\ncreate job Success, job id=0f82371a-442c-4a50-aeb5-528e5a896d52\n```\n> è¿™ä¸€æ­¥éœ€è¦ä¿è¯/etc/hostsä¸­å·²æ·»åŠ äº†example.comï¼Œæˆ‘åœ¨è¿™ä¸€æ­¥å¡äº†å¾ˆä¹…ï¼Œä¸€ç›´ä¸æˆåŠŸã€‚\n\næ ¹æ®å‡ºé”™ä¿¡æ¯å°è¯•äº†ä¸€äº›ï¼Œæœ€ç»ˆè§£å†³æ‰äº†ï¼Œä½†å…·ä½“æ˜¯å“ªä¸ªæ“ä½œè§£å†³äº†ç›®å‰æ²¡å»æ·±ç©¶ï¼Œä»¥ä¸‹æ˜¯æˆ‘åšçš„å¤„ç†ï¼š\n- å…³é—­ç§‘å­¦ä¸Šç½‘è½¯ä»¶ï¼ˆåœ¨ç»ˆç«¯å†…å…³é—­ç§‘å­¦ä¸Šç½‘ï¼Œclashæˆ‘å¿˜äº†æœ‰æ²¡å…³ï¼Œæœ€å¥½ä¹Ÿå…³ä¸€ä¸‹ï¼Œä¹‹å‰é‡åˆ°è¿‡åœ¨/etc/hostsæ·»åŠ äº†åŸŸåï¼Œä½†æ˜¯clashå¼€ç€å¯¼è‡´hostsä¸­çš„åŸŸåæ— æ³•è§£æçš„å‘ï¼Œå…·ä½“åŸå› ä¹Ÿä¸æ˜ï¼‰\n- ç§»é™¤äº†dockerçš„ä»£ç†ï¼ˆåœ¨ /etc/systemd/system/docker.service.d/proxy.confä¸­æˆ‘åŸå…ˆè®¾ç½®äº†ä»£ç†ï¼‰ï¼Œåæ¥æŠŠå®ƒmv proxy.conf proxy.conf.bakäº†\n- å…³é—­äº†ç³»ç»Ÿçš„é˜²ç«å¢™\n- é‡å¯docker,é‡å¯k3s\n\n# æ£€æŸ¥å®‰è£…é›†ç¾¤ä»»åŠ¡çš„çŠ¶æ€\n```shell\nkubefate job describe 0f82371a-442c-4a50-aeb5-528e5a896d52\n```\n```\nUUID     \t0f82371a-442c-4a50-aeb5-528e5a896d52\nStartTime\t2023-06-09 12:14:38\nEndTime  \t2023-06-09 12:23:44\nDuration \t9m6s\nStatus   \tSuccess\nCreator  \tadmin\nClusterId\tfd3e2768-a84d-4732-9de6-87558d7bcd39\nStates   \t- update job status to Running\n         \t- create Cluster in DB Success\n         \t- helm install Success\n         \t- checkout Cluster status [529]\n         \t- job run Success\n\nSubJobs  \tmysql                ModuleStatus: Available, SubJobStatus: Success, Duration:   5m4s, StartTime: 2023-06-09 12:14:38, EndTime: 2023-06-09 12:19:43\n         \tnginx                ModuleStatus: Available, SubJobStatus: Success, Duration:   9m6s, StartTime: 2023-06-09 12:14:38, EndTime: 2023-06-09 12:23:44\n         \tpython               ModuleStatus: Available, SubJobStatus: Success, Duration:   7m5s, StartTime: 2023-06-09 12:14:38, EndTime: 2023-06-09 12:21:43\n         \tspark-worker         ModuleStatus: Available, SubJobStatus: Success, Duration:  2m53s, StartTime: 2023-06-09 12:14:38, EndTime: 2023-06-09 12:17:31\n         \tclient               ModuleStatus: Available, SubJobStatus: Success, Duration:  2m45s, StartTime: 2023-06-09 12:14:38, EndTime: 2023-06-09 12:17:23\n         \tdatanode             ModuleStatus: Available, SubJobStatus: Success, Duration:  2m36s, StartTime: 2023-06-09 12:14:38, EndTime: 2023-06-09 12:17:14\n         \tfateboard            ModuleStatus: Available, SubJobStatus: Success, Duration:  2m54s, StartTime: 2023-06-09 12:14:38, EndTime: 2023-06-09 12:17:32\n         \tnamenode             ModuleStatus: Available, SubJobStatus: Success, Duration:   2m5s, StartTime: 2023-06-09 12:14:38, EndTime: 2023-06-09 12:16:43\n         \tpulsar               ModuleStatus: Available, SubJobStatus: Success, Duration:  4m24s, StartTime: 2023-06-09 12:14:38, EndTime: 2023-06-09 12:19:02\n         \tspark-master         ModuleStatus: Available, SubJobStatus: Success, Duration:  2m45s, StartTime: 2023-06-09 12:14:38, EndTime: 2023-06-09 12:17:23\n```\n```shell\nkubefate cluster describe fd3e2768-a84d-4732-9de6-87558d7bcd39\n```\n```\nUUID        \tfd3e2768-a84d-4732-9de6-87558d7bcd39\nName        \tfate-9999\nNameSpace   \tfate-9999\nChartName   \tfate\nChartVersion\tv1.11.1\nRevision    \t1\nAge         \t27m\nStatus      \tRunning\nSpec        \talgorithm: Basic\n            \tchartName: fate\n            \tchartVersion: v1.11.1\n            \tcomputing: Spark\n            \tdevice: CPU\n            \tfederation: Pulsar\n            \timagePullSecrets:\n            \t- name: myregistrykey\n            \tingressClassName: nginx\n            \tistio:\n            \t  enabled: false\n            \tmodules:\n            \t- mysql\n            \t- python\n            \t- fateboard\n            \t- client\n            \t- spark\n            \t- hdfs\n            \t- nginx\n            \t- pulsar\n            \tname: fate-9999\n            \tnamespace: fate-9999\n            \tpartyId: 9999\n            \tpersistence: false\n            \tpodSecurityPolicy:\n            \t  enabled: false\n            \tpullPolicy: null\n            \tregistry: \"\"\n            \tskippedKeys:\n            \t- route_table\n            \tstorage: HDFS\n\nInfo        \tdashboard:\n            \t- spark.example.com\n            \t- notebook.example.com\n            \t- fateboard.example.com\n            \t- pulsar.example.com\n            \tip: 192.168.100.121\n            \tstatus:\n            \t  containers:\n            \t    client: Running\n            \t    datanode: Running\n            \t    fateboard: Running\n            \t    fateflow: Running\n            \t    mysql: Running\n            \t    namenode: Running\n            \t    nginx: Running\n            \t    pulsar: Running\n            \t    spark-master: Running\n            \t    spark-worker: Running\n            \t  deployments:\n            \t    fateboard: Available\n            \t    nginx: Available\n            \t    spark-master: Available\n            \t    spark-worker: Available\n            \t  statefulSets:\n            \t    client: Available\n            \t    datanode: Available\n            \t    mysql: Available\n            \t    namenode: Available\n            \t    pulsar: Available\n            \t    python: Available\n```"},{"title":"vimå¸¸ç”¨é…ç½®åŠæ“ä½œ","url":"/2023/06/03/vimå¸¸ç”¨é…ç½®åŠæ“ä½œ/","content":"\n# vim æ’ä»¶çš„å®‰è£…\n##  markdown-composer æ’ä»¶çš„å®‰è£…\n- åœ¨`~/.vimrc`å†…æ·»åŠ vim-markdownæ’ä»¶\n```shell\nvim ~/.vimrc\n```\nå†…å®¹å¦‚ä¸‹ï¼š\n```\nPlug 'euclio/vim-markdown-composer'\n```\n\nç”±äºè¿™ä¸ªæ’ä»¶æ˜¯ç”±rustç¼–å†™çš„,vim-plug è¿›è¡Œå®‰è£…æ—¶æ˜¯å…‹éš†ä»£ç ä¸‹æ¥ï¼Œä½†ä¸ä¼šç¼–è¯‘ï¼Œå¯ä»¥åˆ°æ’ä»¶ç›®å½•ä¸‹æ‰‹åŠ¨ç¼–è¯‘è¿™ä¸ªæ’ä»¶\n\n```shell\ncd ~/.vim/plugged/vim-markdown-composer\ncargo build --release --no-default-features --features json-rpc\n```\n# å¸¸ç”¨å‘½ä»¤åŠ©è®°\n- å¢åŠ æ–‡æœ¬\n  - a/A(append): a è¡¨ç¤ºåœ¨å½“å‰å…‰æ ‡çš„åé¢æ’å…¥ï¼ŒAè¡¨ç¤ºåœ¨å½“å‰è¡Œå°¾æ’å…¥\n  - i/I(insert): i è¡¨ç¤ºåœ¨å½“å‰å…‰æ ‡çš„å‰é¢æ’å…¥ï¼ŒIè¡¨ç¤ºåœ¨å½“å‰è¡Œé¦–æ’å…¥\n  - o/O(open a line): o è¡¨ç¤ºåœ¨å½“å‰è¡Œçš„ä¸‹é¢æ’å…¥ä¸€è¡Œï¼ŒOè¡¨ç¤ºåœ¨å½“å‰è¡Œçš„å‰é¢æ’å…¥ä¸€è¡Œ\n- åˆ é™¤\n  - dd: è¡¨ç¤ºåˆ é™¤å½“å‰è¡Œ\n  - x/X: å‘å/å‘å‰åˆ é™¤ä¸€ä¸ªå­—ç¬¦\n  - dw(delete word): åˆ é™¤å…‰æ ‡ä½ç½®åé¢çš„ä¸€ä¸ªå•è¯,å¯ä»¥é…åˆæ•°å­—æ¥è¡¨ç¤ºåˆ é™¤å‡ ä¸ªå•è¯\n  - diw(delete inner word): å½“å…‰æ ‡åœ¨æŸä¸ªå•è¯å†…éƒ¨ï¼Œç°åœ¨æƒ³åˆ é™¤å½“å‰è¿™ä¸ªå•è¯ï¼Œå°±ä½¿ç”¨diw\n  - daw(delete around word): å’Œdiwçš„åŒºåˆ«æ˜¯dawä¼šæŠŠå•è¯å·¦å³çš„ç©ºæ ¼ä¹Ÿä¼šåˆ é™¤\n- ä¿®æ”¹\n  - `c`:(change)\n  - `ciw`:(change inner word):è¿™ä¸ªçš„åº”ç”¨åœºæ™¯æ˜¯æŠŠå…‰æ ‡ç§»åˆ°åŒå¼•å·ä¸­çš„æŸä¸ªå­—ç¬¦ä¸Šï¼Œç„¶å`ciw\"`,å°±å¯ä»¥æŠŠåŒå¼•å·ä¸­çš„\nçš„å­—ç¬¦å…¨åˆ é™¤å¹¶è¿›å…¥æ’å…¥æ¨¡å¼\n  - `ct)`:(change to `)`):è¿™ä¸ªçš„åº”ç”¨åœºæ™¯æ˜¯æŠŠå…‰æ ‡ç§»åŠ¨åˆ°å·¦æ‹¬å·åé¢ï¼Œç„¶å`ct)`å°±å¯ä»¥æŠŠæ‹¬å·ä¸­çš„å­—ç¬¦å…¨åˆ é™¤å¹¶è¿›å…¥\nåˆ°æ’å…¥æ¨¡å¼\n- æŸ¥æ‰¾\n  - `f`:(find): è¿™ä¸ªæ˜¯åœ¨å½“å‰è¡ŒæŸ¥æ‰¾å­—ç¬¦æˆ–ç§»åŠ¨å…‰æ ‡åˆ°ç›¸åº”çš„å­—ç¬¦ä¸Šï¼Œæ¯”å¦‚æŸ¥æ‰¾sè¿™ä¸ªå­—ç¬¦ï¼Œå‘½ä»¤ä¸º`fs`,å…‰æ ‡å°±ä¼šç§»åŠ¨>åˆ°å½“å‰è¡Œçš„`s`å­—ç¬¦ä¸Š,ä½¿ç”¨`;`å®šä½åˆ°ä¸‹ä¸€ä¸ªã€‚ä½¿ç”¨æ•°å­—`0`è¿”å›åˆ°è¡Œçš„ç»å¯¹è¡Œé¦–æˆ–`$`å›åˆ°è¡Œé¦–å†è¿›è¡Œå…¶å®ƒå­—ç¬¦çš„æŸ¥æ‰¾ã€‚å½“\nç„¶`F`ä¸ºåæ–¹å‘çš„æ“ä½œã€‚\n  - `/`: åœ¨å…‰æ ‡ä½ç½®å¾€ä¸‹æŸ¥æ‰¾å•è¯å¯ä»¥åœ¨`/`åé¢è·Ÿå•è¯å°±ä¼šæŸ¥æ‰¾è¿™ä¸ªå•è¯å¹¶é«˜äº®æ˜¾ç¤ºï¼›ä½¿ç”¨`?`åŠ å•è¯å¯ä»¥å¾€åæ–¹å‘æŸ¥æ‰¾\nå•è¯\n- å…‰æ ‡ç§»åŠ¨\n  - w(word): ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå•è¯\n  - b(back word): ç§»åŠ¨åˆ°å‰ä¸€ä¸ªå•è¯\n  - æ•°å­—+Gï¼šå®šä½è¡Œ\n  - 0: ç§»åŠ¨åˆ°ç»å¯¹è¡Œå¤´\n  - ^: ç§»åŠ¨åˆ°è¡Œé¦–\n  - $: ç§»åŠ¨åˆ°è¡Œå°¾\n  - gg: ç§»åŠ¨åˆ°ç¬¬1è¡Œ\n  - Gï¼šç§»åŠ¨åˆ°æœ€åä¸€è¡Œ\n  - ctl + o: è¿”å›åˆ°ä¸Šä¸€ä¸ªä½ç½®\n  - ctl + fï¼ˆforward): å¾€ä¸‹ç¿»é¡µ\n  - ctl + u (upward): å¾€å‰ç¿»é¡µ\n\n# å®å®šä¹‰\n`normal`æ¨¡å¼ä¸‹æŒ‰`q`é”®ï¼Œå†æŒ‰`x`ï¼Œè¡¨ç¤ºä½¿ç”¨å¯„å­˜å™¨`x`\nç„¶åå°±å¼€å§‹å½•åˆ¶äº†,ç­‰å½•åˆ¶ç»“æŸï¼ŒæŒ‰`ESC`ï¼Œå†æŒ‰`q`å°±ç»“æŸå½•åˆ¶ï¼Œç„¶åå°±æ˜¯è°ƒç”¨è¿™ä¸ªå®é‡å¤åšåˆšæ‰çš„äº‹ã€‚è°ƒç”¨æ–¹æ³•ä¸º:\n```\n@x\n```\nè¡¨ç¤ºè°ƒç”¨xå¯„å­˜å™¨ä¸­çš„å®,å½“ç„¶å¯ä»¥åœ¨å‰é¢åŠ ä¸Šä¸€ä¸ªæ•°å­—æ¥è¡¨ç¤ºè°ƒç”¨æ¬¡æ•°\n\n","tags":["vim","plugin"],"categories":["Linux"]},{"title":"k3séƒ¨ç½²","url":"/2023/05/11/k3séƒ¨ç½²/","content":"\n# ä¸€ã€[å®˜æ–¹æ–‡æ¡£](https://docs.k3s.io/zh/quick-start)\n\n# äºŒã€å®‰è£…æ­¥éª¤\n- ä½¿ç”¨dockerä½œä¸ºå®¹å™¨(é»˜è®¤ä¸ºcontainerd)\n- è®¾ç½®dockeræ‹‰å–çš„httpä»£ç†\n- å®‰è£…K3S\n- ä½¿ç”¨ingress-nginx(é»˜è®¤æ˜¯traefik)\n\n\n## ä½¿ç”¨dockerä½œä¸ºå®¹å™¨\n- å¯ä»¥ä½¿ç”¨`Rancher`çš„ä¸€ä¸ª[Dockerå®‰è£…è„šæœ¬](https://github.com/rancher/install-docker)æ¥å®‰è£…Docker\n- ä¹Ÿå¯ä»¥æ ¹æ®Dockerå®˜æ–¹æ–‡æ¡£æ‰‹åŠ¨[ubuntuä¸‹å®‰è£…docker](https://docs.docker.com/engine/install/ubuntu/)\n### å¸è½½æ—§ç‰ˆ\n```shell\nsudo apt-get remove docker docker-engine docker.io containerd runc\n```\n\n### è®¾ç½®`repository`\n\n```shell\nsudo apt-get update\nsudo apt-get install ca-certificates curl gnupg\n```\n\n```shell\nsudo install -m 0755 -d /etc/apt/keyrings\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg\nsudo chmod a+r /etc/apt/keyrings/docker.gpg\n```\n\n```shell\necho \\\n  \"deb [arch=\"$(dpkg --print-architecture)\" signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \\\n  \"$(. /etc/os-release && echo \"$VERSION_CODENAME\")\" stable\" | \\\n  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null\n```\n\n### å®‰è£…`Docker Engine`\n\n```shell\nsudo apt-get update\n```\n\n```shell\nsudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin\n```\n\n## è®¾ç½®dockeræ‹‰å–çš„httpä»£ç†\n\n```shell\nsudo mkdir -p /etc/systemd/system/docker.service.d\ncd /etc/systemd/system/docker.service.d\nsudo vim proxy.conf\n```\næ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n```\n[Service]\nEnvironment=\"HTTP_PROXY=http://127.0.0.1:7890/\"\nEnvironment=\"HTTPS_PROXY=http://127.0.0.1:7890/\"\nEnvironment=\"NO_PROXY=localhost,127.0.0.1\"\n```\n\n## å®‰è£…`K3S`\nä»¥Dockerä¸ºå®¹å™¨\n```shell\ncurl -sfL https://get.k3s.io | sh -s - --docker\n```\n> å¦‚æœæœåŠ¡å™¨ç½‘ç»œç¯å¢ƒå¤æ‚ï¼Œéœ€è¦æŒ‡å®šK3SæœåŠ¡èŠ‚ç‚¹çš„IPï¼Œåˆ™ `--node-ip=192.168.10.100`\n\n## ä½¿ç”¨ingress-nginxä½œä¸ºåå‘ä»£ç†\nä¹‹å‰åœ¨K3Sæ­å»ºçš„ç¯å¢ƒä¸­ï¼Œé»˜è®¤æ˜¯ä½¿ç”¨`traefik`çš„ï¼Œåœ¨ä½¿ç”¨FedLCMéƒ¨ç½²FATEç›¸å…³ç»„ä»¶ï¼Œé‡Œé¢ä½¿ç”¨äº†ingress-nginxï¼Œå¦‚æœä½¿ç”¨FedLCMå»éƒ¨ç½²ingress-nginxï¼Œåˆ™ä¼šæœ‰ä¸€ä¸ªå‘ï¼šè¿™ä¸ªingress-nginxåœ¨k3sä¸­æ˜¯éƒ¨ç½²æˆåŠŸäº†ï¼Œä½†æ˜¯FedLCMä½¿ç”¨K8Sçš„APIå»æŸ¥è¯¢ingress-nginxæ˜¯å¦éƒ¨ç½²å®Œæˆè¿”å›çš„å€¼æ˜¯è·Ÿå®é™…æƒ…å†µä¸ç¬¦çš„ã€‚å¦‚æœæŠŠ`traefik`ç¦ç”¨äº†ï¼Œå°±èƒ½é¿å‘ï¼Œè¿™åº”è¯¥æ˜¯K3Sçš„ä¸€ä¸ªbug(ç›®å‰åº”è¯¥æ˜¯è§£å†³äº†ï¼Œåæ¥æˆ‘åˆéƒ¨ç½²è¿‡å‡ æ¬¡ï¼Œæ²¡è¿™ä¸ªé—®é¢˜äº†)ã€‚\n\n> è§£å†³æ–¹æ³•æ˜¯ï¼šåªéœ€ä½¿ç”¨ `--disable=traefik` å¯åŠ¨ K3s Serverï¼Œç„¶åéƒ¨ç½²ä½ çš„ Ingress å³å¯ã€‚\n\nå…·ä½“æ­¥éª¤ï¼š\n- å®‰è£…kubectl\n  ```shell\n  # ä¸‹è½½kubectl\n  curl -LO \"https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl\"\n  # å®‰è£…kubectl\n  sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl\n  ```\n  ```shell\n  mkdir -p ~/.kube\n  sudo cat /etc/rancher/k3s/k3s.yaml\n  # åœ¨~/.kube/ä¸‹åˆ›å»ºä¸€ä¸ª`config`æ–‡ä»¶æŠŠk3s.yamlä¸­çš„å†…å®¹æ”¾å…¥åˆ°`config`ä¸­\n  ```\n- å®‰è£…helm\n  ```shell\n  curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash\n  ```\n- å®‰è£… ingress-nginx\n  ```shell\n  helm upgrade --install ingress-nginx ingress-nginx  --repo https://kubernetes.github.io/ingress-nginx  --namespace ingress-nginx --create-namespace\n  ```\n- æŸ¥çœ‹ ingress-nginx controllerä¿¡æ¯\n  ```shell\n  kubectl get svc -n ingress-nginx ingress-nginx-controller\n  ```\n  ingress controllerçš„æœåŠ¡ç±»å‹æœ‰`NodePort`å’Œ`LoadBalancer`,è¿™ä¸¤ç§æ¨¡å¼ä¸‹ï¼Œè®¿é—®é‚£äº›é€šè¿‡ingressåå‘ä»£ç†çš„æœåŠ¡æ—¶ï¼Œä½¿ç”¨çš„IPåœ°å€æ˜¯æœ‰åŒºåˆ«çš„ï¼Œ`NodePort`æ¨¡å¼ä¸‹ï¼Œæ²¡æœ‰`EXTERNAL-IP`\n\n","tags":["k3s"],"categories":["äº‘åŸç”Ÿ","åŸºç¡€è®¾æ–½"]},{"title":"ingresss-nginx-controlleréƒ¨ç½²å’Œåº”ç”¨","url":"/2023/05/11/ingresss-nginx-controlleréƒ¨ç½²å’Œåº”ç”¨/","content":"\n# `Ingress`æ˜¯ä»€ä¹ˆ\n`Ingress`å…¬å¼€ä»é›†ç¾¤å¤–éƒ¨åˆ°é›†ç¾¤å†…æœåŠ¡çš„`http`å’Œ`https`è·¯ç”±ã€‚æµé‡è·¯ç”±ç”±`Ingress`èµ„æºä¸Šå®šä¹‰çš„è§„åˆ™æ§åˆ¶ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå°†æ‰€æœ‰æµé‡éƒ½å‘é€åˆ°åŒä¸€ä¸ª`Service`çš„ç®€å•`Ingress`ç¤ºä¾‹ï¼š\n![ç®€å•ç¤ºä¾‹](ingresss-nginx-controlleréƒ¨ç½²å’Œåº”ç”¨/ingress-simple.jpg)\n\n# `Ingress`çš„ç»„æˆ\n## ingress\n`ingress`æ˜¯ä¸€ä¸ªAPIå¯¹è±¡ï¼Œé€šè¿‡`yaml`æ–‡ä»¶æ¥é…ç½®ï¼Œ`ingress`å¯¹è±¡çš„ä½œç”¨æ˜¯å®šä¹‰è¯·æ±‚å¦‚ä½•å‘é€åˆ°`service`çš„è§„åˆ™ï¼Œå¯ä»¥ç†è§£ä¸ºé…ç½®æ¨¡æ¿ã€‚`ingress`é€šè¿‡`http`æˆ–`https`æš´éœ²é›†ç¾¤å†…éƒ¨`service`ï¼Œç»™`service`æä¾›å¤–éƒ¨`URI`ã€`è´Ÿè½½å‡è¡¡`ã€`SSL/TLS`èƒ½åŠ›ä»¥åŠåŸºäºåŸŸåçš„åå‘ä»£ç†ã€‚`ingress`è¦ä¾é `ingress-controller`æ¥å…·ä½“å®ç°ä»¥ä¸ŠåŠŸèƒ½ã€‚\n## Ingress-controller\n`Ingress-controller`æ˜¯å…·ä½“å®ç°åå‘ä»£ç†åŠè´Ÿè½½å‡è¡¡çš„ç¨‹åºï¼Œå¯¹`ingress`å®šä¹‰çš„è§„åˆ™è¿›è¡Œè§£æï¼Œæ ¹æ®é…ç½®çš„è§„åˆ™æ¥å®ç°è¯·æ±‚è½¬å‘ã€‚`ingress-controller`å¹¶ä¸æ˜¯`k8s`è‡ªå¸¦ç»„ä»¶ï¼Œå®é™…ä¸Š`ingress-controller`åªæ˜¯ä¸€ä¸ªç»Ÿç§°ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©ä¸åŒçš„`ingress-controller`å®ç°ï¼Œç›®å‰ï¼Œç”±`k8s`ç»´æŠ¤çš„`ingress-controller`åªæœ‰googleäº‘çš„GCEä¸ingress-nginxä¸¤ä¸ªï¼Œå…¶å®ƒè¿˜æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹ç»´æŠ¤çš„ingress-controller,å…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚ä½†æ˜¯ä¸ç®¡å“ªä¸€ç§`ingress-controller`ï¼Œå®ç°çš„æœºåˆ¶éƒ½å¤§åŒå°å¼‚ï¼Œåªæ˜¯åœ¨å…·ä½“é…ç½®ä¸Šæœ‰å·®å¼‚ã€‚\n\nä¸€èˆ¬æ¥è¯´ï¼Œ`ingress-controller`çš„å½¢å¼éƒ½æ˜¯ä¸€ä¸ªpodï¼Œé‡Œé¢è·‘ç€daemonç¨‹åºå’Œåå‘ä»£ç†ç¨‹åºã€‚daemonè´Ÿè´£ä¸æ–­ç›‘æ§é›†ç¾¤çš„å˜åŒ–ï¼Œæ ¹æ®`ingress`å¯¹è±¡ç”Ÿæˆé…ç½®åˆ°åå‘ä»£ç†ï¼Œæ¯”å¦‚`ingress-nginx`é…ç½®ï¼ŒåŠ¨æ€æ›´æ–°`upstream`ï¼Œå¹¶åœ¨éœ€è¦çš„æ—¶å€™`reload`ç¨‹åºåº”ç”¨æ–°é…ç½®ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œåé¢çš„ä¾‹å­éƒ½ä»¥`k8s`å®˜æ–¹ç»´æŠ¤çš„`ingress-nginx`ä¸ºä¾‹ã€‚\n\n## Ingressçš„å·¥ä½œåŸç†\n- ingress-controlleré€šè¿‡å’Œkubernetes APIServeräº¤äº’ï¼ŒåŠ¨æ€å»æ„ŸçŸ¥é›†ç¾¤ä¸­ingressè§„åˆ™å˜åŒ–ï¼›\n- ç„¶åè¯»å–å®ƒï¼ŒæŒ‰ç…§è‡ªå®šä¹‰çš„è§„åˆ™ï¼Œè§„åˆ™å°±æ˜¯å†™æ˜äº†å“ªä¸ªåŸŸåå¯¹åº”å“ªä¸ªservice,ç”Ÿæˆä¸€æ®µnginxé…ç½®ï¼›\n- å†å†™åˆ°inginx-ingress-controllerçš„podé‡Œï¼Œè¿™ä¸ªingress-controllerçš„podé‡Œè¿è¡Œç€ä¸€ä¸ªNginxæœåŠ¡ï¼Œæ§åˆ¶å™¨ä¼šæŠŠç”Ÿæˆçš„nginxé…ç½®å†™å…¥åˆ°/etc/nginx.confä¸­ï¼›\n- ç„¶åreloadä¸€ä¸‹ä½¿é…ç½®ç”Ÿæ•ˆã€‚ä»¥æ­¤è¾¾åˆ°åŸŸååŒºåˆ†é…ç½®å’ŒåŠ¨æ€æ›´æ–°çš„ä½œç”¨ã€‚\n\nIngressæµå›¾\n![01](ingresss-nginx-controlleréƒ¨ç½²å’Œåº”ç”¨/ingress01.jpg)\n![02](ingresss-nginx-controlleréƒ¨ç½²å’Œåº”ç”¨/ingress02.jpg)\nä¾‹å­å¦‚ä¸‹å›¾ï¼š\n![ingress-controller](ingresss-nginx-controlleréƒ¨ç½²å’Œåº”ç”¨/ingress-nginx-controller.jpg)\n\n# éƒ¨ç½²\n## ä¸‹è½½éƒ¨ç½²æ–‡ä»¶å’Œé•œåƒ\n### ä¸‹è½½ingress-nginxçš„éƒ¨ç½²æ–‡ä»¶\n```shell\n#éœ€è¦ä¸‹è½½åˆ«çš„ç‰ˆæœ¬è¯·æ±‚æ”¹ç‰ˆæœ¬å·\nwget https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.3.0/deploy/static/provider/cloud/deploy.yaml\n#å¤‡æ³¨ï¼šè¯¥æ–‡ä»¶åœ¨githubä¸Šä¹Ÿå¯ä»¥ä¸‹è½½ï¼Œåœ°å€æ˜¯ï¼šhttps://github.com/kubernetes/ingress-nginx/blob/main/deploy/static/provider/cloud/deploy.yaml\n```\n### å…³äºé•œåƒ\nç”±äºé•œåƒç½‘ç»œé—®é¢˜ï¼Œä¼šå¯¼è‡´yamlæ–‡ä»¶ä¸­çš„é•œåƒæ— æ³•ä¸‹è½½ï¼Œè§£å†³æ€è·¯ï¼šå…ˆåœ¨docker hubä¸ŠæŸ¥æ‰¾ï¼Œä¸‹è½½ä¸‹æ¥ä¹‹åï¼Œå°†å…¶æ¨é€åˆ°ç§æœ‰çš„harboré•œåƒæœåŠ¡å™¨ä¸Šéœ€è¦ä¸‹è½½å¦‚ä¸‹ä¸¤ä¸ªé•œåƒï¼š\n```shell\ncat deploy.yaml |grep image\n```\n```\nimage: registry.k8s.io/ingress-nginx/controller:v1.3.0@sha256:d1707ca76d3b044ab8a28277a2466a02100ee9f58a86af1535a3edf9323ea1b5\nimagePullPolicy: IfNotPresent\nimage: registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.1.1@sha256:64d8c73dca984af206adf9d6d7e46aa550362b1d7a01f3a0a91b20cc67868660\nimagePullPolicy: IfNotPresent\nimage: registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.1.1@sha256:64d8c73dca984af206adf9d6d7e46aa550362b1d7a01f3a0a91b20cc67868660\nimagePullPolicy: IfNotPresent\n```\n\n### ä¿®æ”¹éƒ¨ç½²æ–‡ä»¶\n- hostNetworkï¼šæ˜¯ä¸ºäº†æ‰“é€šClusterå’Œnodeçš„ç½‘ç»œï¼Œè®©Clusterç›´æ¥ä¸´å¬nodeçš„ç«¯å£ï¼Œä¸€èˆ¬æ˜¯80å’Œ443ï¼Œä¸ç”¨å†é€šè¿‡éšæœºç»‘å®šNodePortæ¥è®¿é—®é›†ç¾¤æœåŠ¡ã€‚\n  > ä»¥å‰è®¿é—®ï¼šhttp://www.blockchainof.com:10080/server1/path ç°åœ¨è®¿é—®ï¼šhttp://www.blockchainof.com/server1/path å¯ä»¥çœ‹åˆ°ä¸éœ€è¦ç«¯å£äº†ï¼Œå› ä¸ºhostNetworkç›´æ¥ç›‘å¬nodeçš„80ç«¯å£äº†\n- nodeSelectorï¼šåœ¨nodeSelectorä¸‹æ·»åŠ hasIngress: \"true\"\n  > å¯ä»¥ç»™é›†ç¾¤ä¸­çš„nodeæ·»åŠ æ ‡ç­¾ï¼Œç„¶åéƒ¨ç½²çš„æ—¶å€™nodeSelectorå°±ä¼šæ ¹æ®æ ‡ç­¾æ‰¾åˆ°å…·æœ‰è¿™ä¸ªæ ‡ç­¾çš„nodeï¼Œåªåœ¨è¿™éƒ¨åˆ†nodeä¸Šè¿›è¡Œéƒ¨ç½²ã€‚\n- DaemonSet: æŠŠkindçš„å€¼ä»Deploymentæ”¹ä¸ºDaemonSetï¼Œå› ä¸ºDeploymentå¯èƒ½ä¼šæŠŠå¤šä¸ªPodè°ƒåº¦åˆ°åŒä¸€ä¸ªnodeï¼ˆåŒä¸€ä¸ªnodeä¸Šä¼šå­˜åœ¨podçš„å¤šä¸ªå‰¯æœ¬ï¼Œè€ŒDaemonSetæœ€å¤šåªæœ‰ä¸€ä¸ªï¼‰ï¼Œè¿™æ ·æ¯”è¾ƒç¬¦åˆå¤šèŠ‚ç‚¹é«˜å¯ç”¨çš„æ„ä¹‰ã€‚\n\nä¿®æ”¹åçš„deploy.yamlå¦‚ä¸‹ï¼š\n```yaml\n......\napiVersion: apps/v1\n#kind: Deployment\nkind: DaemonSet  #è¿™é‡ŒæŠŠDeploymentæ”¹æˆDaemonSet\nmetadata:\n  labels:\n    app.kubernetes.io/component: controller\n    app.kubernetes.io/instance: ingress-nginx\n    app.kubernetes.io/name: ingress-nginx\n    app.kubernetes.io/part-of: ingress-nginx\n    app.kubernetes.io/version: 1.3.0\n  name: ingress-nginx-controller\n  namespace: ingress-nginx\nspec:\n  minReadySeconds: 0\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      app.kubernetes.io/component: controller\n      app.kubernetes.io/instance: ingress-nginx\n      app.kubernetes.io/name: ingress-nginx\n  template:\n    metadata:\n      labels:\n        app.kubernetes.io/component: controller\n        app.kubernetes.io/instance: ingress-nginx\n        app.kubernetes.io/name: ingress-nginx\n    spec:\n      hostNetwork: true  #è¿™é‡ŒåŠ ä¸€å¥\n      containers:\n      - args:\n        - /nginx-ingress-controller\n        - --publish-service=$(POD_NAMESPACE)/ingress-nginx-controller\n        - --election-id=ingress-controller-leader\n        - --controller-class=k8s.io/ingress-nginx\n        - --ingress-class=nginx\n        - --configmap=$(POD_NAMESPACE)/ingress-nginx-controller\n        - --validating-webhook=:8443\n        - --validating-webhook-certificate=/usr/local/certificates/cert\n        - --validating-webhook-key=/usr/local/certificates/key\n        env:\n...\n      nodeSelector:\n        kubernetes.io/os: linux\n        hasIngress: \"true\"  # è¿™é‡Œæ ¹æ®æ ‡ç­¾é€‰æ‹©node\n...\n```\n\n### ç»™èŠ‚ç‚¹å¢åŠ æ ‡ç­¾\nåœ¨ä¸Šä¸€ç« èŠ‚ä¸­`deploy.yaml`ä¸­`nodeSelector`ä¸‹å¢åŠ äº†`hasIngress: \"true\"`, æ‰€ä»¥å¯¹åº”çš„ï¼Œåœ¨éœ€è¦éƒ¨ç½²`ingress controller`çš„èŠ‚ç‚¹æ‰“ä¸Š`hasIngress`è¿™ä¸ªæ ‡ç­¾ã€‚\n```shell\nkubectl label nodes ${k8s-node1} hasIngress=true\nkubectl label nodes ${k8s-node2} hasIngress=true\n```\n\n### éƒ¨ç½²\n```shell\nkubectl apply -f deploy.yaml \n```\næ²¡ä»€ä¹ˆæ„å¤–çš„è¯ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´å®Œæˆéƒ¨ç½²ã€‚\n\n# åº”ç”¨\n## éƒ¨ç½²æœåŠ¡ï¼ˆä»¥tomcatå’Œnginxä¸ºä¾‹ï¼‰\n### åˆ›å»ºtomcat-nginx.yaml\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nginx-deployment\n  namespace: dev\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: nginx-pod\n  template:\n    metadata:\n      labels:\n        app: nginx-pod\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.17.1\n        ports:\n        - containerPort: 80\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: tomcat-deployment\n  namespace: dev\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: tomcat-pod\n  template:\n    metadata:\n      labels:\n        app: tomcat-pod\n    spec:\n      containers:\n      - name: tomcat\n        image: tomcat:8.5-jre10-slim\n        ports:\n        - containerPort: 8080\n\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: nginx-service\n  namespace: dev\nspec:\n  ports:\n    - port: 80\n      name: nginx\n  clusterIP: None\n  selector:\n    app: nginx-pod\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: tomcat-service\n  namespace: dev\nspec:\n  ports:\n    - port: 8080\n      name: tomcat\n  clusterIP: None\n  selector:\n    app: tomcat-pod\n```\nåˆ›å»º\n```shell\nkubectl apply -f tomcat-nginx.yaml \n```\n```\ndeployment.apps/nginx-deployment created\ndeployment.apps/tomcat-deployment created\n```\næŸ¥çœ‹\n```shell\nkubectl get svc -n dev\n```\n```\nNAME             TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE\nnginx-service    ClusterIP   None         <none>        80/TCP     59m\ntomcat-service   ClusterIP   None         <none>        8080/TCP   59m\n```\n> æœåŠ¡å°±å·²ç»éƒ¨ç½²å¥½äº†\n\n## httpä»£ç†\n### åˆ›å»ºingress-http.yaml\n```yaml\napiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: ingress-http\n  namespace: dev\nspec:\n  rules:\n  - host: nginx.blockchainof.com\n    http:\n      paths:\n      - path: /\n        backend:\n          serviceName: nginx-service\n          servicePort: 80\n  - host: tomcat.blockchainof.com\n    http:\n      paths:\n      - path: /\n        backend:\n          serviceName: tomcat-service\n          servicePort: 8080\n```\n### åˆ›å»º\n```shell\nkubectl create -f ingress-http.yaml\n```\n```\ningress.extensions/ingress-http created\n```\n### æŸ¥çœ‹\n```shell\nkubectl get ing ingress-http -n dev\n```\n```\nNAME           HOSTS                                  ADDRESS   PORTS   AGE\ningress-http   nginx.blockchainof.com,tomcat.blockchainof.com             80      18s\n```\n### æŸ¥çœ‹è¯¦æƒ…\n```shell\nkubectl describe ing ingress-http -n dev\n```\n```\nName:             ingress-http\nNamespace:        dev\n\n  nginx.blockchainof.com   \n                      /   nginx-service:80 (10.244.1.132:80,10.244.1.135:80,10.244.1.139:80)\n  tomcat.blockchainof.com  \n                      /   tomcat-service:8080 (10.244.1.129:8080,10.244.1.134:8080,10.244.1.140:8080)\nAnnotations:\nEvents:\n  Type    Reason  Age   From                      Message\n  ----    ------  ----  ----                      -------\n  Normal  CREATE  48s   nginx-ingress-controller  Ingress dev/ingress-http\n```\n### æŸ¥çœ‹ingress-controllerçš„nginxé…ç½®æ˜¯å¦å‘ç”Ÿä¿®æ”¹\n```shell\nkubectl exec -it nginx-ingress-controller-7f74f657bd-t8pvt sh -n ingress-nginx\n/etc/nginx\n```\n```shell\ncat nginx.conf|grep nginx.blockchainof.com\n```\n```\n\t## start server nginx.blockchainof.com\n\t\tserver_name nginx.blockchainof.com ;\n\t## end server nginx.blockchainof.com\n```\n\n### æŸ¥çœ‹ingress-controllerçš„svcç«¯å£\n```shell\nkubectl get svc -n ingress-nginx\n```","tags":["k3s","k8s","ingress","ingress-niginx-controller"],"categories":["äº‘åŸç”Ÿ","åŸºç¡€è®¾æ–½"]},{"title":"Cpp11-functionå’Œbindç”¨æ³•è¯¦è§£","url":"/2023/03/27/Cpp11-functionå’Œbindç”¨æ³•è¯¦è§£/","content":"\nåœ¨è®¾è®¡å›è°ƒå‡½æ•°çš„æ—¶å€™ï¼Œæ— å¯é¿å…åœ°ä¼šæ¥è§¦åˆ°å¯å›è°ƒå¯¹è±¡ã€‚åœ¨C++11ä¸­ï¼Œæä¾›äº†std::functionå’Œstd::bindä¸¤ä¸ªæ–¹æ³•æ¥å¯¹å¯å›è°ƒå¯¹è±¡è¿›è¡Œç»Ÿä¸€å’Œå°è£…ã€‚\n\n# å¯è°ƒç”¨å¯¹è±¡\nC++ ä¸­æœ‰å¦‚ä¸‹å‡ ç§å¯è°ƒç”¨å¯¹è±¡ï¼šå‡½æ•°ã€å‡½æ•°æŒ‡é’ˆã€lambdaè¡¨è¾¾å¼ã€bindå¯¹è±¡ã€å‡½æ•°å¯¹è±¡ã€‚å…¶ä¸­ï¼Œlambdaè¡¨è¾¾å¼å’Œbindå¯¹è±¡æ˜¯C++11æ ‡å‡†ä¸­æå‡ºçš„ï¼ˆbindæœºåˆ¶å¹¶ä¸æ˜¯æ–°æ ‡å‡†ä¸­é¦–æ¬¡æå‡ºï¼Œè€Œæ˜¯å¯¹æ—§ç‰ˆæœ¬ä¸­bind1stå’Œbind2ndçš„åˆå¹¶ï¼‰ã€‚ä¸ªäººè®¤ä¸ºäº”ç§å¯è°ƒç”¨å¯¹è±¡ä¸­ï¼Œå‡½æ•°å’Œå‡½æ•°æŒ‡é’ˆæœ¬è´¨ç›¸åŒï¼Œè€Œlambdaè¡¨è¾¾å¼ã€bindå¯¹è±¡åŠå‡½æ•°å¯¹è±¡åˆ™å¼‚æ›²åŒå·¥ã€‚\n\n# å‡½æ•°\nè¿™é‡Œçš„å‡½æ•°æŒ‡çš„æ˜¯æ™®é€šå‡½æ•°ï¼Œæ²¡ä»€ä¹ˆå¯æ‹“å±•çš„ã€‚\n\n# å‡½æ•°æŒ‡é’ˆ\nå‡½æ•°æŒ‡é’ˆå’Œå‡½æ•°ç±»å‹çš„åŒºåˆ«ï¼š\n- å‡½æ•°æŒ‡é’ˆæŒ‡å‘çš„æ˜¯å‡½æ•°è€Œéå¯¹è±¡ã€‚å’Œå…¶å®ƒæŒ‡é’ˆç±»å‹ä¸€æ ·ï¼Œå‡½æ•°æŒ‡é’ˆæŒ‡å‘æŸç§ç‰¹å®šç±»å‹ï¼›\n- å‡½æ•°ç±»å‹ç”±å®ƒçš„è¿”å›å€¼å’Œå‚æ•°ç±»å‹å†³å®šï¼Œä¸å‡½æ•°åæ— å…³\n\nä¾‹ï¼š\n```cpp\nbool fun(int a, int b)\n```\nä¸Šè¿°å‡½æ•°çš„å‡½æ•°ç±»å‹æ˜¯ï¼š`bool(int, int)`\n\nä¸Šè¿°å‡½æ•°çš„å‡½æ•°æŒ‡é’ˆ`pf`æ˜¯ï¼š`bool (*pf)(int, int)`\n\nä¸€èˆ¬å¯¹äºå‡½æ•°æ¥è¯´ï¼Œå‡½æ•°åå³ä¸ºå‡½æ•°æŒ‡é’ˆï¼š\n```cpp\n#include <iostream>\n\nint fun(int x, int y) {\n    std::cout << x + y << std::endl;\n    return x + y;\n}\n\nint fun1(int (*fp)(int, int), int x, int y) {\n    return fp(x, y);\n}\n\ntypedef int (*Ftype)(int, int);\nint fun2(Ftype fp, int x, int y) {\n    return fp(x, y);\n}\n\n//int main() {\n//    fun1(fun, 100, 100);\n//    fun2(fun, 200, 200);\n//}\n\n```\nä¸Šè¿°ä¾‹å­å°±æ˜¯å°†å‡½æ•°æŒ‡é’ˆä½œä¸ºå‚æ•°ï¼Œå†ä½¿ç”¨å‡½æ•°æŒ‡é’ˆå¯¹å‡½æ•°è¿›è¡Œè°ƒç”¨ã€‚ä¼ å‚ï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰æ—¶ï¼Œåªéœ€è¦æŠŠå‡½æ•°åç§°ä¼ å…¥å³å¯\n\n# lambdaè¡¨è¾¾å¼\nlambdaè¡¨è¾¾å¼å°±æ˜¯ä¸€æ®µå¯è°ƒç”¨çš„ä»£ç ã€‚ä¸»è¦é€‚åˆäºåªç”¨åˆ°ä¸€ä¸¤æ¬¡çš„ç®€çŸ­ä»£ç æ®µã€‚ç”±äºlambdaæ˜¯åŒ¿åçš„ï¼Œæ‰€ä»¥ä¿è¯äº†å…¶ä¸ä¼šè¢«ä¸å®‰å…¨åœ°è®¿é—®ï¼š\n```cpp\n#include <iostream>\n\nint fun3(int x, int y) {\n    auto f = [](int x, int y) { return x + y; };\n    std::cout << f(x, y) << std::endl;\n}\n\nint main() {\n   fun3(300, 300);\n}\n```\n\n# bindå¯¹è±¡\nstd::bindå¯ä»¥ç”¨æ¥ç”Ÿäº§ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œæ¥é€‚åº”åŸå¯¹è±¡çš„å‚æ•°åˆ—è¡¨ã€‚\n\n# å‡½æ•°å¯¹è±¡\né‡è½½äº†å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦`()`çš„ç±»çš„å¯¹è±¡ï¼Œå³ä¸ºå‡½æ•°å¯¹è±¡ã€‚\n\n# std::function\nç”±ä¸Šæ–‡å¯ä»¥çœ‹å‡ºï¼šç”±äºå¯è°ƒç”¨å¯¹è±¡çš„å®šä¹‰æ–¹å¼æ¯”è¾ƒå¤šï¼Œä½†æ˜¯å‡½æ•°çš„è°ƒç”¨æ–¹å¼è¾ƒä¸ºç±»ä¼¼ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ä¸€ä¸ªç»Ÿä¸€çš„æ–¹å¼ä¿å­˜å¯è°ƒç”¨å¯¹è±¡æˆ–è€…ä¼ é€’å¯è°ƒç”¨å¯¹è±¡ã€‚äºæ˜¯ï¼Œ`std::function`å°±è¯ç”Ÿäº†ã€‚\n\n`std::function`æ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡åŒ…è£…å™¨ï¼Œæ˜¯ä¸€ä¸ªç±»æ¨¡æ¿ï¼Œå¯ä»¥å®¹çº³é™¤äº†ç±»æˆå‘˜å‡½æ•°æŒ‡é’ˆä¹‹å¤–çš„æ‰€æœ‰å¯è°ƒç”¨å¯¹è±¡ï¼Œå®ƒå¯ä»¥ç”¨ç»Ÿä¸€çš„æ–¹å¼å¤„ç†å‡½æ•°ã€å‡½æ•°å¯¹è±¡ã€å‡½æ•°æŒ‡é’ˆï¼Œå¹¶å…è®¸ä¿å­˜å’Œå»¶è¿Ÿå®ƒä»¬çš„æ‰§è¡Œã€‚\n\nå®šä¹‰functionçš„ä¸€èˆ¬å½¢å¼ï¼š\n```cpp\n#include <functional>\n\nstd::function<å‡½æ•°ç±»å‹>\n```\n\nä¾‹å¦‚ï¼š\n```cpp\n#include <functional>\n#include <iostream>\n\ntypedef std::function<int(int, int)> comfun;\n\n// æ™®é€šå‡½æ•°\nint add(int a, int b) { return a + b; }\n\n// lambdaè¡¨è¾¾å¼\nauto mod = [](int a, int b) {\n    return a % b;\n};\n\n// å‡½æ•°å¯¹è±¡\nstruct divide {\n    int operator()(int denominator, int divisor) {\n        return denominator / divisor;\n    }\n};\n\nint main() {\n   comfun a = add;\n   comfun b = mod;\n   comfun c = divide();\n   std::cout << a(5, 3) << std::endl;\n   std::cout << b(5, 3) << std::endl;\n   std::cout << c(5, 3) << std::endl;\n}\n\n```\nstd::functionå¯ä»¥å–ä»£å‡½æ•°æŒ‡é’ˆçš„ä½œç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥å»¶è¿Ÿå‡½æ•°çš„æ‰§è¡Œï¼Œç‰¹åˆ«é€‚åˆä½œä¸º`å›è°ƒå‡½æ•°`ä½¿ç”¨ã€‚å®ƒæ¯”æ™®é€šå‡½æ•°æŒ‡é’ˆæ›´åŠ çš„çµæ´»å’Œä¾¿åˆ©ã€‚\n\næ•…è€Œï¼Œstd::functionçš„ä½œç”¨å¯ä»¥å½’çº³ä¸ºï¼š\n1. std::functionå¯¹C++ä¸­å„ç§å¯è°ƒç”¨å®ä½“ï¼ˆæ™®é€šå‡½æ•°ã€Lambdaè¡¨è¾¾å¼ã€å‡½æ•°æŒ‡é’ˆã€ä»¥åŠå…¶å®ƒå‡½æ•°å¯¹è±¡ç­‰ï¼‰çš„å°è£…ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„å¯è°ƒç”¨çš„std::functionå¯¹è±¡ï¼Œç®€åŒ–è°ƒç”¨ï¼›\n2. std::functionå¯¹è±¡æ˜¯å¯¹C++ä¸­ç°æœ‰çš„å¯è°ƒç”¨å®ä½“çš„ä¸€ç§ç±»å‹å®‰å…¨çš„åŒ…è£¹ï¼ˆå¦‚ï¼šå‡½æ•°æŒ‡é’ˆè¿™ç±»å¯è°ƒç”¨å®ä½“ï¼Œæ˜¯ç±»å‹ä¸å®‰å…¨çš„ï¼‰ã€‚\n\n# std::bind\nstd::bindå¯ä»¥çœ‹ä½œä¸€ä¸ªé€šç”¨çš„å‡½æ•°é€‚é…å™¨ï¼Œ**å®ƒæ¥å—ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„å¯è°ƒç”¨å¯¹è±¡æ¥é€‚åº”åŸå¯¹è±¡çš„å‚æ•°åˆ—è¡¨**ã€‚\n\nstd::bindå°†å¯è°ƒç”¨å¯¹è±¡ä¸å…¶å‚æ•°ä¸€èµ·è¿›è¡Œç»‘å®šï¼Œç»‘å®šåçš„ç»“æœå¯ä»¥ä½¿ç”¨std::functionä¿å­˜ã€‚std::bindä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªä½œç”¨ï¼š\n- å°†å¯è°ƒç”¨å¯¹è±¡å’Œå…¶å‚æ•°ç»‘å®šæˆä¸€ä¸ªä»¿å‡½æ•°ï¼›\n- åªç»‘å®šéƒ¨åˆ†å‚æ•°ï¼Œå‡å°‘å¯è°ƒç”¨å¯¹è±¡ä¼ å…¥çš„å‚æ•°ï¼›\n\nè°ƒç”¨bindçš„ä¸€èˆ¬å½¢å¼ï¼š\n```cpp\nauto newCallable = bind(callable, arg_list);\n```\nè¯¥å½¢å¼è¡¨è¾¾çš„æ„æ€æ˜¯ï¼šå½“è°ƒç”¨`newCallable`æ—¶ï¼Œä¼šè°ƒç”¨`callable`ï¼Œå¹¶ä¼ ç»™å®ƒ`arg_list`ä¸­çš„å‚æ•°ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼š`arg_list`ä¸­çš„å‚æ•°å¯èƒ½åŒ…å«å½¢å¦‚`_n`çš„åå­—ã€‚å…¶ä¸­`n`æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè¿™äº›å‚æ•°æ˜¯å ä½ç¬¦ï¼Œè¡¨ç¤º`newCallable`çš„å‚æ•°ï¼Œå®ƒä»¬å æ®äº†ä¼ é€’ç»™`newCallable`çš„å‚æ•°çš„ä½ç½®ã€‚æ•°å€¼nè¡¨ç¤ºç”Ÿæˆçš„å¯è°ƒç”¨å¯¹è±¡ä¸­å‚æ•°çš„ä½ç½®ï¼š`_1`ä¸º`newCallable`çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ`_2`ä¸ºç¬¬`2`ä¸ªå‚æ•°ï¼Œä»¥æ­¤ç±»æ¨ã€‚\n\nçœ‹ä¸‹é¢ä»£ç ï¼š\n```cpp\n\n#include <iostream>\n\nclass A {\npublic:\n    void fun_3(int k, int m) {\n        std::cout << \"print: k = \" << k << \", m = \" << m << std::endl;\n    }\n};\n\nvoid fun_1(int x, int y, int z) {\n    std::cout << \"print: x = \" << x << \", y = \" << y << \", z = \" << z << std::endl;\n}\n\nvoid fun_2(int &a, int &b) {\n    ++a;\n    ++b;\n    std::cout << \"print: a = \" << a << \", b = \" << b << std::endl;\n}\n\nint main(int argc, char *argv[]) {\n    //f1çš„ç±»å‹ä¸ºfunction<void(int, int, int)>\n    auto f1 = std::bind(fun_1, 1, 2, 3); // è¡¨ç¤ºç»‘å®šå‡½æ•°fun_1 çš„ç¬¬ä¸€ï¼ŒäºŒï¼Œä¸‰ä¸ªå‚æ•°å€¼ä¸ºï¼š 1, 2, 3\n    f1();\n\n    // è¡¨ç¤ºç»‘å®šå‡½æ•° fun_1çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¸º3ï¼Œè€Œfun_1å‡½æ•°ç¬¬ä¸€ï¼ŒäºŒä¸ªå‚æ•°åˆ†åˆ«ç”±è°ƒç”¨f3çš„æ—¶æŒ‡å®šï¼Œæ³¨æ„ï¼Œè¿™é‡Œä¼ å‚çš„é¡ºåºæ˜¯å¯ä»¥æ ¹æ®placeholders::_n æŒ‡å®šçš„\n    auto f2 = std::bind(fun_1, std::placeholders::_1, std::placeholders::_2, 3);\n    f2(1, 2);\n\n    // æ³¨æ„ä¸‹é¢çš„std::placeholders::_n çš„é¡ºåº\n    auto f3 = std::bind(fun_1, std::placeholders::_2, std::placeholders::_1, 3);\n    f3(1, 2);\n\n    int m = 2;\n    int n = 3;\n    auto f4 = std::bind(fun_2, std::placeholders::_1, n); // è¡¨ç¤ºç»‘å®šäº†fun_2çš„ç¬¬äºŒä¸ªå‚æ•°ä¸ºnï¼Œç¬¬äºŒä¸ªå‚æ•°ç”±f4è°ƒç”¨æ—¶çš„ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®š\n    f4(m);\n    std::cout << \"m = \" << m << std::endl; // m=3 è¯´æ˜bindå¯¹äºä¸é¢„å…ˆç»‘å®šçš„å‚æ•°ï¼Œæ˜¯å¼•ç”¨ä¼ é€’çš„\n    std::cout << \"n = \" << n << std::endl; // n=3 è¯´æ˜bindå¯¹äºé¢„å…ˆç»‘å®šçš„å‚æ•°ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªå€¼æ‹·è´ï¼Œè€Œä¸æ˜¯ä½¿ç”¨çš„nçš„å¼•ç”¨\n\n    A a;\n    //f5çš„ç±»å‹ä¸ºfunction<void(int, int)>\n    auto f5 = std::bind(&A::fun_3, &a, std::placeholders::_1, std::placeholders::_2);\n    f5(10, 20); // è°ƒç”¨a.fun_3(10, 20)\n\n    auto f6 = std::bind(&A::fun_3, a, std::placeholders::_1, std::placeholders::_2);\n    f6(10, 20); // è°ƒç”¨a.fun_3(10, 20)\n\n    std::function<void(int, int)> fc = std::bind(&A::fun_3, a, std::placeholders::_1, std::placeholders::_2);\n    fc(10, 20);\n\n    return 0;\n}\n```\nç”±æ­¤ä¾‹å­å¯ä»¥çœ‹å‡ºï¼š\n- é¢„ç»‘å®šçš„å‚æ•°æ˜¯ä»¥å€¼ä¼ é€’çš„å½¢å¼ï¼Œä¸é¢„ç»‘å®šçš„å‚æ•°è¦ç”¨std::placeholders(å ä½ç¬¦)çš„å½¢å¼å ä½ï¼Œä»_1å¼€å§‹ï¼Œä¾æ¬¡é€’å¢ï¼Œæ˜¯ä»¥å¼•ç”¨ä¼ é€’çš„å½¢å¼ï¼›ï¼ˆè¿™é‡Œçš„å€¼ä¼ é€’æˆ–å¼•ç”¨ä¼ é€’æ˜¯é’ˆå¯¹bindç”Ÿæˆå¯¹è±¡æ¥è¯´çš„ï¼Œå¹¶ä¸æ˜¯æŒ‡å¯è°ƒç”¨å¯¹è±¡çš„è°ƒç”¨ï¼‰\n- std::placeholdersè¡¨ç¤ºæ–°çš„å¯è°ƒç”¨å¯¹è±¡çš„å‚æ•°çš„å ä½ï¼Œå…¶ä¸­çš„_nä¸åŸå‡½æ•°çš„è¯¥å ä½ç¬¦æ‰€åœ¨ä½ç½®è¿›è¡ŒåŒ¹é…ï¼›ä¹Ÿå°±æ˜¯è¯´bindäº§ç”Ÿçš„æ–°çš„å¯è°ƒç”¨å¯¹è±¡çš„å‚æ•°ï¼Œå¯ä»¥å’ŒåŸå‡½æ•°çš„å‚æ•°é¡ºåºä¸ä¸€è‡´ã€‚\n- std::bindç»‘å®šç±»æˆå‘˜å‡½æ•°æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºå¯¹è±¡çš„æˆå‘˜å‡½æ•°çš„æŒ‡é’ˆï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºå¯¹è±¡çš„åœ°å€ï¼ˆè¿™é‡Œå¥½åƒå¯ä»¥ç›´æ¥ä¼ å¯¹è±¡çš„å˜é‡è¿›å»ï¼Œåº”è¯¥æ˜¯ä¼šåšéšå¼çš„è½¬æ¢ï¼Œå³å–åœ°å€ï¼Œå…·ä½“æ²¡ç ”ç©¶è¿‡ï¼‰ï¼Œè¿™æ˜¯å› ä¸ºå¯¹è±¡çš„æˆå‘˜å‡½æ•°éœ€è¦æœ‰thisæŒ‡é’ˆã€‚å¹¶ä¸”ç¼–è¯‘å™¨ä¸ä¼šå°†å¯¹è±¡çš„æˆå‘˜å‡½æ•°æŒ‡é’ˆï¼Œéœ€è¦é€šè¿‡æ˜¾å¼& å–åœ°å€è¿›è¡Œè½¬æ¢ã€‚\n- std::bindçš„è¿”å›å€¼æ˜¯å¯è°ƒç”¨å®ä½“ï¼Œå¯ä»¥ç›´æ¥èµ‹ç»™std::functionã€‚\n\n\n","tags":["function","bind"],"categories":["C++","åŸºç¡€"]},{"title":"Cpp11-lambdaè¡¨è¾¾å¼","url":"/2023/03/24/Cpp11-lambdaè¡¨è¾¾å¼/","content":"\n# å¼•è¨€\nlambdaè¡¨è¾¾å¼æ˜¯C++11æœ€é‡è¦ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„ç‰¹æ€§ä¹‹ä¸€ã€‚lambdaæ¥æºäºå‡½æ•°å¼ç¼–ç¨‹çš„æ¦‚å¿µï¼Œä¹Ÿæ˜¯ç°ä»£ç¼–ç¨‹è¯­è¨€çš„ä¸€ä¸ªç‰¹ç‚¹ã€‚lambdaè¡¨è¾¾å¼æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š\n- å£°æ˜å¼ç¼–ç¨‹é£æ ¼ï¼šå°±åœ°åŒ¿åå®šä¹‰ç›®æ ‡å‡½æ•°æˆ–å‡½æ•°å¯¹è±¡ï¼Œä¸éœ€è¦é¢å¤–å†™ä¸€ä¸ªå‘½åå‡½æ•°æˆ–è€…å‡½æ•°å¯¹è±¡ã€‚ä»¥æ›´ç›´æ¥çš„æ–¹å¼å»å†™ç¨‹åºï¼Œå¥½çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚\n- ç®€æ´ï¼šä¸éœ€è¦é¢å¤–å†å†™ä¸€ä¸ªå‡½æ•°æˆ–è€…å‡½æ•°å¯¹è±¡ï¼Œé¿å…äº†ä»£ç è†¨èƒ€å’ŒåŠŸèƒ½åˆ†æ•£ï¼Œè®©å¼€å‘è€…æ›´åŠ é›†ä¸­ç²¾åŠ›åœ¨æ‰‹è¾¹çš„é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿè·å–äº†æ›´é«˜çš„ç”Ÿäº§ç‡ã€‚\n- åœ¨éœ€è¦çš„æ—¶é—´å’Œåœ°ç‚¹å®ç°åŠŸèƒ½é—­åŒ…ï¼Œä½¿ç¨‹åºæ›´çµæ´»ã€‚\n\n# lambdaè¡¨è¾¾å¼çš„æ¦‚å¿µå’ŒåŸºæœ¬ç”¨æ³•\nlambdaè¡¨è¾¾å¼å®šä¹‰äº†ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå¹¶ä¸”å¯ä»¥æ•è·ä¸€å®šèŒƒå›´å†…çš„å˜é‡ã€‚lambdaè¡¨è¾¾å¼çš„è¯­æ³•å½¢å¼å¯ç®€å•å½’çº³å¦‚ä¸‹ï¼š\n```\n[capture](params)opt->ret{body;};\n```\n> å…¶ä¸­captureæ˜¯æ•è·åˆ—è¡¨ï¼Œparamsæ˜¯å‚æ•°åˆ—è¡¨ï¼Œoptæ˜¯å‡½æ•°é€‰é¡¹ï¼Œretæ˜¯è¿”å›å€¼ç±»å‹ï¼Œbodyæ˜¯å‡½æ•°ä½“ã€‚\n\nå› æ­¤ï¼Œä¸€ä¸ªå®Œæ•´çš„lambdaè¡¨è¾¾å¼çœ‹èµ·æ¥åƒè¿™æ ·ï¼š\n```cpp\n...\nauto f = [](int a) -> int { return a + 1; };\n\nstd::cout << f(1) << std::endl; // è¾“å‡ºï¼š 2\n...\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œä¸Šé¢é€šè¿‡ä¸€è¡Œä»£ç å®šä¹‰äº†ä¸€ä¸ªå°å°çš„åŠŸèƒ½é—­åŒ…ï¼Œç”¨æ¥å°†è¾“å…¥åŠ 1å¹¶è¿”å›ã€‚\n\nåœ¨å¾ˆå¤šæ—¶å€™ï¼Œlambdaè¡¨è¾¾å¼çš„è¿”å›å€¼æ˜¯éå¸¸æ˜æ˜¾çš„ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ã€‚å› æ­¤ï¼ŒC++11ä¸­å…è®¸çœç•¥lambdaè¡¨è¾¾å¼çš„è¿”å›å€¼å®šä¹‰ï¼š\n```cpp\n...\nauto f = [](int a){ return a + 1; };\n...\n```\nè¿™æ ·ç¼–è¯‘å™¨å°±ä¼šæ ¹æ®returnè¯­å¥è‡ªåŠ¨æ¨å¯¼å‡ºè¿”å›å€¼ç±»å‹ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆå§‹åŒ–åˆ—è¡¨ä¸èƒ½ç”¨äºè¿”å›å€¼çš„è‡ªåŠ¨æ¨å¯¼ï¼š\n```cpp\n...\nauto x1 = [](int i) { return i; }; //OK: return type is int\nauto x2 = []() { return {1, 2}; }; // error:æ— æ³•æ¨å¯¼å‡ºè¿”å›å€¼ç±»å‹\n...\n```\nè¿™æ—¶æˆ‘ä»¬éœ€è¦æ˜¾å¼ç»™å‡ºå…·ä½“çš„è¿”å›å€¼ç±»å‹ã€‚\n\nå¦å¤–ï¼Œlambdaè¡¨è¾¾å¼åœ¨æ²¡æœ‰å‚æ•°åˆ—è¡¨æ—¶ï¼Œå‚æ•°åˆ—è¡¨æ˜¯å¯ä»¥çœç•¥çš„ã€‚å› æ­¤åƒä¸‹é¢çš„å†™æ³•éƒ½æ˜¯æ­£ç¡®çš„ï¼š\n```cpp\n...\nauto f1 = []() { return 1; };\nauto f2 = [] { return 1; }; // çœç•¥ç©ºå‚æ•°åˆ—è¡¨\n...\n```\n\n# ä½¿ç”¨lambdaè¡¨è¾¾å¼æ•è·åˆ—è¡¨\nlambdaè¡¨è¾¾å¼è¿˜å¯ä»¥é€šè¿‡æ•è·åˆ—è¡¨æ•è·ä¸€å®šèŒƒå›´çš„å˜é‡ï¼š\n- []ä¸æ•è·ä»»ä½•å˜é‡\n- [&]æ•è·å¤–éƒ¨ä½œç”¨åŸŸä¸­æ‰€æœ‰å˜é‡ï¼Œå¹¶ä½œä¸ºå¼•ç”¨åœ¨å‡½æ•°ä½“ä¸­ä½¿ç”¨ï¼ˆæŒ‰å¼•ç”¨æ•è·ï¼‰ã€‚\n- [=]æ•è·å¤–éƒ¨ä½œç”¨åŸŸä¸­æ‰€æœ‰å˜é‡ï¼Œå¹¶ä½œä¸ºå‰¯æœ¬åœ¨å‡½æ•°ä½“ä¸­ä½¿ç”¨ï¼ˆæŒ‰å€¼æ•è·ï¼‰ã€‚\n- [=, &foo]æŒ‰å€¼æ•è·å¤–éƒ¨ä½œç”¨åŸŸä¸­æ‰€æœ‰å˜é‡ï¼Œå¹¶æŒ‰å¼•ç”¨æ•è·fooå˜é‡ã€‚\n- [bar]æŒ‰å€¼æ•è·barå˜é‡ï¼ŒåŒæ—¶ä¸æ•è·å…¶å®ƒå˜é‡ã€‚\n- [this]æŒ‰å€¼æ•è·å½“å‰ç±»ä¸­çš„thisæŒ‡é’ˆï¼Œè®©lambdaè¡¨è¾¾å¼æ‹¥æœ‰å’Œå½“å‰ç±»æˆå‘˜å‡½æ•°åŒæ ·çš„è®¿é—®æƒé™ã€‚å¦‚æœå·²ç»ä½¿ç”¨äº†&æˆ–è€…=ï¼Œå°±é»˜è®¤æ·»åŠ æ­¤é€‰é¡¹ã€‚æ•è·thisçš„ç›®çš„æ˜¯å¯ä»¥åœ¨lambdaä¸­ä½¿ç”¨å½“å‰çš„æˆå‘˜å‡½æ•°å’Œæˆå‘˜å˜é‡ã€‚\n\nä¸‹é¢çœ‹ä¸€ä¸‹å®ƒçš„å…·ä½“ç”¨æ³•ï¼š\n```cpp\nclass A\n{\n    public:\n    int i_ = 0;\n    void func(int x, int y)\n    {\n        auto x1 = []{ return i_; };                    // errorï¼Œæ²¡æœ‰æ•è·å¤–éƒ¨å˜é‡\n        auto x2 = [=]{ return i_ + x + y; };           // OKï¼Œæ•è·æ‰€æœ‰å¤–éƒ¨å˜é‡\n        auto x3 = [&]{ return i_ + x + y; };           // OKï¼Œæ•è·æ‰€æœ‰å¤–éƒ¨å˜é‡\n        auto x4 = [this]{ return i_; };                // OKï¼Œæ•è·thisæŒ‡é’ˆ\n        auto x5 = [this]{ return i_ + x + y; };        // errorï¼Œæ²¡æœ‰æ•è·xã€y\n        auto x6 = [this, x, y]{ return i_ + x + y; };  // OKï¼Œæ•è·thisæŒ‡é’ˆã€xã€y\n        auto x7 = [this]{ return i_++; };              // OKï¼Œæ•è·thisæŒ‡é’ˆï¼Œå¹¶ä¿®æ”¹æˆå‘˜çš„å€¼\n    }\n};\n```\n\nä»ä¸Šä¾‹ä¸­å¯ä»¥çœ‹åˆ°ï¼Œlambda è¡¨è¾¾å¼çš„æ•è·åˆ—è¡¨ç²¾ç»†åœ°æ§åˆ¶äº† lambda è¡¨è¾¾å¼èƒ½å¤Ÿè®¿é—®çš„å¤–éƒ¨å˜é‡ï¼Œä»¥åŠå¦‚ä½•è®¿é—®è¿™äº›å˜é‡ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé»˜è®¤çŠ¶æ€ä¸‹ lambda è¡¨è¾¾å¼æ— æ³•ä¿®æ”¹é€šè¿‡å¤åˆ¶æ–¹å¼æ•è·çš„å¤–éƒ¨å˜é‡ã€‚å¦‚æœå¸Œæœ›ä¿®æ”¹è¿™äº›å˜é‡çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å¼•ç”¨æ–¹å¼è¿›è¡Œæ•è·ã€‚\n\nä¸€ä¸ªå®¹æ˜“å‡ºé”™çš„ç»†èŠ‚æ˜¯å…³äº lambda è¡¨è¾¾å¼çš„å»¶è¿Ÿè°ƒç”¨çš„ï¼š\n```cpp\n...\nint a = 0;\nauto f = [=]{ return a; };      // æŒ‰å€¼æ•è·å¤–éƒ¨å˜é‡\na += 1;                         // aè¢«ä¿®æ”¹äº†\nstd::cout << f() << std::endl;  // è¾“å‡ºï¼Ÿ\n...\n```\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œlambda è¡¨è¾¾å¼æŒ‰å€¼æ•è·äº†æ‰€æœ‰å¤–éƒ¨å˜é‡ã€‚åœ¨æ•è·çš„ä¸€ç¬é—´ï¼Œa çš„å€¼å°±å·²ç»è¢«å¤åˆ¶åˆ°fä¸­äº†ã€‚ä¹‹å a è¢«ä¿®æ”¹ï¼Œä½†æ­¤æ—¶ f ä¸­å­˜å‚¨çš„ a ä»ç„¶è¿˜æ˜¯æ•è·æ—¶çš„å€¼ï¼Œå› æ­¤ï¼Œæœ€ç»ˆè¾“å‡ºç»“æœæ˜¯ 0ã€‚\n\n**å¦‚æœå¸Œæœ› lambda è¡¨è¾¾å¼åœ¨è°ƒç”¨æ—¶èƒ½å¤Ÿå³æ—¶è®¿é—®å¤–éƒ¨å˜é‡ï¼Œæˆ‘ä»¬åº”å½“ä½¿ç”¨å¼•ç”¨æ–¹å¼æ•è·ã€‚**\n\nä»ä¸Šé¢çš„ä¾‹å­ä¸­æˆ‘ä»¬çŸ¥é“ï¼ŒæŒ‰å€¼æ•è·å¾—åˆ°çš„å¤–éƒ¨å˜é‡å€¼æ˜¯åœ¨ lambda è¡¨è¾¾å¼å®šä¹‰æ—¶çš„å€¼ã€‚æ­¤æ—¶æ‰€æœ‰å¤–éƒ¨å˜é‡å‡è¢«å¤åˆ¶äº†ä¸€ä»½å­˜å‚¨åœ¨ lambda è¡¨è¾¾å¼å˜é‡ä¸­ã€‚æ­¤æ—¶è™½ç„¶ä¿®æ”¹ lambda è¡¨è¾¾å¼ä¸­çš„è¿™äº›å¤–éƒ¨å˜é‡å¹¶ä¸ä¼šçœŸæ­£å½±å“åˆ°å¤–éƒ¨ï¼Œæˆ‘ä»¬å´ä»ç„¶æ— æ³•ä¿®æ”¹å®ƒä»¬ã€‚\n\né‚£ä¹ˆå¦‚æœå¸Œæœ›å»**ä¿®æ”¹æŒ‰å€¼æ•è·çš„å¤–éƒ¨å˜é‡**åº”å½“æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™æ—¶ï¼Œéœ€è¦æ˜¾å¼æŒ‡æ˜ lambda è¡¨è¾¾å¼ä¸º mutableï¼š\n\n```cpp\n...\nint a = 0;\nauto f1 = [=]{ return a++; };               // error, ä¿®æ”¹æŒ‰å€¼æ•è·çš„å¤–éƒ¨å˜é‡\nauto f2 = [=]() mutable { return a++; };    // OK, mutable\n...\n```\néœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œè¢«mutableä¿®é¥°çš„lambdaè¡¨è¾¾å¼å°±ç®—æ²¡æœ‰å‚æ•°ä¹Ÿè¦å†™æ˜å‚æ•°åˆ—è¡¨\n\n# lambdaè¡¨è¾¾å¼çš„ç±»å‹\næœ€åï¼Œä»‹ç»ä¸€ä¸‹lambdaè¡¨è¾¾å¼çš„ç±»å‹ã€‚\nlambdaè¡¨è¾¾å¼çš„ç±»å‹åœ¨C++11ä¸­è¢«ç§°ä¸ºâ€œé—­åŒ…ç±»å‹ï¼ˆClosure Typeï¼‰â€œã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ªå¸¦æœ‰operator()çš„ç±»â€”â€”å¯¹æ‹¬å·è¿ç®—ç¬¦è¿›è¡Œäº†é‡è½½çš„ç±»ï¼Œå³ä»¿å‡½æ•°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨std::functionå’Œstd::bindæ¥å­˜å‚¨å’Œæ“ä½œlambdaè¡¨è¾¾å¼ï¼š\n```cpp\n...\nstd::function<int(int)> f1 = [](int a) { return a; };\nstd::function<int(void)> f2 = std::bind([](int a){ return a; }, 123);\nf1(555); // 555\nf2(); // 123\n...\n```\nå¦å¤–ï¼Œ**å¯¹äºæ²¡æœ‰æ•è·ä»»ä½•å˜é‡çš„lambdaè¡¨è¾¾å¼**ï¼Œè¿˜å¯ä»¥è¢«è½¬æ¢æˆä¸€ä¸ªæ™®é€šçš„å‡½æ•°æŒ‡é’ˆï¼š\n```cpp\n...\nusing funct_t = int(*)(int);\nfunc_t f = [](int a) { return a; };\nf(123);\n...\n```\nlambdaè¡¨è¾¾å¼å¯ä»¥è¯´æ˜¯å°±åœ°å®šä¹‰ä»¿å‡½æ•°é—­åŒ…çš„â€è¯­æ³•ç³–â€œã€‚å®ƒçš„æ•è·åˆ—è¡¨æ•è·ä½çš„ä»»ä½•å¤–éƒ¨å˜é‡ï¼Œæœ€ç»ˆå‡ä¼šå˜ä¸º**é—­åŒ…ç±»å‹çš„æˆå‘˜å˜é‡**ã€‚è€Œä¸€ä¸ªä½¿ç”¨äº†æˆå‘˜å˜é‡çš„ç±»çš„operator(),å¦‚æœèƒ½ç›´æ¥è¢«è½¬æ¢ä¸ºæ™®é€šçš„å‡½æ•°æŒ‡é’ˆï¼Œ**é‚£ä¹ˆlambdaè¡¨è¾¾å¼æœ¬èº«çš„thisæŒ‡é’ˆå°±ä¸¢å¤±æ‰äº†**ã€‚è€Œæ²¡æœ‰æ•è·ä»»ä½•å¤–éƒ¨å˜é‡çš„lambdaè¡¨è¾¾å¼åˆ™ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚\n\nè¿™é‡Œä¹Ÿå¯ä»¥å¾ˆè‡ªç„¶åœ°è§£é‡Šä¸ºä½•æŒ‰å€¼æ•è·æ— æ³•ä¿®æ”¹æ•è·çš„å¤–éƒ¨å˜é‡ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯åŸå§‹å¤–éƒ¨å˜é‡Œçš„å€¼çš„å‰¯æœ¬ï¼Œåœ¨é—­åŒ…å†…éƒ¨çš„ä¸€ä¸ªæˆå‘˜å˜é‡ï¼‰ã€‚å› ä¸ºæŒ‰C++æ ‡å‡†ï¼Œlambdaè¡¨è¾¾å¼çš„operator()é»˜è®¤æ˜¯constçš„ã€‚ä¸€ä¸ªconstæˆå‘˜å‡½æ•°æ˜¯æ— æ³•ä¿®æ”¹æˆå‘˜å˜é‡çš„å€¼çš„ã€‚è€Œmutableçš„ä½œç”¨ï¼Œå°±åœ¨äºå–æ¶ˆoperator()çš„constã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ²¡æœ‰æ•è·å˜é‡çš„lambdaè¡¨è¾¾å¼å¯ä»¥ç›´æ¥è½¬æ¢ä¸ºå‡½æ•°æŒ‡é’ˆï¼Œè€Œæ•è·å˜é‡çš„lambdaè¡¨è¾¾å¼åˆ™ä¸èƒ½è½¬æ¢ä¸ºå‡½æ•°æŒ‡é’ˆã€‚çœ‹çœ‹ä¸‹é¢çš„ä»£ç ï¼š\n```cpp\n...\n\ntypedef void(*Ptr)(int*);\n\nPtr p = [](int* p) { delete p; }; //æ­£ç¡®ï¼Œæ— çŠ¶æ€çš„lambdaï¼ˆæ²¡æœ‰æ•è·ï¼‰è¡¨è¾¾å¼å¯ä»¥ç›´æ¥è½¬æ¢ä¸ºå‡½æ•°æŒ‡é’ˆ\nPtr p1 = [&](int* p) { delete p; }; // é”™è¯¯ï¼Œæœ‰çŠ¶æ€çš„lambdaä¸èƒ½ç›´æ¥è½¬æ¢ä¸ºå‡½æ•°æŒ‡é’ˆ\n...\n```\nä¸Šé¢ç¬¬äºŒè¡Œä»£ç èƒ½ç¼–è¯‘é€šè¿‡ï¼Œè€Œç¬¬ä¸‰è¡Œä»£ç ä¸èƒ½ç¼–è¯‘é€šè¿‡ï¼Œå› ä¸ºç¬¬ä¸‰è¡Œä»£ç æ•è·äº†å˜é‡ï¼Œä¸èƒ½ç›´æ¥è½¬ä¸ºå‡½æ•°æŒ‡é’ˆã€‚\n\n# å£°æ˜å¼çš„ç¼–ç¨‹é£æ ¼ï¼Œç®€æ´çš„ä»£ç \nå°±åœ°å®šä¹‰åŒ¿åå‡½æ•°ï¼Œä¸å†éœ€è¦å®šä¹‰å‡½æ•°å¯¹è±¡ï¼Œå¤§å¤§ç®€åŒ–äº†æ ‡å‡†åº“ç®—æ³•çš„è°ƒç”¨ã€‚æ¯”å¦‚ï¼Œåœ¨C++11ä¹‹å‰ï¼Œæˆ‘ä»¬è¦è°ƒç”¨for_eachå‡½æ•°å°†vecoträ¸­çš„å¶æ•°æ‰“å°å‡ºæ¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\n\nã€å®ä¾‹ã€‘lambdaè¡¨è¾¾å¼ä»£æ›¿å‡½æ•°å¯¹åƒçš„ç¤ºä¾‹ã€‚\n```cpp\nclass CountEven\n{\n    int& count_;\npublic:\n    CountEven(int& count) : count_(count) {}\n    void operator()(int val)\n    {\n        if (!(val & 1))       // val % 2 == 0\n        {\n            ++ count_;\n        }\n    }\n};\n```\n```cpp\n...\nstd::vector<int> v = { 1, 2, 3, 4, 5, 6 };\nint even_count = 0;\nfor_each(v.begin(), v.end(), CountEven(even_count));\nstd::cout << \"The number of even is \" << even_count << std::endl;\n...\n```\n\nè¿™æ ·å†™æ—¢çƒ¦çåˆå®¹æ˜“å‡ºé”™ã€‚æœ‰äº†lambdaè¡¨è¾¾å¼ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨çœŸæ­£çš„é—­åŒ…æ¦‚å¿µæ¥æ›¿æ¢æ‰è¿™é‡Œçš„ä»¿å‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š\n```cpp\nstd::vector<int> v = { 1, 2, 3, 4, 5, 6 };\nint even_count = 0;\nfor_each( v.begin(), v.end(), [&even_count](int val)\n        {\n            if (!(val & 1))  // val % 2 == 0\n            {\n                ++ even_count;\n            }\n        });\nstd::cout << \"The number of even is \" << even_count << std::endl;\n```\nlambdaè¡¨è¾¾å¼çš„ä»·å€¼åœ¨äºï¼Œå°±åœ°å°è£…çŸ­å°çš„åŠŸèƒ½é—­åŒ…ï¼Œå¯ä»¥æå…¶æ–¹ä¾¿åœ°è¡¨è¾¾å‡ºæˆ‘ä»¬å¸Œæœ›æ‰§è¡Œçš„å…·ä½“æ“ä½œï¼Œå¹¶è®©ä¸Šä¸‹æ–‡ç»“åˆå¾—æ›´åŠ ç´§å¯†ã€‚\n\n\n","tags":["c++","cpp","lambda"],"categories":["C++","åŸºç¡€"]},{"title":"Primihubæ ¸å¿ƒæ¨¡å‹","url":"/2023/03/13/Primihubæ ¸å¿ƒæ¨¡å‹/","content":"\n# æ ¸å¿ƒæ¨¡å‹\nåˆæ­¥äº†è§£PrimiHubæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š\n- èŠ‚ç‚¹ï¼ˆNodeï¼‰ï¼šä¸€ä¸ªåŠ è½½å®‰å…¨åè®®å’Œæ¥æ”¶è®¡ç®—è¯·æ±‚çš„å¯æ‰§è¡Œç¨‹åºï¼ŒèŠ‚ç‚¹ä¸ºä¸Šå±‚åè®®æ‰§è¡Œæä¾›åŸºç¡€æœåŠ¡ï¼Œç›®å‰æä¾›çš„åŸºç¡€æœåŠ¡æœ‰æ•°æ®é›†å…ƒæ•°æ®æœåŠ¡ã€æ•°æ®ç¼“å­˜æœåŠ¡ï¼›\n- åè®®ï¼ˆProtocolï¼‰ï¼šæŒ‡å¤šæ–¹å®‰å…¨è®¡ç®—MPCåè®®\n- è™šæ‹ŸèŠ‚ç‚¹ï¼ˆVMNodeï¼‰ï¼šè™šæ‹ŸèŠ‚ç‚¹æ˜¯èŠ‚ç‚¹ä¸Šæ‰€æœ‰ä»»åŠ¡çš„æ‰§è¡Œå™¨\n- è™šæ‹ŸèŠ‚ç‚¹çš„è§’è‰²ï¼ˆVMNode roleï¼‰ï¼šæŒ‡åœ¨ä¸€æ¬¡è¡ŒåŠ¡æ‰§è¡Œä¸­æ‰®æ¼”çš„è§’è‰²ï¼Œåˆ†ä¸ºä¸¤ç§ï¼ša.æ§åˆ¶èŠ‚ç‚¹ï¼ˆSchedulerï¼‰ b.å·¥ä½œèŠ‚ç‚¹ï¼ˆWorkerï¼‰\n- æ•°æ®é›†ï¼ˆDatasetï¼‰ï¼šæŒ‡ä»»åŠ¡éœ€è¦è®¡ç®—çš„æ•°æ®\n- ç®—æ³•ï¼ˆAlgorithmï¼‰ï¼šæŒ‡ä»»åŠ¡æ‰§è¡Œçš„å…·ä½“é€»è¾‘ï¼Œå°†æ ¹æ®åè®®åˆ†é…åˆ°æŒ‡å®šèŠ‚ç‚¹ä¸Šæ‰§è¡Œ\n- ä»»åŠ¡ï¼ˆTaskï¼‰ï¼šç‰¹å®šåè®®æ­£åœ¨æ‰§è¡Œçš„MPCè®¡ç®—ä»»åŠ¡ï¼Œä¸€ä¸ªè®¡ç®—ä»»åŠ¡éœ€è¦æŒ‡å®šç®—æ³•ã€æ•°æ®é›†ã€åè®®ï¼ˆåè®®å¯è‡ªåŠ¨ç”±èŠ‚ç‚¹æ ¹æ®ç®—æ³•è‡ªåŠ¨åå•†æˆ–äººå·¥æŒ‡å®šï¼‰\n- è¿è¡Œæ—¶ï¼ˆWorkerï¼‰ï¼šä»»åŠ¡ï¼ˆTaskï¼‰çš„åŠ è½½å’Œè¿è¡Œå™¨ï¼Œä¸€ä¸ªè¿è¡Œæ—¶åœ¨å¯åŠ¨æ—¶ç”±VMNodeåˆ†é…ä½¿ç”¨çš„åè®®ï¼ˆProtocolï¼‰ï¼›\n- è¿è¡Œæ—¶å‚ä¸è§’è‰²ï¼ˆWorker partyï¼‰ï¼šè¿è¡Œæ—¶è§’è‰²æ ¹æ®ä¼ å…¥çš„å®‰å…¨åè®®æŒ‡å®šä¸å®‰å…¨åè®®ç›¸å…³çš„è§’è‰²\n\n## æ ¸å¿ƒæ¨¡å‹å¦‚ä½•å·¥ä½œ\n![æ ¸å¿ƒæ¨¡å‹å¦‚ä½•å·¥ä½œ](Primihubæ ¸å¿ƒæ¨¡å‹/æ ¸å¿ƒæ¨¡å‹å¦‚ä½•å·¥ä½œ.jpg)","categories":["è”é‚¦å­¦ä¹ "]},{"title":"Primihubç¯å¢ƒæ­å»º","url":"/2023/03/08/Primihubç¯å¢ƒæ­å»º/","content":"# å¿«é€Ÿå¼€å§‹\n\n## å‡†å¤‡å·¥ä½œ\nå®‰è£…`docker`å’Œ`docker-compose`ï¼Œæˆ–è€…ä¸‹è½½`PrimiHub`æ•´ç†å¥½çš„[å®‰è£…åŒ…](https://primihub.oss-cn-beijing.aliyuncs.com/dev/docker20.10.tar.gz), ä¸‹è½½åè§£å‹æ‰§è¡Œ\n```shell\nbash install_docker.sh\n```\nå®Œæˆ`docker`å’Œ`docker-compose`çš„å®‰è£…ã€‚\n\nç„¶åä¸‹è½½ä»“åº“å¹¶è¿›å…¥åˆ°ä»£ç ç›®å½•ï¼š\n```shell\ngit clone https://github.com/primihub/primihub.git\ncd primihub\n```\n\n## å¯åŠ¨èŠ‚ç‚¹\n### å¯åŠ¨æµ‹è¯•ç”¨çš„èŠ‚ç‚¹\nä½¿ç”¨`docker-compose`å¯åŠ¨å®¹å™¨ã€‚å®¹å™¨åŒ…æ‹¬ï¼šå¯åŠ¨ç‚¹ã€redis(æ•°æ®é›†æŸ¥æ‰¾é»˜è®¤ä½¿ç”¨redis)ã€ä¸‰ä¸ªèŠ‚ç‚¹\n```shell\ndocker-compose up -d\n```\næŸ¥çœ‹è¿è¡Œèµ·æ¥çš„dockerå®¹å™¨ï¼š\n```shell\ndocker-compose ps -a\n```\nå¦‚æœä¸€åˆ‡é¡ºåˆ©ä¼šçœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„ä¿¡æ¯ï¼š\n```shell\nNAME                    COMMAND                  SERVICE                 STATUS              PORTS\nprimihub-node0          \"/bin/bash -c './priâ€¦\"   node0                   running             0.0.0.0:6666->6666/tcp, 0.0.0.0:8050->50050/tcp\nprimihub-node1          \"/bin/bash -c './priâ€¦\"   node1                   running             0.0.0.0:6667->6667/tcp, 0.0.0.0:8051->50051/tcp\nprimihub-node2          \"/bin/bash -c './priâ€¦\"   node2                   running             0.0.0.0:6668->6668/tcp, 0.0.0.0:8052->50052/tcp\nredis                   \"docker-entrypoint.sâ€¦\"   redis                   running             0.0.0.0:6379->6379/tcp\nsimple_bootstrap_node   \"/app/simple-bootstrâ€¦\"   simple_bootstrap_node   running             0.0.0.0:4001->4001/tcp\n```\n\nä½†æ˜¯ï¼Œæˆ‘è¿™é‡Œé‡åˆ°å‘äº†ï¼Œnode0, node1, node2 è¿™3ä¸ªå®¹å™¨çš„çŠ¶æ€ä¸ºrestartingã€‚å¹¶ä¸”æ˜¯ä¸æ–­restartingã€‚ä½¿ç”¨å‘½ä»¤ï¼š\n```shell\ndocker logs å®¹å™¨ID\n```\næŸ¥çœ‹æ—¥å¿—æ˜¯åŠ è½½mysqlå®¢æˆ·ç«¯çš„ä¸€ä¸ªåŠ¨æ€åº“æ–‡ä»¶å¤±è´¥ã€‚è¿™ä¸ªå®¹å™¨æ²¡æ‰“åŒ…å¥½ï¼Ÿissueæ€»å…±ä¹Ÿæ²¡æœ‰å‡ æ¡ï¼Œæ›´ä¸ç”¨è¯´æœç´¢æœ‰æ²¡æœ‰é‡åˆ°ç±»ä¼¼çš„é—®é¢˜äº†ï¼Œå¯è§è¿™ä¸ªé¡¹ç›®ç”¨çš„äººå°‘å¾—å¯æ€œï¼Œæ–‡æ¡£ä¹Ÿä¸å¥å…¨ã€‚\n\nè§£å†³æ–¹æ³•: æ£€å‡ºå¦å¤–çš„åˆ†æ”¯ï¼Œå†ä½¿ç”¨ docker-compose up -d\n> æµ‹è¯•äº† feature/node_as_share_lib æ˜¯å¯ä»¥çš„ï¼Œdevelopeå’Œmasteréƒ½ä¸è¡Œ\n\n## åˆ›å»ºä¸€ä¸ªMPCä»»åŠ¡\nè®©ä¸‰ä¸ªèŠ‚ç‚¹å…±åŒæ‰§è¡Œä¸€ä¸ªå¤šæ–¹å®‰å…¨è®¡ç®—ï¼ˆMPC)çš„é€»è¾‘å›å½’ä»»åŠ¡\n\n```shell\nsudo docker run \"--network=host\" -it primihub/primihub-node:1.1.0 ./primihub-cli \"--server=127.0.0.1:8050\"\n```\n\n> æ³¨ï¼šæ³¨æ„primihub-nodeçš„ç‰ˆæœ¬ï¼Œè¦å’Œå‰ä¸€ç« èŠ‚ä¸­docker-composeå¯åŠ¨çš„primihub-nodeç‰ˆæœ¬ä¸€è‡´\n\n# ä½¿ç”¨docker-composeéƒ¨ç½²\n\n## ä¸‹è½½å®‰è£…åŒ…ï¼Œæ‰§è¡Œè„šæœ¬ï¼Œå®Œæˆéƒ¨ç½²\n```shell\ncurl -s https://get.primihub.com/release/latest/docker-deploy.tar.gz | tar zxf -\ncd docker-deploy\nbash deploy.sh\n```\n\n## æŸ¥çœ‹éƒ¨ç½²ç»“æœ\n```shell\n# docker-compose ps -a\nNAME                COMMAND                  SERVICE                 STATUS              PORTS\napplication1        \"/bin/sh -c 'java -jâ€¦\"   application1            running             \napplication2        \"/bin/sh -c 'java -jâ€¦\"   application2            running             \napplication3        \"/bin/sh -c 'java -jâ€¦\"   application3            running             \nbootstrap-node      \"/app/simple-bootstrâ€¦\"   simple-bootstrap-node   running             4001/tcp\nfusion              \"/bin/sh -c 'java -jâ€¦\"   fusion                  running             \ngateway1            \"/bin/sh -c 'java -jâ€¦\"   gateway1                running             \ngateway2            \"/bin/sh -c 'java -jâ€¦\"   gateway2                running             \ngateway3            \"/bin/sh -c 'java -jâ€¦\"   gateway3                running             \nloki                \"/usr/bin/loki -confâ€¦\"   loki                    running             0.0.0.0:3100->3100/tcp, :::3100->3100/tcp\nmanage-web1         \"/docker-entrypoint.â€¦\"   nginx1                  running             0.0.0.0:30811->80/tcp, :::30811->80/tcp\nmanage-web2         \"/docker-entrypoint.â€¦\"   nginx2                  running             0.0.0.0:30812->80/tcp, :::30812->80/tcp\nmanage-web3         \"/docker-entrypoint.â€¦\"   nginx3                  running             0.0.0.0:30813->80/tcp, :::30813->80/tcp\nmysql               \"docker-entrypoint.sâ€¦\"   mysql                   running             0.0.0.0:3306->3306/tcp, :::3306->3306/tcp\nnacos-server        \"bin/docker-startup.â€¦\"   nacos                   running             0.0.0.0:8848->8848/tcp, 0.0.0.0:9555->9555/tcp, 0.0.0.0:9848->9848/tcp, :::8848->8848/tcp, :::9555->9555/tcp, :::9848->9848/tcp\nprimihub-node0      \"/bin/bash -c './priâ€¦\"   node0                   running             0.0.0.0:6666->6666/tcp, 0.0.0.0:50050->50050/tcp, :::6666->6666/tcp, :::50050->50050/tcp\nprimihub-node1      \"/bin/bash -c './priâ€¦\"   node1                   running             0.0.0.0:6667->6667/tcp, 0.0.0.0:50051->50051/tcp, :::6667->6667/tcp, :::50051->50051/tcp\nprimihub-node2      \"/bin/bash -c './priâ€¦\"   node2                   running             0.0.0.0:6668->6668/tcp, 0.0.0.0:50052->50052/tcp, :::6668->6668/tcp, :::50052->50052/tcp\nrabbitmq1           \"docker-entrypoint.sâ€¦\"   rabbitmq1               running             25672/tcp\nrabbitmq2           \"docker-entrypoint.sâ€¦\"   rabbitmq2               running             25672/tcp\nrabbitmq3           \"docker-entrypoint.sâ€¦\"   rabbitmq3               running             25672/tcp\nredis               \"docker-entrypoint.sâ€¦\"   redis                   running             6379/tcp\n```\n\n## ä½¿ç”¨è¯´æ˜\ndocker-compose.yaml æ–‡ä»¶ä¸­çš„nginx1ã€nginx2ã€nginx3 æ¨¡æ‹Ÿ 3 ä¸ªæœºæ„çš„ç®¡ç†åå°ï¼Œå¯åŠ¨å®Œæˆååœ¨æµè§ˆå™¨åˆ†åˆ«è®¿é—®\n\nhttp://æœºå™¨IP:30811\n\nhttp://æœºå™¨IP:30812\n\nhttp://æœºå™¨IP:30813\n\né»˜è®¤ç”¨æˆ·å¯†ç éƒ½æ˜¯ admin / 123456\n\nå…·ä½“çš„è”é‚¦å»ºæ¨¡ã€éšç§æ±‚äº¤ã€åŒ¿è¸ªæŸ¥è¯¢ç­‰åŠŸèƒ½çš„æ“ä½œæ­¥éª¤è¯·å‚è€ƒ [å¿«é€Ÿè¯•ç”¨ç®¡ç†å¹³å°](https://docs.primihub.com/docs/quick-start-platform)\n\n\n# primihubä»£ç ç¼–è¯‘\n\n## Mac Silicon M1\n- å®‰è£…Xcode\n- å®‰è£…Bazel 5.0.0ï¼Œæœ€å¥½æ˜¯ç›´æ¥brew install bazelisk\n- å®‰è£…CMakeï¼Œè¿™ä¸ªæœ€å‘ï¼Œç¼ºäº†è¿™ä¸ªï¼Œåœ¨è¿™é‡Œå¡äº†å¥½ä¹…\n- ç¼–å†™ä¸€ä¸ªshellè„šæœ¬ï¼Œç”¨æ¥æ‰§è¡Œç¼–è¯‘å‘½ä»¤:\n    ```shell\n    #!/bin/bash\n\n    ./pre_build.sh\n    bazel build --config=darwin_arm64 --config=macos  :node :cli :opt_paillier_c2py :linkcontext\n    ```\n\n# èŠ‚ç‚¹è¿è¡Œ\nåœ¨ç¼–è¯‘æˆåŠŸåï¼Œåœ¨æºç ç›®å½•ä¸‹ç”Ÿæˆäº†å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè·¯å¾„ä¸ºï¼š\n```\n./bazel_bin/node\n```\nå¯ä½¿ç”¨ä¸‹é¢å‘½ä»¤è¿è¡Œnode\n\n```shell\n./bazel-bin/node --node_id=node0 --service_port=50050 --config=./config/node0.yaml\n```\n\n```shell\n./bazel-bin/node --node_id=node1 --service_port=50051 --config=./config/node1.yaml\n```\n\n```shell\n./bazel-bin/node --node_id=node2 --service_port=50052 --config=./config/node2.yaml\n```\n","tags":["è”é‚¦å­¦ä¹ ","å¤šæ–¹å®‰å…¨è®¡ç®—","primihub"],"categories":["è”é‚¦å­¦ä¹ "]},{"title":"é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00008","url":"/2023/02/18/é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00008/","content":"# è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆLoDï¼‰\nè¿ªç±³ç‰¹æ³•åˆ™(Law of Demeteræˆ–ç®€å†™ä¸ºLoD)åˆå«åšæœ€å°‘çŸ¥è¯†åŸåˆ™ï¼ˆLeast Knowledge Principleæˆ–ç®€å†™ä¸ºLKP)ï¼Œå°±æ˜¯è¯´ï¼Œä¸€ä¸ªå¯¹è±¡åº”å½“å¯¹å…¶ä»–å¯¹è±¡æœ‰å°½å¯èƒ½å°‘çš„äº†è§£ã€‚\n\nè¿ªç±³ç‰¹æ³•åˆ™æœ€åˆæ˜¯ç”¨æ¥ä½œä¸ºé¢å‘å¯¹è±¡çš„ç³»ç»Ÿè®¾è®¡é£æ ¼çš„ä¸€ç§æ³•åˆ™ï¼Œäº1987å¹´ç§‹å¤©ç”±Ian Hollandåœ¨ç¾å›½ä¸œåŒ—å¤§å­¦ï¼ˆNortheastern Universityï¼‰ä¸ºä¸€ä¸ªå«åšè¿ªç±³ç‰¹ï¼ˆDemeterï¼‰çš„é¡¹ç›®è®¾è®¡æå‡ºçš„ï¼Œå› æ­¤å«åšè¿ªç±³ç‰¹æ³•åˆ™ã€‚è¿™æ¡æ³•åˆ™å®é™…ä¸Šæ˜¯å¾ˆå¤šè‘—åç³»ç»Ÿï¼Œæ¯”å¦‚ç«æ˜Ÿç™»å½•è½¯ä»¶ç³»ç»Ÿã€æœ¨æ˜Ÿçš„æ¬§ç½—å·´å«æ˜Ÿè½¨é“é£èˆ¹çš„è½¯ä»¶ç³»ç»Ÿçš„æŒ‡å¯¼è®¾è®¡åŸåˆ™ã€‚\n\n## è¿ªç±³ç‰¹æ³•åˆ™çš„å„ç§è¡¨è¿°\næ²¡æœ‰ä»»ä½•ä¸€ä¸ªå…¶å®ƒçš„OOè®¾è®¡åŸåˆ™åƒè¿ªç±³ç‰¹æ³•åˆ™è¿™æ ·æœ‰å¦‚æ­¤ä¹‹å¤šçš„è¡¨è¿°æ–¹å¼ï¼Œä¸‹é¢ç»™å‡ºçš„ä¹Ÿåªæ˜¯ä¼—å¤šçš„è¡¨è¿°ä¸­è¾ƒæœ‰ä»£è¡¨æ€§çš„å‡ ç§ï¼š\n- åªä¸ä½ ç›´æ¥çš„æœ‹å‹ä»¬é€šä¿¡ï¼ˆOnly talk to your immediate friends)ã€‚\n- ä¸è¦è·Ÿâ€œé™Œç”Ÿäººâ€è¯´è¯ï¼ˆDon't talk to strangers)ã€‚\n- æ¯ä¸€ä¸ªè½¯ä»¶å•ä½å¯¹å…¶å®ƒçš„å•ä½éƒ½åªæœ‰æœ€å°‘çš„çŸ¥è¯†ï¼Œè€Œä¸”å±€é™äºé‚£äº›ä¸æœ¬å•ä½å¯†åˆ‡ç›¸å…³çš„è½¯ä»¶å•ä½\n\nåœ¨ä¸Šé¢çš„è¡¨è¿°é‡Œé¢ï¼Œä»€ä¹ˆæ˜¯â€œç›´æ¥â€ã€â€œé™Œç”Ÿâ€å’Œâ€œå¯†åˆ‡â€åˆ™è¢«æœ‰æ„åœ°æ¨¡ç³ŠåŒ–äº†ï¼Œä»¥ä¾¿åœ¨ä¸åŒçš„ç¯å¢ƒä¸‹å¯ä»¥æœ‰ä¸åŒçš„è§£é‡Šã€‚\n\n## ç‹­ä¹‰çš„è¿ªç±³ç‰¹æ³•åˆ™\nå¦‚æœä¸¤ä¸ªç±»ä¸å¿…å½¼æ­¤ç›´æ¥é€šä¿¡ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªç±»å°±ä¸åº”å½“å‘ç”Ÿç›´æ¥çš„ç›¸äº’ä½œç”¨ã€‚å¦‚æœå…¶ä¸­çš„ä¸€ä¸ªç±»éœ€è¦è°ƒç”¨å¦ä¸€ä¸ªç±»çš„æŸä¸€ä¸ªæ–¹æ³•çš„è¯ï¼Œå¯ä»¥é€šè¿‡ç¬¬ä¸‰è€…è½¬å‘è¿™ä¸ªè°ƒç”¨ã€‚\n\n### æœ‹å‹åœˆä¸é™Œç”Ÿäºº\nå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œâ€œæŸäººâ€ä¸ä¸€ä¸ªâ€œæœ‹å‹â€ç»„æˆè‡ªå·±çš„æœ‹å‹åœˆï¼Œä¸¤ä¸ªäººéƒ½éœ€è¦ä¸ä¸€ä¸ªåœˆå¤–çš„â€œé™Œç”Ÿäººâ€å‘ç”Ÿç›¸äº’ä½œç”¨ã€‚\n![æŸäººçš„æœ‹å‹åœˆ](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00008/1.jpg)\nâ€œæœ‹å‹â€ä¸â€œé™Œç”Ÿäººâ€è‹¥æ˜¯æœ‹å‹ï¼Œç»„æˆâ€œæœ‹å‹â€çš„æœ‹å‹åœˆå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n![æœ‹å‹çš„æœ‹å‹åœˆ](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00008/2.jpg)\nç›¸æ¯”è¾ƒä¹‹ä¸‹ï¼Œâ€œæŸäººâ€å…¶å®å¹¶ä¸éœ€è¦ä¸â€œé™Œç”Ÿäººâ€ç›´æ¥å‘ç”Ÿç›¸äº’ä½œç”¨ï¼Œä½†æ˜¯â€œæœ‹å‹â€åˆ™æ›´éœ€è¦ä¸â€œé™Œç”Ÿäººâ€å‘ç”Ÿç›¸äº’ä½œç”¨ã€‚è¿™æ—¶å€™ï¼Œè¿ªç±³ç‰¹æ³•åˆ™å»ºè®®â€œæŸäººâ€ä¸è¦ç›´æ¥ä¸â€œé™Œç”Ÿäººâ€å‘ç”Ÿç›¸äº’ä½œç”¨ï¼Œè€Œæ˜¯é€šè¿‡â€œæœ‹å‹â€ä¸ä¹‹å‘ç”Ÿç›´æ¥çš„ç›¸äº’ä½œç”¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n![æŸäººå’Œé™Œç”Ÿäººé—´æ¥é€šè®¯](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00008/3.jpg)\nè¿™æ—¶å€™ï¼Œâ€œæœ‹å‹â€å®é™…ä¸Šèµ·åˆ°äº†å°†â€œæŸäººâ€å¯¹â€œé™Œç”Ÿäººâ€çš„è°ƒç”¨è½¬å‘ç»™â€œé™Œç”Ÿäººâ€çš„ä½œç”¨ã€‚è¿™ç§ä¼ é€’å«åšè°ƒç”¨è½¬å‘ï¼ˆCall Forwardingï¼‰ã€‚æ‰€è°“è°ƒç”¨è½¬å‘ï¼Œéœ€è¦éšè—â€œé™Œç”Ÿäººâ€çš„å­˜åœ¨ï¼Œä½¿å¾—â€œæŸäººâ€ä»…çŸ¥é“â€œæœ‹å‹â€ï¼Œè€Œä¸çŸ¥é“â€œé™Œç”Ÿäººâ€ï¼›æ¢è¨€ä¹‹ï¼Œâ€œæŸäººâ€ä¼šè®¤ä¸ºä»–æ‰€è°ƒç”¨çš„è¿™ä¸ªæ–¹æ³•æ˜¯â€œæœ‹å‹â€çš„æ–¹æ³•ã€‚\n\n### æœ‹å‹åœˆçš„ç¡®å®š\nä»¥ä¸‹æ¡ä»¶ç§°ä¸ºâ€œæœ‹å‹â€æ¡ä»¶ï¼š\n- å½“å‰å¯¹è±¡æœ¬èº«ï¼ˆthisï¼‰\n- ä»¥å‚é‡å½¢å¼ä¼ å…¥åˆ°å½“å‰å¯¹è±¡æ–¹æ³•ä¸­çš„å¯¹è±¡\n- å½“å‰å¯¹è±¡çš„å®ä¾‹å˜é‡ç›´æ¥å¼•ç”¨çš„å¯¹è±¡\n- å½“å‰å¯¹è±¡çš„å®ä¾‹å˜é‡å¦‚æœæ˜¯ä¸€ä¸ªèšé›†ï¼Œé‚£ä¹ˆèšé›†ä¸­çš„å…ƒç´ ä¹Ÿéƒ½æ˜¯æœ‹å‹\n- å½“å‰å¯¹è±¡æ‰€åˆ›å»ºçš„å¯¹è±¡\n\nä»»ä½•ä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœæ»¡è¶³ä¸Šé¢çš„æ¡ä»¶ä¹‹ä¸€ï¼Œå°±æ˜¯å½“å‰å¯¹è±¡çš„â€œæœ‹å‹â€ï¼›å¦åˆ™å°±æ˜¯â€œé™Œç”Ÿäººâ€\n\n### ä¸æ»¡è¶³è¿ªç±³ç‰¹æ³•åˆ™çš„ç³»ç»Ÿ\nè¿™é‡Œè¦è®¨è®ºçš„ç³»ç»Ÿç”±ä¸‰ä¸ªç±»ç»„æˆï¼Œåˆ†åˆ«æ˜¯Someoneï¼ŒFriendå’ŒStrangerã€‚å…¶ä¸­Someoneä¸Friendæ˜¯æœ‹å‹ï¼Œè€ŒFriendä¸Strangeræ˜¯æœ‹å‹ã€‚ç³»ç»Ÿçš„ç»“æ„å›¾å¦‚ä¸‹ï¼š\n\n{% mermaid %}\n\nclassDiagram\n\nclass Someone {\n    +operation1():void\n}\n\nclass Friend {\n    -stranger:Stranger\n    +operation2():void\n    +provide():Stranger\n}\n\nclass Stranger {\n    +operation3():void\n}\n\nSomeone ..> Friend\n\nFriend o--> Stranger\n\nSomeone ..> Stranger\n{% endmermaid %}\n\n\nä»ä¸Šé¢çš„ç±»å›¾å¯ä»¥çœ‹å‡ºï¼ŒFriendæŒæœ‰ä¸€ä¸ªStrangerå¯¹è±¡çš„å¼•ç”¨ï¼Œè¿™å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆFriendä¸Strangeræ˜¯æœ‹å‹ã€‚ä¸ºäº†è§£é‡Šä¸ºä»€ä¹ˆSomeoneä¸Friendæ˜¯æœ‹å‹ï¼Œè¯·å‚è§è¿™é‡Œç»™å‡ºçš„Someoneçš„æºç ï¼š\n```java\npublic class Someone {\n    public void operation1(Friend friend) {\n        Stranger stranger = friend.provide();\n        stranger.operation3();\n    }\n}\n```\nå¯ä»¥çœ‹å‡ºï¼ŒSomeoneå…·æœ‰ä¸€ä¸ªæ–¹æ³•operation1()ï¼Œè¿™ä¸ªæ–¹æ³•æ¥å—Friendä¸ºå‚é‡ã€‚æ˜¾ç„¶ï¼Œæ ¹æ®â€œæœ‹å‹â€çš„å®šä¹‰ï¼ŒFriendæ˜¯Someoneçš„æœ‹å‹ã€‚å…¶ä¸­Friendçš„provide()æ–¹æ³•ä¼šæä¾›è‡ªå·±åˆ›å»ºçš„Strangerçš„å®ä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š\n```java\npublic class Friend {\n    private Stranger stranger = new Stranger();\n    public void operation2() {\n\n    }\n    public Stranger provide() {\n        return stranger;\n    }\n}\n```\næ˜¾ç„¶ï¼ŒSomeoneçš„æ–¹æ³•operation1()ä¸æ»¡è¶³è¿ªç±³ç‰¹æ³•åˆ™ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºè¿™ä¸ªæ–¹æ³•å¼•ç”¨äº†Strangerå¯¹è±¡ï¼Œè€ŒStrangerå¯¹è±¡ä¸æ˜¯Someoneçš„æœ‹å‹ã€‚\n\n### ä½¿ç”¨è¿ªç±³ç‰¹æ³•åˆ™è¿›è¡Œæ”¹é€ \nå¯ä»¥ä½¿ç”¨è¿ªç±³ç‰¹æ³•åˆ™å¯¹ä¸Šé¢çš„ä¾‹å­è¿›è¡Œæ”¹é€ ï¼Œæ”¹é€ çš„åšæ³•å°±æ˜¯è°ƒç”¨è½¬å‘ã€‚æ”¹é€ åçš„æƒ…å†µå¦‚ä¸‹ï¼š\n\n{% mermaid %}\nclassDiagram\n\nclass Someone {\n    +operation1():void\n}\n\nclass Friend {\n    -stranger:Stranger\n    +operation2():void\n    +forward():void\n}\n\nclass Stranger {\n    +operation3():void\n}\n\nSomeone ..> Friend\n\nFriend o--> Stranger\n{% endmermaid %}\n\nä»ä¸Šé¢çš„ç±»å›¾å¯ä»¥çœ‹å‡ºï¼Œä¸æ”¹é€ å‰ç›¸æ¯”ï¼Œåœ¨Someoneä¸Strangerä¹‹é—´çš„è”ç³»å·²ç»æ²¡æœ‰äº†ã€‚Someoneä¸éœ€è¦çŸ¥é“Strangerçš„å­˜åœ¨å°±å¯ä»¥åšåŒæ ·çš„äº‹æƒ…ã€‚Someoneçš„æºä»£ç å¦‚ä¸‹ï¼š\n```java\npublic class Someone {\n    public void operation1(Friend friend) {\n        friend.forward();\n    }\n}\n```\nä»æºä»£ç å¯ä»¥çœ‹å‡ºï¼ŒSomeoneé€šè¿‡è°ƒç”¨è‡ªå·±çš„æœ‹å‹Friendå¯¹è±¡çš„forward()æ–¹æ³•åšåˆ°äº†åŸæ¥éœ€è¦è°ƒç”¨Strangerå¯¹è±¡æ‰èƒ½å¤Ÿåšåˆ°çš„äº‹æƒ…ã€‚é‚£ä¹ˆè¿™ä¸ªforward()æ–¹æ³•æ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿä»£ç å¦‚ä¸‹ï¼š\n```java\npublic class Friend {\n    private Stranger stranger = new Stranger();\n    public void operation2() {\n        System.out.println(\"In Friend.operation2()\");\n    }\n    public void forward() {\n        stranger.operation3();\n    }\n}\n```\nåŸæ¥Friendç±»çš„forward()æ–¹æ³•æ‰€åšçš„å°±æ˜¯ä»¥å‰Someoneè¦åšçš„äº‹æƒ…ï¼Œä½¿ç”¨äº†Strangerçš„operation3()æ–¹æ³•ï¼Œè€Œè¿™ç§forward()æ–¹æ³•å«åšè½¬å‘æ–¹æ³•ã€‚ç”±äºä½¿ç”¨äº†è°ƒç”¨è½¬å‘ï¼Œä½¿å¾—è°ƒç”¨çš„å…·ä½“ç»†èŠ‚è¢«éšè—åœ¨Friendå†…éƒ¨ï¼Œä»è€Œä½¿Someoneä¸Strangerä¹‹é—´çš„ç›´æ¥è”ç³»è¢«çœç•¥æ‰äº†ã€‚è¿™æ ·ä¸€æ¥ï¼Œä½¿å¾—ç³»ç»Ÿå†…éƒ¨çš„è€¦åˆåº¦é™ä½ã€‚åœ¨ç³»ç»Ÿçš„æŸä¸€ä¸ªç±»éœ€è¦ä¿®æ”¹æ—¶ï¼Œä»…ä»…ä¼šç›´æ¥å½±å“åˆ°è¿™ä¸ªç±»çš„â€œæœ‹å‹â€ä»¬ï¼Œè€Œä¸ä¼šç›´æ¥å½±å“åˆ°å…¶ä½™éƒ¨åˆ†ã€‚\n\n### ç‹­ä¹‰çš„è¿ªç±³ç‰¹æ³•åˆ™çš„ç¼ºç‚¹\néµå¾ªç‹­ä¹‰çš„è¿ªç±³ç‰¹æ³•åˆ™ä¼šäº§ç”Ÿä¸€ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ï¼šä¼šåœ¨ç³»ç»Ÿé‡Œé€ å‡ºå¤§é‡çš„å°æ–¹æ³•ï¼Œæ•£è½åœ¨ç³»ç»Ÿçš„å„ä¸ªè§’è½ã€‚è¿™äº›æ–¹æ³•ä»…ä»…æ˜¯ä¼ é€’é—´æ¥çš„è°ƒç”¨ï¼Œå› æ­¤ä¸ç³»ç»Ÿçš„å•†åŠ¡é€»è¾‘æ— å…³ã€‚å½“è®¾è®¡å¸ˆè¯•å›¾ä»ä¸€å¼ ç±»å›¾çœ‹å‡ºæ€»ä½“çš„æ¶æ„æ—¶ï¼Œè¿™äº›å°çš„æ–¹æ³•ä¼šé€ æˆè¿·æƒ‘å’Œå›°æ‰°ã€‚\n\néµå¾ªç±»ä¹‹é—´çš„è¿ªç±³ç‰¹æ³•åˆ™ä¼šä½¿ä¸€ä¸ªç³»ç»Ÿçš„å±€éƒ¨è®¾è®¡ç®€åŒ–ï¼Œå› ä¸ºæ¯ä¸€ä¸ªå±€éƒ¨éƒ½ä¸ä¼šå’Œè¿œè·ç¦»çš„å¯¹è±¡æœ‰ç›´æ¥çš„å…³è”ã€‚ä½†æ˜¯ï¼Œè¿™ä¹Ÿä¼šé€ æˆç³»ç»Ÿçš„ä¸åŒæ¨¡å—ä¹‹é—´çš„é€šä¿¡æ•ˆç‡é™ä½ï¼Œä¹Ÿä¼šä½¿ç³»ç»Ÿçš„ä¸åŒæ¨¡å—ä¹‹é—´ä¸å®¹æ˜“åè°ƒã€‚\n\n### ä¸ä¾èµ–å€’è½¬åŸåˆ™äº’è¡¥ä½¿ç”¨\nä¸ºäº†å…‹æœç‹­ä¹‰çš„è¿ªç±³ç‰¹æ³•åˆ™çš„ç¼ºç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ä¾èµ–å€’è½¬åŸåˆ™ï¼Œå¼•å…¥ä¸€ä¸ªæŠ½è±¡çš„ç±»å‹å¼•ç”¨â€œæŠ½è±¡é™Œç”Ÿäººâ€å¯¹è±¡ï¼Œä½¿â€œæŸäººâ€ä¾èµ–äºâ€œæŠ½è±¡é™Œç”Ÿäººâ€ã€‚æ¢è¨€ä¹‹ï¼Œå°±æ˜¯å°†â€œæŠ½è±¡é™Œç”Ÿäººâ€å˜æˆæœ‹å‹ï¼Œå¦‚ä¸‹å›¾ï¼š\n![è¿ªç±³ç‰¹æ³•åˆ™å’Œä¾èµ–å€’è½¬åŸåˆ™äº’è¡¥](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00008/4.jpg)\n\n\"æŸäººâ€œç°åœ¨ä¸ä¸€ä¸ªæŠ½è±¡è§’è‰²å»ºç«‹äº†æœ‹å‹å…³ç³»ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯â€æœ‹å‹â€œå¯ä»¥éšæ—¶å°†å…·ä½“â€é™Œç”Ÿäººâ€œæ¢æ‰ã€‚åªè¦æ–°çš„å…·ä½“â€é™Œç”Ÿäººâ€œå…·æœ‰ç›¸åŒçš„æŠ½è±¡ç±»å‹ï¼Œé‚£ä¹ˆâ€æŸäººâ€œå°±æ— æ³•åŒºåˆ†å®ƒä»¬ã€‚è¿™å°±å…è®¸â€é™Œç”Ÿäººâ€œçš„å…·ä½“å®ç°å¯ä»¥ç‹¬ç«‹äºâ€æŸäººâ€œè€Œå˜åŒ–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n![è¿ªç±³ç‰¹æ³•åˆ™å’Œä¾èµ–å€’è½¬åŸåˆ™äº’è¡¥](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00008/5.jpg)","tags":["LoD","è¿ªç±³ç‰¹æ³•åˆ™"],"categories":["è®¾è®¡æ¨¡å¼","è®¾è®¡åŸåˆ™çš„ä½“ç°"]},{"title":"é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00007","url":"/2023/02/12/é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00007/","content":"# åˆæˆ/èšåˆå¤ç”¨åŸåˆ™(CARP)\nåˆæˆ/èšåˆå¤ç”¨åŸåˆ™(Composite/Aggregate Reuse Principle, æˆ–CARP)ï¼Œç»å¸¸åˆå«ä½œåˆæˆå¤ç”¨åŸåˆ™(Composite Reuse Principleæˆ–CRP)ã€‚åˆæˆ/èšåˆå¤ç”¨åŸåˆ™å°±æ˜¯åœ¨ä¸€ä¸ªæ–°çš„å¯¹è±¡é‡Œé¢ä½¿ç”¨ä¸€äº›å·²æœ‰çš„å¯¹è±¡ï¼Œä½¿ä¹‹æˆä¸ºæ–°å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼šæ–°çš„å¯¹è±¡é€šè¿‡å‘è¿™äº›å¯¹è±¡çš„å§”æ´¾è¾¾åˆ°å¤ç”¨å·²æœ‰åŠŸèƒ½çš„ç›®çš„ã€‚\n\nè¿™ä¸ªè®¾è®¡åŸåˆ™æœ‰å¦ä¸€ä¸ªæ›´ç®€çŸ­çš„è¡¨è¿°ï¼šè¦å°½é‡ä½¿ç”¨åˆæˆ/èšåˆï¼Œå°½é‡ä¸è¦ä½¿ç”¨ç»§æ‰¿ã€‚\n\nåˆæˆ(Composite)ä¸€è¯çš„ä½¿ç”¨å¾ˆå¹¿æ³›ï¼Œç»å¸¸å¯¼è‡´æ··æ·†ã€‚ä¸ºé¿å…è¿™äº›æ··æ·†ï¼Œä¸å¦¨å…ˆæ¥è€ƒå¯Ÿä¸€ä¸‹â€œåˆæˆâ€ä¸â€œèšåˆâ€çš„åŒºåˆ«ã€‚\n\n## åˆæˆå’Œèšåˆçš„åŒºåˆ«\nåˆæˆ(Composition)å’Œèšåˆ(Aggregation)å‡æ˜¯å…³è”(Association)çš„ç‰¹æ®Šç§ç±»ã€‚èšåˆç”¨æ¥è¡¨ç¤ºâ€œæ‹¥æœ‰â€å…³ç³»æˆ–è€…æ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³»ï¼›è€Œåˆæˆåˆ™ç”¨æ¥è¡¨ç¤ºä¸€ç§å¼ºå¾—å¤šçš„â€œæ‹¥æœ‰â€å…³ç³»ã€‚åœ¨ä¸€ä¸ªåˆæˆå…³ç³»é‡Œï¼Œéƒ¨åˆ†å’Œæ•´ä½“çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€æ ·çš„ã€‚ä¸€ä¸ªåˆæˆçš„æ–°çš„å¯¹è±¡å®Œå…¨æ‹¥æœ‰å¯¹å…¶ç»„æˆçš„æ”¯é…æƒï¼ŒåŒ…æ‹¬å®ƒä»¬çš„åˆ›å»ºå’Œæ¹®ç­ç­‰ã€‚ä½¿ç”¨ç¨‹åºè¯­è¨€çš„æœ¯è¯­æ¥è®²ï¼Œç»„åˆè€Œæˆçš„æ–°å¯¹è±¡å¯¹ç»„æˆéƒ¨åˆ†çš„å†…å­˜åˆ†é…ã€å†…å­˜é‡Šæ”¾æœ‰ç»å¯¹çš„è´£ä»»ã€‚\n\næ›´è¿›ä¸€æ­¥æ¥è®²ï¼Œä¸€ä¸ªåˆæˆçš„å¤šé‡æ€§(Multiplicity)ä¸èƒ½è¶…è¿‡1ï¼Œæ¢è¨€ä¹‹ï¼Œä¸€ä¸ªåˆæˆå…³ç³»ä¸­çš„æˆåˆ†å¯¹è±¡æ˜¯ä¸èƒ½ä¸å¦ä¸€ä¸ªåˆæˆå…³ç³»å…±äº«çš„ã€‚ä¸€ä¸ªæˆåˆ†å¯¹è±¡åœ¨åŒä¸€æ—¶é—´å†…åªèƒ½å±äºä¸€ä¸ªåˆæˆå…³ç³»ã€‚å¦‚æœä¸€ä¸ªåˆæˆå…³ç³»æ¹®ç­äº†ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æˆåˆ†å¯¹è±¡è¦ä¹ˆè‡ªå·±æ¹®ç­æ‰€æœ‰çš„æˆåˆ†å¯¹è±¡(è¿™ç§æƒ…å†µè¾ƒä¸ºæ™®é€š)ï¼Œè¦ä¹ˆå°±å¾—å°†è¿™ä¸€è´£ä»»äº¤ç»™åˆ«äººï¼ˆè¿™ç§æƒ…å†µè¾ƒä¸ºç½•è§ï¼‰ã€‚\n\nç”¨Cç¨‹åºå‘˜è¾ƒæ˜“ç†è§£çš„è¯­è¨€æ¥è®²ï¼Œåˆæˆæ˜¯å€¼çš„èšåˆ(Aggregation by Value), è€Œé€šå¸¸æ‰€è¯´çš„èšåˆåˆ™æ˜¯å¼•ç”¨çš„èšåˆ(Aggreation by Reference)ã€‚\n\n## å¤ç”¨çš„åŸºæœ¬ç§ç±»\nåœ¨é¢å‘å¯¹è±¡çš„è®¾è®¡é‡Œï¼Œæœ‰ä¸¤ç§åŸºæœ¬çš„åŠæ³•å¯ä»¥åœ¨ä¸åŒçš„ç¯å¢ƒä¸­å¤ç”¨å·²æœ‰çš„è®¾è®¡å’Œå®ç°ï¼Œå³é€šè¿‡åˆæˆ/èšåˆæˆ–é€šè¿‡ç»§æ‰¿ã€‚é‚£ä¹ˆè¿™ä¸¤ç§ä¸åŒçš„å¤ç”¨æ–¹å¼åœ¨å¯ç»´æŠ¤æ€§ä¸Šé¢æœ‰ä½•åŒºåˆ«å‘¢ï¼Ÿ\n\n### åˆæˆ/èšåˆå¤ç”¨\nç”±äºåˆæˆæˆ–èšåˆå¯ä»¥å°†å·²æœ‰çš„å¯¹è±¡çº³å…¥åˆ°æ–°å¯¹è±¡ä¸­ï¼Œä½¿ä¹‹æˆä¸ºæ–°å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤æ–°çš„å¯¹è±¡å¯ä»¥è°ƒç”¨å·²æœ‰å¯¹è±¡çš„åŠŸèƒ½ã€‚è¿™æ ·åšæœ‰ä¸‹é¢çš„å¥½å¤„ï¼š\n- æ–°å¯¹è±¡å­˜å–æˆåˆ†å¯¹è±¡çš„æƒŸä¸€æ–¹æ³•æ˜¯é€šè¿‡æˆåˆ†å¯¹è±¡çš„æ¥å£ã€‚\n- è¿™ç§å¤ç”¨æ˜¯é»‘ç®±å¤ç”¨ï¼Œå› ä¸ºæˆåˆ†å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚æ˜¯æ–°å¯¹è±¡æ‰€çœ‹ä¸è§çš„ã€‚\n- è¿™ç§å¤ç”¨æ”¯æŒåŒ…è£…ã€‚\n- è¿™ç§å¤ç”¨æ‰€éœ€è¦çš„ä¾èµ–è¾ƒå°‘ã€‚\n- æ¯ä¸€ä¸ªæ–°çš„ç±»å¯ä»¥å°†ç„¦ç‚¹é›†ä¸­åœ¨ä¸€ä¸ªä»»åŠ¡ä¸Šã€‚\n- è¿™ç§å¤ç”¨å¯ä»¥åœ¨è¿è¡Œæ—¶é—´å†…åŠ¨æ€è¿›è¡Œï¼Œæ–°å¯¹è±¡å¯ä»¥åŠ¨æ€åœ°å¼•ç”¨ä¸æˆåˆ†å¯¹è±¡ç±»å‹ç›¸åŒçš„å¯¹è±¡ã€‚\nä¸€èˆ¬è€Œè¨€ï¼Œå¦‚æœä¸€ä¸ªè§’è‰²å¾—åˆ°äº†æ›´å¤šçš„è´£ä»»ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç”¨åˆæˆ/èšåˆå…³ç³»å°†æ–°çš„è´£ä»»å§”æ´¾åˆ°åˆé€‚çš„å¯¹è±¡ã€‚\n\nå½“ç„¶ï¼Œè¿™ç§å¤ç”¨ä¹Ÿæœ‰ç¼ºç‚¹ã€‚å…¶ä¸­æœ€ä¸»è¦çš„ç¼ºç‚¹å°±æ˜¯é€šè¿‡ä½¿ç”¨è¿™ç§å¤ç”¨å»ºé€ çš„ç³»ç»Ÿä¼šæœ‰è¾ƒå¤šçš„å¯¹è±¡éœ€è¦ç®¡ç†ã€‚\n\n### é€šè¿‡ç»§æ‰¿è¾¾åˆ°å¤ç”¨çš„ç›®çš„\nåˆæˆ/èšåˆä½œä¸ºå¤ç”¨çš„æ‰‹æ®µå¯ä»¥åº”ç”¨åˆ°å‡ ä¹ä»»ä½•ç¯å¢ƒä¸­å»ã€‚è€Œä¸åˆæˆ/èšåˆä¸åŒçš„æ˜¯ï¼Œç»§æ‰¿åªèƒ½åº”ç”¨åˆ°å¾ˆæœ‰é™çš„ä¸€äº›ç¯å¢ƒä¸­å»ã€‚æ¢è¨€ä¹‹ï¼Œå°½ç®¡ç»§æ‰¿æ˜¯ä¸€ç§éå¸¸é‡è¦çš„å¤ç”¨æ‰‹æ®µï¼Œä½†æ˜¯è®¾è®¡å¸ˆåº”å½“é¦–å…ˆè€ƒè™‘ä½¿ç”¨åˆæˆ/èšåˆï¼Œè€Œä¸æ˜¯ç»§æ‰¿ã€‚\n\n#### ç»§æ‰¿çš„ç§ç±»\nç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡çš„è¯­è¨€ç‰¹æœ‰çš„å¤ç”¨å·¥å…·ï¼Œè€Œä¸”æ˜¯æœ€å®¹æ˜“è¢«æ»¥ç”¨çš„å¤ç”¨å·¥å…·ã€‚è¿™é‡Œè®¨è®ºçš„ç»§æ‰¿ï¼Œæ˜¯æŒ‡ä»ä¸€ä¸ªJavaç±»åˆ°å¦ä¸€ä¸ªJavaç±»çš„å®ç°æ€§ç»§æ‰¿ï¼Œä¹Ÿå°±æ˜¯å®ç°ç»§æ‰¿ï¼Œå¹¶ä¸åŒ…æ‹¬æ¥å£ç»§æ‰¿ã€‚ä¸€ä¸ªå®ç°ç»§æ‰¿çš„ä¾‹å­å¦‚ä¸‹å›¾ï¼š\n\n{% mermaid %}\n\nclassDiagram\n\nè›‹ <|-- é¸¡\n\n{% endmermaid %}\n\nç»§æ‰¿å¤ç”¨é€šè¿‡æ‰©å±•ä¸€ä¸ªå·²æœ‰å¯¹è±¡çš„å®ç°æ¥å¾—åˆ°æ–°çš„åŠŸèƒ½ï¼ŒåŸºç±»æ˜æ˜¾åœ°æ•è·å…±åŒçš„å±æ€§å’Œæ–¹æ³•ï¼Œè€Œå­ç±»é€šè¿‡å¢åŠ æ–°çš„å±æ€§å’Œæ–¹æ³•æ¥æ‰©å±•è¶…ç±»çš„å®ç°ã€‚ç»§æ‰¿æ˜¯ç±»å‹çš„å¤ç”¨ï¼Œæ¯”å¦‚ä¸‹é¢éƒ½æ˜¯ç»§æ‰¿çš„ä¾‹å­ï¼š\n- ç”·äººå’Œå¥³äººæ˜¯äººç±»\n- ä¸Šæ¨æ’åº(Bubble Sort)æ˜¯æ’åºç¨‹åºçš„ä¸€ç§\n- æ±½è½¦é©¾ç…§æ˜¯å®˜æ–¹æ–‡ä»¶çš„ä¸€ç§\n- æ­£å¼é›‡å‘˜å’Œä¸´æ—¶é›‡å‘˜å‡æ˜¯é›‡å‘˜çš„ä¸€ç§\n- ç»ç†æ˜¯æ­£å¼é›‡å‘˜çš„ä¸€ç§\n\nåœ¨é¢å‘å¯¹è±¡çš„è®¾è®¡ç†è®ºæ—©æœŸï¼Œè®¾è®¡å¸ˆååˆ†çƒ­è¡·äºç»§æ‰¿ï¼Œå¥½åƒç»§æ‰¿å°±æ˜¯æœ€å¥½çš„å¤ç”¨æ‰‹æ®µã€‚éšç€æ—¶é—´çš„æ¨ç§»å’Œå®è·µç»éªŒçš„ç§¯ç´¯ï¼Œäººä»¬é€æ¸è®¤è¯†åˆ°äº†ç»§æ‰¿å…³ç³»çš„ç¼ºç‚¹ã€‚\n\n#### ç»§æ‰¿å¤ç”¨çš„ä¼˜ç‚¹\nåˆ©ç”¨ç»§æ‰¿å…³ç³»è¾¾åˆ°å¤ç”¨çš„åšæ³•æœ‰ä¸‹é¢çš„ä¼˜ç‚¹ï¼š\n- æ–°çš„å®ç°è¾ƒä¸ºå®¹æ˜“ï¼Œå› ä¸ºè¶…ç±»çš„å¤§éƒ¨åˆ†åŠŸèƒ½å¯ä»¥é€šè¿‡ç»§æ‰¿å…³ç³»è‡ªåŠ¨è¿›å…¥å­ç±»ã€‚\n- ä¿®æ”¹æˆ–æ‰©å±•ç»§æ‰¿è€Œæ¥çš„å®ç°è¾ƒä¸ºå®¹æ˜“\n#### ç»§æ‰¿å¤ç”¨çš„ç¼ºç‚¹\nä¸åˆæˆ/èšåˆå¤ç”¨ä¸åŒçš„æ˜¯ï¼Œç»§æ‰¿æœ‰å¤šä¸ªç¼ºç‚¹ï¼š\n- ç»§æ‰¿å¤ç”¨ç ´ååŒ…è£…ï¼Œå› ä¸ºç»§æ‰¿å°†è¶…ç±»çš„å®ç°ç»†èŠ‚æš´éœ²ç»™å­ç±»ã€‚ç”±äºè¶…ç±»çš„å†…éƒ¨ç»†èŠ‚å¸¸å¸¸æ˜¯å¯¹å­ç±»é€æ˜çš„ï¼Œå› æ­¤è¿™ç§å¤ç”¨æ˜¯é€æ˜çš„å¤ç”¨ï¼Œåˆç§°â€œç™½ç®±â€å¤ç”¨ã€‚\n- å¦‚æœè¶…ç±»çš„å®ç°å‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¹ˆå­ç±»çš„å®ç°ä¹Ÿä¸å¾—ä¸å‘ç”Ÿæ”¹å˜ã€‚å› æ­¤ï¼Œå½“ä¸€ä¸ªåŸºç±»å‘ç”Ÿæ”¹å˜æ—¶ï¼Œè¿™ç§æ”¹å˜ä¼šåƒæ°´ä¸­æŠ•å…¥çŸ³å­å¼•èµ·çš„æ°´æ³¢ä¸€æ ·ï¼Œå°†å˜åŒ–ä¸€åœˆåˆä¸åœˆåœ°ä¼ å¯¼åˆ°ä¸€çº§åˆä¸€çº§çš„å­ç±»ï¼Œä½¿è®¾è®¡å¸ˆä¸å¾—ä¸ç›¸åº”åœ°æ”¹å˜è¿™äº›å­ç±»ï¼Œä»¥é€‚åº”è¶…ç±»çš„å˜åŒ–ã€‚\n- ä»è¶…ç±»ç»§æ‰¿è€Œæ¥çš„å®ç°æ˜¯é™æ€çš„ï¼Œä¸å¯èƒ½åœ¨è¿è¡Œæ—¶é—´å†…å‘ç”Ÿæ”¹å˜ï¼Œå› æ­¤æ²¡æœ‰è¶³å¤Ÿçš„çµæ´»æ€§ã€‚\n  \nç”±äºä»¥ä¸Šçš„è¿™äº›ç¼ºç‚¹ï¼Œå°½é‡ä½¿ç”¨åˆæˆ/èšåˆè€Œä¸æ˜¯ç»§æ‰¿æ¥è¾¾åˆ°å¯¹å®ç°çš„å¤ç”¨ï¼Œæ˜¯éå¸¸é‡è¦çš„è®¾è®¡åŸåˆ™ã€‚\n\n## ä»ä»£ç é‡æ„çš„è§’åº¦ç†è§£\nåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œç¼ºä¹ç»éªŒçš„Javaè®¾è®¡å¸ˆä¹‹æ‰€ä»¥é€‰æ‹©ç»§æ‰¿å…³ç³»æè¿°ä¸¤ä¸ªç±»ä¹‹é—´çš„å…³ç³»ï¼Œæ˜¯å› ä¸ºå¯¹ç»§æ‰¿å…³ç³»çš„ç†è§£ä¸å¤Ÿé€ æˆçš„ã€‚è€Œè¦æ­£ç¡®åœ°ä½¿ç”¨ç»§æ‰¿å…³ç³»ï¼Œå¿…é¡»é€å½»åœ°ç†è§£é‡Œæ°ä»£æ¢åŸåˆ™å’ŒCoadæ³•åˆ™ã€‚\n\nä¸€èˆ¬æ¥è¯´ï¼Œå¯¹è¿åé‡Œæ°ä»£æ¢åŸåˆ™çš„è®¾è®¡è¿›è¡Œé‡æ„æ—¶ï¼Œå¯ä»¥é‡‡å–ä¸¤ä¸ªåŠæ³•ï¼šä¸€æ˜¯åŠ å…¥ä¸€ä¸ªæŠ½è±¡è¶…ç±»ï¼Œè¿™ä¸€åŠæ³•å·²ç»åœ¨æœ¬ä¹¦çš„â€œé‡Œæ°ä»£æ¢åŸåˆ™â€ä¸€ç« ä¸­è®¨è®ºè¿‡äº†ï¼›äºŒæ˜¯å°†ç»§æ‰¿å…³ç³»æ”¹å†™åˆæˆ/èšåˆå…³ç³»ï¼Œè¿™ä¸€ç‚¹æ˜¯æœ¬ç« è®¨è®ºçš„é‡ç‚¹ã€‚\n\n### åŒºåˆ†â€œHas-Aâ€ä¸â€œIs-Aâ€\nâ€œIs-Aâ€æ˜¯ä¸¥æ ¼çš„åˆ†ç±»å­¦æ„ä¹‰ä¸Šçš„å®šä¹‰ï¼Œæ„æ€æ˜¯ä¸€ä¸ªç±»æ˜¯å¦ä¸€ä¸ªç±»çš„â€œä¸€ç§â€ã€‚è€Œâ€Has-Aâ€œåˆ™ä¸åŒï¼Œå®ƒè¡¨ç¤ºæŸä¸€ä¸ªè§’è‰²å…·æœ‰æŸä¸€é¡¹è´£ä»»ã€‚\n\nå¯¼è‡´é”™è¯¯åœ°ä½¿ç”¨ç»§æ‰¿è€Œä¸æ˜¯åˆæˆ/èšåˆçš„ä¸€ä¸ªå¸¸è§çš„åŸå› æ˜¯é”™è¯¯åœ°æŠŠâ€Has-Aâ€œå½“ä½œâ€Is-Aâ€œã€‚â€Is-Aâ€œä»£è¡¨ä¸€ä¸ªç±»æ˜¯å¦ä¸€ä¸ªç±»çš„ä¸€ç§ï¼›â€Has-Aâ€œä»£è¡¨ä¸€ä¸ªç±»æ˜¯å¦ä¸€ä¸ªç±»çš„ä¸€ä¸ªè§’è‰²ï¼Œè€Œä¸æ˜¯å¦ä¸€ä¸ªçš„ä¸€ä¸ªç‰¹æ®Šç§ç±»ã€‚è¿™å°±æ˜¯Coadæ¡ä»¶çš„ç¬¬ä¸€æ¡ã€‚\n\nè¯·è€ƒè™‘ä¸€ä¸‹ä¸‹å›¾æ‰€ç¤ºçš„ç±»å›¾ä¸­æ‰€æè¿°çš„ä¾‹å­ã€‚â€äººâ€œè¢«ç»§æ‰¿åˆ°â€é›‡å‘˜â€œã€â€ç»ç†â€œã€â€œå­¦ç”Ÿâ€ç­‰å­ç±»ã€‚è€Œå®é™…ä¸Šï¼Œâ€œé›‡å‘˜â€ã€â€œç»ç†â€å’Œâ€œå­¦ç”Ÿâ€åˆ†åˆ«æè¿°ä¸€ç§è§’è‰²ï¼Œè€Œâ€œäººâ€å¯ä»¥åŒæ—¶æœ‰å‡ ç§ä¸åŒçš„è§’è‰²ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªâ€œäººâ€æ—¢ç„¶æ˜¯â€œç»ç†â€ï¼Œå°±å¿…ç„¶æ˜¯â€œé›‡å‘˜â€ï¼›è€Œæ­¤â€œäººâ€å¯èƒ½åŒæ—¶è¿˜å‚åŠ MBAè¯¾ç¨‹ï¼Œä»è€Œä¹Ÿæ˜¯ä¸€ä¸ªâ€œå­¦ç”Ÿâ€ã€‚ä½¿ç”¨ç»§æ‰¿æ¥å®ç°è§’è‰²ï¼Œåˆ™åªèƒ½ä½¿æ¯ä¸€ä¸ªâ€œäººâ€å…·æœ‰â€œHas-Aâ€è§’è‰²ï¼Œè€Œä¸”ç»§æ‰¿æ˜¯é™æ€çš„ï¼Œè¿™ä¼šä½¿å¾—ä¸€ä¸ªâ€œäººâ€åœ¨æˆä¸ºâ€œé›‡å‘˜â€èº«ä»½åï¼Œå°±æ°¸è¿œä¸ºâ€œé›‡å‘˜â€ï¼Œä¸èƒ½ç§°ä¸ºâ€œç»ç†â€æˆ–â€œå­¦ç”Ÿâ€ï¼Œè€Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ã€‚\n\n{% mermaid %}\n\nclassDiagram\n\näºº <|-- é›‡å‘˜\näºº <|-- ç»ç†\näºº <|-- å­¦ç”Ÿ\n\n{% endmermaid %}\n\nè¿™ä¸€é”™è¯¯çš„è®¾è®¡æºè‡ªæŠŠâ€œè§’è‰²â€çš„ç­‰çº§ç»“æ„ä¸â€œäººâ€çš„ç­‰çº§ç»“æ„æ··æ·†èµ·æ¥ï¼ŒæŠŠHas-Aè§’è‰²è¯¯è§£ä¸ºIs-Aè§’è‰²ã€‚å› æ­¤è¦çº æ­£è¿™ä¸€é”™è¯¯ï¼Œå…³é”®æ˜¯åŒºåˆ†â€œäººâ€å’Œâ€œè§’è‰²â€çš„åŒºåˆ«ã€‚ä¸‹å›¾æ‰€ç¤ºçš„è®¾è®¡å°±æ­£ç¡®åœ°åšåˆ°äº†è¿™ä¸€ç‚¹ã€‚\n\n{% mermaid %}\n\nclassDiagram\nè§’è‰² <|-- é›‡å‘˜\nè§’è‰² <|-- ç»ç†\nè§’è‰² <|-- å­¦ç”Ÿ\näºº \"1\" *--> \"*\" è§’è‰²\n\n{% endmermaid %}\n\nä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œæ¯ä¸€ä¸ªâ€œäººâ€éƒ½å¯ä»¥æœ‰ä¸€ä¸ªä»¥ä¸Šçš„â€œè§’è‰²â€ï¼Œæ‰€ä»¥ä¸€ä¸ªäººå¯ä»¥åŒæ—¶æ˜¯â€œé›‡å‘˜â€ï¼Œåˆæ˜¯â€œç»ç†â€ï¼Œç”šè‡³åŒæ—¶åˆæ˜¯â€œå­¦ç”Ÿâ€ã€‚è€Œä¸”ç”±äºâ€œäººâ€ä¸â€œè§’è‰²â€çš„è€¦åˆæ˜¯é€šè¿‡åˆæˆçš„ï¼Œå› æ­¤ï¼Œè§’è‰²å¯ä»¥æœ‰åŠ¨æ€çš„å˜åŒ–ã€‚ä¸€ä¸ªâ€œäººâ€å¯ä»¥å¼€å§‹æ˜¯ä¸€ä¸ªâ€œé›‡å‘˜â€ï¼Œç„¶åæ™‹å‡ä¸ºâ€œç»ç†â€ï¼Œç„¶ååˆç”±äºä»–å‚åŠ äº†MBAè¯¾ç¨‹ï¼Œåˆæˆä¸ºäº†â€œå­¦ç”Ÿâ€ã€‚\n\nè¿™å°±æ˜¯è¯´ï¼Œå½“ä¸€ä¸ªç±»æ˜¯å¦ä¸€ä¸ªç±»çš„è§’è‰²æ—¶ï¼Œä¸åº”å½“ä½¿ç”¨ç»§æ‰¿æè¿°è¿™ç§å…³ç³»ã€‚\n\n### ä¸é‡Œæ°ä»£æ¢åŸåˆ™è”åˆä½¿ç”¨\né‡Œæ°ä»£æ¢åŸåˆ™æ˜¯ç»§æ‰¿å¤ç”¨çš„åŸºçŸ³ã€‚å¦‚æœåœ¨ä»»ä½•ä½¿ç”¨Bç±»å‹çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨Sç±»å‹ï¼Œé‚£ä¹ˆSç±»å‹æ‰èƒ½ç§°ä¸ºBç±»å‹çš„å­ç±»å‹ï¼ˆSubtypeï¼‰ï¼Œè€ŒBç±»å‹æ‰èƒ½ç§°ä¸ºSç±»å‹çš„åŸºç±»å‹ï¼ˆBase Typeï¼‰ã€‚\n\næ¢è¨€ä¹‹ï¼Œåªæœ‰å½“æ¯ä¸€ä¸ªSåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½æ˜¯ä¸€ç§Bçš„æ—¶å€™ï¼Œæ‰å¯ä»¥å°†Sè®¾è®¡æˆä¸ºBçš„å­ç±»ã€‚å¦‚æœä¸¤ä¸ªç±»çš„å…³ç³»æ˜¯\"Has-Aâ€œå…³ç³»è€Œä¸æ˜¯â€Is-Aâ€œå…³ç³»ï¼Œè¿™ä¸¤ä¸ªç±»ä¸€å®šè¿åäº†é‡Œæ°ä»£æ¢åŸåˆ™ã€‚\n\nåªæœ‰ä¸¤ä¸ªç±»æ»¡è¶³é‡Œæ°ä»£æ¢åŸåˆ™ï¼Œæ‰æœ‰å¯èƒ½æ˜¯â€Is-Aâ€œå…³ç³»ã€‚\n\n### Javaè¯­è¨€APIä¸­çš„ä¾‹å­\nåœ¨Javaè¯­è¨€çš„APIä¸­ï¼Œæœ‰å‡ ä¸ªæ˜æ˜¾è¿åè¿™ä¸€åŸåˆ™çš„ä¾‹å­ï¼Œå…¶ä¸­æœ€ä¸ºè‘—åçš„å°±æ˜¯Stackå’ŒPropertiesã€‚å‰è€…è¢«ä¸å½“åœ°è®¾ç½®ä¸ºVectorçš„å­ç±»ï¼Œè€ŒPropertiesè¢«ä¸æ°å½“åœ°è®¾ç½®æˆHashtableçš„å­ç±»ï¼Œ\n![Javaè¯­è¨€APIä¸­çš„ä¾‹å­](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00007/1.jpg)\n\nä¸€ä¸ªStackä¸æ˜¯ä¸€ä¸ªVectorï¼Œæ‰€ä»¥Stackä¸åº”å½“è®¾ç½®æˆä¸ºVectorçš„å­ç±»ã€‚åŒæ ·åœ°ï¼Œä¸€ä¸ªæ€§è´¨åˆ—ï¼ˆPropertiesï¼‰ä¹Ÿä¸æ˜¯ä¸€ä¸ªHashtableã€‚åœ¨ä¸¤ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨èšåˆæ¯”ä½¿ç”¨ç»§æ‰¿å…³ç³»æ›´åˆé€‚ã€‚\n\nç”±äºPropertiesç»§æ‰¿äº†Hashtableçš„è¡Œä¸ºï¼Œå› è€Œå½“pæ˜¯ä¸€ä¸ªPropertiesç±»å‹çš„å¯¹è±¡æ—¶ï¼Œ`p.getProperties(key)`å’Œ`p.get(key)`å°±ä¼šç»™å‡ºä¸åŒçš„ç»“æœã€‚å‰è€…æ¥è‡ªäºPropertiesæœ¬èº«ï¼Œå› æ­¤ä¼šåˆ©ç”¨é»˜è®¤å€¼ï¼›è€Œåè€…åˆ™æ¥è‡ªäºHashtableï¼Œå› æ­¤ä¸ä¼šåˆ©ç”¨é»˜è®¤å€¼ã€‚\n\næ›´ç³Ÿç³•çš„æ˜¯ï¼Œç”±äºPropertiesæ˜¯Hashtableçš„å­ç±»ï¼Œå› æ­¤ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ç±»å‹çš„è½¬æ¢ï¼Œç›´æ¥ä½¿ç”¨è¶…ç±»å‹çš„è¡Œä¸ºã€‚æ¯”å¦‚ï¼ŒPropertieså‡å®šæ‰€æœ‰çš„é”®å’Œå€¼éƒ½æ˜¯Stringç±»å‹çš„ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±ä¼šå¯¼è‡´è¿è¡Œå´©æºƒã€‚ä½†æ˜¯ï¼Œå®¢æˆ·ç«¯å®Œå…¨å¯ä»¥é€šè¿‡Hashtableæä¾›çš„è¡Œä¸ºåŠ å…¥ä»»æ„ç±»å‹çš„é”®å’Œå€¼ã€‚ç»•è¿‡Propertiesçš„æ¥å£ï¼Œå¹¶å¯¼è‡´Propertiesçš„å†…éƒ¨çŸ›ç›¾å’Œå´©æºƒã€‚\n\nè¿™æ ·ä¸€æ¥ï¼ŒPropertieså…¶å®ä»…ä»…æ˜¯æœ‰ä¸€äº›Hashtableçš„å±æ€§çš„ï¼Œæ¢è¨€ä¹‹ï¼Œè¿™æ˜¯ä¸€ä¸ª\"Has-Aâ€çš„å…³ç³»ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªâ€œIs-Aâ€çš„å…³ç³»ã€‚","tags":["CARP","åˆæˆ","èšåˆ","å¤ç”¨åŸåˆ™","é‡Œæ°ä»£æ¢","Coadæ³•æµ‹"],"categories":["è®¾è®¡æ¨¡å¼","è®¾è®¡åŸåˆ™çš„ä½“ç°"]},{"title":"é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00006","url":"/2023/02/08/é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00006/","content":"\n# å¼•è¨€\næ¥å£éš”ç¦»åŸåˆ™(Interface Segregation Principle, å¸¸å¸¸ç¼©å†™åšISP)ï¼Œè®²çš„æ˜¯ï¼šä½¿ç”¨å¤šä¸ªä¸“é—¨çš„æ¥å£æ¯”ä½¿ç”¨å•ä¸€çš„æ€»æ¥å£è¦å¥½ã€‚æ¢è¨€ä¹‹ï¼Œä»ä¸€ä¸ªå®¢æˆ·ç±»çš„è§’åº¦æ¥è®²ï¼šä¸€ä¸ªç±»å¯¹å¦å¤–ä¸€ä¸ªç±»çš„ä¾èµ–æ€§åº”å½“æ˜¯å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šçš„ã€‚\n\n# ä»€ä¹ˆæ˜¯æ¥å£éš”ç¦»åŸåˆ™\næ­£å¦‚æœ¬ä¹¦åœ¨â€œä¸“é¢˜ï¼šJavaæ¥å£â€ä¸€ç« ä¸­æ‰€æŒ‡å‡ºçš„é‚£æ ·ï¼Œäººä»¬æ‰€è¯´çš„â€œæ¥å£â€å¾€å¾€æ˜¯æŒ‡ä¸¤ç§ä¸åŒçš„ä¸œè¥¿ï¼šä¸€ç§æ˜¯æŒ‡Javaè¯­è¨€ä¸­çš„æœ‰ä¸¥æ ¼å®šä¹‰çš„Interfaceç»“æ„ï¼Œæ¯”å¦‚java.lang.Runnableå°±æ˜¯ä¸€ä¸ªJavaæ¥å£ï¼›å¦ä¸€ç§å°±æ˜¯ä¸€ä¸ªç±»å‹æ‰€å…·æœ‰çš„æ–¹æ³•ç‰¹å¾çš„é›†åˆï¼Œä¹Ÿç§°åšâ€œæ¥å£â€ï¼Œä½†ä»…æ˜¯ä¸€ç§é€»è¾‘ä¸Šçš„æŠ½è±¡ã€‚å¯¹åº”è¿™ä¸¤ç§ä¸åŒçš„ç”¨è¯ï¼Œæ¥å£éš”ç¦»åŸåˆ™çš„è¡¨è¾¾æ–¹å¼ä»¥åŠå«ä¹‰éƒ½æœ‰æ‰€ä¸åŒã€‚\n\n## è§’è‰²çš„åˆç†åˆ’åˆ†\nå°†â€œæ¥å£â€ç†è§£ä¸ºä¸€ä¸ªç±»æ‰€æä¾›çš„æ‰€æœ‰æ–¹æ³•çš„ç‰¹å¾é›†åˆï¼Œä¹Ÿå°±æ˜¯ä¸€ç§åœ¨é€»è¾‘ä¸Šæ‰å­˜åœ¨çš„æ¦‚å¿µã€‚è¿™æ ·çš„è¯ï¼Œæ¥å£çš„åˆ’åˆ†å°±ç›´æ¥å¸¦æ¥ç±»å‹çš„åˆ’åˆ†ã€‚\n\nä¸€ä¸ªæ¥å£ç›¸å½“äºå‰§æœ¬ä¸­çš„ä¸€ç§è§’è‰²ï¼Œè€Œæ­¤è§’è‰²åœ¨ä¸€ä¸ªèˆå°ä¸Šç”±å“ªä¸€ä¸ªæ¼”å‘˜æ¥æ¼”åˆ™ç›¸å½“äºæ¥å£çš„å®ç°ã€‚å› æ­¤ï¼Œä¸€ä¸ªæ¥å£åº”å½“ç®€å•åœ°ä»£è¡¨ä¸€ä¸ªè§’è‰²ï¼Œè€Œä¸æ˜¯å¤šä¸ªè§’è‰²ã€‚å¦‚æœç³»ç»Ÿæ¶‰åŠåˆ°å¤šä¸ªè§’è‰²çš„è¯ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªè§’è‰²éƒ½åº”å½“ç”±ä¸€ä¸ªç‰¹å®šçš„æ¥å£ä»£è¡¨ã€‚\n\nä¸ºäº†é¿å…æ··æ·†ï¼Œæœ¬ä¹¦å°†è¿™ç§è§’è‰²åˆ’åˆ†çš„åŸåˆ™å«åšè§’è‰²éš”ç¦»åŸåˆ™ã€‚\n\n## å®šåˆ¶æœåŠ¡\nå°†æ¥å£ç†è§£æˆä¸ºç‹­ä¹‰çš„Javaæ¥å£ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ¥å£éš”ç¦»åŸåˆ™è®²çš„å°±æ˜¯ä¸ºåŒä¸€ä¸ªè§’è‰²æä¾›å®½ã€çª„ä¸åŒçš„æ¥å£ï¼Œä»¥å¯¹ä»˜ä¸åŒçš„å®¢æˆ·ç«¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚è¿™ç§åŠæ³•åœ¨æœåŠ¡è¡Œä¸šä¸­å«åšå®šåˆ¶æœåŠ¡(Customized Service)ï¼Œè¿™ä¹Ÿæ˜¯æœ¬ä¹¦ç»™è¿™ç§è¯ é‡Šçš„ä¸€ä¸ªåå­—ã€‚\n\n{% mermaid %}\n\nclassDiagram\nclass IService1 {\n\t<<interface>>\n}\nIService1: +m1()\nIService1: +p2()\n\nclass IService2 {\n\t<<interface>>\n}\nIService2: +m2()\nIService2: +p1()\n\nclass IService3 {\n\t<<interface>>\n}\nIService3: +m1()\nIService3: +p1()\nIService3: +p2()\n\nIService1 <|-- Service\nIService2 <|-- Service\nIService3 <|-- Service\n\nClient1 --> IService1\nClient2 --> IService2\nClient3 --> IService3\n\nService: +m1()\nService: +m2()\nService: +p1()\nService: +p2()\n\n{% endmermaid %}\n\nåœ¨ä¸Šé¢çš„ç¤ºæ„æ€§ç±»å›¾ä¸­ï¼Œæœ‰ä¸€ä¸ªè§’è‰²Serviceä»¥åŠä¸‰ä¸ªä¸åŒçš„å®¢æˆ·ç«¯ã€‚è¿™ä¸‰ä¸ªå®¢æˆ·ç«¯éœ€è¦çš„æœåŠ¡éƒ½æ˜¯ç¨ç¨ä¸åŒçš„ï¼Œå› æ­¤ç³»ç»Ÿåˆ†åˆ«ä¸ºå®ƒä»¬æä¾›äº†ä¸‰ä¸ªä¸åŒçš„Javaæ¥å£ï¼Œå³IService1ï¼ŒIService2ä»¥åŠIService3ã€‚æ˜¾ç„¶ï¼Œæ¯ä¸€ä¸ªJavaæ¥å£éƒ½ä»…å°†å®¢æˆ·ç«¯éœ€è¦çš„æ¥å£æš´éœ²ç»™å®¢æˆ·ç«¯ï¼Œè€Œæ²¡æœ‰å°†å®¢æˆ·ç«¯ä¸éœ€è¦çš„è¡Œä¸ºæ”¾åˆ°æ¥å£ä¸­ã€‚ç†Ÿæ‚‰é€‚é…å™¨æ¨¡å¼çš„è¯»è€…å¯ä»¥è¾¨è®¤å‡ºï¼Œè¿™æ˜¯é€‚é…å™¨æ¨¡å¼çš„åº”ç”¨ã€‚\n\n## æ¥å£æ±¡æŸ“\nè¿‡äºè‡ƒè‚¿çš„æ¥å£æ˜¯å¯¹æ¥å£çš„æ±¡æŸ“(Interface Contamination)ã€‚\n\nç”±äºæ¯ä¸€ä¸ªæ¥å£éƒ½ä»£è¡¨ä¸€ä¸ªè§’è‰²ï¼Œå®ç°ä¸€ä¸ªæ¥å£çš„å¯¹è±¡ï¼Œåœ¨å®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­éƒ½æ‰®æ¼”è¿™ä¸ªè§’è‰²ï¼Œå› æ­¤å°†è§’è‰²åŒºåˆ†æ¸…æ¥šå°±æ˜¯ç³»ç»Ÿè®¾è®¡çš„ä¸€ä¸ªé‡è¦å·¥ä½œã€‚å› æ­¤ï¼Œä¸€ä¸ªç¬¦åˆé€»è¾‘çš„æ¨æ–­ï¼Œä¸åº”å½“å°†å‡ ä¸ªä¸åŒçš„è§’è‰²éƒ½äº¤ç»™åŒä¸€ä¸ªæ¥å£ï¼Œè€Œåº”å½“äº¤ç»™ä¸åŒçš„æ¥å£ã€‚\n\nä¸€ä¸ªæ²¡æœ‰ç»éªŒçš„è®¾è®¡å¸ˆå¾€å¾€æƒ³èŠ‚çœæ¥å£çš„æ•°ç›®ï¼Œå› æ­¤å°†ä¸€äº›çœ‹ä¸Šå»å·®ä¸å¤šçš„æ¥å£åˆå¹¶ã€‚ä¸€äº›äººå°†è¿™çœ‹åšæ˜¯ä»£ç ä¼˜åŒ–çš„ä¸€éƒ¨åˆ†ï¼Œè¿™æ˜¯é”™è¯¯çš„ã€‚\n\nå‡†ç¡®è€Œæ°å½“åœ°åˆ’åˆ†è§’è‰²ä»¥åŠè§’è‰²æ‰€å¯¹åº”çš„æ¥å£ï¼Œæ˜¯é¢å‘å¯¹è±¡çš„è®¾è®¡çš„ä¸€ä¸ªé‡è¦çš„ç»„æˆéƒ¨åˆ†ã€‚å°†æ²¡æœ‰å…³ç³»çš„æ¥å£åˆå¹¶åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªè‡ƒè‚¿çš„å¤§æ¥å£ï¼Œæ˜¯å¯¹è§’è‰²å’Œæ¥å£çš„æ±¡æŸ“ã€‚\n\n## ç°è¿ªç±³ç‰¹æ³•åˆ™çš„å…³ç³»\nè¿ªç±³ç‰¹æ³•åˆ™è¦æ±‚ä»»ä½•ä¸€ä¸ªè½¯ä»¶å®ä½“ï¼Œé™¤éç»å¯¹éœ€è¦ï¼Œä¸ç„¶ä¸è¦ä¸å¤–ç•Œé€šä¿¡ã€‚å³ä½¿å¿…é¡»è¿›è¡Œé€šä¿¡ï¼Œä¹Ÿåº”å½“å°½é‡é™åˆ¶é€šä¿¡çš„å¹¿åº¦å’Œæ·±åº¦ã€‚\n\næ˜¾ç„¶ï¼Œå®šåˆ¶æœåŠ¡åŸåˆ™æ‹’ç»å‘å®¢æˆ·æä¾›ä¸éœ€è¦æä¾›çš„è¡Œä¸ºï¼Œæ˜¯ç¬¦åˆè¿ªç±³ç‰¹æ³•åˆ™çš„ã€‚\n\n# ä¸€ä¸ªè§’è‰²éš”ç¦»åŸåˆ™çš„ä¾‹å­\næœ¬èŠ‚ä»ä»£ç é‡æ„çš„è§’åº¦è®¨è®ºæ€æ ·å°†ä¸€ä¸ªè‡ƒè‚¿çš„è§’è‰²é‡æ–°åˆ†å‰²æˆæ›´ä¸ºåˆé€‚çš„è¾ƒå°è§’è‰²ã€‚\n## å…¨æ–‡æŸ¥è¯¢å¼•æ“çš„ç³»ç»Ÿè®¾è®¡\næœ¬ç« åœ¨è¿™é‡Œä»¥ä¸€ä¸ªç½‘ç«™çš„å…¨æ–‡æŸ¥è¯¢å¼•æ“çš„ç³»ç»Ÿè®¾è®¡ä¸ºä¾‹ï¼Œè¿™ä¸ªä¾‹å­å–æè‡ªä¸€ä¸ªçœŸå®çš„é¡¹ç›®ï¼Œå¦‚æœè¯»è€…ä½¿ç”¨è¿‡AltaVisaå…¬å¸çš„æ–‡å­—æœç´¢å¼•æ“è½¯ä»¶åŒ…çš„è¯ï¼Œå°±ä¼šå¾ˆç†Ÿæ‚‰æœ¬ä¾‹å­çš„æƒ…å½¢ã€‚ä¸€ä¸ªåŠ¨æ€çš„èµ„æ–™ç½‘ç«™å°†å¤§é‡çš„æ–‡ä»¶èµ„æ–™å­˜å‚¨åœ¨æ–‡ä»¶ä¸­æˆ–å…³ç³»æ•°æ®åº“é‡Œé¢ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è¾“å…¥ä¸€ä¸ªæˆ–æ•°ä¸ªå…³é”®è¯è¿›è¡Œå…¨æ–‡æœç´¢ã€‚è¿™ä¸ªæœç´¢å¼•æ“éœ€è¦ç»´æŒä¸€ä¸ªç´¢å¼•åº“ï¼Œåœ¨æœ¬ä¾‹å­é‡Œé¢ç´¢å¼•åº“ä»¥æ–‡æœ¬æ–‡ä»¶æ–¹å¼å­˜äºæ–‡ä»¶ç³»ç»Ÿä¸­ã€‚åœ¨æºæ•°æ®è¢«ä¿®æ”¹ã€åˆ é™¤æˆ–å¢åŠ æ—¶ï¼Œæœç´¢å¼•æ“è¦åšç›¸åº”çš„åŠ¨ä½œï¼Œä»¥ä¿è¯å¼•æ“çš„ç´¢å¼•æ–‡ä»¶ä¹Ÿè¢«ç›¸åº”åœ°æ›´æ–°ã€‚\n## åé¢ä¾‹å­\né¦–å…ˆï¼Œä¸‹å›¾æ‰€ç¤ºä¸ºä¸€ä¸ªä¸å¥½çš„è§£å†³æ–¹æ¡ˆã€‚ä¸€ä¸ªå«åšBadExampleçš„æ¥å£è´Ÿè´£æ‰€æœ‰çš„æ“ä½œï¼Œä»æä¾›æœç´¢åŠŸèƒ½åˆ°å»ºç«‹ç´¢å¼•çš„åŠŸèƒ½ï¼Œç”šè‡³åŒ…æ‹¬æœç´¢ç»“æœé›†åˆçš„åŠŸèƒ½å‡åœ¨ä¸€ä¸ªæ¥å£å†…æä¾›ã€‚\n\n{% mermaid %}\n\nclassDiagram\n\nclass Client {\n   -indexCursor:Indexer \n   -searcher:Searcher\n}\n\nclass BadExample {\n    <<interface>>\n    +first():void\n    +last():void\n    +next():void\n    +previous():void\n    +getExcerpt():String\n    +getFullRecord():String\n    +reIndexAll():void\n    +updateIndex():void\n    +search(keywords:String[]):void\n    +getResultset():void\n}\n\nClient o--> BadExample\n\n{% endmermaid %}\n\nè¿™ä¸ªè§£å†³æ–¹æ¡ˆè¿åäº†è§’è‰²åˆ†å‰²åŸåˆ™ï¼ŒæŠŠä¸åŒåŠŸèƒ½çš„æ¥å£æ”¾åœ¨ä¸€èµ·ï¼Œç”±ä¸€ä¸ªæ¥å£ç»™å‡ºåŒ…æ‹¬æœç´¢å™¨è§’è‰²ã€ç´¢å¼•ç”Ÿæˆå™¨è§’è‰²ä»¥åŠæœç´¢ç»“æœé›†è§’è‰²åœ¨å†…çš„æ‰€æœ‰è§’è‰²ã€‚\n\n## è§’è‰²çš„åˆ†å‰²\né‚£ä¹ˆï¼Œéµå®ˆæ¥å£éš”ç¦»åŸåˆ™çš„åšæ³•æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n{% mermaid %}\n\nclassDiagram\nclass Indexer {\n    <<interface>>\n    +reIndexAll():void\n    +updateIndex():void\n}\nclass Searcher {\n    <<interface>>\n    +search(keywords:String[]):void\n    +getResultset():void\n}\nclass FileIndexer {\n    +reIndexAll():void\n    +updateIndex():void\n}\nclass RdbIndexer {\n    +reIndexAll():void\n    +updateIndex():void\n}\nFileIndexer ..|>Indexer\nRdbIndexer ..|>Indexer\nclass Resultset {\n    <<interface>>\n    +first():void\n    +last():void\n    +next():void\n    +previous():void\n    +getExcerpt():String\n    +getFullRecord():String\n}\n\nSearcher o--> Resultset\n\nclass Client {\n    -indexCursor:Indexer\n    -searcher:Searcher\n}\n\nClient o-->Indexer\nClient o--Searcher\n\n{% endmermaid %}\n\nåœ¨å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæœç´¢å¼•æ“çš„åŠŸèƒ½è¢«åˆ†å‰²ä¸ºä¸‰ä¸ªè§’è‰²ï¼š\n- æœç´¢å™¨è§’è‰²\n- ç´¢å¼•ç”Ÿæˆå™¨è§’è‰²\n- æœç´¢ç»“æœé›†è§’è‰²\n\nä»¥ç´¢å¼•ç”Ÿæˆå™¨è§’è‰²ä¸ºä¾‹ï¼Œç”±äºç´¢å¼•ç”Ÿæˆå› æ•°æ®çš„æ ¼å¼ä¸åŒè€Œä¸åŒï¼Œæ•…åˆ†ä¸ºRdbIndexerå’ŒFileIndexerä¸¤ç§å®ç°ã€‚FileIndexerç±»ä»£è¡¨è¯¸å¦‚*.txtã€*.htmlã€ *.htmlã€ *.doc ä»¥åŠ *.pdfç­‰æ–‡ä»¶ç±»å‹çš„æ•°æ®ç”Ÿæˆå…¨æ–‡ç´¢å¼•ï¼Œè€ŒRdbIndexeråˆ™é’ˆå¯¹å…³ç³»æ•°æ®åº“çš„æ•°æ®è¿›è¡Œå…¨æ–‡ç´¢å¼•ç”Ÿæˆã€‚è¿™ä¸¤ä¸ªå®ç°æ‰®æ¼”çš„åŒä¸ºç´¢å¼•ç”Ÿæˆå™¨è§’è‰²ï¼Œå°±å¥½åƒæ‰®æ¼”åŒæ ·è§’è‰²çš„ä¸¤ä¸ªä¸åŒæ¼”å‘˜ä¸€æ ·ã€‚\n\næœç´¢å™¨è§’è‰²åˆ™æ˜¯ä¸ç´¢å¼•ç”Ÿæˆå™¨è§’è‰²å®Œå…¨ä¸åŒçš„è§’è‰²ï¼Œå®ƒæä¾›ç”¨æˆ·å…¨æ–‡æœç´¢åŠŸèƒ½ã€‚ç”¨æˆ·ä¼ è¿›ä¸€äº›å…³é”®å­—ï¼Œæœç´¢å™¨è§’è‰²åˆ™è¿”å›ä¸€ä¸ªResultsetå¯¹è±¡ã€‚\n\næœç´¢ç»“æœé›†è§’è‰²å°±æ˜¯Resultsetã€‚å®ƒç»™ç”¨æˆ·æä¾›å¯¹é›†åˆè¿›è¡Œè¿­ä»£èµ°è®¿çš„åŠŸèƒ½ï¼Œå¦‚first()å°†å…‰æ ‡ç§»åˆ°é›†åˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼›last()å°†å…‰æ ‡ç§»åˆ°é›†åˆçš„æœ€åä¸€ä¸ªå…ƒç´ ï¼›next()å°†å…‰æ ‡ç§»åˆ°é›†åˆçš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼›previous()å°†å…‰æ ‡ç§»åˆ°é›†åˆçš„å‰ä¸€ä¸ªå…ƒç´ ï¼›è€ŒgetExerpt()åˆ™è¿”å›å½“å‰è®°å½•çš„æ‘˜è¦ï¼›è€ŒgetFullRecord()åˆ™å°†è®°å½•çš„å…¨æ–‡è¿”å›ã€‚\n\n# å®šåˆ¶æœåŠ¡çš„ä¾‹å­\nå®šåˆ¶æœåŠ¡(Customized Service)ä¹Ÿæ˜¯ä¸€ä¸ªé‡è¦çš„è®¾è®¡åŸåˆ™ã€‚å®ƒçš„æ„æ€æ˜¯è¯´ï¼Œå¦‚æœå®¢æˆ·ç«¯ä»…ä»…éœ€è¦æŸä¸€äº›æ–¹æ³•çš„è¯ï¼Œé‚£ä¹ˆå°±åº”å½“å‘å®¢æˆ·ç«¯æä¾›è¿™äº›éœ€è¦çš„æ–¹æ³•ï¼Œè€Œä¸è¦æä¾›ä¸éœ€è¦çš„æ–¹æ³•ã€‚\n\nè¿™æ ·åšçš„æ•ˆæœæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ\n- è¿™æ ·åšå¾ˆæ•´æ´ã€‚ä»ç¾å­¦çš„è§’åº¦ä¸Šè€ƒè™‘ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åšæ³•ã€‚ä»è¿™æ ·çš„ä¸€ä¸ªè®¾è®¡å¯ä»¥çœ‹å‡ºï¼Œè®¾è®¡å¸ˆèŠ±äº†å¾ˆå¤šçš„æ—¶é—´åœ¨åˆ†æå’Œåˆ’åˆ†è¿™äº›æ¥å£ä¸Šé¢ã€‚ä½†æ˜¯è¿™å¹¶ä¸æ˜¯æœ€é‡è¦çš„æ•ˆæœï¼Œæ²¡æœ‰äººä¼šä»…ä»…å› ä¸ºç¾å­¦æ•ˆæœè€Œå°†è¿™ä¸€åŸåˆ™å½“ä½œé¢å‘å¯¹è±¡çš„è®¾è®¡åŸåˆ™ã€‚\n- ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚å‘å®¢æˆ·ç«¯æä¾›publicæ¥å£æ˜¯ä¸€ç§æ‰¿è¯ºï¼Œä¸€ä¸ªpublicæ¥å£ä¸€æ—¦æä¾›ï¼Œå°±å¾ˆéš¾æ’¤å›ã€‚ä½œä¸ºè½¯ä»¶æä¾›å•†ï¼Œæ²¡æœ‰äººæ„¿æ„åšå‡ºè¿‡å¤šçš„æ‰¿è¯ºï¼Œç‰¹åˆ«æ˜¯ä¸å¿…è¦çš„æ‰¿è¯ºã€‚è¿‡å¤šçš„æ‰¿è¯ºä¼šç»™ç³»ç»Ÿçš„ç»´æŠ¤é€ æˆä¸å¿…è¦çš„è´Ÿæ‹…ã€‚å¦‚æœè¿™äº›æ¥å£ä»…ä»…æ˜¯æä¾›ç»™å…¬å¸å†…éƒ¨çš„ç³»ç»Ÿä½¿ç”¨ï¼Œé‚£ä¹ˆå°†è¿™äº›æ¥å£éš”ç¦»å¼€æ¥ï¼Œä¹Ÿå¯ä»¥é™ä½ç»´æŠ¤çš„æˆæœ¬ã€‚å› ä¸ºå¦‚æœä¸€æ—¦æ‰€æä¾›çš„æœåŠ¡å‡ºç°å˜åŒ–çš„è¯ï¼Œè®¾è®¡å¸ˆçŸ¥é“å“ªäº›å®¢æˆ·ç«¯ä¼šå—åˆ°å½±å“ï¼Œå“ªäº›ä¸ä¼šå—åˆ°å½±å“ã€‚è¿™æ˜¾ç„¶ä¹Ÿæ˜¯ç¬¦åˆè¿ªç±³ç‰¹æ³•åˆ™çš„ã€‚\n\n## å¤‡å¿˜å½•æ¨¡å¼\nå¤‡å¿˜å½•æ¨¡å¼(Memento Pattern)çš„ç”¨æ„æ˜¯åœ¨ä¸ç ´åå°è£…çš„æ¡ä»¶ä¸‹ï¼Œæ•æ‰ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€ï¼Œå¹¶å°†ä¹‹å¤–éƒ¨åŒ–ï¼Œä»è€Œå¯ä»¥åœ¨å°†æ¥åˆé€‚çš„æ—¶å€™æŠŠè¿™ä¸ªå¯¹è±¡è¿˜åŸåˆ°å­˜å‚¨èµ·æ¥çš„çŠ¶æ€ã€‚å¤‡å¿˜å½•æ¨¡å¼çš„ç®€ç•¥ç±»å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š\n![å¤‡å¿˜å½•ç®€ç•¥ç±»å›¾](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00006/1.jpg)\nåœ¨è¿™é‡Œï¼Œä¸ç ´åå°è£…æ˜¯ä¸€ä¸ªå…³é”®è¯ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œå¿…é¡»ä½¿å¤‡å¿˜å½•å¯¹è±¡å‘å¤–ç•Œæä¾›åŒé‡æ¥å£ï¼Œä¹Ÿå³ä¸€ä¸ªçª„æ¥å“å’Œä¸€ä¸ªå®½æ¥å£ã€‚\n\nå®½æ¥å£æ˜¯ä¸ºå‘èµ·äººè§’è‰²å‡†å¤‡çš„ï¼Œå› ä¸ºè¿™ä¸ªå¤‡å¿˜å½•è§’è‰²æ‰€å­˜å‚¨çš„çŠ¶æ€å°±æ˜¯å±äºè¿™ä¸ªå‘èµ·äººè§’è‰²çš„ï¼Œè€Œä¸”è¿™ä¸ªè§’è‰²éœ€è¦è®¿é—®å¤‡å¿˜å½•è§’è‰²æ‰€å­˜å‚¨çš„ä¿¡æ¯ä»¥ä¾¿æ¢å¤è‡ªå·±çš„çŠ¶æ€ã€‚\n\nçª„æ¥å£æ˜¯ä¸ºåŒ…æ‹¬è´Ÿè´£äººè§’è‰²åœ¨å†…çš„æ‰€æœ‰å…¶å®ƒå¯¹è±¡å‡†å¤‡çš„ï¼Œå› ä¸ºå®ƒä»¬ä¸éœ€è¦ã€ä¹Ÿä¸åº”è¯¥è¯»å–å¤‡å¿˜å½•è§’è‰²æ‰€å­˜å‚¨çš„ä¿¡æ¯ã€‚\n\næ¢è¨€ä¹‹ï¼Œå‘èµ·äººè§’è‰²å’Œè´Ÿè´£äººè§’è‰²å°±ç›¸å½“äºå¤‡å¿˜å½•è§’è‰²çš„ä¸åŒå®¢æˆ·ç«¯ï¼Œè€Œè¿™ç§ä¸ºä¸åŒå®¢æˆ·ç«¯æä¾›ä¸åŒæ¥å£çš„åšæ³•å°±æ˜¯å®šåˆ¶æœåŠ¡æ¦‚å¿µçš„ä½“ç°ã€‚\n\n## è¿­ä»£å­æ¨¡å¼\nè¿­ä»£å­æ¨¡å¼æä¾›ä¸€ä¸ªè¿­ä»£å­å¯¹è±¡ï¼Œä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥é¡ºåºåœ°è®¿é—®ä¸€ä¸ªèšé›†ä¸­çš„å…ƒç´ ï¼Œè€Œä¸å¿…æš´éœ²èšé›†çš„å†…éƒ¨è¡¨è±¡ã€‚è¿­ä»£å­æ¨¡å¼çš„ç¤ºæ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š\n![è¿­ä»£å­æ¨¡å¼ç®€ç•¥ç±»å›¾](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00006/2.jpg)\n\næ¢è¨€ä¹‹ï¼Œä¸Šé¢çš„è¿™ä¸ªç³»ç»Ÿçš„å®¢æˆ·ç«¯å’Œç³»ç»Ÿå†…éƒ¨çš„è¿­ä»£å­å¯¹è±¡éƒ½éœ€è¦è®¿é—®èšé›†å¯¹è±¡ï¼Œä½†æ˜¯å®ƒä»¬æ‰€éœ€è¦çš„è®¿é—®æ€§è´¨æœ‰æ‰€ä¸åŒã€‚å‰è€…ä»…éœ€è¦é€šè¿‡ä¸€ä¸ªè¿­ä»£å­æ¥å£éå†èšé›†å…ƒç´ ï¼Œè€Œè¿­ä»£å­å¯¹è±¡åˆ™éœ€è¦çŸ¥é“èšé›†å¯¹è±¡çš„å†…éƒ¨ç»“æ„ä¿¡æ¯ã€‚\n\nå› æ­¤ï¼Œèšé›†å¯¹è±¡å‘ä¸åŒçš„å®¢æˆ·ç«¯æä¾›ä¸åŒçš„æ¥å£ï¼Œä¸€ä¸ªæ˜¯å®½æ¥å£ï¼Œæä¾›ç»™è¿­ä»£å­å¯¹è±¡ï¼›å¦ä¸€ä¸ªæ˜¯çª„æ¥å£ï¼Œæä¾›ç»™ç³»ç»Ÿçš„å®¢æˆ·ç«¯ã€‚","tags":["ISP","æ¥å£éš”ç¦»åŸåˆ™"],"categories":["è®¾è®¡æ¨¡å¼","è®¾è®¡åŸåˆ™çš„ä½“ç°"]},{"title":"ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0004","url":"/2023/02/02/ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0004/"},{"title":"Golangç­‰å€¼è¿ç®—ç¬¦æœºåˆ¶è¯¦è§£","url":"/2023/02/01/Golangç­‰å€¼è¿ç®—ç¬¦æœºåˆ¶è¯¦è§£/","content":"\n# èƒŒæ™¯\nè¿™ç¯‡æ–‡ç« æºäºä»£ç ä¸­å…³äºnilåˆ¤æ–­çš„ä¸€ä¸ªé—®é¢˜ã€‚å…ˆä»ä¸€æ®µä»£ç çœ‹èµ·ï¼Œä¸‹é¢è¿™æ®µä»£ç æ˜¯å°†ä¼ å…¥çš„å¯¹è±¡è½¬æ¢æˆ`JSON string`å¹¶è¿”å›ï¼Œå…¶ä¸­ï¼Œå¦‚æœåˆ¤æ–­`i==nil`æ—¶ï¼Œä¼šè¿”å›`\"\"`ã€‚\n```go\nfunc ToJSONString(i interface{}) string {\n   if i == nil {\n      return \"\"\n   }\n   bytes, _ := json.Marshal(i)\n   return string(bytes)\n}\n```\nè¿™æ®µä»£ç åˆçœ‹å¹¶æ²¡æœ‰å¤ªå¤§çš„é—®é¢˜ï¼Œä½†å®é™…ä¸Šè¿™é‡Œéšå«äº†ä¸€ä¸ªä¸å®¹æ˜“è¢«å‘ç°çš„é—®é¢˜ï¼Œåœ¨è¯´æ˜è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸‹è¿™æ®µä»£ç åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°é—®é¢˜ï¼š\n```go\ntype Data struct {\n   V int `json:\"v\"`\n}\n\nfunc TestToJSONString(t *testing.T) {\n   a := assert.New(t)\n\n   a.Equal(\"\", ToJSONString(nil))\n\n   var data *Data\n   a.Equal(\"\", ToJSONString(data))\n\n   var k *int\n   a.Equal(\"\", ToJSONString(k))\n}\n```\nè¿™æ®µæµ‹è¯•ä»£ç ä¸­ä¸‰ä¸ªæ–­è¨€åˆ†åˆ«è¿”å›ï¼š\n```\nPASS\nFAIL, Expect: \"\", Actual: \"null\"\nFAIL, Expect: \"\", Actual: \"null\"\n```\nè¿™é‡Œå¾ˆè®©äººç–‘æƒ‘ï¼Œdataåº”è¯¥æ˜¯nilï¼Œä¼¼ä¹data==nilçš„ç»“è®ºæ˜¯falseï¼Œä¸ºäº†ç¡®è®¤è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¼•å…¥ä¸€æ®µä»£ç ã€‚\n```go\nvar a *int = nil\nvar b interface{} = nil\n\nfmt.Println(\"a == nil:\", a == nil)\nfmt.Println(\"b == nil:\", b == nil)\nfmt.Println(\"a == b:\", a == b)\n```\nç»“æœä¸ºï¼š\n```\na == nil: true\nb == nil: true\na == b: false // é‡ç‚¹\n```\nè¿™ä¸ªä¾‹å­æ¯”è¾ƒç®€å•ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå¾ˆç›¸ä¼¼ï¼Œä½†ç¨å¾®å¤æ‚äº›çš„ä¾‹å­\n```go\nvar a *int = nil\nvar b interface{} = a\n\nfmt.Println(\"a == nil:\", a == nil)\nfmt.Println(\"b == nil:\", b == nil)\nfmt.Println(\"a == b:\", a == b)\n```\nç»“æœä¸ºï¼š\n```\na == nil: true\nb == nil: false // é‡ç‚¹\na == b: true\n```\n# åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ\né¦–å…ˆæˆ‘ä»¬è¦äº†è§£çš„æ˜¯ï¼šåœ¨Goä¸­ï¼Œæ¯ä¸ªæŒ‡é’ˆéƒ½æœ‰2ä¸ªåŸºæœ¬ä¿¡æ¯ï¼ŒæŒ‡é’ˆçš„ç±»å‹å’ŒæŒ‡é’ˆçš„å€¼ï¼Œåç»­æˆ‘å°†ä¼šä½¿ç”¨`(type, value)`è¿™æ ·çš„å½¢å¼æ¥ä½“ç°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ`a := nil`è¿™æ ·çš„ä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ï¼Œå› ä¸ºå®ƒç¼ºå¤±äº†`type`ï¼Œæ‰€ä»¥éœ€è¦è¿™æ ·`var a *int = nil`ã€‚\næˆ‘ä»¬å¯ä»¥åœ¨fmtä¸­è¾“å‡ºè¿™äº›æŒ‡é’ˆçš„`type`ï¼š\n```go\nvar a *int = nil\nvar b interface{} = nil\n\nfmt.Printf(\"a.type:%T\\n\", a) // a.type:*int\nfmt.Printf(\"b.type:%T\\n\", b) // b.type:<nil>\n```\næˆ‘ä»¬ç°åœ¨å·²ç»äº†è§£äº†`interace{}`çš„é»˜è®¤`type`ä¸º`nil`ï¼Œä¸‹é¢æˆ‘ä»¬ä¸ä½¿ç”¨ç¡¬ç¼–ç çš„æ–¹å¼ï¼Œè€Œæ˜¯å°†`a`ä¼ é€’ç»™`b`ï¼Œç„¶åå†æ¥çœ‹ä¸‹ç»“æœï¼š\n```go\nvar a *int = nil\nvar b interface{} = a\n\nfmt.Printf(\"a.type:%T\\n\", a) // a.type:*int\nfmt.Printf(\"b.type:%T\\n\", b) // b.type:*int\n```\nä¹Ÿå°±æ˜¯è¯´ï¼Œ`b`ç°åœ¨æœ‰äº†ä¸€ä¸ªæ–°çš„ç±»å‹`*int`ã€‚ç›®å‰ä½ å·²ç»äº†è§£äº†å…³äºç±»å‹çš„ä¸€äº›åŸºæœ¬æœºåˆ¶ï¼Œä½†è¿˜æœ‰ä¸€äº›é—®é¢˜è¿˜æ²¡æœ‰è¢«è§£ç­”.\n\n# å½“æ‰§è¡Œ`==`æ—¶ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ\n```go\nvar a *int = nil\nvar b interface{} = nil\n\nfmt.Printf(\"a=(%T, %v)\\n\", a, a)\nfmt.Printf(\"b=(%T, %v)\\n\", b, b)\nfmt.Println(\"a == nil:\", a == nil)\nfmt.Println(\"b == nil:\", b == nil)\nfmt.Println(\"a == b:\", a == b)\n```\nç»“æœï¼š\n```\na=(*int, <nil>)\nb=(<nil>, <nil>)\na == nil: true\nb == nil: true\na == b: false\n```\nè¿™æ®µä»£ç ä¹ä¸€çœ‹ä¼¼ä¹ä¸å¯èƒ½ï¼Œåƒæ˜¯åœ¨è¯´ï¼ša==nilã€b==nilï¼Œä½†a!=bã€‚å®é™…æƒ…å†µæ˜¯ï¼Œç±»å‹åˆ¤æ–­ä¸ä»…ä»…åªåˆ¤æ–­äºŒè€…çš„å€¼ï¼Œè¿˜ä¼šåˆ¤æ–­å…¶ç±»å‹ã€‚\n```\na == nil // ç­‰ä»·äºï¼š(*int, nil) == (*int, nil)\nb == nil // ç­‰ä»·äºï¼š(nil, nil) == (nil, nil)\na == b   // ç­‰ä»·äºï¼š(*int, nil) == (nil, nil)\n```\nå½“æˆ‘ä»¬ç”¨è¿™æ ·çš„æ–¹å¼å†™å‡ºæ¥æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ˜“çš„æ˜ç™½ï¼Œa!=bæ˜¯æˆç«‹çš„ï¼Œä½†è¿™äº›ä¿¡æ¯å¹¶ä¸ä¼šåœ¨ä»£ç ä¸­ä½“ç°å‡ºæ¥ï¼Œè¿™ä¹Ÿæ­£æ˜¯å®¹æ˜“å‡ºç°è¯¯è§£çš„åœ°æ–¹ã€‚åœ¨è¿™é‡Œï¼Œå¦‚æœä½ æƒ³è¦åˆ¤æ–­äºŒè€…æ˜¯å¦éƒ½æ˜¯nilï¼Œä½ å¯ä»¥è¿™æ ·å†™\n```go\nif a == nil && b == nil {\n  // do something\n}\n```\næ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥çœ‹çœ‹å‰é¢é‚£ä¸ªä»¤äººå›°æƒ‘çš„ä¾‹å­ï¼Œç›¸å…³ç»“æœç›´æ¥è·Ÿåœ¨äº†ä»£ç åé¢\n```go\nvar a *int = nil\nvar b interface{} = a\n\nfmt.Printf(\"a=(%T, %v)\\n\", a, a)   // a=(*int, <nil>)\nfmt.Printf(\"b=(%T, %v)\\n\", b, b)   // b=(*int, <nil>)\nfmt.Println(\"a == nil:\", a == nil) // a == nil: true\nfmt.Println(\"b == nil:\", b == nil) // b == nil: false\nfmt.Println(\"a == b:\", a == b)     // a == b: true\n```\nç°åœ¨æˆ‘ä»¬å†æ¥çœ‹b==nilè¿™æ®µä»£ç ä¼šå‘ç°æ˜æœ—è®¸å¤šï¼š\n```go\nb == nil // ç­‰ä»·äºï¼š(*int, nil) == (nil, nil)\n```\nè¿™é‡Œå¯èƒ½ä¼šç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆç­‰å¼å³ä¾§çš„`nil`ï¼Œå…¶`type`ä¸º`nil`å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºå½“`b`æŒ‡å®šä¸º`interface{}`ç±»å‹çš„æ—¶å€™ï¼Œæ— æ³•ç¡®å®šå…¶çœŸå®çš„ç±»å‹ï¼Œéšç€ç¨‹åºçš„è¿è¡Œï¼Œå…¶ç±»å‹å¯èƒ½ä¼šä¸æ–­æ”¹å˜ï¼Œæ‰€ä»¥å…¶ç±»å‹é»˜è®¤ä¸º`nil`ã€‚\næ›´è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸ªç¡¬ç¼–ç çš„æ•°å­—æ˜¯å¦‚ä½•è¿›è¡Œæ¯”è¾ƒåˆ¤æ–­çš„ã€‚æ•°å­—ä¼šæ ¹æ®ä¸Šä¸‹æ–‡æ¥æ¨æ–­è‡ªå·±çš„ç±»å‹ï¼Œä¸€ä¸ªå…·ä½“çš„ä¾‹å­å¦‚ä¸‹ï¼š\n```go\nvar a int = 12\nvar b float64 = 12\nvar c interface{} = a\n\nfmt.Println(\"a==12:\", a == 12) // true  => (int, 12) == (int, 12)\nfmt.Println(\"b==12:\", b == 12) // true  => (float64, 12) == (float64, 12)\nfmt.Println(\"c==12:\", c == 12) // true  => (int, 12) == (int, 12)\nfmt.Println(\"a==c:\", a == c)   // true  => (int, 12) == (int, 12)\nfmt.Println(\"b==c:\", b == c)   // false => (float64, 12) == (int, 12)\n```\nä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹æ˜¯ï¼Œå½“`12`ä¸ä¸€ä¸ª`interface{}`è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œä¼šé»˜è®¤è½¬æ¢ä¸º`(int, 12)`ï¼Œç±»ä¼¼çš„`interface{}`ä¹Ÿä¼šè¢«å¼ºåˆ¶è½¬æ¢ä¸º`(nil, nil)`ï¼Œå¦‚ä¸‹ä»£ç å±•ç¤ºäº†è¿™ä¸ªè¿‡ç¨‹:\n```go\nvar b float64 = 12\nvar c interface{} = b\n\nfmt.Println(\"c==12:\", c == 12) // c==12: false\nfmt.Printf(\"c=(%T,%v)\\n\", c, c) // c=(float64,12)\nfmt.Printf(\"hard-coded=(%T,%v)\\n\", 12, 12) // hard-coded=(int,12)\n```\n\n# å›åˆ°æœ€å¼€å§‹çš„`nil`åˆ¤æ–­\nè®©æˆ‘ä»¬å›åˆ°æœ€å¼€å§‹å‡ºç°é—®é¢˜çš„ä»£ç ï¼Œç°åœ¨å†æ¥çœ‹ä¼šæ¸…æ™°è®¸å¤š\n```go\nfunc ToJSONString(i interface{}) string {\n   if i == nil {\n      return \"\"\n   }\n   bytes, _ := json.Marshal(i)\n   return string(bytes)\n}\n\nfunc TestToJSONString() {\n  // ...\n  var data *Data\n  a.Equal(\"\", ToJSONString(data))\n}\n```\nç¬¬2è¡Œä¸­ï¼Œ`i==nil`çš„åˆ¤æ–­ç›¸å½“äº`(*Data, nil) == (nil, nil)`ï¼Œæ˜¾è€Œæ˜“è§ï¼Œè¿™æ ·çš„ç­‰å¼å¹¶ä¸ä¼šæˆç«‹ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬æœ‰å…¶ä»–çš„åŠæ³•å¤„ç†è¿™æ ·çš„ç­‰å¼åˆ¤æ–­ï¼Œè¿™éœ€è¦ç”¨åˆ°`reflect`åŒ…ï¼Œå¦‚ä¸‹ï¼š\n```go\nfunc ToJSONString(i interface{}) string {\n   if i == nil || (reflect.ValueOf(i).Kind() == reflect.Ptr && reflect.ValueOf(i).IsNil()) {\n      return \"\"\n   }\n   bytes, _ := json.Marshal(i)\n   return string(bytes)\n}\n```\n","tags":["nil"],"categories":["Golang","åŸºç¡€"]},{"title":"Fabric-Idemixè¯´æ˜","url":"/2023/01/30/Fabric-Idemixè¯´æ˜/","content":"[æŠ„è‡ªè¿™ä¸ªé“¾æ¥](https://blog.csdn.net/ice_fire_x/article/details/104639727)\n# Idemixæ˜¯ä»€ä¹ˆ\nIdemix(Identity Mixer)çš„æ ¸å¿ƒæ˜¯é›¶çŸ¥è¯†è¯æ˜(Zero Knowledge Proof)ï¼Œç”¨æˆ·æ— éœ€æš´éœ²ç§æœ‰æ•°æ®ä»¥åŠä»»ä½•æœ‰ç”¨çš„ä¿¡æ¯ï¼Œä¹Ÿèƒ½è¯æ˜è‡ªå·±æ‹¥æœ‰è¿™äº›ç§æœ‰æ•°æ®ï¼Œå¯¹æ–¹èƒ½å¤Ÿè¿›è¡Œæœ‰æ•ˆéªŒè¯ï¼Œè¿™å°±æ˜¯é›¶çŸ¥è¯†è¯æ˜ã€‚\n\nIdemixæ˜¯ä¸€ä¸ªå¯†ç åè®®å¥—ä»¶(X.509+åŠ å¯†ç®—æ³•)ï¼Œä¿ç•™éšç§å®ç°åŒ¿åæ€§ï¼Œäº¤æ˜“æ—¶ä¸ç”¨é€éœ²äº¤æ˜“è€…çš„èº«ä»½ï¼Œè€Œä¸”äº¤æ˜“é—´æ˜¯æ— å…³è”çš„ï¼Œä¸å¯å¾€å‰è¿½æº¯ã€‚\n\nIdentityåŒ…å«ä¸‰ä¸ªè§’è‰²ï¼ŒåŒ…æ‹¬ç”¨æˆ·(User)ã€å‘è¡Œè€…(Issuer)ã€éªŒè¯è€…(Verifier)ï¼Œå„è‡ªä½œç”¨å¦‚ä¸‹ï¼š\n- ç”¨æˆ·ï¼šé€šè¿‡Idemixç”Ÿæˆä¸€ä¸ªproofï¼Œè¯æ˜è‡ªå·±çŸ¥é“æŸä¸ªç§˜å¯†\n- å‘è¡Œè€…ï¼š(Fabric CAæˆ–idemixgenå·¥å…·)éªŒè¯ç”¨æˆ·çš„éš¶å±å±æ€§ï¼Œç„¶åé¢å‘ä¸€ä¸ªè¯ä¹¦\n- éªŒè¯è€…ï¼š(fabric MSP)éªŒè¯proof\n![Identity Mixer Overview](Fabric-Idemixè¯´æ˜/Idemix-1.png)\n\n# Idemixçš„å®ç°\nFabricä¸­Peeré€šè¿‡Fabric CAè¿›è¡ŒEnrollã€Registerã€Revokeçš„æ“ä½œã€è¿˜å¯ä»¥é€šè¿‡Identity Mixerå¯¹äº¤æ˜“è¿›è¡Œç­¾åéªŒç­¾çš„æ“ä½œï¼›Identity Mixerå’ŒFabric CAéƒ½éœ€è¦è°ƒç”¨åŠ å¯†åŒ…è¿›è¡Œå…·ä½“çš„æµç¨‹ã€‚\n![å®ç°æµç¨‹](Fabric-Idemixè¯´æ˜/Idemix-2.png)\n\n## å¸¦æœ‰Identity Mixerçš„MSP\né™¤äº†X.509è¯ä¹¦å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡å‘è¡ŒIdemixå‡­æ®æ¥å®ç°MSPã€‚fabric MSPä½œä¸ºéªŒè¯è€…ï¼ˆVerifierï¼‰ï¼Œå‘è¡Œè€…ä¸ºç”¨æˆ·é¢å‘æ•°å­—è¯ä¹¦ï¼Œç”¨æˆ·ç”ŸæˆIdenmixå‡­æ®åå‘éªŒè¯è€…æä¾›proofï¼Œç”¨äºéªŒè¯å±æ€§æ˜¯å¦æ­£ç¡®ã€‚ç›®å‰Idemixå‡­æ®åªæ”¯æŒ3ä¸ªå±æ€§ï¼ŒåŒ…æ‹¬ï¼š\n- OU\n- isAdmin\n- Enrollment ID\n![Identity Mixer In Hyperledger Fabric](Fabric-Idemixè¯´æ˜/Idemix-3.png)\n\n# Idemixçš„ç‰¹æ€§\nIdemixä¸X.509çš„ç›¸åŒç‚¹ï¼š\n- ä¸€ç»„å±æ€§è¢«ç­¾åï¼Œä¸”ç­¾åä¸å¯ä¼ªé€ \n- å‡­è¯é€šè¿‡å¯†ç å­¦çš„æ–¹å¼ç»‘å®šåˆ°ä¸€ä¸ªå¯†é’¥\n\nIdemixä¸X.509çš„ä¸åŒç‚¹ï¼š\n- Idemixé€šè¿‡é›¶çŸ¥è¯†è¯æ˜æ¥ç¡®ä¿ä¸ä¼šæ³„éœ²çŸ¥è¯†æˆ–ä¿¡æ¯ï¼Œå¹¶ä¸”ç”¨æˆ·æ‹¥æœ‰å‡­è¯å¯†é’¥ï¼›è€ŒX.509é€šè¿‡æœ€åˆç­¾åçš„å…¬é’¥æ¥éªŒè¯ï¼ŒçŸ¥é“ç§é’¥çš„äººæ‰èƒ½ç”Ÿæˆè¯æ˜ï¼›\n- Idemixæ˜¯å„ä¸ªä¿¡æ¯é—´æ˜¯æ— å…³è”çš„ï¼Œä¸”ä¸å¯å¾€å›è¿½æº¯ï¼›è€ŒX.509æ˜¾ç¤ºæ‰€æœ‰å±æ€§ï¼Œå› æ­¤æ‰€æœ‰ç”¨äºç­¾å‘äº¤æ˜“çš„X.509è¯ä¹¦ä½¿ç”¨éƒ½æ˜¯å…³è”çš„ã€‚\n\n![ä¸¤è€…å¯¹æ¯”](Fabric-Idemixè¯´æ˜/Idemix-4.png)\nIdemixä¸X.509æ˜¯å¯ä»¥å…±å­˜çš„ï¼Œå¯ä»¥é€šè¿‡åœ¨configtx.yamé‡Œé¢æŒ‡å®šâ€œmsptype: idemixâ€æ¥æ”¯æŒIdemixï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n![é…ç½®æ”¯æŒIdemix](Fabric-Idemixè¯´æ˜/Idemix-5.png)\nIdemixä»ç„¶æœ‰ä¸€äº›å±€é™æ€§ï¼š\n\n- åªæ”¯æŒå›ºå®šçš„å±æ€§ï¼Œä¾‹å¦‚OUã€Role attributeã€Enrollment IDã€Revocation Handle attributeç­‰ï¼›\n- ä¸æ”¯æŒIdemixçš„æ’¤é”€\n- Peersè¿˜ä¸èƒ½ä½¿ç”¨Idemixæ¥è¿›è¡ŒèƒŒä¹¦ï¼Œç›®å‰Peersçš„Idemix MSPåªæ˜¯ç”¨æ¥éªŒè¯ç­¾åï¼ŒIdemixç­¾ååªèƒ½é€šè¿‡å®¢æˆ·ç«¯SDKæ¥è¿›è¡Œï¼›\n- å»ºè®®æ¯ä¸ªchannelæˆ–æ¯ä¸ªç½‘ç»œåªä½¿ç”¨ä¸€ä¸ªåŸºäºIdemixçš„MSPï¼Œå› ä¸ºIdemixå½“å‰ä»…æä¾›åŒä¸€ç»„ç»‡ï¼ˆMSPï¼‰ä¸­clientçš„åŒ¿åæ€§ã€‚","tags":["é›¶çŸ¥è¯†è¯æ˜"],"categories":["åŒºå—é“¾","Fabric"]},{"title":"Fabric-discoverè¯´æ˜","url":"/2023/01/29/Fabric-discoverè¯´æ˜/","content":"\n# å¼•è¨€\nå®¢æˆ·ç«¯è¦å¾€`Fabric`ç½‘ç»œä¸­å‘é€è¯·æ±‚ï¼Œé¦–å…ˆéœ€è¦çŸ¥é“ç½‘ç»œç½‘ç»œçš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚ç½‘ç»œä¸­æˆå‘˜ç»„ç»‡ä¿¡æ¯ã€èƒŒä¹¦èŠ‚ç‚¹çš„åœ°å€ã€é“¾ç å®‰è£…ä¿¡æ¯ç­‰ã€‚åœ¨`Fabric v1.2.0`ç‰ˆä¹‹å‰ï¼Œè¿™äº›ä¿¡æ¯éœ€è¦è°ƒç”¨è€…æ‰‹åŠ¨æŒ‡å®šï¼Œå®¹æ˜“å‡ºé”™ï¼›å¦å¤–ï¼Œå½“ç½‘ç»œä¸­ä¿¡æ¯å˜æ›´åï¼ˆå¦‚èŠ‚ç‚¹ä¸Šä¸‹çº¿ï¼‰è¿˜éœ€è¦å†æ¬¡æ›´æ–°ã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œç¤¾åŒºè‡ª`v1.2.0`ç‰ˆæœ¬å¼€å§‹åœ¨`Peer`èŠ‚ç‚¹ä¸Šæä¾›`Discovery gRPC`æœåŠ¡ï¼Œå¹¶ç¼–å†™äº†`discover`å®¢æˆ·ç«¯å·¥å…·ï¼ˆå…¥å£ä½äº`fabric/discovery/cmd/cmd.go`)ï¼ŒæŸ¥è¯¢`Discovery`æœåŠ¡è·å–æŒ‡å®šä¿¡æ¯ï¼ˆå¦‚é€šé“å†…çš„é‚»å±…èŠ‚ç‚¹ã€å¯å¯¹æŸé“¾ç è¿›è¡ŒèƒŒä¹¦çš„èŠ‚ç‚¹ç»„ï¼‰ã€‚\n\n# ä¸»è¦åŠŸèƒ½\n`discover`å·¥å…·ç›®å‰æä¾›å¦‚ä¸‹æŸ¥è¯¢åŠŸèƒ½ï¼š\n- èŠ‚ç‚¹ä¿¡æ¯ï¼Œä½¿ç”¨`peers`å­å‘½ä»¤æŸ¥è¯¢é€šé“å†…å„èŠ‚ç‚¹çš„`MSP ID`ã€`æœåŠ¡åœ°å€`å’Œ`è¯ä¹¦ç­‰ä¿¡æ¯`\n- é€šé“é…ç½®ï¼Œä½¿ç”¨`config`å­å‘½ä»¤æŸ¥è¯¢é€šé“çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬é€šé“å†…æˆå‘˜ç»„ç»‡çš„èº«ä»½ä¿¡æ¯ã€æ’åºæœåŠ¡ä¿¡æ¯ç­‰ã€‚\n- é“¾ç èƒŒä¹¦ä¿¡æ¯ï¼Œä½¿ç”¨`endorsers`å­å‘½ä»¤æŸ¥è¯¢å¯¹æŸä¸ªé“¾ç å¯ä»¥è¿›è¡ŒèƒŒä¹¦çš„èŠ‚ç‚¹ä¿¡æ¯ã€‚å‘½ä»¤ä½¿ç”¨æ ¼å¼ä¸ºï¼š\n  ```\n  discover [å…¨å±€å‚æ•°] <å­å‘½ä»¤> [å­å‘½ä»¤å‚æ•°åˆ—è¡¨]\n  ```\n  æ³¨æ„ï¼šèŠ‚ç‚¹ä¿¡æ¯å’Œé“¾ç èƒŒä¹¦ä¿¡æ¯æŸ¥è¯¢åŠŸèƒ½åœ¨é»˜è®¤æƒ…å†µä¸‹åªæ”¯æŒç»„ç»‡ç®¡ç†å‘˜ï¼Œå¦‚æœå¸Œæœ›æ™®é€šæˆå‘˜ä¹Ÿå¯ä»¥æŸ¥è¯¢ï¼Œéœ€è¦å¼€å¯`peer`é…ç½®ï¼Œ`core.yaml`ä¸­ï¼š\n  ```yaml\n  peer:\n    discovery:\n        orgMembersAllowedAccess: true\n  ```\n![å‘½ä»¤å¸®åŠ©](Fabric-discoverè¯´æ˜/cmd-help.jpg)\n\n# å…¨å±€å‚æ•°\n`discover`æ”¯æŒçš„å…¨å±€å‚æ•°å’Œç›¸å…³è¯´æ˜å¦‚ä¸‹ï¼š\n- --help, è¾“å‡ºå¸®åŠ©ä¿¡æ¯.\n- --configFile=CONFIGFILE, æŒ‡å®šä»é…ç½®æ–‡ä»¶ä¸­è½½å…¥å‚æ•°é…ç½®ï¼Œæ— é¡»ä»å‘½ä»¤è¡ŒæŒ‡å®šå‚æ•°\n- --peerTLSCA=PEERTLSCA, æŒ‡å®šæ ¡éªŒ`Peer`ç«¯TLSçš„CAè¯ä¹¦ã€‚\n- --tlsCert=TLSCERT, æŒ‡å®šå®¢æˆ·ç«¯ä½¿ç”¨çš„TLSè¯ä¹¦ï¼ˆå¯é€‰ï¼Œå½“`Peer`æ ¡éªŒå®¢æˆ·ç«¯TLSæ—¶ï¼‰ã€‚\n- --tlsKey=TLSKEY, æŒ‡å®šå®¢æˆ·ç«¯ä½¿ç”¨çš„TLSç§é’¥ï¼ˆå¯é€‰ï¼Œå½“`Peer`æ ¡éªŒå®¢æˆ·ç«¯TLSæ—¶ï¼‰ã€‚\n- --userKey=USERKEY, å®¢æˆ·ç«¯ç­¾åç§é’¥ã€‚\n- --userCert=USERCERT, å®¢æˆ·ç«¯ç­¾åè¯ä¹¦ã€‚\n- --MSP=MSP, æŒ‡å®šå®¢æˆ·ç«¯çš„`MSP ID`\n\n# peers å­å‘½ä»¤\næ˜¾ç¤ºé€šé“ä¸­çš„`peer`èŠ‚ç‚¹ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„`MSP ID`ã€`gRPCæœåŠ¡ç›‘å¬åœ°å€`å’Œ`èº«ä»½è¯ä¹¦`ã€‚ä¾‹å¦‚é€šè¿‡`peer0.org1.example.com`èŠ‚ç‚¹æŸ¥è¯¢`businesschannel`é€šé“å†…çš„`peer`èŠ‚ç‚¹ä¿¡æ¯ï¼š\n```shell\ndiscover peers \\\n    --channel businesschannel \\\n    --peerTLSCA /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/tlsca/tlsca.org1.example.com-cert.pem \\\n    --userKey /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin\\@org1.example.com/msp/keystore/priv_sk \\\n    --userCert /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin\\@org1.example.com/msp/signcerts/Admin@org1.example.com-cert.pem \\\n    --MSP Org1MSP --tlsCert /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin\\@org1.example.com/tls/client.crt \\\n    --tlsKey /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin\\@org1.example.com/tls/client.key \\\n    --server peer0.org1.example.com:7051\n```\næ­£å¸¸è¿”å›ç»“æœå¦‚ä¸‹ï¼š\n```json\n[\n\t{\n\t\t\"MSPID\": \"Org1MSP\",\n\t\t\"LedgerHeight\": 9,\n\t\t\"Endpoint\": \"peer0.org1.example.com:7051\",\n\t\t\"Identity\": \"-----BEGIN CERTIFICATE-----\\nMIICKDCCAc+gAwIBAgIRAIc6sjio0hnYI+sBuebcN9gwCgYIKoZIzj0EAwIwczEL\\nMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNhbGlmb3JuaWExFjAUBgNVBAcTDVNhbiBG\\ncmFuY2lzY28xGTAXBgNVBAoTEG9yZzEuZXhhbXBsZS5jb20xHDAaBgNVBAMTE2Nh\\nLm9yZzEuZXhhbXBsZS5jb20wHhcNMjIwMjE3MTAzMDAwWhcNMzIwMjE1MTAzMDAw\\nWjBqMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMN\\nU2FuIEZyYW5jaXNjbzENMAsGA1UECxMEcGVlcjEfMB0GA1UEAxMWcGVlcjAub3Jn\\nMS5leGFtcGxlLmNvbTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABEHhWvyNC5Pp\\noJmF9pZzdVkKrLcjhS3ePhEIW/53NrnqZUB5QT6NRvo+rxqpIxAjMMZTTg2OewJd\\ng/crbYls2GyjTTBLMA4GA1UdDwEB/wQEAwIHgDAMBgNVHRMBAf8EAjAAMCsGA1Ud\\nIwQkMCKAIGk9e22kEiVLy3ReWOlHBJklL9JCedP2QWQP/12fsPLuMAoGCCqGSM49\\nBAMCA0cAMEQCICVqogpr/tI+sNTy8EYbkuuek4gw5Y/bNNI5cTZJpefKAiB8Zr2o\\nx1r62J3DV5qmF2jEAVRV8duwliiAkKW4q1xcNA==\\n-----END CERTIFICATE-----\\n\",\n\t\t\"Chaincodes\": [\n\t\t\t\"hyperledger-fabric-contract-java-demo\",\n\t\t\t\"_lifecycle\"\n\t\t]\n\t},\n\t{\n\t\t\"MSPID\": \"Org1MSP\",\n\t\t\"LedgerHeight\": 9,\n\t\t\"Endpoint\": \"peer1.org1.example.com:8051\",\n\t\t\"Identity\": \"-----BEGIN CERTIFICATE-----\\nMIICKDCCAc6gAwIBAgIQYSi1/xYV9ghavadHl49VMDAKBggqhkjOPQQDAjBzMQsw\\nCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMNU2FuIEZy\\nYW5jaXNjbzEZMBcGA1UEChMQb3JnMS5leGFtcGxlLmNvbTEcMBoGA1UEAxMTY2Eu\\nb3JnMS5leGFtcGxlLmNvbTAeFw0yMjAyMTcxMDMwMDBaFw0zMjAyMTUxMDMwMDBa\\nMGoxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRYwFAYDVQQHEw1T\\nYW4gRnJhbmNpc2NvMQ0wCwYDVQQLEwRwZWVyMR8wHQYDVQQDExZwZWVyMS5vcmcx\\nLmV4YW1wbGUuY29tMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEp42mYDwJKY11\\nntYoyWAwXtIyJiWH/9EB93jVPsFALzicKbibE1vSZlGl1mkb7M5wYCtfai11Bqqz\\nUFEz7e+DsqNNMEswDgYDVR0PAQH/BAQDAgeAMAwGA1UdEwEB/wQCMAAwKwYDVR0j\\nBCQwIoAgaT17baQSJUvLdF5Y6UcEmSUv0kJ50/ZBZA//XZ+w8u4wCgYIKoZIzj0E\\nAwIDSAAwRQIhAP+WvJIfhdpG/zkc1GrlTwZOppc0JZL9Nl0MfhJ4TMpiAiAfJ8kF\\njJeEYOonkKeZcRG77WoeB/+32BCUJNsSIwYyKA==\\n-----END CERTIFICATE-----\\n\",\n\t\t\"Chaincodes\": [\n\t\t\t\"hyperledger-fabric-contract-java-demo\",\n\t\t\t\"_lifecycle\"\n\t\t]\n\t},\n\t{\n\t\t\"MSPID\": \"Org2MSP\",\n\t\t\"LedgerHeight\": 9,\n\t\t\"Endpoint\": \"peer0.org2.example.com:7051\",\n\t\t\"Identity\": \"-----BEGIN CERTIFICATE-----\\nMIICKTCCAc+gAwIBAgIRAJnk+wcTIbag0SNs4f2TAeIwCgYIKoZIzj0EAwIwczEL\\nMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNhbGlmb3JuaWExFjAUBgNVBAcTDVNhbiBG\\ncmFuY2lzY28xGTAXBgNVBAoTEG9yZzIuZXhhbXBsZS5jb20xHDAaBgNVBAMTE2Nh\\nLm9yZzIuZXhhbXBsZS5jb20wHhcNMjIwMjE3MTAzMDAwWhcNMzIwMjE1MTAzMDAw\\nWjBqMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMN\\nU2FuIEZyYW5jaXNjbzENMAsGA1UECxMEcGVlcjEfMB0GA1UEAxMWcGVlcjAub3Jn\\nMi5leGFtcGxlLmNvbTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABKtm2wfuhEqm\\nht8CqbV1CKAe7YRAao5ySPMCCswpXuX3Amw65L0pFLELhhFHvqoTmwTZOLNHeHCl\\nJoDQgoM5DUyjTTBLMA4GA1UdDwEB/wQEAwIHgDAMBgNVHRMBAf8EAjAAMCsGA1Ud\\nIwQkMCKAINRek9OkgUPYeL4655/hNDSGXlXS/7qqtIzG+9yf2LG2MAoGCCqGSM49\\nBAMCA0gAMEUCIQCB9+ASmx0BgYaN30Zeq+z3Gtj/q1yqrae2bD0dJspbMwIgcAFC\\nx9CQ52jYET7PbIqJOGPksb8amAPUAJXBOIxVJ7U=\\n-----END CERTIFICATE-----\\n\",\n\t\t\"Chaincodes\": [\n\t\t\t\"hyperledger-fabric-contract-java-demo\",\n\t\t\t\"_lifecycle\"\n\t\t]\n\t},\n\t{\n\t\t\"MSPID\": \"Org2MSP\",\n\t\t\"LedgerHeight\": 9,\n\t\t\"Endpoint\": \"peer1.org2.example.com:8051\",\n\t\t\"Identity\": \"-----BEGIN CERTIFICATE-----\\nMIICKDCCAc+gAwIBAgIRAMV4swH5jaaH+rQ13cBAzcwwCgYIKoZIzj0EAwIwczEL\\nMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNhbGlmb3JuaWExFjAUBgNVBAcTDVNhbiBG\\ncmFuY2lzY28xGTAXBgNVBAoTEG9yZzIuZXhhbXBsZS5jb20xHDAaBgNVBAMTE2Nh\\nLm9yZzIuZXhhbXBsZS5jb20wHhcNMjIwMjE3MTAzMDAwWhcNMzIwMjE1MTAzMDAw\\nWjBqMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMN\\nU2FuIEZyYW5jaXNjbzENMAsGA1UECxMEcGVlcjEfMB0GA1UEAxMWcGVlcjEub3Jn\\nMi5leGFtcGxlLmNvbTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABJQ2FIGAqO2J\\ngR9LzplbIGt2OXCHklyoQzl/o8OubrAy0hc88KqCFJQeH9gynDDrZM8eSyrlNWTO\\nf6ZXcoMMRbejTTBLMA4GA1UdDwEB/wQEAwIHgDAMBgNVHRMBAf8EAjAAMCsGA1Ud\\nIwQkMCKAINRek9OkgUPYeL4655/hNDSGXlXS/7qqtIzG+9yf2LG2MAoGCCqGSM49\\nBAMCA0cAMEQCICAY5hjEBFmhjJgOPNZx7oJIh5YlhPPMPuVnofwXR4ZCAiAVnOzZ\\nGzUNe7WFYhT4L2l7xLPl51FjigMoLYjG2Jt+ng==\\n-----END CERTIFICATE-----\\n\",\n\t\t\"Chaincodes\": [\n\t\t\t\"hyperledger-fabric-contract-java-demo\",\n\t\t\t\"_lifecycle\"\n\t\t]\n\t}\n]\n```\n\n# config å­å‘½ä»¤\næ˜¾ç¤ºç½‘ç»œä¸­çš„é€šé“é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬å„ä¸ªç»„ç»‡çš„`MSP`ä¿¡æ¯å’Œæ’åºèŠ‚ç‚¹ä¿¡æ¯ã€‚ä¾‹å¦‚é€šè¿‡`peer0.org1.example.com`èŠ‚ç‚¹æŸ¥è¯¢`businesschannel`é€šé“å†…çš„é…ç½®ä¿¡æ¯ï¼Œå¯ä»¥æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\n```shell\ndiscover config \\\n--channel businesschannel \\\n--peerTLSCA /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/tlsca/tlsca.org1.example.com-cert.pem \\\n--userKey /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin\\@org1.example.com/msp/keystore/priv_sk \\\n--userCert /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin\\@org1.example.com/msp/signcerts/Admin@org1.example.com-cert.pem \\\n--MSP Org1MSP --tlsCert /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin\\@org1.example.com/tls/client.crt \\\n--tlsKey /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin\\@org1.example.com/tls/client.key \\\n--server peer0.org1.example.com:7051\n```\næ­£å¸¸è¿”å›ç»“æœå¦‚ä¸‹ï¼š\n```json\n{\n\t\"msps\": {\n\t\t\"OrdererMSP\": {\n\t\t\t\"name\": \"OrdererMSP\",\n\t\t\t\"root_certs\": [\n\t\t\t\t\"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNQVENDQWVTZ0F3SUJBZ0lSQU53NEdYbDlIMmE0S2hKdzM4TzlhWHd3Q2dZSUtvWkl6ajBFQXdJd2FURUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhGREFTQmdOVkJBb1RDMlY0WVcxd2JHVXVZMjl0TVJjd0ZRWURWUVFERXc1allTNWxlR0Z0CmNHeGxMbU52YlRBZUZ3MHlNakF5TVRjeE1ETXdNREJhRncwek1qQXlNVFV4TURNd01EQmFNR2t4Q3pBSkJnTlYKQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVFlXNGdSbkpoYm1OcApjMk52TVJRd0VnWURWUVFLRXd0bGVHRnRjR3hsTG1OdmJURVhNQlVHQTFVRUF4TU9ZMkV1WlhoaGJYQnNaUzVqCmIyMHdXVEFUQmdjcWhrak9QUUlCQmdncWhrak9QUU1CQndOQ0FBUzdMSWppODVNTVVscGo0bTd6ZW1RZU9TS2EKTnBFWHA3bEF1R3Ryb3ZSMUIwMTVBRzZ4aTFCcCtCRVJNUjZTZXpVV2pGRDlKWHJqWHVJRXc0R0o5YjZZbzIwdwphekFPQmdOVkhROEJBZjhFQkFNQ0FhWXdIUVlEVlIwbEJCWXdGQVlJS3dZQkJRVUhBd0lHQ0NzR0FRVUZCd01CCk1BOEdBMVVkRXdFQi93UUZNQU1CQWY4d0tRWURWUjBPQkNJRUlJSlJGclVMcnQxdk5GQmJORG5OR2RZSkNGSmEKMkdVK0VLbVpEd1ZkVzBLNU1Bb0dDQ3FHU000OUJBTUNBMGNBTUVRQ0lCdnZ6ekhtVW5aUExiWStNYWdDcGhGOApINjJRcnpmSkxnTHZXQmFaaW5LeEFpQlZxQkZWMVBValFoS09RbEVnbzcxeE1HVXlLNHEvbHAwNGF2empXVjY0CmRRPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\"\n\t\t\t],\n\t\t\t\"crypto_config\": {\n\t\t\t\t\"signature_hash_family\": \"SHA2\",\n\t\t\t\t\"identity_identifier_hash_function\": \"SHA256\"\n\t\t\t},\n\t\t\t\"tls_root_certs\": [\n\t\t\t\t\"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNSRENDQWVxZ0F3SUJBZ0lSQUs4eXNvYjliUmNJRGJyVjJVZjdFTDh3Q2dZSUtvWkl6ajBFQXdJd2JERUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhGREFTQmdOVkJBb1RDMlY0WVcxd2JHVXVZMjl0TVJvd0dBWURWUVFERXhGMGJITmpZUzVsCmVHRnRjR3hsTG1OdmJUQWVGdzB5TWpBeU1UY3hNRE13TURCYUZ3MHpNakF5TVRVeE1ETXdNREJhTUd3eEN6QUoKQmdOVkJBWVRBbFZUTVJNd0VRWURWUVFJRXdwRFlXeHBabTl5Ym1saE1SWXdGQVlEVlFRSEV3MVRZVzRnUm5KaApibU5wYzJOdk1SUXdFZ1lEVlFRS0V3dGxlR0Z0Y0d4bExtTnZiVEVhTUJnR0ExVUVBeE1SZEd4elkyRXVaWGhoCmJYQnNaUzVqYjIwd1dUQVRCZ2NxaGtqT1BRSUJCZ2dxaGtqT1BRTUJCd05DQUFSSlRjKzArcU9RNjU2WkEwanoKVEZWNnRVSkloaWJJbjhxekY5dzduNlpOZkMvaUVjUGI5NmJaMFA2UTZjWGw4SGpySG1qOG9BOVhVUW9LNVc3UgpBU0NlbzIwd2F6QU9CZ05WSFE4QkFmOEVCQU1DQWFZd0hRWURWUjBsQkJZd0ZBWUlLd1lCQlFVSEF3SUdDQ3NHCkFRVUZCd01CTUE4R0ExVWRFd0VCL3dRRk1BTUJBZjh3S1FZRFZSME9CQ0lFSU5iQ0ZOcy9wUXRQSllZU1RvYkYKRjdnTThIa0o5SFhlL3dGeXFMbHh1YU1yTUFvR0NDcUdTTTQ5QkFNQ0EwZ0FNRVVDSVFDMG9Pdjh6YU95T1JYTApzVFp2VnFUclIrNzBvcTVzRGZNNHNsSStyTE5nM0FJZ01SZjRpUFY2MDFwa2E3ZnpUOUdpTHZmN0hsUWRDZnhDClN3ZC9xRFh4ZElVPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==\"\n\t\t\t],\n\t\t\t\"fabric_node_ous\": {\n\t\t\t\t\"enable\": true,\n\t\t\t\t\"client_ou_identifier\": {\n\t\t\t\t\t\"certificate\": \"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNQVENDQWVTZ0F3SUJBZ0lSQU53NEdYbDlIMmE0S2hKdzM4TzlhWHd3Q2dZSUtvWkl6ajBFQXdJd2FURUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhGREFTQmdOVkJBb1RDMlY0WVcxd2JHVXVZMjl0TVJjd0ZRWURWUVFERXc1allTNWxlR0Z0CmNHeGxMbU52YlRBZUZ3MHlNakF5TVRjeE1ETXdNREJhRncwek1qQXlNVFV4TURNd01EQmFNR2t4Q3pBSkJnTlYKQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVFlXNGdSbkpoYm1OcApjMk52TVJRd0VnWURWUVFLRXd0bGVHRnRjR3hsTG1OdmJURVhNQlVHQTFVRUF4TU9ZMkV1WlhoaGJYQnNaUzVqCmIyMHdXVEFUQmdjcWhrak9QUUlCQmdncWhrak9QUU1CQndOQ0FBUzdMSWppODVNTVVscGo0bTd6ZW1RZU9TS2EKTnBFWHA3bEF1R3Ryb3ZSMUIwMTVBRzZ4aTFCcCtCRVJNUjZTZXpVV2pGRDlKWHJqWHVJRXc0R0o5YjZZbzIwdwphekFPQmdOVkhROEJBZjhFQkFNQ0FhWXdIUVlEVlIwbEJCWXdGQVlJS3dZQkJRVUhBd0lHQ0NzR0FRVUZCd01CCk1BOEdBMVVkRXdFQi93UUZNQU1CQWY4d0tRWURWUjBPQkNJRUlJSlJGclVMcnQxdk5GQmJORG5OR2RZSkNGSmEKMkdVK0VLbVpEd1ZkVzBLNU1Bb0dDQ3FHU000OUJBTUNBMGNBTUVRQ0lCdnZ6ekhtVW5aUExiWStNYWdDcGhGOApINjJRcnpmSkxnTHZXQmFaaW5LeEFpQlZxQkZWMVBValFoS09RbEVnbzcxeE1HVXlLNHEvbHAwNGF2empXVjY0CmRRPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\",\n\t\t\t\t\t\"organizational_unit_identifier\": \"client\"\n\t\t\t\t},\n\t\t\t\t\"peer_ou_identifier\": {\n\t\t\t\t\t\"certificate\": \"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNQVENDQWVTZ0F3SUJBZ0lSQU53NEdYbDlIMmE0S2hKdzM4TzlhWHd3Q2dZSUtvWkl6ajBFQXdJd2FURUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhGREFTQmdOVkJBb1RDMlY0WVcxd2JHVXVZMjl0TVJjd0ZRWURWUVFERXc1allTNWxlR0Z0CmNHeGxMbU52YlRBZUZ3MHlNakF5TVRjeE1ETXdNREJhRncwek1qQXlNVFV4TURNd01EQmFNR2t4Q3pBSkJnTlYKQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVFlXNGdSbkpoYm1OcApjMk52TVJRd0VnWURWUVFLRXd0bGVHRnRjR3hsTG1OdmJURVhNQlVHQTFVRUF4TU9ZMkV1WlhoaGJYQnNaUzVqCmIyMHdXVEFUQmdjcWhrak9QUUlCQmdncWhrak9QUU1CQndOQ0FBUzdMSWppODVNTVVscGo0bTd6ZW1RZU9TS2EKTnBFWHA3bEF1R3Ryb3ZSMUIwMTVBRzZ4aTFCcCtCRVJNUjZTZXpVV2pGRDlKWHJqWHVJRXc0R0o5YjZZbzIwdwphekFPQmdOVkhROEJBZjhFQkFNQ0FhWXdIUVlEVlIwbEJCWXdGQVlJS3dZQkJRVUhBd0lHQ0NzR0FRVUZCd01CCk1BOEdBMVVkRXdFQi93UUZNQU1CQWY4d0tRWURWUjBPQkNJRUlJSlJGclVMcnQxdk5GQmJORG5OR2RZSkNGSmEKMkdVK0VLbVpEd1ZkVzBLNU1Bb0dDQ3FHU000OUJBTUNBMGNBTUVRQ0lCdnZ6ekhtVW5aUExiWStNYWdDcGhGOApINjJRcnpmSkxnTHZXQmFaaW5LeEFpQlZxQkZWMVBValFoS09RbEVnbzcxeE1HVXlLNHEvbHAwNGF2empXVjY0CmRRPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\",\n\t\t\t\t\t\"organizational_unit_identifier\": \"peer\"\n\t\t\t\t},\n\t\t\t\t\"admin_ou_identifier\": {\n\t\t\t\t\t\"certificate\": \"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNQVENDQWVTZ0F3SUJBZ0lSQU53NEdYbDlIMmE0S2hKdzM4TzlhWHd3Q2dZSUtvWkl6ajBFQXdJd2FURUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhGREFTQmdOVkJBb1RDMlY0WVcxd2JHVXVZMjl0TVJjd0ZRWURWUVFERXc1allTNWxlR0Z0CmNHeGxMbU52YlRBZUZ3MHlNakF5TVRjeE1ETXdNREJhRncwek1qQXlNVFV4TURNd01EQmFNR2t4Q3pBSkJnTlYKQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVFlXNGdSbkpoYm1OcApjMk52TVJRd0VnWURWUVFLRXd0bGVHRnRjR3hsTG1OdmJURVhNQlVHQTFVRUF4TU9ZMkV1WlhoaGJYQnNaUzVqCmIyMHdXVEFUQmdjcWhrak9QUUlCQmdncWhrak9QUU1CQndOQ0FBUzdMSWppODVNTVVscGo0bTd6ZW1RZU9TS2EKTnBFWHA3bEF1R3Ryb3ZSMUIwMTVBRzZ4aTFCcCtCRVJNUjZTZXpVV2pGRDlKWHJqWHVJRXc0R0o5YjZZbzIwdwphekFPQmdOVkhROEJBZjhFQkFNQ0FhWXdIUVlEVlIwbEJCWXdGQVlJS3dZQkJRVUhBd0lHQ0NzR0FRVUZCd01CCk1BOEdBMVVkRXdFQi93UUZNQU1CQWY4d0tRWURWUjBPQkNJRUlJSlJGclVMcnQxdk5GQmJORG5OR2RZSkNGSmEKMkdVK0VLbVpEd1ZkVzBLNU1Bb0dDQ3FHU000OUJBTUNBMGNBTUVRQ0lCdnZ6ekhtVW5aUExiWStNYWdDcGhGOApINjJRcnpmSkxnTHZXQmFaaW5LeEFpQlZxQkZWMVBValFoS09RbEVnbzcxeE1HVXlLNHEvbHAwNGF2empXVjY0CmRRPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\",\n\t\t\t\t\t\"organizational_unit_identifier\": \"admin\"\n\t\t\t\t},\n\t\t\t\t\"orderer_ou_identifier\": {\n\t\t\t\t\t\"certificate\": \"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNQVENDQWVTZ0F3SUJBZ0lSQU53NEdYbDlIMmE0S2hKdzM4TzlhWHd3Q2dZSUtvWkl6ajBFQXdJd2FURUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhGREFTQmdOVkJBb1RDMlY0WVcxd2JHVXVZMjl0TVJjd0ZRWURWUVFERXc1allTNWxlR0Z0CmNHeGxMbU52YlRBZUZ3MHlNakF5TVRjeE1ETXdNREJhRncwek1qQXlNVFV4TURNd01EQmFNR2t4Q3pBSkJnTlYKQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVFlXNGdSbkpoYm1OcApjMk52TVJRd0VnWURWUVFLRXd0bGVHRnRjR3hsTG1OdmJURVhNQlVHQTFVRUF4TU9ZMkV1WlhoaGJYQnNaUzVqCmIyMHdXVEFUQmdjcWhrak9QUUlCQmdncWhrak9QUU1CQndOQ0FBUzdMSWppODVNTVVscGo0bTd6ZW1RZU9TS2EKTnBFWHA3bEF1R3Ryb3ZSMUIwMTVBRzZ4aTFCcCtCRVJNUjZTZXpVV2pGRDlKWHJqWHVJRXc0R0o5YjZZbzIwdwphekFPQmdOVkhROEJBZjhFQkFNQ0FhWXdIUVlEVlIwbEJCWXdGQVlJS3dZQkJRVUhBd0lHQ0NzR0FRVUZCd01CCk1BOEdBMVVkRXdFQi93UUZNQU1CQWY4d0tRWURWUjBPQkNJRUlJSlJGclVMcnQxdk5GQmJORG5OR2RZSkNGSmEKMkdVK0VLbVpEd1ZkVzBLNU1Bb0dDQ3FHU000OUJBTUNBMGNBTUVRQ0lCdnZ6ekhtVW5aUExiWStNYWdDcGhGOApINjJRcnpmSkxnTHZXQmFaaW5LeEFpQlZxQkZWMVBValFoS09RbEVnbzcxeE1HVXlLNHEvbHAwNGF2empXVjY0CmRRPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\",\n\t\t\t\t\t\"organizational_unit_identifier\": \"orderer\"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"Org1MSP\": {\n\t\t\t\"name\": \"Org1MSP\",\n\t\t\t\"root_certs\": [\n\t\t\t\t\"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVekNDQWZpZ0F3SUJBZ0lSQU9wamxIMFRsLzlteXYrSWZzRGVSSnN3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpFdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekV1WlhoaGJYQnNaUzVqYjIwd0hoY05Nakl3TWpFM01UQXpNREF3V2hjTk16SXdNakUxTVRBek1EQXcKV2pCek1Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFWk1CY0dBMVVFQ2hNUWIzSm5NUzVsZUdGdGNHeGxMbU52YlRFY01Cb0dBMVVFCkF4TVRZMkV1YjNKbk1TNWxlR0Z0Y0d4bExtTnZiVEJaTUJNR0J5cUdTTTQ5QWdFR0NDcUdTTTQ5QXdFSEEwSUEKQkVoVGc2cFRtZ214QnExM0VvRmx5SGozeWd5em9ydWZQb1J3MjlXUVdUNFluMFhTZnNmT1RUZHZRKzJlRThxSgo5WHNVenFmKzVkc2Y4dDF4SFpmR2wxU2piVEJyTUE0R0ExVWREd0VCL3dRRUF3SUJwakFkQmdOVkhTVUVGakFVCkJnZ3JCZ0VGQlFjREFnWUlLd1lCQlFVSEF3RXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QXBCZ05WSFE0RUlnUWcKYVQxN2JhUVNKVXZMZEY1WTZVY0VtU1V2MGtKNTAvWkJaQS8vWFordzh1NHdDZ1lJS29aSXpqMEVBd0lEU1FBdwpSZ0loQU5lRzUzL3hxMHZHTXpaaVVwWG9RZGwySGZFeU9pVXl3bG43c3AvY0hTOGxBaUVBa3dWN09GckhOTnZECkJUT2szVnVneWxwcytOdWxXTGpOU0hXWTB2NTZaZDA9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K\"\n\t\t\t],\n\t\t\t\"crypto_config\": {\n\t\t\t\t\"signature_hash_family\": \"SHA2\",\n\t\t\t\t\"identity_identifier_hash_function\": \"SHA256\"\n\t\t\t},\n\t\t\t\"tls_root_certs\": [\n\t\t\t\t\"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNWekNDQWYyZ0F3SUJBZ0lRTGUwVEFISlZGaW0zUXB0OGJQSUhFREFLQmdncWhrak9QUVFEQWpCMk1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTVM1bGVHRnRjR3hsTG1OdmJURWZNQjBHQTFVRUF4TVdkR3h6ClkyRXViM0puTVM1bGVHRnRjR3hsTG1OdmJUQWVGdzB5TWpBeU1UY3hNRE13TURCYUZ3MHpNakF5TVRVeE1ETXcKTURCYU1IWXhDekFKQmdOVkJBWVRBbFZUTVJNd0VRWURWUVFJRXdwRFlXeHBabTl5Ym1saE1SWXdGQVlEVlFRSApFdzFUWVc0Z1JuSmhibU5wYzJOdk1Sa3dGd1lEVlFRS0V4QnZjbWN4TG1WNFlXMXdiR1V1WTI5dE1SOHdIUVlEClZRUURFeFowYkhOallTNXZjbWN4TG1WNFlXMXdiR1V1WTI5dE1Ga3dFd1lIS29aSXpqMENBUVlJS29aSXpqMEQKQVFjRFFnQUV0OWg1T3VpZlVZekdyN21YcnFSQUJMRDVXTWVJQnUzKzlCcFJsOUhtbnRaSnR1a2JpS0IwbDdkdApvcTROYmVHM1NSRmNvUDFodlI5L1NuZjF2Ny81LzZOdE1Hc3dEZ1lEVlIwUEFRSC9CQVFEQWdHbU1CMEdBMVVkCkpRUVdNQlFHQ0NzR0FRVUZCd01DQmdnckJnRUZCUWNEQVRBUEJnTlZIUk1CQWY4RUJUQURBUUgvTUNrR0ExVWQKRGdRaUJDQjhXckdseUQydUVuZmJjcW50SnBxUzFDTXZ5aHRUYlFpOUVYb0ZIdFBkUnpBS0JnZ3Foa2pPUFFRRApBZ05JQURCRkFpRUFvZzVPY29jVGs1eGFmU2hmMjAzUzJSU2JXNm1xZldhWXZFWC80RjdEUnlBQ0lDaExueHNTCjZPMGJJZm1BbUVQaERFV0E4TTM2M1RkbWpQQTBCbCtXb2lwTQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==\"\n\t\t\t],\n\t\t\t\"fabric_node_ous\": {\n\t\t\t\t\"enable\": true,\n\t\t\t\t\"client_ou_identifier\": {\n\t\t\t\t\t\"certificate\": \"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVekNDQWZpZ0F3SUJBZ0lSQU9wamxIMFRsLzlteXYrSWZzRGVSSnN3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpFdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekV1WlhoaGJYQnNaUzVqYjIwd0hoY05Nakl3TWpFM01UQXpNREF3V2hjTk16SXdNakUxTVRBek1EQXcKV2pCek1Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFWk1CY0dBMVVFQ2hNUWIzSm5NUzVsZUdGdGNHeGxMbU52YlRFY01Cb0dBMVVFCkF4TVRZMkV1YjNKbk1TNWxlR0Z0Y0d4bExtTnZiVEJaTUJNR0J5cUdTTTQ5QWdFR0NDcUdTTTQ5QXdFSEEwSUEKQkVoVGc2cFRtZ214QnExM0VvRmx5SGozeWd5em9ydWZQb1J3MjlXUVdUNFluMFhTZnNmT1RUZHZRKzJlRThxSgo5WHNVenFmKzVkc2Y4dDF4SFpmR2wxU2piVEJyTUE0R0ExVWREd0VCL3dRRUF3SUJwakFkQmdOVkhTVUVGakFVCkJnZ3JCZ0VGQlFjREFnWUlLd1lCQlFVSEF3RXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QXBCZ05WSFE0RUlnUWcKYVQxN2JhUVNKVXZMZEY1WTZVY0VtU1V2MGtKNTAvWkJaQS8vWFordzh1NHdDZ1lJS29aSXpqMEVBd0lEU1FBdwpSZ0loQU5lRzUzL3hxMHZHTXpaaVVwWG9RZGwySGZFeU9pVXl3bG43c3AvY0hTOGxBaUVBa3dWN09GckhOTnZECkJUT2szVnVneWxwcytOdWxXTGpOU0hXWTB2NTZaZDA9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K\",\n\t\t\t\t\t\"organizational_unit_identifier\": \"client\"\n\t\t\t\t},\n\t\t\t\t\"peer_ou_identifier\": {\n\t\t\t\t\t\"certificate\": \"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVekNDQWZpZ0F3SUJBZ0lSQU9wamxIMFRsLzlteXYrSWZzRGVSSnN3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpFdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekV1WlhoaGJYQnNaUzVqYjIwd0hoY05Nakl3TWpFM01UQXpNREF3V2hjTk16SXdNakUxTVRBek1EQXcKV2pCek1Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFWk1CY0dBMVVFQ2hNUWIzSm5NUzVsZUdGdGNHeGxMbU52YlRFY01Cb0dBMVVFCkF4TVRZMkV1YjNKbk1TNWxlR0Z0Y0d4bExtTnZiVEJaTUJNR0J5cUdTTTQ5QWdFR0NDcUdTTTQ5QXdFSEEwSUEKQkVoVGc2cFRtZ214QnExM0VvRmx5SGozeWd5em9ydWZQb1J3MjlXUVdUNFluMFhTZnNmT1RUZHZRKzJlRThxSgo5WHNVenFmKzVkc2Y4dDF4SFpmR2wxU2piVEJyTUE0R0ExVWREd0VCL3dRRUF3SUJwakFkQmdOVkhTVUVGakFVCkJnZ3JCZ0VGQlFjREFnWUlLd1lCQlFVSEF3RXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QXBCZ05WSFE0RUlnUWcKYVQxN2JhUVNKVXZMZEY1WTZVY0VtU1V2MGtKNTAvWkJaQS8vWFordzh1NHdDZ1lJS29aSXpqMEVBd0lEU1FBdwpSZ0loQU5lRzUzL3hxMHZHTXpaaVVwWG9RZGwySGZFeU9pVXl3bG43c3AvY0hTOGxBaUVBa3dWN09GckhOTnZECkJUT2szVnVneWxwcytOdWxXTGpOU0hXWTB2NTZaZDA9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K\",\n\t\t\t\t\t\"organizational_unit_identifier\": \"peer\"\n\t\t\t\t},\n\t\t\t\t\"admin_ou_identifier\": {\n\t\t\t\t\t\"certificate\": \"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVekNDQWZpZ0F3SUJBZ0lSQU9wamxIMFRsLzlteXYrSWZzRGVSSnN3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpFdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekV1WlhoaGJYQnNaUzVqYjIwd0hoY05Nakl3TWpFM01UQXpNREF3V2hjTk16SXdNakUxTVRBek1EQXcKV2pCek1Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFWk1CY0dBMVVFQ2hNUWIzSm5NUzVsZUdGdGNHeGxMbU52YlRFY01Cb0dBMVVFCkF4TVRZMkV1YjNKbk1TNWxlR0Z0Y0d4bExtTnZiVEJaTUJNR0J5cUdTTTQ5QWdFR0NDcUdTTTQ5QXdFSEEwSUEKQkVoVGc2cFRtZ214QnExM0VvRmx5SGozeWd5em9ydWZQb1J3MjlXUVdUNFluMFhTZnNmT1RUZHZRKzJlRThxSgo5WHNVenFmKzVkc2Y4dDF4SFpmR2wxU2piVEJyTUE0R0ExVWREd0VCL3dRRUF3SUJwakFkQmdOVkhTVUVGakFVCkJnZ3JCZ0VGQlFjREFnWUlLd1lCQlFVSEF3RXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QXBCZ05WSFE0RUlnUWcKYVQxN2JhUVNKVXZMZEY1WTZVY0VtU1V2MGtKNTAvWkJaQS8vWFordzh1NHdDZ1lJS29aSXpqMEVBd0lEU1FBdwpSZ0loQU5lRzUzL3hxMHZHTXpaaVVwWG9RZGwySGZFeU9pVXl3bG43c3AvY0hTOGxBaUVBa3dWN09GckhOTnZECkJUT2szVnVneWxwcytOdWxXTGpOU0hXWTB2NTZaZDA9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K\",\n\t\t\t\t\t\"organizational_unit_identifier\": \"admin\"\n\t\t\t\t},\n\t\t\t\t\"orderer_ou_identifier\": {\n\t\t\t\t\t\"certificate\": \"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVekNDQWZpZ0F3SUJBZ0lSQU9wamxIMFRsLzlteXYrSWZzRGVSSnN3Q2dZSUtvWkl6ajBFQXdJd2N6RUwKTUFrR0ExVUVCaE1DVlZNeEV6QVJCZ05WQkFnVENrTmhiR2xtYjNKdWFXRXhGakFVQmdOVkJBY1REVk5oYmlCRwpjbUZ1WTJselkyOHhHVEFYQmdOVkJBb1RFRzl5WnpFdVpYaGhiWEJzWlM1amIyMHhIREFhQmdOVkJBTVRFMk5oCkxtOXlaekV1WlhoaGJYQnNaUzVqYjIwd0hoY05Nakl3TWpFM01UQXpNREF3V2hjTk16SXdNakUxTVRBek1EQXcKV2pCek1Rc3dDUVlEVlFRR0V3SlZVekVUTUJFR0ExVUVDQk1LUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnhNTgpVMkZ1SUVaeVlXNWphWE5qYnpFWk1CY0dBMVVFQ2hNUWIzSm5NUzVsZUdGdGNHeGxMbU52YlRFY01Cb0dBMVVFCkF4TVRZMkV1YjNKbk1TNWxlR0Z0Y0d4bExtTnZiVEJaTUJNR0J5cUdTTTQ5QWdFR0NDcUdTTTQ5QXdFSEEwSUEKQkVoVGc2cFRtZ214QnExM0VvRmx5SGozeWd5em9ydWZQb1J3MjlXUVdUNFluMFhTZnNmT1RUZHZRKzJlRThxSgo5WHNVenFmKzVkc2Y4dDF4SFpmR2wxU2piVEJyTUE0R0ExVWREd0VCL3dRRUF3SUJwakFkQmdOVkhTVUVGakFVCkJnZ3JCZ0VGQlFjREFnWUlLd1lCQlFVSEF3RXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QXBCZ05WSFE0RUlnUWcKYVQxN2JhUVNKVXZMZEY1WTZVY0VtU1V2MGtKNTAvWkJaQS8vWFordzh1NHdDZ1lJS29aSXpqMEVBd0lEU1FBdwpSZ0loQU5lRzUzL3hxMHZHTXpaaVVwWG9RZGwySGZFeU9pVXl3bG43c3AvY0hTOGxBaUVBa3dWN09GckhOTnZECkJUT2szVnVneWxwcytOdWxXTGpOU0hXWTB2NTZaZDA9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K\",\n\t\t\t\t\t\"organizational_unit_identifier\": \"orderer\"\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"Org2MSP\": {\n\t\t\t\"name\": \"Org2MSP\",\n\t\t\t\"root_certs\": [\n\t\t\t\t\"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVVENDQWZlZ0F3SUJBZ0lRWDhHQkcvWDg0V29LdmtOeUNaZnU5ekFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTWk1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NaTVsZUdGdGNHeGxMbU52YlRBZUZ3MHlNakF5TVRjeE1ETXdNREJhRncwek1qQXlNVFV4TURNd01EQmEKTUhNeEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVJrd0Z3WURWUVFLRXhCdmNtY3lMbVY0WVcxd2JHVXVZMjl0TVJ3d0dnWURWUVFECkV4TmpZUzV2Y21jeUxtVjRZVzF3YkdVdVkyOXRNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUUKRWs1RnpVQTFYYmtKZk5jRnJQSUxvLytKejhMSXdhcFM3U2FneUhBQ0ZhQTRuK0djcVk0Q3d0SDg3WnRmQnNMYgpvaUh5THVDam8reDhnNnAyREN5MXNxTnRNR3N3RGdZRFZSMFBBUUgvQkFRREFnR21NQjBHQTFVZEpRUVdNQlFHCkNDc0dBUVVGQndNQ0JnZ3JCZ0VGQlFjREFUQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01Da0dBMVVkRGdRaUJDRFUKWHBQVHBJRkQySGkrT3VlZjRUUTBobDVWMHYrNnFyU014dnZjbjlpeHRqQUtCZ2dxaGtqT1BRUURBZ05JQURCRgpBaUVBNVo5Z0tqODFKVHg2U0wzR2hYWm12V0FtYTIzclE1OUpHTXRBR0IyQURjd0NJRlFoM3JCOGdkM0ZKM0hnCkdSVEgwakZlTGtGMURHdEdRRWJ0Vys2ektMZVUKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\"\n\t\t\t],\n\t\t\t\"crypto_config\": {\n\t\t\t\t\"signature_hash_family\": \"SHA2\",\n\t\t\t\t\"identity_identifier_hash_function\": \"SHA256\"\n\t\t\t},\n\t\t\t\"tls_root_certs\": [\n\t\t\t\t\"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNWekNDQWYyZ0F3SUJBZ0lRUityNWtGYnF6WUR2cFhJNzFPd0JYVEFLQmdncWhrak9QUVFEQWpCMk1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTWk1bGVHRnRjR3hsTG1OdmJURWZNQjBHQTFVRUF4TVdkR3h6ClkyRXViM0puTWk1bGVHRnRjR3hsTG1OdmJUQWVGdzB5TWpBeU1UY3hNRE13TURCYUZ3MHpNakF5TVRVeE1ETXcKTURCYU1IWXhDekFKQmdOVkJBWVRBbFZUTVJNd0VRWURWUVFJRXdwRFlXeHBabTl5Ym1saE1SWXdGQVlEVlFRSApFdzFUWVc0Z1JuSmhibU5wYzJOdk1Sa3dGd1lEVlFRS0V4QnZjbWN5TG1WNFlXMXdiR1V1WTI5dE1SOHdIUVlEClZRUURFeFowYkhOallTNXZjbWN5TG1WNFlXMXdiR1V1WTI5dE1Ga3dFd1lIS29aSXpqMENBUVlJS29aSXpqMEQKQVFjRFFnQUVUWlBZRkxmSUJMUUFkcDVmZ0NxSnZ3SjMyeDY5OG1LWEhibEY2cUR4bFVvMG5GUnRmbkhTU2NLZQplNXdmREtlM0pHS3pWek1RSDJQUlFTSVVHRGVKNWFOdE1Hc3dEZ1lEVlIwUEFRSC9CQVFEQWdHbU1CMEdBMVVkCkpRUVdNQlFHQ0NzR0FRVUZCd01DQmdnckJnRUZCUWNEQVRBUEJnTlZIUk1CQWY4RUJUQURBUUgvTUNrR0ExVWQKRGdRaUJDQm5CN25MTy9yczNHeWpQM09KaXAvYks3OHBDMURjSWtVQUg5T29IWjM4V1RBS0JnZ3Foa2pPUFFRRApBZ05JQURCRkFpQTQwUWNNYzlTdGZONnVVcFhhdGJQWUpyV21TekErdmdVS3MyS1hxQTNxa3dJaEFLeGh4UGVICkhicXRRK2x0bUFHT3JxUTd1RHM5Q0NtWS9WVFNDYmg4Z2E4RAotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==\"\n\t\t\t],\n\t\t\t\"fabric_node_ous\": {\n\t\t\t\t\"enable\": true,\n\t\t\t\t\"client_ou_identifier\": {\n\t\t\t\t\t\"certificate\": \"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVVENDQWZlZ0F3SUJBZ0lRWDhHQkcvWDg0V29LdmtOeUNaZnU5ekFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTWk1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NaTVsZUdGdGNHeGxMbU52YlRBZUZ3MHlNakF5TVRjeE1ETXdNREJhRncwek1qQXlNVFV4TURNd01EQmEKTUhNeEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVJrd0Z3WURWUVFLRXhCdmNtY3lMbVY0WVcxd2JHVXVZMjl0TVJ3d0dnWURWUVFECkV4TmpZUzV2Y21jeUxtVjRZVzF3YkdVdVkyOXRNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUUKRWs1RnpVQTFYYmtKZk5jRnJQSUxvLytKejhMSXdhcFM3U2FneUhBQ0ZhQTRuK0djcVk0Q3d0SDg3WnRmQnNMYgpvaUh5THVDam8reDhnNnAyREN5MXNxTnRNR3N3RGdZRFZSMFBBUUgvQkFRREFnR21NQjBHQTFVZEpRUVdNQlFHCkNDc0dBUVVGQndNQ0JnZ3JCZ0VGQlFjREFUQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01Da0dBMVVkRGdRaUJDRFUKWHBQVHBJRkQySGkrT3VlZjRUUTBobDVWMHYrNnFyU014dnZjbjlpeHRqQUtCZ2dxaGtqT1BRUURBZ05JQURCRgpBaUVBNVo5Z0tqODFKVHg2U0wzR2hYWm12V0FtYTIzclE1OUpHTXRBR0IyQURjd0NJRlFoM3JCOGdkM0ZKM0hnCkdSVEgwakZlTGtGMURHdEdRRWJ0Vys2ektMZVUKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\",\n\t\t\t\t\t\"organizational_unit_identifier\": \"client\"\n\t\t\t\t},\n\t\t\t\t\"peer_ou_identifier\": {\n\t\t\t\t\t\"certificate\": \"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVVENDQWZlZ0F3SUJBZ0lRWDhHQkcvWDg0V29LdmtOeUNaZnU5ekFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTWk1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NaTVsZUdGdGNHeGxMbU52YlRBZUZ3MHlNakF5TVRjeE1ETXdNREJhRncwek1qQXlNVFV4TURNd01EQmEKTUhNeEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVJrd0Z3WURWUVFLRXhCdmNtY3lMbVY0WVcxd2JHVXVZMjl0TVJ3d0dnWURWUVFECkV4TmpZUzV2Y21jeUxtVjRZVzF3YkdVdVkyOXRNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUUKRWs1RnpVQTFYYmtKZk5jRnJQSUxvLytKejhMSXdhcFM3U2FneUhBQ0ZhQTRuK0djcVk0Q3d0SDg3WnRmQnNMYgpvaUh5THVDam8reDhnNnAyREN5MXNxTnRNR3N3RGdZRFZSMFBBUUgvQkFRREFnR21NQjBHQTFVZEpRUVdNQlFHCkNDc0dBUVVGQndNQ0JnZ3JCZ0VGQlFjREFUQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01Da0dBMVVkRGdRaUJDRFUKWHBQVHBJRkQySGkrT3VlZjRUUTBobDVWMHYrNnFyU014dnZjbjlpeHRqQUtCZ2dxaGtqT1BRUURBZ05JQURCRgpBaUVBNVo5Z0tqODFKVHg2U0wzR2hYWm12V0FtYTIzclE1OUpHTXRBR0IyQURjd0NJRlFoM3JCOGdkM0ZKM0hnCkdSVEgwakZlTGtGMURHdEdRRWJ0Vys2ektMZVUKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\",\n\t\t\t\t\t\"organizational_unit_identifier\": \"peer\"\n\t\t\t\t},\n\t\t\t\t\"admin_ou_identifier\": {\n\t\t\t\t\t\"certificate\": \"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVVENDQWZlZ0F3SUJBZ0lRWDhHQkcvWDg0V29LdmtOeUNaZnU5ekFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTWk1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NaTVsZUdGdGNHeGxMbU52YlRBZUZ3MHlNakF5TVRjeE1ETXdNREJhRncwek1qQXlNVFV4TURNd01EQmEKTUhNeEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVJrd0Z3WURWUVFLRXhCdmNtY3lMbVY0WVcxd2JHVXVZMjl0TVJ3d0dnWURWUVFECkV4TmpZUzV2Y21jeUxtVjRZVzF3YkdVdVkyOXRNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUUKRWs1RnpVQTFYYmtKZk5jRnJQSUxvLytKejhMSXdhcFM3U2FneUhBQ0ZhQTRuK0djcVk0Q3d0SDg3WnRmQnNMYgpvaUh5THVDam8reDhnNnAyREN5MXNxTnRNR3N3RGdZRFZSMFBBUUgvQkFRREFnR21NQjBHQTFVZEpRUVdNQlFHCkNDc0dBUVVGQndNQ0JnZ3JCZ0VGQlFjREFUQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01Da0dBMVVkRGdRaUJDRFUKWHBQVHBJRkQySGkrT3VlZjRUUTBobDVWMHYrNnFyU014dnZjbjlpeHRqQUtCZ2dxaGtqT1BRUURBZ05JQURCRgpBaUVBNVo5Z0tqODFKVHg2U0wzR2hYWm12V0FtYTIzclE1OUpHTXRBR0IyQURjd0NJRlFoM3JCOGdkM0ZKM0hnCkdSVEgwakZlTGtGMURHdEdRRWJ0Vys2ektMZVUKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\",\n\t\t\t\t\t\"organizational_unit_identifier\": \"admin\"\n\t\t\t\t},\n\t\t\t\t\"orderer_ou_identifier\": {\n\t\t\t\t\t\"certificate\": \"LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUNVVENDQWZlZ0F3SUJBZ0lRWDhHQkcvWDg0V29LdmtOeUNaZnU5ekFLQmdncWhrak9QUVFEQWpCek1Rc3cKQ1FZRFZRUUdFd0pWVXpFVE1CRUdBMVVFQ0JNS1EyRnNhV1p2Y201cFlURVdNQlFHQTFVRUJ4TU5VMkZ1SUVaeQpZVzVqYVhOamJ6RVpNQmNHQTFVRUNoTVFiM0puTWk1bGVHRnRjR3hsTG1OdmJURWNNQm9HQTFVRUF4TVRZMkV1CmIzSm5NaTVsZUdGdGNHeGxMbU52YlRBZUZ3MHlNakF5TVRjeE1ETXdNREJhRncwek1qQXlNVFV4TURNd01EQmEKTUhNeEN6QUpCZ05WQkFZVEFsVlRNUk13RVFZRFZRUUlFd3BEWVd4cFptOXlibWxoTVJZd0ZBWURWUVFIRXcxVApZVzRnUm5KaGJtTnBjMk52TVJrd0Z3WURWUVFLRXhCdmNtY3lMbVY0WVcxd2JHVXVZMjl0TVJ3d0dnWURWUVFECkV4TmpZUzV2Y21jeUxtVjRZVzF3YkdVdVkyOXRNRmt3RXdZSEtvWkl6ajBDQVFZSUtvWkl6ajBEQVFjRFFnQUUKRWs1RnpVQTFYYmtKZk5jRnJQSUxvLytKejhMSXdhcFM3U2FneUhBQ0ZhQTRuK0djcVk0Q3d0SDg3WnRmQnNMYgpvaUh5THVDam8reDhnNnAyREN5MXNxTnRNR3N3RGdZRFZSMFBBUUgvQkFRREFnR21NQjBHQTFVZEpRUVdNQlFHCkNDc0dBUVVGQndNQ0JnZ3JCZ0VGQlFjREFUQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01Da0dBMVVkRGdRaUJDRFUKWHBQVHBJRkQySGkrT3VlZjRUUTBobDVWMHYrNnFyU014dnZjbjlpeHRqQUtCZ2dxaGtqT1BRUURBZ05JQURCRgpBaUVBNVo5Z0tqODFKVHg2U0wzR2hYWm12V0FtYTIzclE1OUpHTXRBR0IyQURjd0NJRlFoM3JCOGdkM0ZKM0hnCkdSVEgwakZlTGtGMURHdEdRRWJ0Vys2ektMZVUKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\",\n\t\t\t\t\t\"organizational_unit_identifier\": \"orderer\"\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\t\"orderers\": {\n\t\t\"OrdererMSP\": {\n\t\t\t\"endpoint\": [\n\t\t\t\t{\n\t\t\t\t\t\"host\": \"orderer0.example.com\",\n\t\t\t\t\t\"port\": 7050\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"host\": \"orderer1.example.com\",\n\t\t\t\t\t\"port\": 8050\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"host\": \"orderer2.example.com\",\n\t\t\t\t\t\"port\": 9050\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t}\n}\n```\n# endorsers å­å‘½ä»¤\næ˜¾ç¤ºç½‘ç»œä¸­çš„èƒŒä¹¦èŠ‚ç‚¹ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®ƒä»¬çš„`MSP ID`ã€`å¸æœ¬é«˜åº¦`ã€`æœåŠ¡åœ°å€`å’Œ`èº«ä»½è¯ä¹¦`ç­‰ã€‚\n```shell\ndiscover --configFile discover_config.yaml \\\n    endorsers \\\n        --channel businesschannel \\\n        --chaincode hyperledger-fabric-contract-java-demo \\\n        --server peer0.org1.example.com:7051\n```\n> `discover_config.yaml` æ–‡ä»¶å¯ä»¥ä½¿ç”¨ saveConfig å‘½ä»¤ç”Ÿæˆ\næ­£å¸¸è¿”å›ç»“æœå¦‚ä¸‹ï¼š\n```json\n[\n\t{\n\t\t\"Chaincode\": \"hyperledger-fabric-contract-java-demo\",\n\t\t\"EndorsersByGroups\": {\n\t\t\t\"G0\": [\n\t\t\t\t{\n\t\t\t\t\t\"MSPID\": \"Org1MSP\",\n\t\t\t\t\t\"LedgerHeight\": 9,\n\t\t\t\t\t\"Endpoint\": \"peer1.org1.example.com:8051\",\n\t\t\t\t\t\"Identity\": \"-----BEGIN CERTIFICATE-----\\nMIICKDCCAc6gAwIBAgIQYSi1/xYV9ghavadHl49VMDAKBggqhkjOPQQDAjBzMQsw\\nCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMNU2FuIEZy\\nYW5jaXNjbzEZMBcGA1UEChMQb3JnMS5leGFtcGxlLmNvbTEcMBoGA1UEAxMTY2Eu\\nb3JnMS5leGFtcGxlLmNvbTAeFw0yMjAyMTcxMDMwMDBaFw0zMjAyMTUxMDMwMDBa\\nMGoxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRYwFAYDVQQHEw1T\\nYW4gRnJhbmNpc2NvMQ0wCwYDVQQLEwRwZWVyMR8wHQYDVQQDExZwZWVyMS5vcmcx\\nLmV4YW1wbGUuY29tMFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEp42mYDwJKY11\\nntYoyWAwXtIyJiWH/9EB93jVPsFALzicKbibE1vSZlGl1mkb7M5wYCtfai11Bqqz\\nUFEz7e+DsqNNMEswDgYDVR0PAQH/BAQDAgeAMAwGA1UdEwEB/wQCMAAwKwYDVR0j\\nBCQwIoAgaT17baQSJUvLdF5Y6UcEmSUv0kJ50/ZBZA//XZ+w8u4wCgYIKoZIzj0E\\nAwIDSAAwRQIhAP+WvJIfhdpG/zkc1GrlTwZOppc0JZL9Nl0MfhJ4TMpiAiAfJ8kF\\njJeEYOonkKeZcRG77WoeB/+32BCUJNsSIwYyKA==\\n-----END CERTIFICATE-----\\n\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"MSPID\": \"Org1MSP\",\n\t\t\t\t\t\"LedgerHeight\": 9,\n\t\t\t\t\t\"Endpoint\": \"peer0.org1.example.com:7051\",\n\t\t\t\t\t\"Identity\": \"-----BEGIN CERTIFICATE-----\\nMIICKDCCAc+gAwIBAgIRAIc6sjio0hnYI+sBuebcN9gwCgYIKoZIzj0EAwIwczEL\\nMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNhbGlmb3JuaWExFjAUBgNVBAcTDVNhbiBG\\ncmFuY2lzY28xGTAXBgNVBAoTEG9yZzEuZXhhbXBsZS5jb20xHDAaBgNVBAMTE2Nh\\nLm9yZzEuZXhhbXBsZS5jb20wHhcNMjIwMjE3MTAzMDAwWhcNMzIwMjE1MTAzMDAw\\nWjBqMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMN\\nU2FuIEZyYW5jaXNjbzENMAsGA1UECxMEcGVlcjEfMB0GA1UEAxMWcGVlcjAub3Jn\\nMS5leGFtcGxlLmNvbTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABEHhWvyNC5Pp\\noJmF9pZzdVkKrLcjhS3ePhEIW/53NrnqZUB5QT6NRvo+rxqpIxAjMMZTTg2OewJd\\ng/crbYls2GyjTTBLMA4GA1UdDwEB/wQEAwIHgDAMBgNVHRMBAf8EAjAAMCsGA1Ud\\nIwQkMCKAIGk9e22kEiVLy3ReWOlHBJklL9JCedP2QWQP/12fsPLuMAoGCCqGSM49\\nBAMCA0cAMEQCICVqogpr/tI+sNTy8EYbkuuek4gw5Y/bNNI5cTZJpefKAiB8Zr2o\\nx1r62J3DV5qmF2jEAVRV8duwliiAkKW4q1xcNA==\\n-----END CERTIFICATE-----\\n\"\n\t\t\t\t}\n\t\t\t],\n\t\t\t\"G1\": [\n\t\t\t\t{\n\t\t\t\t\t\"MSPID\": \"Org2MSP\",\n\t\t\t\t\t\"LedgerHeight\": 9,\n\t\t\t\t\t\"Endpoint\": \"peer0.org2.example.com:7051\",\n\t\t\t\t\t\"Identity\": \"-----BEGIN CERTIFICATE-----\\nMIICKTCCAc+gAwIBAgIRAJnk+wcTIbag0SNs4f2TAeIwCgYIKoZIzj0EAwIwczEL\\nMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNhbGlmb3JuaWExFjAUBgNVBAcTDVNhbiBG\\ncmFuY2lzY28xGTAXBgNVBAoTEG9yZzIuZXhhbXBsZS5jb20xHDAaBgNVBAMTE2Nh\\nLm9yZzIuZXhhbXBsZS5jb20wHhcNMjIwMjE3MTAzMDAwWhcNMzIwMjE1MTAzMDAw\\nWjBqMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMN\\nU2FuIEZyYW5jaXNjbzENMAsGA1UECxMEcGVlcjEfMB0GA1UEAxMWcGVlcjAub3Jn\\nMi5leGFtcGxlLmNvbTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABKtm2wfuhEqm\\nht8CqbV1CKAe7YRAao5ySPMCCswpXuX3Amw65L0pFLELhhFHvqoTmwTZOLNHeHCl\\nJoDQgoM5DUyjTTBLMA4GA1UdDwEB/wQEAwIHgDAMBgNVHRMBAf8EAjAAMCsGA1Ud\\nIwQkMCKAINRek9OkgUPYeL4655/hNDSGXlXS/7qqtIzG+9yf2LG2MAoGCCqGSM49\\nBAMCA0gAMEUCIQCB9+ASmx0BgYaN30Zeq+z3Gtj/q1yqrae2bD0dJspbMwIgcAFC\\nx9CQ52jYET7PbIqJOGPksb8amAPUAJXBOIxVJ7U=\\n-----END CERTIFICATE-----\\n\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t\"MSPID\": \"Org2MSP\",\n\t\t\t\t\t\"LedgerHeight\": 9,\n\t\t\t\t\t\"Endpoint\": \"peer1.org2.example.com:8051\",\n\t\t\t\t\t\"Identity\": \"-----BEGIN CERTIFICATE-----\\nMIICKDCCAc+gAwIBAgIRAMV4swH5jaaH+rQ13cBAzcwwCgYIKoZIzj0EAwIwczEL\\nMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNhbGlmb3JuaWExFjAUBgNVBAcTDVNhbiBG\\ncmFuY2lzY28xGTAXBgNVBAoTEG9yZzIuZXhhbXBsZS5jb20xHDAaBgNVBAMTE2Nh\\nLm9yZzIuZXhhbXBsZS5jb20wHhcNMjIwMjE3MTAzMDAwWhcNMzIwMjE1MTAzMDAw\\nWjBqMQswCQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEWMBQGA1UEBxMN\\nU2FuIEZyYW5jaXNjbzENMAsGA1UECxMEcGVlcjEfMB0GA1UEAxMWcGVlcjEub3Jn\\nMi5leGFtcGxlLmNvbTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABJQ2FIGAqO2J\\ngR9LzplbIGt2OXCHklyoQzl/o8OubrAy0hc88KqCFJQeH9gynDDrZM8eSyrlNWTO\\nf6ZXcoMMRbejTTBLMA4GA1UdDwEB/wQEAwIHgDAMBgNVHRMBAf8EAjAAMCsGA1Ud\\nIwQkMCKAINRek9OkgUPYeL4655/hNDSGXlXS/7qqtIzG+9yf2LG2MAoGCCqGSM49\\nBAMCA0cAMEQCICAY5hjEBFmhjJgOPNZx7oJIh5YlhPPMPuVnofwXR4ZCAiAVnOzZ\\nGzUNe7WFYhT4L2l7xLPl51FjigMoLYjG2Jt+ng==\\n-----END CERTIFICATE-----\\n\"\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t\"Layouts\": [\n\t\t\t{\n\t\t\t\t\"quantities_by_group\": {\n\t\t\t\t\t\"G0\": 1,\n\t\t\t\t\t\"G1\": 1\n\t\t\t\t}\n\t\t\t}\n\t\t]\n\t}\n]\n```\n\n# saveConfig å­å‘½ä»¤\nè¯¥å‘½ä»¤å¹¶ä¸ä¸`peer`èŠ‚ç‚¹æ‰“äº¤é“ï¼Œå®ƒå°†ç”±å‚æ•°æŒ‡å®šçš„å˜é‡ä¿¡æ¯ä¿å­˜ä¸ºæœ¬åœ°æ–‡ä»¶ã€‚è¿™æ ·ç”¨æˆ·åœ¨æ‰§è¡Œåç»­å‘½ä»¤æ—¶å¯ä»¥æŒ‡å®šè¯¥æ–‡ä»¶ï¼Œè€Œæ— é¡»å†æŒ‡å®šå„ä¸ªå‚æ•°å€¼ã€‚éœ€è¦é€šè¿‡`--configFile=CONFIGFILE`æ¥æŒ‡å®šæ‰€å­˜æ”¾çš„å‚æ•°ä¿¡æ¯æ–‡ä»¶è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œä¿å­˜æŒ‡å®šçš„å‚æ•°ä¿¡æ¯åˆ°æœ¬åœ°çš„`discover_config.yaml`æ–‡ä»¶ã€‚\n```shell\ndiscover saveConfig --configFile discover_config.yaml \\\n    --peerTLSCA /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/tlsca/tlsca.org1.example.com-cert.pem \\\n    --userKey /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin\\@org1.example.com/msp/keystore/priv_sk \\\n    --userCert /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin\\@org1.example.com/msp/signcerts/Admin@org1.example.com-cert.pem \\\n    --MSP Org1MSP --tlsCert /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin\\@org1.example.com/tls/client.crt \\\n    --tlsKey /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin\\@org1.example.com/tls/client.key\n```\n`discover_config.yaml`æ–‡ä»¶ï¼š\n```yaml\nversion: 0\ntlsconfig:\n  certpath: /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/tls/client.crt\n  keypath: /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/tls/client.key\n  peercacertpath: /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/tlsca/tlsca.org1.example.com-cert.pem\n  timeout: 0s\nsignerconfig:\n  mspid: Org1MSP\n  identitypath: /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/signcerts/Admin@org1.example.com-cert.pem\n  keypath: /etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp/keystore/priv_sk\n```\n\næœ‰äº†è¿™ä¸ªå‚æ•°æ–‡ä»¶ï¼Œå½“å†ä½¿ç”¨åŒæ ·çš„å‚æ•°æ—¶å°±æ— é¡»æ‰‹åŠ¨æŒ‡å®šï¼Œç›´æ¥ä½¿ç”¨`--configFile discover_config.yaml`å³å¯ã€‚å½“ç„¶ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥æ‰‹åŠ¨ç¼–å†™å‚æ•°æ–‡ä»¶ï¼Œä½†ç›´æ¥ä½¿ç”¨`saveConfig`å‘½ä»¤è‡ªåŠ¨ç”Ÿæˆå°†æ›´åŠ æ–¹ä¾¿ã€é«˜æ•ˆã€‚\n","tags":["æœåŠ¡å‘ç°"],"categories":["åŒºå—é“¾","Fabric"]},{"title":"Fabric-configtxlatorè¯´æ˜","url":"/2023/01/28/Fabric-configtxlatorè¯´æ˜/","content":"\n# ä½œç”¨\nå› ä¸ºæ— è®ºé…ç½®äº¤æ˜“æ–‡ä»¶`.tx`å’Œåˆå§‹åŒºå—æ–‡ä»¶`.block`éƒ½æ˜¯äºŒè¿›åˆ¶æ ¼å¼ï¼Œç”¨æˆ·æ— æ³•ç›´æ¥ç¼–è¾‘ã€‚`configtxlator`å·¥å…·å°†è¿™äº›é…ç½®æ–‡ä»¶åœ¨äºŒè¿›åˆ¶æ ¼å¼å’Œæ–¹ä¾¿é˜…è¯»çš„`json`æ ¼å¼ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚å¼€å‘`configtxlator`å·¥å…·æ˜¯ä¸ºäº†æ”¯æŒç‹¬ç«‹äº`SDK`æ¥è¿›è¡Œé‡æ–°é…ç½®ã€‚`configtxlator`å·¥å…·è¢«è®¾è®¡ä¸ºæä¾›ä¸€ä¸ªAPIè®©ä»»æ„SDKçš„ç”¨æˆ·éƒ½èƒ½å¤Ÿä¸ä¹‹äº¤äº’æ¥æ›´æ–°é…ç½®ã€‚å·¥å…·çš„åç§°æ˜¯`configtx`å’Œ`translator`çš„æ‹¼æ¥ï¼Œæ„åœ¨ä¼ è¾¾è¯¥å·¥å…·ç®€å•åœ°åœ¨ä¸åŒçš„ç­‰æ•ˆæ•°æ®ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚å®ƒä¸äº§ç”Ÿé…ç½®ï¼Œä¹Ÿä¸æäº¤æˆ–æ’¤å›é…ç½®ã€‚å®ƒä¸ä¿®æ”¹é…ç½®æœ¬èº«ï¼Œåªæ˜¯ç®€å•åœ°æä¾›ä¸€äº›é…ç½®æ ¼å¼çš„ä¸åŒçš„æ˜ å°„å±•ç°ã€‚\n\næœ¬åœ°å‘½ä»¤è¡Œå¯ä½¿ç”¨å‘½ä»¤ï¼š\n- ç¼–ç (proto_encode)\n- è§£ç (proto_decode)\n- å¯¹æ¯”ä¿®æ”¹ç»“æ„(compute_update)\n- ç‰ˆæœ¬ä¿¡æ¯(version)\n\nè¿œç¨‹`RESTful`è·¯ç”±:\n- ç¼–ç (proto_encode)\n- è§£ç (proto_decode)\n- å¯¹æ¯”ä¿®æ”¹ç»“æ„(compute_update)\n\n# ä½¿ç”¨æ­¥éª¤\n- ä½¿ç”¨SDKè·å–æœ€æ–°çš„é…ç½®\n- ç„¶åä½¿ç”¨`configtxlator`å·¥å…·å°†äºŒè¿›åˆ¶æ–‡ä»¶è½¬æ¢ä¸ºå¯è¯»çš„é…ç½®æ–‡ä»¶\n- ç¼–è¾‘å¯è¯»çš„é…ç½®æ–‡ä»¶\n- ä½¿ç”¨`configtxlator`å·¥å…·è®¡ç®—æ›´æ–°çš„é…ç½®ä¸åŸæœ‰é…ç½®çš„å·®å¼‚\n- ä½¿ç”¨SDKæäº¤é…ç½®ä»¥åŠç­¾å\n---\n## æœ¬åœ°ä½¿ç”¨\nåœ¨`cli`ä¸­åŠ¨æ€å¢åŠ ç»„ç»‡çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸‹ç›´æ¥ä½¿ç”¨`configtxlator proto_encode`å’Œ`configtxlator proto_decode`è¿™ç§æ–¹å¼ã€‚\n\n`proto_encode`å’Œ`proto_decode`ä¸¤ä¸ªå‘½ä»¤æ‰€æ‹¥æœ‰çš„å‚æ•°æ˜¯ä¸€æ ·çš„ï¼Œéƒ½éœ€è¦ä»¥ä¸‹å‡ ä¸ªå‚æ•°ï¼š\n- `type`: æ¶ˆæ¯ç»“æ„ç±»å‹\n- `input`: è¾“å…¥å‚æ•°ï¼Œencodeæ—¶å€¼ä¸ºjsonæ ¼å¼ï¼Œdecodeæ—¶å€¼ä¸ºprotoæ ¼å¼çš„å­—èŠ‚æ•°ç»„ã€‚\n- `output`: è¾“å‡ºç»“æœï¼Œå’Œè¾“å…¥ç›¸å¯¹ï¼Œè¾“å‡ºçš„æ˜¯jsonæˆ–è€…protoæ ¼å¼ã€‚\n\ntypeåŒ…å«ä»¥ä¸‹å‡ ç§:\n| -- | -- |\n| type |  description |\n| -- | -- |\n| common.Block | åŒºå—ç»“æ„ |\n| common.Envelope | å¸¦æœ‰æ•ˆè½½è·å’Œæ•°å­—ç­¾åçš„æ•°å­—ä¿¡å°ï¼ŒåŒºå—çš„æ•°æ®éƒ¨åˆ†å°±æ˜¯åºåˆ—åŒ–åçš„æ•°å­—ä¿¡å° |\n| common.ConfigEnvelope | åŒ…å«é“¾é…ç½®çš„æ•°å­—ä¿¡å°ï¼Œå†…å®¹åŒ…å«ConfigUpdateEnvelope |\n| common.ConfigUpdateEnvelope | æäº¤ç»™æ’åºèŠ‚ç‚¹çš„é…ç½®æ•°å­—ä¿¡å° |\n| common.Config | ConfigEnvelopeçš„é…ç½®éƒ¨åˆ† |\n| common.ConfigUpdate | ConfigUpdateEnvelopeçš„ä¸€éƒ¨åˆ† |\n\n`compute_update`è®¡ç®—ä¿®æ”¹é‡ï¼Œå‘½ä»¤æœ‰ä»¥ä¸‹å‡ ä¸ªå‚æ•°\n- `original`: åŸå§‹proto\n- `updated`: ä¿®æ”¹åçš„proto\n- `channel_id`: é€šé“id\n- `output`: å¯¹æ¯”è®¡ç®—åçš„ç›®æ ‡é…ç½®proto\n\nä¸¾ä¾‹ï¼šå°†å½“å‰`channel`çš„å—æ¶ˆæ¯çš„é…ç½®`decode`ä¸º`json`æ–‡ä»¶\n```shell\nconfigtxlator proto_decode --input orderer.block --type common.Block\n```\n> è¿™é‡Œæ‰€ä½¿ç”¨çš„ orderer.block æ–‡ä»¶è¯·å‚è€ƒ [Fabricå¼€å‘æ¨¡å¼è¿è¡Œ](http://www.blockchainof.com/2023/01/10/Fabric%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F%E8%BF%90%E8%A1%8C/) 2.4ä¸­æ‰€ç”Ÿæˆçš„åˆ›å§‹å—å¯¹åº”çš„æ–‡ä»¶ã€‚åªè¦æ˜¯åŒºå—æ•°æ®ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‘½ä»¤è¿›è¡Œè§£æã€‚\n\n## è¿œç¨‹è°ƒç”¨RESTfulæ¥å£\nå’Œæœ¬åœ°è°ƒç”¨ç±»ä¼¼ï¼Œä¸è¯¦ç»†ä»‹ç»ï¼Œç›´æ¥ä¸¾ä¾‹å§ï¼š\n```shell\ncurl -X POST --data-binary @orderer.block \"${CONFIGTXLATOR_URL}/protolator/decode/common.Block\"\n```","tags":["äºŒè¿›åˆ¶","JSON","è½¬æ¢"],"categories":["åŒºå—é“¾","Fabric"]},{"title":"è¯¦è§£Golangä¸­çš„initå‡½æ•°","url":"/2023/01/18/è¯¦è§£Golangä¸­çš„initå‡½æ•°/","content":"# initå‡½æ•°è¯´æ˜\nåˆå§‹åŒ–æ¯ä¸ªåŒ…åï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œ`init()`å‡½æ•°ï¼Œå¹¶ä¸”æ‰§è¡Œä¼˜å…ˆçº§é«˜äºä¸»å‡½æ•°çš„æ‰§è¡Œä¼˜å…ˆçº§ã€‚`init`å‡½æ•°é€šå¸¸ç”¨äºï¼š\n- å˜é‡åˆå§‹åŒ–\n- æ£€æŸ¥/ä¿®å¤çŠ¶æ€\n- æ³¨å†Œå™¨\n- è¿è¡Œè®¡ç®—\n  \n# åŒ…åˆå§‹åŒ–\nä¸ºäº†ä½¿ç”¨å¯¼å…¥çš„ç¨‹åºåŒ…ï¼Œå¿…é¡»é¦–å…ˆå¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ã€‚åˆå§‹åŒ–å§‹ç»ˆåœ¨å•ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå¹¶ä¸”ä»¥ç¨‹åºåŒ…ä¾èµ–å…³ç³»çš„é¡ºåºæ‰§è¡Œã€‚è¿™ç”±`Golang`è¿è¡Œæ—¶ç³»ç»Ÿæ§åˆ¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n- åˆå§‹åŒ–å¯¼å…¥çš„åŒ…ï¼ˆé€’å½’å¯¼å…¥ï¼‰\n- è®¡ç®—å¹¶ä¸ºå—ä¸­å£°æ˜çš„å˜é‡åˆ†é…åˆå§‹å€¼\n- åœ¨åŒ…ä¸­æ‰§è¡Œåˆå§‹åŒ–å‡½æ•°\n\n![initè°ƒç”¨é¡ºåº](è¯¦è§£Golangä¸­çš„initå‡½æ•°/initå‡½æ•°æ‰§è¡Œé¡ºåº.jpg)\n\n# ç¤ºä¾‹ä»£ç \n```go\npackage main\n\nimport \"fmt\"\n\nvar _ int64=s()\n\nfunc init() {\n    fmt.Println(\"init function\")\n}\n\nfunc s() int64 {\n    fmt.Println(\"function s()\")\n    return 1\n}\n\nfunc main() {\n    fmt.Println(\"main\")\n}\n```\næ‰§è¡Œç»“æœï¼š\n```\nfunction s()\ninit function\nmain\n```\n>å³ä½¿ç¨‹åºåŒ…è¢«å¤šæ¬¡å¯¼å…¥ï¼Œåˆå§‹åŒ–ä¹Ÿåªæ‰§è¡Œ1æ¬¡\n\n## ç‰¹æ€§\n### æ— æ³•å¼•ç”¨\ninitå‡½æ•°ä¸éœ€è¦ä¼ å…¥èƒ½æ•°ï¼Œä¹Ÿä¸éœ€è¦è¿”å›ä»»ä½•å€¼ã€‚ä¸mainç›¸æ¯”ï¼Œinitæ²¡æœ‰å£°æ˜ï¼Œ**å› æ­¤æ— æ³•å¼•ç”¨**ã€‚\n```go\npackage main\n\nimport \"fmt\"\n\nfunc init() {\n    fmt.Println(\"init\")\n}\nfunc main() {\n    init()\n}\n```\nç¼–è¯‘ä¸Šè¿°ä»£ç ä¼šæŠ¥ï¼š`undefined: init`\n\n### ä¸€ä¸ªæºæ–‡ä»¶å¯ä»¥åŒ…å«å¤šä¸ªinitå‡½æ•°\n```go\npackage main\n\nimport \"fmt\"\n\nfunc init() {\n    fmt.Println(\"init1\")\n}\nfunc init() {\n    fmt.Println(\"init2\")\n}\nfunc main() {\n    fmt.Println(\"main\")\n}\n```\næ‰§è¡Œç»“æœï¼š\n```\ninit1\ninit2\nmain\n```\n","tags":["init"],"categories":["Golang","åŸºç¡€"]},{"title":"ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0003","url":"/2023/01/16/ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0003/","content":"\n# ç®¡ç†Fabricç½‘ç»œ\n\n## ç®€ä»‹\n`Fabric`ç½‘ç»œå¯åŠ¨åï¼Œå¯ä»¥å¯¹ç½‘ç»œä¸­èµ„æºè¿›è¡Œç®¡ç†ã€‚è¦æ®èµ„æºç±»å‹çš„ä¸åŒï¼Œç›®å‰ä¸»è¦åŒ…æ‹¬3ç±»æ“ä½œï¼š\n- é€šé“æ“ä½œï¼ŒåŒ…æ‹¬å¯¹é€šé“è¿›è¡Œåˆ›å»ºã€åŠ å…¥é€šé“ã€æŸ¥è¯¢ä¿¡æ¯ã€æ›´æ–°é…ç½®ç­‰æ“ä½œã€‚\n- èŠ‚ç‚¹ç®¡ç†ï¼ŒåŒ…æ‹¬å¯¹`Peer`èŠ‚ç‚¹è¿›è¡Œå¯åŠ¨ã€é‡ç½®ã€å›æ»šã€æš‚åœã€ç»§ç»­ã€é‡å»ºDBå’Œå‡çº§DBç­‰æ“ä½œã€‚\n- é“¾ç æ“ä½œï¼ŒåŒ…æ‹¬é“¾ç çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚æ‰“åŒ…ã€å®‰è£…ã€æ‰¹å‡†ã€æäº¤ã€å‡çº§å’Œè°ƒç”¨é“¾ç ç­‰ã€‚\n\nå¦å¤–ï¼Œä¸ºäº†æé«˜ä½¿ç”¨ç½‘ç»œçš„æ•ˆç‡ï¼Œ`Fabric`æä¾›äº†äº‹ä»¶é€šçŸ¥æœºåˆ¶ï¼ˆå¯ä»¥ç¡®è®¤äº¤æ˜“æ˜¯å¦æœ€ç»ˆæäº¤ï¼‰å’Œç½‘ç»œä¿¡æ¯è‡ªåŠ¨å‘ç°åŠŸèƒ½ï¼Œå¹¶æ”¯æŒå¯¹ç½‘ç»œè¿›è¡Œåœ¨çº¿å‡çº§ã€‚è¿™äº›éƒ½ä¸ºä½¿ç”¨ç½‘ç»œæä¾›äº†ä¾¿åˆ©ã€‚ä¸‹é¢å°†å…·ä½“è¿›è¡Œä»‹ç»ã€‚\n\n## ä½¿ç”¨é€šé“\n### é€šé“æ“ä½œå‘½ä»¤\nå‘½ä»¤è¡Œä¸‹å¯ä»¥ä½¿ç”¨`peer channel`å‘½ä»¤ï¼ˆå®ç°ä½äº`internal/peer/channel`)è¿›è¡Œé€šé“æ“ä½œï¼ŒåŒ…æ‹¬`create`, `fetch`, `join`, `list`, `update`, `getinfo`, `signconfigtx`ç­‰å­å‘½ä»¤ã€‚å…¶ä¸­`create`, `fetch`, `update`å‘½ä»¤ä¸»è¦ä¸æ’åºæœåŠ¡æ‰“äº¤é“ï¼›`join`, `list`, `getinfo`ä¸`Peer`èŠ‚ç‚¹æ‰“äº¤é“ï¼›`signconfigtx`åˆ™ä¸ºæœ¬åœ°å¤„ç†ã€‚\n\nå„é€šé“æ“ä½œå‘½ä»¤çš„åŠŸèƒ½å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š\n![é€šé“æ“ä½œå‘½ä»¤](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0003/é€šé“æ“ä½œå‘½ä»¤.jpeg)\nå¯ä»¥é€šè¿‡ peer channel<subcommand> --help æ¥æŸ¥çœ‹å…·ä½“çš„å‘½ä»¤ä½¿ç”¨è¯´æ˜ã€‚\n\n### å‘½ä»¤é€‰é¡¹\n`peer channel`å‘½ä»¤æ”¯æŒçš„å…¨å±€é€‰é¡¹å¦‚ä¸‹è¡¨ï¼š\n![peer channelå‘½ä»¤çš„å…¨å±€é€‰é¡¹åŠè¯´æ˜](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0003/å‘½ä»¤é€‰é¡¹.jpeg)\n\nå®¢æˆ·ç«¯æ”¯æŒä»ç¯å¢ƒå˜é‡ä¸­è¯»å–æ“ä½œçš„é»˜è®¤`Peer`åœ°å€å’Œèº«ä»½ä¿¡æ¯ï¼Œå¯ä»¥æå‰é€šè¿‡ç¯å¢ƒå˜é‡æ¥æŒ‡å®šï¼š\n```shell\n#ç›®æ ‡Peer\nCORE_PEER_ADDRESS=<peer endpoint>\n#è¿æ¥ç›®æ ‡Peeræ—¶ä¿¡ä»»çš„TLSæ ¹è¯ä¹¦\nCORE_PEER_TLS_ROOTCERT_FILE=<peer tls ca path>\n#ä½¿ç”¨çš„å®¢æˆ·ç«¯ç”¨æˆ·çš„MSP ID\nCORE_PEER_LOCALMSPID=<user msp id>\n#ä½¿ç”¨çš„å®¢æˆ·ç«¯ç”¨æˆ·MSPè·¯å¾„\nCORE_PEER_MSPCONFIGPATH=<user msp path>\n```\nä¾‹å¦‚ï¼Œä¸‹é¢çš„å‘½ä»¤æŒ‡å®šäº†å¯¹ç»„ç»‡org1.example.comçš„peer0.org1.example.comèŠ‚ç‚¹æ‰§è¡Œç›¸å…³æ“ä½œï¼Œèº«ä»½ä¸ºç»„ç»‡çš„ç®¡ç†å‘˜Adminã€‚ä»£ç å¦‚ä¸‹ï¼š\n```shell\nCORE_PEER_ADDRESS=peer0.org1.example.com:7051 \\\nCORE_PEER_TLS_ROOTCERT_FILE=/etc/hyperledger/fabric/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \\\nCORE_PEER_LOCALMSPID=\"Org1MSP\" \\\nCORE_PEER_MSPCONFIGPATH=/etc/hyperledger/fabric/crypto/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp \\\npeer channel <subcommand>\n```\n\n### åˆ›å»ºé€šé“\n`create`å­å‘½ä»¤ç”±æ‹¥æœ‰åˆ›å»ºé€šé“æƒé™ç»„ç»‡ç®¡ç†å‘˜èº«ä»½æ¥è°ƒç”¨ï¼Œåœ¨æŒ‡å®šçš„æ’åºæœåŠ¡ä¸Šåˆ›å»ºæ–°çš„åº”ç”¨é€šé“ï¼Œéœ€è¦æä¾›æœåŠ¡åœ°å€ã€‚è¯¥å­å‘½ä»¤æ”¯æŒçš„é€‰é¡¹åŒ…æ‹¬ï¼š\n- -c, --channelID string, åˆ›å»ºé€šé“åç§°\n- -f, --file string, æŒ‡å®šåˆ›å»ºé€šé“æ‰€ç”¨çš„äº¤æ˜“æ–‡ä»¶\n- --outputBlock string, åˆ›å»ºé€šé“æˆåŠŸåï¼Œå°†åˆå§‹åŒºå—å†™åˆ°æœ¬åœ°æŒ‡å®šæ–‡ä»¶ï¼Œé»˜è®¤ä¸º./.blockã€‚\n- -t, --timeout duration, åˆ›å»ºè¶…æ—¶ï¼Œé»˜è®¤ä¸º10ç§’ã€‚\n\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé€šè¿‡æå‰åˆ›å»ºçš„é€šé“é…ç½®æ–‡ä»¶æ¥æŒ‡å®šé…ç½®ä¿¡æ¯ã€‚å¦‚æœä¸æŒ‡å®šé€šé“é…ç½®æ–‡ä»¶ï¼Œåˆ™é»˜è®¤é‡‡ç”¨`SampleConsortium`é…ç½®å’Œæœ¬åœ°çš„`MSP`ç»„ç»‡æ¥æ„é€ é…ç½®äº¤æ˜“ç»“æ„ã€‚ä¾‹å¦‚ï¼Œåˆ©ç”¨äº‹å…ˆåˆ›å»ºçš„é…ç½®äº¤æ˜“æ–‡ä»¶`channel.tx`æ¥åˆ›å»ºæ–°çš„åº”ç”¨é€šé“`businesschannel`, å‘½ä»¤ä»£ç å¦‚ä¸‹ï¼š\n```shell\nAPP_CHANNEL=\"businesschannel\"\npeer channel create \\\n-o orderer:7050 \\\n-c ${APP_CHANNEL} \\\n-f ./channel.tx \\\n--timeout 30s\n```\nåŠ å…¥æˆåŠŸåï¼Œæœ¬åœ°ä¼šäº§ç”Ÿè¯¥åº”ç”¨é€šé“çš„åˆå§‹åŒºå—æ–‡ä»¶`businesschannel.block`\n\nåˆ›å»ºåº”ç”¨é€šé“çš„ä¸»è¦è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œéœ€è¦ä¸æ’åºæœåŠ¡äº¤äº’ä¸¤æ¬¡ï¼šå‘èµ·åˆ›å»ºé€šè¯·æ±‚åˆ°ç³»ç»Ÿé€šé“ï¼Œç„¶åè·å–æ‰€åˆ›å»ºåº”ç”¨é€šé“çš„åˆå§‹åŒºå—ã€‚\n![åº”ç”¨é€šé“çš„åˆ›å»º](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0003/åº”ç”¨é€šé“çš„åˆ›å»º.jpeg)\nåˆ›å»ºåº”ç”¨é€šé“çš„å®ç°æµç¨‹\n![åº”ç”¨é€šé“çš„åˆ›å»ºçš„å®ç°æµç¨‹](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0003/åº”ç”¨é€šé“çš„åˆ›å»ºçš„å®ç°æµç¨‹.jpeg)\n\nä¸»è¦æ­¥éª¤åŒ…æ‹¬ï¼š\n- å®¢æˆ·ç«¯è°ƒç”¨`sendCreateChainTransaction()`,è¯»å–æŒ‡å®šçš„é…ç½®äº¤æ˜“æ–‡ä»¶ï¼ˆæˆ–åˆ©ç”¨é»˜è®¤é…ç½®ï¼‰ï¼Œæ„é€ ä¸€ä¸ªåˆ›å»ºåº”ç”¨é€šé“çš„é…ç½®äº¤æ˜“ç»“æ„ï¼Œæ·»åŠ ç­¾åï¼Œå°è£…ä¸º`Envelope`ç»“æ„ã€‚å…¶ä¸­æŒ‡å®šé€šé“å¤´éƒ¨ç±»å‹ä¸º`CONFIG_UPDATE`,æ ¸å¿ƒçš„æ•°æ®ä¸º`ConfigUpdateEnvelope`ç»“æ„ã€‚\n- å®¢æˆ·ç«¯å‘é€é…ç½®äº¤æ˜“åˆ°æ’åºæœåŠ¡ã€‚\n- `Orderder`æ”¶åˆ°`CONFIG_UPDATE`æ¶ˆæ¯åï¼Œæ£€æŸ¥æŒ‡å®šçš„é€šé“æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºé€šé“ï¼Œå¹¶æ„é€ è¯¥åº”ç”¨é€šé“çš„åˆå§‹åŒºå—ã€‚\n  - `Orderer`é¦–å…ˆæ£€æŸ¥é€šé“åº”ç”¨ï¼ˆApplicationï¼‰é…ç½®ä¸­çš„ç»„ç»‡éƒ½åœ¨åˆ›å»ºçš„è”ç›Ÿï¼ˆConsortium)å†…, é…ç½®åˆ°ç»„ç»‡ä¸­ã€‚\n  - ä¹‹åä»ç³»ç»Ÿé€šé“ä¸­è·å–`Orderder`ç›¸å…³çš„é…ç½®ï¼Œå¹¶åˆ›å»ºåº”ç”¨é€šé“é…ç½®ã€‚åº”ç”¨é…ç½®å¯¹åº”çš„`mod_policy`ä¸º`Admins`ã€‚\n  - æ ¹æ®`ChannelCreateionPolicy`æŒ‡å®šç­–ç•¥ï¼Œåˆ©ç”¨æ–°åˆ›å»ºåº”ç”¨é€šé“çš„æˆå‘˜ï¼Œè¿›è¡Œæƒé™æ ¡éªŒã€‚\n  - æ¥ä¸‹æ¥æ ¹æ®`CONFIG_UPDATE`æ¶ˆæ¯çš„å†…å®¹æ›´æ–°è·å–åˆ°çš„é…ç½®ä¿¡æ¯ã€‚æ‰€æœ‰é…ç½®å‘ç”Ÿå˜æ›´åç‰ˆæœ¬å·éƒ½è¦æ›´æ–°ã€‚\n  - åˆ›å»ºç­¾å`Proposal`æ¶ˆæ¯ï¼ˆå¤´éƒ¨ç±»å‹ä¸º`ORDERER_TRANSACTION`),è¿›è¡Œå…±è¯†ï¼ŒæŒ‡å®šç›®æ ‡ä¸ºç³»ç»Ÿé€šé“ã€‚\n  - `Orderer`å…±è¯†å®Œæˆåæäº¤äº¤æ˜“ï¼Œåˆå§‹åŒ–å¯¹åº”æœ¬åœ°ç»“æ„ï¼Œå®Œæˆåº”ç”¨é€šé“çš„åˆ›å»ºè¿‡ç¨‹ã€‚\n- å®¢æˆ·ç«¯ä»æ’åºæœåŠ¡çš„`Deliver`æœåŠ¡è·å–åº”ç”¨é€šé“çš„åˆå§‹åŒºå—ï¼ˆå…·ä½“è¿‡ç¨‹ç±»ä¼¼`fetch`å‘½ä»¤ï¼‰ï¼Œè¯·æ±‚ç±»å‹ä¸º`DELIVER_SEEK_INFO`, æ ¸å¿ƒçš„æ•°æ®ä¸º`SeekInfo`ç»“æ„ã€‚\n- å®¢æˆ·ç«¯å°†æ”¶åˆ°çš„åŒºå—å†™å…¥æœ¬åœ°çš„`chainID+\".block\"`æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶åç»­ä¼šåŠ å…¥é€šé“çš„èŠ‚ç‚¹ä¸­å¤‡ç”¨ã€‚\n\nå…¶ä¸­ï¼Œå‘å¾€æ’åºæœåŠ¡çš„`Envelope`æ¶ˆæ¯ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š\n```go\n// github.com/hyperledger/fabric-protos-go/common/common.pb.go\ntype Envelope struct {\n  // åºåˆ—åŒ–çš„è½½è·æ•°æ®ï¼Œå¯ä»¥ä¸ºä»»æ„å†…å®¹\n  Payload []byte\n  // è½½è·å¤´éƒ¨ä¸­çš„æ¶ˆæ¯åˆ›å»ºè€…å¯¹è½½è·çš„ç­¾å\n  Signature []byte\n}\n```\n`Envelope`çš„ç»“æ„é€šå¸¸å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸­è½½è·åŒ…æ‹¬å¤´éƒ¨å’Œæ•°æ®ä¸¤éƒ¨åˆ†ã€‚\n![Envelopeçš„ç»“æ„](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0003/Envelope.jpeg)\n\n\n### åŠ å…¥é€šé“\n`join`å­å‘½ä»¤ä¼šå°†æŒ‡å®šçš„`Peer`èŠ‚ç‚¹åŠ å…¥æŒ‡å®šçš„åº”ç”¨é€šé“ä¸­ã€‚éœ€è¦æå‰æ‹¥æœ‰æ‰€åŠ å…¥åº”ç”¨é€šé“çš„åˆå§‹åŒºå—æ–‡ä»¶ï¼Œå¹¶ä¸”åªæœ‰å±äºé€šé“çš„æŸä¸ªç»„ç»‡çš„ç®¡ç†å‘˜èº«ä»½æ‰å¯ä»¥æˆåŠŸæ‰§è¡Œè¯¥æ“ä½œã€‚åŠ å…¥é€šé“å‘½ä»¤ä¸»è¦é€šè¿‡è°ƒç”¨`Peer`çš„é…ç½®ç³»ç»Ÿé“¾ç è¿›è¡Œå¤„ç†ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯å°†`Peer`èŠ‚ç‚¹åŠ å…¥åº”ç”¨é€šé“`businesschannel`ä¸­ã€‚è¯¥å­å‘½ä»¤æ”¯æŒ`-b`, `--blockpath string`é€‰é¡¹ï¼Œç”¨æ¥æŒ‡å®šé€šé“åˆå§‹åŒºå—æ–‡ä»¶è·¯å¾„ã€‚ä»£ç å¦‚ä¸‹ï¼š\n```shell\npeer channel join \\\n-b ${APP_CHANNEL}.block\n\nPeer joined the channel!\n```\nåŠ å…¥åº”ç”¨é€šé“çš„ä¸»è¦è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼Œåªä¸`Peer`èŠ‚ç‚¹æ‰“äº¤é“\n![åŠ å…¥åº”ç”¨é€šé“](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0003/åŠ å…¥åº”ç”¨é€šé“.jpeg)\n\nä¸»è¦æ­¥éª¤ï¼š\n- å®¢æˆ·ç«¯é¦–å…ˆåˆ›å»ºä¸€ä¸ª`ChaincodeSpec`ç»“æ„ï¼Œå…¶`input`ä¸­çš„`Args`ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯`cscc.JoinChain`ï¼ˆæŒ‡å®šè°ƒç”¨é…ç½®é“¾ç çš„æ“ä½œï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæ‰€åŠ å…¥é€šé“çš„é…ç½®åŒºå—ã€‚\n- åˆ©ç”¨`ChaincodeSpec`æ„é€ ä¸€ä¸ª`ChaincodeInvocationSpec`ç»“æ„ã€‚\n- åˆ©ç”¨`ChaincodeInvocationSpec`ï¼Œåˆ›å»º`Proposal`ç»“æ„å¹¶è¿›è¡Œç­¾åï¼Œ`channel`å¤´éƒ¨ç±»å‹ä¸º`CONFIG`ã€‚\n- å®¢æˆ·ç«¯é€šè¿‡`gRPC`å°†`Proposal`ç­¾ååå‘ç»™`Endorser`ï¼ˆæ‰€æ“ä½œçš„Peerï¼‰ï¼Œè°ƒç”¨\n  `ProcessProposal(ctx context.Context,in *SignedProposal,opts...grpc.CallOption)(*ProposalResponse,error)`æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚ä¸»è¦é€šè¿‡é…ç½®ç³»ç»Ÿé“¾ç ä»é…ç½®åŒºå—ä¸­è¯»å–é€šé“å†…å·²æœ‰æˆå‘˜çš„TLS CAæ ¹è¯ä¹¦ï¼ŒåŠ å…¥æœ¬åœ°çš„æ ¹è¯ä¹¦ä¿¡ä»»ç»“æ„ä¸­ï¼Œå¹¶è¿›è¡Œæœ¬åœ°é“¾ç»“æ„çš„åˆå§‹åŒ–å·¥ä½œã€‚\n  ![åŠ å…¥åº”ç”¨é€šé“-æµç¨‹](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0003/åŠ å…¥åº”ç”¨é€šé“æµç¨‹.jpeg)\n- åˆå§‹åŒ–å®Œæˆåï¼Œå³å¯æ”¶åˆ°æ¥è‡ªé€šé“å†…çš„`Gossip`æ¶ˆæ¯ç­‰ã€‚\n\nå…¶ä¸­ï¼Œå‘é€ç»™`Peer`çš„`SignedProposal`æ¶ˆæ¯ååˆ†å¸¸è§ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š\n```go\ntype SignedProposal struct {\n  // å­—èŠ‚ç æ ¼å¼çš„ææ¡ˆå†…å®¹\n  ProposalBytes []byte `protobuf:\"bytes,1,opt,name=proposal_bytes,json=proposalBytes,proto3\" json:\"proposal_bytes,omitempty\"`\n  // å¯¹ææ¡ˆå†…å®¹çš„ç­¾åï¼Œç­¾åäººéœ€è¦ä¸ºææ¡ˆå‘èµ·è€…ï¼ˆèº«ä»½ä¿¡æ¯åŒ…æ‹¬åœ¨ææ¡ˆå¤´éƒ¨ä¸­ï¼‰\n  Signature     []byte `protobuf:\"bytes,2,opt,name=signature,proto3\" json:\"signature,omitempty\"`\n}\n```\n![SignedProposalç»“æ„](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0003/SignedProposal.jpeg)\n\n`Peer`è¿”å›çš„`ProposalResponse`æ¶ˆæ¯å®šä¹‰å¦‚ä¸‹ï¼š\n```go\ntype ProposalResponse struct {\n  // æ¶ˆæ¯åè®®ç‰ˆæœ¬\n  Version int32 `protobuf:\"varint,1,opt,name=version\" json:\"version,omitempty\"`\n  // æ¶ˆæ¯åˆ›å»ºæ—¶çš„æ—¶é—´æˆ³\n  Timestamp *google_protobuf1.Timestamp `protobuf:\"bytes,2,opt,name=timestamp\" json:\"timestamp,omitempty\"`\n  // è¿”å›æ¶ˆæ¯ï¼ŒåŒ…æ‹¬çŠ¶æ€ã€æ¶ˆæ¯ã€å…ƒæ•°æ®è½½è·ç­‰\n  Response *Response `protobuf:\"bytes,4,opt,name=response\" json:\"response,omitempty\"`\n  // æ•°æ®è½½è·ï¼ŒåŒ…æ‹¬ææ¡ˆçš„Hashå€¼ï¼Œå’Œæ‰©å±•çš„è¡ŒåŠ¨ç­‰\n  Payload []byte `protobuf:\"bytes,5,opt,name=payload,proto3\" json:\"payload,omitempty\"`\n  // èƒŒä¹¦ä¿¡æ¯åˆ—è¡¨ï¼ŒåŒ…æ‹¬èƒŒä¹¦è€…çš„è¯ä¹¦ï¼Œä»¥åŠå…¶å¯¹\"è½½è·+èƒŒä¹¦è€…è¯ä¹¦\"çš„ç­¾å\n  Endorsement *Endorsement `protobuf:\"bytes,6,opt,name=endorsement\" json:\"endorsement, omitempty\"`\n}\n```\n**æ³¨æ„ï¼šæ‰§è¡ŒåŠ å…¥é€šé“å‘½ä»¤æˆåŠŸè¿”å›ï¼Œå¹¶ä¸ç¡®ä¿`Peer`æœ€ç»ˆèƒ½åŠ å…¥é€šé“ã€‚**\n\n### åˆ—å‡ºæ‰€åŠ å…¥çš„é€šé“\n`list`å­å‘½ä»¤ä¼šåˆ—å‡ºæŒ‡å®šçš„`Peer`èŠ‚ç‚¹å·²ç»åŠ å…¥çš„æ‰€æœ‰åº”ç”¨é€šé“çš„åˆ—è¡¨ã€‚åˆ—å‡ºé€šé“å‘½ä»¤ä¸»è¦é€šè¿‡è°ƒç”¨`Peer`çš„é…ç½®ç³»ç»Ÿé“¾ç è¿›è¡Œå¤„ç†ã€‚\nä¾‹å¦‚é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼Œå¯ä»¥åˆ—å‡ºæœ¬åœ°`Peer`èŠ‚ç‚¹å·²åŠ å…¥çš„æ‰€æœ‰åº”ç”¨é€šé“ã€‚\n```shell\npeer channel list\n\nChannels peers has joined to:\n    businesschannel\n    businesschannel2\n```\nåˆ—å‡ºæ‰€åŠ å…¥çš„åº”ç”¨é€šé“çš„ä¸»è¦è¿‡ç¨‹å¦‚ä¸‹ï¼Œä¸åŠ å…¥è¿‡ç¨‹ç±»ä¼¼ï¼Œå‘`Peer`å‘é€è¯·æ±‚ï¼Œæ³¨æ„ç±»å‹æ˜¯`ENDORSER_TRANSACTION`ã€‚\n![åˆ—å‡ºåŠ å…¥çš„æ‰€æœ‰é€šé“-æµç¨‹](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0003/åˆ—å‡ºåŠ å…¥çš„æ‰€æœ‰é€šé“-æµç¨‹.jpeg)\nå®ç°æµç¨‹å¦‚ä¸‹ï¼š\n![åˆ—å‡ºåŠ å…¥çš„æ‰€æœ‰é€šé“-å®ç°æµç¨‹](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0003/åˆ—å‡ºåŠ å…¥çš„æ‰€æœ‰é€šé“-å®ç°æµç¨‹.jpeg)\n\nä¸»è¦æ­¥éª¤ï¼š\n- å®¢æˆ·ç«¯é¦–å…ˆåˆ›å»ºä¸€ä¸ª`ChaincodeSpec`ç»“æ„ï¼Œå…¶`input`ä¸­çš„`Args`ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯`cscc.GetChannels`(æŒ‡å®šè°ƒç”¨é…ç½®é“¾ç çš„æ“ä½œ)ã€‚\n- åˆ©ç”¨`ChaincodeSpec`æ„é€ ä¸€ä¸ª`ChaincodeInvocationSpec`ç»“æ„\n- åˆ©ç”¨`ChaincodeInvocationSpec`åˆ›å»º`Proposal`ç»“æ„å¹¶è¿›è¡Œç­¾åï¼Œ`channel`å¤´éƒ¨ç±»å‹ä¸º`ENDORSER_TRANSACTION`ã€‚\n- å®¢æˆ·ç«¯é€šè¿‡`gRPC`å°†`Proposal`å‘ç»™`Endorser`ï¼ˆæ‰€æ“ä½œçš„Peerï¼‰ï¼Œè°ƒç”¨`ProcessProposal(ctx context.Context,in *SignedProposal,opts...grpc.CallOption)(*ProposalResponse,error)`æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚ä¸»è¦æ˜¯é€šè¿‡é…ç½®ç³»ç»Ÿé“¾ç æŸ¥è¯¢æœ¬åœ°é“¾ä¿¡æ¯å¹¶è¿”å›ã€‚\n- å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œå®¢æˆ·ç«¯ä¼šå—åˆ°æ¥è‡ªPeerç«¯çš„å›å¤æ¶ˆæ¯ï¼Œä»å…¶ä¸­æå–å‡ºåº”ç”¨é€šé“åˆ—è¡¨ä¿¡æ¯å¹¶è¾“å‡ºã€‚\n\nå…¶ä¸­ï¼Œæ¯”è¾ƒé‡è¦çš„æ•°æ®ç»“æ„åŒæ ·ä¹ŸåŒ…æ‹¬ChaincodeSpecã€ChaincodeInvocationSpecã€Proposalç­‰ï¼Œæ³¨æ„channelå¤´éƒ¨ç±»å‹ä»¥åŠChaincodeSpecç»“æ„ä¸­çš„æ•°æ®ä¸åŠ å…¥é€šé“çš„æ¶ˆæ¯ä¸­çš„ç•¥æœ‰å·®å¼‚ï¼Œ å¦‚ä¸‹å›¾ï¼š\n![SignedProposalç»“æ„](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0003/SignedProposal1.jpeg)\n\n### è·å–æŸåŒºå—\n`fetch`å­å‘½ä»¤ä¼šé¢å‘æ’åºæœåŠ¡è¿›è¡ŒæŸ¥è¯¢ï¼Œè·å–é€šé“çš„æŒ‡å®šåŒºå—ï¼Œå¹¶å†™å…¥æœ¬åœ°æ–‡ä»¶ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š\n```shell\npeer channel fetch [outputfile] j[flags]\n```\n\nè¯¥å­å‘½ä»¤æ”¯æŒçš„é€‰é¡¹åŒ…æ‹¬ï¼š\n- --bestEffort å¿½ç•¥é‡åˆ°çš„é”™è¯¯ï¼Œå°½æœ€å¤§åŠªåŠ›ç»§ç»­è·å–åŒºå—\n- -c, --channelID string æ‰€è·å–çš„é€šé“çš„åç§°\nä¾‹å¦‚ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼Œå¯ä»¥è·å–å·²å­˜åœ¨çš„`businesschannel`åº”ç”¨é€šé“çš„åˆå§‹åŒºå—ï¼Œå¹¶ä¿å­˜åˆ°æœ¬åœ°çš„`businesschannel.block`æ–‡ä»¶ï¼š\n```shell\npeer channel fetch oldest businesschannel1_0.block \\\n-c ${APP_CHANNEL} \\\n-o orderer:7050\n```\n```shell\npeer channel fetch 1 businesschannel1_1.block \\\n-c ${APP_CHANNEL} \\\n-o orderer:7050\n```\nè·å–åŒºå—çš„ä¸»è¦è¿‡ç¨‹å¦‚ä¸‹å›¾ï¼šï¼ˆä»¥æŒ‡å®šåŒºå—å·ä¸ºä¾‹ï¼‰ï¼Œä»æ’åºæœåŠ¡è·å–æŒ‡å®šçš„åŒºå—ã€‚\n![è·å–åŒºå—](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0003/è·å–åŒºå—.jpeg)\nå®ç°æµç¨‹\n![è·å–åŒºå—å®ç°æµç¨‹](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0003/è·å–åŒºå—å®ç°æµç¨‹.jpeg)\nä¸»è¦æ­¥éª¤ï¼š\n- å®¢æˆ·ç«¯æ„é€ `SeekInfo`ç»“æ„ï¼Œè¯¥ç»“æ„å¯ä»¥æŒ‡å®šè¦è·å–çš„åŒºå—èŒƒå›´ï¼ˆå¦‚æœè·å–é…ç½®åŒºå—ï¼Œå…ˆä»æœ€æ–°åŒºå—ä¸­è§£æé…ç½®åŒºå—å·ï¼Œç„¶åé€šè¿‡åŒºå—å·æŒ‡å®šï¼‰ã€‚è¿™é‡Œ`Start`å’Œ`Stop`æŒ‡å®šä¸ºç›®æ ‡åŒºå—ã€‚\n- å®¢æˆ·ç«¯åˆ©ç”¨`SeekInfo`ç»“æ„ï¼Œæ„é€ `Envelope`å¹¶è¿›è¡Œç­¾åï¼Œé€šè¿‡`deliverClient`ç»`gRPC`é€šé“å‘ç»™æ’åºæœåŠ¡çš„`Deliver()`æ¥å£ã€‚\n- ä»æ’åºæœåŠ¡è·å–æŒ‡å®šé€šé“çš„åŒºå—åï¼Œå†™åˆ°æœ¬åœ°æ–‡ä»¶ä¸­ã€‚\n\nå…¶ä¸­ï¼Œå‘å¾€æ’åºæœåŠ¡çš„`Envelope`ç»“æ„å¦‚ä¸‹ï¼š\n![Envelopeç»“æ„](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0003/Envelope1.jpeg)\n\n### æ›´æ–°é€šé“é…ç½®\n`update`å­å‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹ä¸`create`å‘½ä»¤ç±»ä¼¼ï¼Œä¼šå‘æ’åºæœåŠ¡å‘èµ·æ›´æ–°çš„é…ç½®äº¤æ˜“è¯·æ±‚ã€‚éœ€è¦æå‰åˆ›å»ºçš„é€šé“æ›´æ–°é…ç½®äº¤æ˜“æ–‡ä»¶æŒ‡å®šé…ç½®ä¿¡æ¯ï¼Œæ‰å¯æ‰§è¡Œè¯¥å‘½ä»¤ã€‚è¯¥å­å‘½ä»¤æ”¯æŒé€‰é¡¹åŒ…æ‹¬ï¼š\n- -c, --channelID string æ‰€æ›´æ–°çš„é€šé“åç§°ã€‚\n- -f, --file string æŒ‡å®šæ›´æ–°é€šé“æ‰€ç”¨çš„äº¤æ˜“æ–‡ä»¶\n\nå¦‚ä¸‹æ“ä½œæ¥æ›´æ–°é€šé“ä¸­çš„é”šèŠ‚ç‚¹é…ç½®ï¼Œé¦–å…ˆåˆ©ç”¨`configtxgen`æ¥åˆ›å»ºé”šèŠ‚ç‚¹é…ç½®æ›´æ–°æ–‡ä»¶ï¼Œä¹‹åä½¿ç”¨è¯¥æ›´æ–°æ–‡ä»¶å¯¹é€šé“è¿›è¡Œé…ç½®æ›´æ–°æ“ä½œï¼š\n```shell\nconfigtxgen \\\n -profile APP_CHANNEL_PROFILE \\\n -outputAnchorPeersUpdate ./update_anchors.tx \\\n -channelID ${APP_CHANNEL} \\\n -asOrg Org1MSP\n```\n```shell\npeer channel update \\\n -c ${APP_CHANNEL} \\\n -o orderer:7050 \\\n -f ./update_anchors.tx\n```\n\næ›´æ–°åº”ç”¨é€šé“çš„è¿‡ç¨‹å¦‚ä¸‹ï¼Œä¸åˆ›å»ºåº”ç”¨é€šé“è¿‡ç¨‹ç±»ä¼¼ï¼Œç›´æ¥å‘é€äº¤æ˜“æ›´æ–°è¯·æ±‚ç»™æ’åºæœåŠ¡ã€‚\n![æ›´æ–°é€šé“](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0003/æ›´æ–°é€šé“.jpeg)\nå®ç°æµç¨‹\n![æ›´æ–°é€šé“å®ç°æµç¨‹](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0003/æ›´æ–°é€šé“å®ç°æµç¨‹.jpeg)\n\nä¸»è¦æ­¥éª¤ï¼š\n- å®¢æˆ·ç«¯è¯»å–æŒ‡å®šçš„é…ç½®äº¤æ˜“æ–‡ä»¶ï¼Œæ„é€ ä¸€ä¸ªæ›´æ–°åº”ç”¨é€šé“çš„é…ç½®äº¤æ˜“ä¿¡å°ç»“æ„ï¼Œç¡®è®¤é€šé“å¤´éƒ¨ç±»å‹ä¸º`CONFIG_UPDATE`ï¼Œé€šé“IDå­˜åœ¨ä¸”ä¸å‘½ä»¤è¡Œä¸€è‡´ã€‚\n- å®¢æˆ·ç«¯å¯¹æ›´æ–°ä¿¡å°ç»“æ„è¿›è¡Œç­¾åï¼Œæœ€ç»ˆæ„é€ ç­¾åä¿¡å°ç»“æ„ï¼Œé€šé“å¤´éƒ¨ç±»å‹ä¸º`CONFIG_UPDATE`ã€‚\n- å®¢æˆ·ç«¯é€šè¿‡`gRPC`å‘é€é…ç½®äº¤æ˜“åˆ°æ’åºæœåŠ¡çš„`Broadcast`æ¥å£ã€‚\n- æ’åºæœåŠ¡æ”¶åˆ°`CONFIG_UPDATE`æ¶ˆæ¯åï¼Œåˆ¤æ–­æ˜¯é…ç½®æ¶ˆæ¯åï¼Œè¿›è¡Œé…ç½®ç›¸å…³å¤„ç†ã€‚\n  - è°ƒç”¨`ProcessConf igUpdateMsg()`å°è¯•æ¥å—é…ç½®ï¼Œè®¡ç®—æ–°é…ç½®ç»“æ„ï¼ˆå°è£…ä¸º`CONFIG`ç±»å‹çš„ä¿¡å°ç»“æ„ï¼‰å’Œå¯¹åº”çš„åºå·ï¼›\n  - æ’åºæœåŠ¡å°†æ–°çš„é…ç½®ä¿¡å°ç»“æ„å‘é€ç»™åç«¯é˜Ÿåˆ—ï¼ˆå¦‚Raftæˆ–Kafkaï¼‰è¿›è¡Œæ’åºï¼Œå¹¶å“åº”å®¢æˆ·ç«¯ç­”å¤ï¼›\n  - æ’åºå®Œæˆåï¼Œæ’åºæœåŠ¡å°†æ–°çš„é…ç½®äº¤æ˜“å­˜æ”¾åˆ°è´¦æœ¬ç»“æ„ä¸­ç­‰å¾…PeerèŠ‚ç‚¹è·å–ã€‚\n- å®¢æˆ·ç«¯åœ¨å‘å‡ºè¯·æ±‚åä¼šæ¥æ”¶åˆ°å“åº”ï¼Œä½†å®é™…è¯·æ±‚ä»åœ¨æ’åºæœåŠ¡å¼‚æ­¥è¿›è¡Œã€‚\n\n### è·å–é€šé“åŸºæœ¬ä¿¡æ¯\n`getinfo`å‘½ä»¤å¯ä»¥å‘æŒ‡å®šçš„`Peer`èŠ‚ç‚¹è·å–æŸä¸ªé€šé“çš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬é«˜åº¦ã€å½“å‰Hashã€å‰å¯¼åŒºå—Hashç­‰ã€‚è¯¥å­å‘½ä»¤æ”¯æŒé€‰é¡¹`-c`,`--channelID string`ï¼Œå³æ‰€è·å–ä¿¡æ¯çš„é€šé“çš„åç§°ã€‚ä¾‹å¦‚ï¼ŒæŸ¥è¯¢é»˜è®¤PeerèŠ‚ç‚¹ä¸Šbusinesschannelé€šé“çš„ä¿¡æ¯ï¼Œä»£ç å¦‚ä¸‹ï¼š\n```shell\n$ peer channel getinfo -c ${APP_CHANNEL}\n\nBlockchain info: {\"height\":7,\"currentBlockHash\":\"bHlVT/swOzeJ8JaTXyhStu40QL4JBx ZBD695FISJf2o=\",\"previousBlockHash\":\"ViDfGewz/GRg3wDz68dtg4s9NNojtq3ciBB4VcpGBuk=\"} \n```\n\nè·å–é€šé“åŸºæœ¬ä¿¡æ¯çš„ä¸»è¦è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸åˆ—å‡ºæ‰€åŠ å…¥é€šé“å‘½ä»¤ç±»ä¼¼ï¼Œé€šè¿‡è°ƒç”¨Peerçš„csccæ¥æŸ¥è¯¢ã€‚\n![è·å–é€šé“åŸºæœ¬ä¿¡æ¯](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0003/è·å–é€šé“ä¿¡æ¯.jpeg)\nå®ç°æµç¨‹\n![è·å–é€šé“åŸºæœ¬ä¿¡æ¯å®ç°æµç¨‹](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0003/è·å–é€šé“åŸºæœ¬ä¿¡æ¯å®ç°æµç¨‹.jpeg)\n\nä¸»è¦æ­¥éª¤ï¼š\n- å®¢æˆ·ç«¯é¦–å…ˆåˆ›å»ºä¸€ä¸ª`ChaincodeSpec`ç»“æ„ï¼Œå…¶`input`ä¸­çš„`Args`ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯cscc.Getchannelsï¼ˆæŒ‡å®šè°ƒç”¨é…ç½®é“¾ç çš„æ“ä½œï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæ‰€åŠ å…¥é€šé“çš„é…ç½®åŒºå—ã€‚\n- åˆ©ç”¨`ChaincodeSpec`æ„é€ ä¸€ä¸ª`ChaincodeInvocationSpec`ç»“æ„ã€‚\n- åˆ©ç”¨`ChaincodeInvocationSpec`ï¼Œåˆ›å»º`Proposal`ç»“æ„å¹¶è¿›è¡Œç­¾åï¼Œ`channel`å¤´éƒ¨ç±»å‹ä¸º`ENDORSER_TRANSACTION`ã€‚\n- å®¢æˆ·ç«¯é€šè¿‡`gRPC`å°†`Proposal`ç­¾ååå‘ç»™`Endorser`ï¼ˆæ‰€æ“ä½œçš„`Peer`ï¼‰ï¼Œè°ƒç”¨`ProcessProposal(ctx context.Context,in*SignedProposal,opts...grpc.CallOption)(*ProposalResponse,error)`æ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œä¸»è¦é€šè¿‡é…ç½®ç³»ç»Ÿé“¾ç è·å–å¯¹åº”è´¦æœ¬çš„åŸºæœ¬ä¿¡æ¯å¹¶è¿”å›å®¢æˆ·ç«¯ã€‚\n\n### å¯¹é€šé“é…ç½®æ›´æ–°æ·»åŠ ç­¾å\n`signconfigtx`å¯ä»¥å¯¹æœ¬åœ°çš„é€šé“æ›´æ–°äº¤æ˜“è¿›è¡Œç­¾åï¼Œå±äºå®¢æˆ·ç«¯æœ¬åœ°æ“ä½œï¼Œä¸ä¸`Peer`æˆ–`Orderer`æ‰“äº¤é“ã€‚è¯¥å­å‘½ä»¤æ”¯æŒé€‰é¡¹`-f`,`--file string`ï¼Œå³æŒ‡å®šæ‰€ç­¾åçš„é€šé“é…ç½®æ›´æ–°äº¤æ˜“æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œå¯¹æœ¬åœ°çš„é€šé“é…ç½®æ›´æ–°æ·»åŠ ç­¾åï¼Œä»£ç å¦‚ä¸‹ï¼š\n```shell\npeer channel signconfigtx -f config_delta_env.pb \n```","categories":["åŒºå—é“¾","Fabric","é˜…è¯»æ‘˜å½•"]},{"title":"å»ä¸­å¿ƒåŒ–èº«ä»½(DID)","url":"/2023/01/13/å»ä¸­å¿ƒåŒ–èº«ä»½-DID/","content":"\n# å¯¼è¯»\nä»Šå¤©ï¼Œæˆ‘ä»¬çš„ç”Ÿæ´»ä¸ä½¿ç”¨çš„åº”ç”¨å’ŒæœåŠ¡çš„è”ç³»è¶Šæ¥è¶Šç´§å¯†ã€‚ä½¿ç”¨ç”µå­å•†åŠ¡è¿›è¡Œç½‘ä¸Šè´­ç‰©ï¼Œä½¿ç”¨ç¤¾äº¤ç½‘ç»œäº¤æµï¼Œä½¿ç”¨ç”µå­é‚®ä»¶è¿›è¡Œå·¥ä½œæ²Ÿé€šï¼Œè¿™æ ·çš„ä¾‹å­ä¸èƒœæšä¸¾ã€‚\n\nä½¿ç”¨è¿™äº›æœåŠ¡éœ€è¦è¯æ˜æˆ‘ä»¬çš„èº«ä»½å’Œæˆæƒã€‚è™½ç„¶æˆ‘ä»¬ä¹ æƒ¯äºæä¾›ä½çº§åˆ«çš„èº«ä»½ä¿¡æ¯ï¼Œå¦‚å§“åå’Œç”µå­é‚®ä»¶åœ°å€ï¼Œä½†å…¶å®ƒæœåŠ¡å¯èƒ½éœ€è¦ä¸€ä¸ªé«˜çº§åˆ«çš„èº«ä»½ï¼Œå¦‚é©¾é©¶æ‰§ç…§ã€‚\n\nç„¶è€Œï¼Œç›®å‰çš„èº«ä»½ç®¡ç†ç³»ç»Ÿæœ‰å‡ ä¸ªç¼ºé™·ï¼š\n- æ•°æ®ä¸­å¿ƒåŒ–ï¼Œæ•°æ®ç”±æœåŠ¡æä¾›è€…å­˜å‚¨ç”¨æˆ·æ•°æ®ï¼Œå­˜å‚¨åœ¨æœåŠ¡æä¾›è€…çš„æœåŠ¡å™¨ä¸­ã€‚\n- å®‰å…¨é£é™©ï¼Œå› ä¸ºæ¶æ„è¡Œä¸ºè€…å¯èƒ½ç ´åæœåŠ¡å™¨å¹¶çªƒå–ä½ çš„ä¿¡æ¯ã€‚\n\nå»ä¸­å¿ƒåŒ–èº«ä»½æ”¹è¿›äº†ç°æœ‰çš„èº«ä»½ç®¡ç†æ ‡å‡†ï¼Œè®©ç”¨æˆ·å¯¹ä¸ªäººæ•°æ®æœ‰æ›´å¤§çš„æ§åˆ¶åŠ›ã€‚åœ¨ä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„èº«ä»½æ¡†æ¶ä¸­ï¼Œä¸ªäººå­˜å‚¨ä»–ä»¬çš„èº«ä»½ä¿¡æ¯ï¼Œå¹¶é€‰æ‹©ä¸ç¬¬ä¸‰æ–¹åˆ†äº«å“ªäº›ä¿¡æ¯ã€‚å› ä¸ºåœ¨å»ä¸­å¿ƒåŒ–çš„æ ‡è¯†ç¬¦è¢«å­˜å‚¨åœ¨åŒºå—é“¾ç½‘ç»œä¸­ï¼Œå®ƒä»¬æ˜¯é˜²ç¯¡æ”¹çš„ï¼Œå®‰å…¨çš„ï¼Œå¹¶ä¸”å¯ä»¥è¢«ä»»ä½•äººå³æ—¶éªŒè¯çš„ã€‚è¿™å‡å°‘äº†åœ¨æœåŠ¡å™¨ä¸­å­˜å‚¨èº«ä»½ä¿¡æ¯çš„éœ€è¦ï¼Œä½¿ç”¨æˆ·æ›´å®¹æ˜“æ— ç¼è®¿é—®æœåŠ¡ã€‚\n\næœ¬æ–‡è¯¦ç»†è§£é‡Šäº†å»ä¸­å¿ƒåŒ–èº«ä»½æ„å‘³ç€ä»€ä¹ˆï¼Œå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠä¸ºä»€ä¹ˆå®ƒå¾ˆé‡è¦ã€‚æœ¬æ–‡å°†æ¶µç›–ä¸€äº›å…³é”®çš„æ¦‚å¿µï¼Œå¦‚å»ä¸­å¿ƒåŒ–çš„æ ‡è¯†ç¬¦å’Œå»ä¸­å¿ƒåŒ–çš„è®¤è¯ï¼Œå¹¶æ¢ç´¢ç°æœ‰çš„å»ä¸­å¿ƒåŒ–èº«ä»½é¡¹ç›®ã€‚\n\n# å»ä¸­å¿ƒåŒ–èº«ä»½æ„å‘³ç€ä»€ä¹ˆï¼Ÿ\nå»ä¸­å¿ƒåŒ–èº«ä»½æ˜¯ä¸€ç§æ–°çš„èº«ä»½å’Œè®¿é—®ç®¡ç†ï¼ˆIAM: Identity and Access Managementï¼‰å½¢å¼ï¼Œä¸å†æ˜¯ç”¨æˆ·ä¿¡æ¯çš„é›†ä¸­å­˜å‚¨ã€‚å»ä¸­å¿ƒåŒ–èº«ä»½æ”¯æŒä¸ªäººå¯¹å…¶æ•°æ®çš„æ§åˆ¶ï¼Œå› æ­¤å®ƒä¹Ÿè¢«ç§°ä¸ºè‡ªæˆ‘ä¸»æƒèº«ä»½ï¼ˆSSI: Self-Sovereign Identity)ã€‚\n\né€šä¿—åœ°è¯´ï¼Œå»ä¸­å¿ƒåŒ–èº«ä»½å…è®¸ä½ æ‹¥æœ‰è‡ªå·±çš„èº«ä»½ã€‚é‚£ä¹ˆï¼Œå®ƒåœ¨å®è·µä¸­æ˜¯å¦‚ä½•è¿ä½œçš„å‘¢ï¼Ÿä½ çš„èº«ä»½æ˜¯ç‹¬ä¸€æ— äºŒç”¨æ¥æè¿°ä½ çš„å±æ€§å’Œå‡­è¯çš„é›†åˆã€‚ä¸€äº›èº«ä»½æ ‡è¯†å¯èƒ½æ˜¯è‡ªæˆ‘æ‹¥æœ‰çš„ï¼Œå¦‚ä½ çš„åå­—ã€ç”Ÿæ—¥ã€ç”µå­é‚®ä»¶åœ°å€ã€ç”¨æˆ·åã€‚è€Œæœ‰äº›å¯èƒ½æ˜¯æœºæ„é¢å‘çš„ï¼Œå¦‚å¤§å­¦å­¦ä½ã€é©¾é©¶æ‰§ç…§æˆ–æŠ¤ç…§ç¼–å·ã€‚\n\nåœ¨å»ä¸­å¿ƒåŒ–èº«ä»½ç®¡ç†ä¸­ï¼Œç”¨æˆ·åœ¨`æ•°å­—é’±åŒ…`ä¸­å­˜å‚¨å‡­è¯å’Œä¸ªäººä¿¡æ¯ã€‚å°±åƒç°å®ç”Ÿæ´»ä¸­çš„é’±åŒ…ä¸€æ ·ï¼Œæ•°å­—é’±åŒ…ä¿å­˜ç€ä½ çš„èº«ä»½è¯æ˜ï¼Œå¦‚ä½ çš„æ‰§ç…§æˆ–èº«ä»½è¯ã€‚\n\nå»ä¸­å¿ƒåŒ–èº«ä»½æ ‡è¯†å°†èº«ä»½ä¿¡æ¯çš„å­˜å‚¨åœ¨åˆ†å¸ƒå¼çš„è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œå¦‚åˆ†å¸ƒå¼è´¦æœ¬æˆ–åŒºå—é“¾ï¼ˆ[è¿™é‡Œæœ‰ä¸€ä¸ªè§†é¢‘ä»‹ç»](https://www.youtube.com/watch?v=gWfAIYXcyH4))ï¼Œä½¿ç”¨åˆ†å¸ƒå¼å¸æœ¬æ¥ä¿å­˜èº«ä»½è¦ç´ ï¼Œä½¿å…¶å…äºè¢«ç¯¡æ”¹å’Œç›—çªƒã€‚å› æ­¤ï¼Œå³ä½¿ä½ çš„èº«ä»½ä¿¡æ¯æ˜¯ä»¥ç”µå­æ ¼å¼è®°å½•çš„ï¼Œå®ƒä¹Ÿä¸èƒ½è¢«æ›´æ”¹ã€çªƒå–æˆ–åˆ é™¤ã€‚\n\nåˆ†å¸ƒå¼è´¦æœ¬å›ºæœ‰çš„é€æ˜åº¦ä½¿èº«ä»½ä¿¡æ¯å¯ä»¥ç«‹å³å¾—åˆ°éªŒè¯ï¼Œè€Œä¸ä¸€å®šè¦ä¾èµ–å‘è¡Œè€…ã€‚\n\nä¸‹é¢æ˜¯ä¸€ä¸ªå…³äºå»ä¸­å¿ƒåŒ–èº«ä»½å¦‚ä½•è¿ä½œçš„ç®€è¦è¯´æ˜ï¼š\n- ä¸€ä¸ªç»„ç»‡ï¼ˆäº¤é€šè­¦å¯Ÿå¤§é˜Ÿï¼‰æƒ³ç»™ä½ ï¼ˆç”¨æˆ·ï¼‰å‘ä¸€ä¸ªè¯ä¹¦ï¼ˆé©¾é©¶æ‰§ç…§ï¼‰ã€‚ä½ å‘é€ä½ çš„é’±åŒ…åœ°å€ï¼Œè¿™æ˜¯åˆ†å¸ƒå¼è´¦æœ¬æˆ–åŒºå—é“¾ä¸Šç”¨äºå­˜å‚¨æ•°æ®çš„ç‰¹å®šä½ç½®ã€‚ç„¶åDMV(äº¤é€šè­¦å¯Ÿå¤§é˜Ÿï¼Œä¸‹æ–‡ä½¿ç”¨ç®€å†™DMV)ç”¨å…¶ç§é’¥ç­¾ç½²äº¤æ˜“ï¼Œå°†å‡­è¯å‘é€åˆ°ä½ çš„æ•°å­—é’±åŒ…ã€‚\n- ç°åœ¨ï¼Œä½ å¯ä»¥åœ¨ä»»ä½•æ—¶å€™åˆ†äº«è¿™ä¸ªå‡­è¯ï¼Œä»¥ç¡®å®šä½ çš„èº«ä»½ã€‚ä¾‹å¦‚åœ¨å®Œæˆè´·æ¬¾ç”³è¯·æ—¶ã€‚ä½¿ç”¨ä¸€ä¸ªå—ä¿¡ä»»çš„å·¥å…·ï¼Œå¯¹æ–¹å¯ä»¥æ£€æŸ¥ä½ çš„å‡­è¯çš„æœ‰æ•ˆæ€§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯¥å·¥å…·æ£€æŸ¥å…¬é’¥å’Œäº¤æ˜“ç»†èŠ‚ï¼Œä»¥ç¡®è®¤å‘è¡Œæœºæ„å’Œå‘è¡Œæ—¥æœŸã€‚\n- è¯·æ³¨æ„ï¼Œä¿¡æ¯æœ¬èº«å¹¶ä¸å­˜å‚¨åœ¨åŒºå—é“¾ä¸Šã€‚ç›¸åï¼ŒåŒºå—é“¾ä¼šç”Ÿæˆä¸€ä¸ªä¸å¯æ”¹å˜çš„äº¤æ˜“è®°å½•ï¼Œçœ‹åˆ°ä¿¡æ¯ä»å‘è¡Œæœºæ„ä¼ é€’ç»™ä½ ã€‚è¿™ç§`æ•°å­—æŒ‡çº¹`ï¼ˆä¹Ÿç§°ä¸ºå•¥å¸Œå€¼ï¼‰å¯¹æ¯ä¸ªå‡­è¯æ¥è¯´éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œå¯ä»¥å¯é åœ°è¯æ˜ä½ çš„æ‰€æœ‰æƒã€‚\n\nå»ä¸­å¿ƒåŒ–èº«ä»½ç”Ÿæ€ç³»ç»Ÿä¸­çš„å„ç§å‚ä¸è€…åŒ…æ‹¬ï¼š\n- ç”¨æˆ·ï¼šæ‹¥æœ‰å’Œä½¿ç”¨èº«ä»½ä¿¡æ¯ç‰‡æ®µçš„ä¸ªäººã€‚åƒæˆ‘ä»¬è¿™æ ·çš„ç”¨æˆ·å¯ä»¥å°†å„ç§èº«ä»½ä¿¡æ¯ä¿å­˜åœ¨æ•°å­—é’±åŒ…ä¸­ï¼Œå¹¶åœ¨éœ€è¦æ—¶åˆ†äº«å®ƒä»¬ã€‚\n- å‡­è¯æœºæ„ï¼ˆIssuerï¼‰ï¼šå‘ç”¨æˆ·å‘æ”¾å‡­è¯çš„ç»„ç»‡å’Œæœºæ„ã€‚è¿™å¯ä»¥æ˜¯åœ°æ–¹ç¨åŠ¡å±€ï¼Œé›‡ä¸»ï¼Œå­¦æœ¯æœºæ„ï¼Œä»¥åŠä»»ä½•å¯ä»¥å‘å¸ƒèº«ä»½ä¿¡æ¯çš„å®ä½“ã€‚\n- éªŒè¯äººï¼šéœ€è¦èº«ä»½ä¿¡æ¯æ¥å»ºç«‹ä¿¡ä»»å’ŒæˆäºˆæœåŠ¡è®¿é—®æƒçš„ç¬¬ä¸‰æ–¹ã€‚ä¾‹å¦‚ï¼Œä¸€å®¶ç”µå•†ç½‘åº—åœ¨å…è®¸ä½ è´­ä¹°æŸäº›ç‰©å“ä¹‹å‰ï¼Œå¯èƒ½éœ€è¦ä½ çš„å¹´é¾„æˆ–å…¬æ°‘èº«ä»½è¯æ˜ã€‚ä½ æä¾›çš„ä»»ä½•ä¿¡æ¯éƒ½éœ€è¦å¾—åˆ°é€‚å½“çš„éªŒè¯ã€‚\n  ![å»ä¸­å¿ƒåŒ–èº«ä»½ç”Ÿæ€ç³»ç»Ÿæ¦‚è¿°](å»ä¸­å¿ƒåŒ–èº«ä»½-DID/1.png)\n\n# å»ä¸­å¿ƒåŒ–èº«ä»½æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ\nä¸‡ç»´ç½‘è”ç›Ÿï¼ˆW3Cï¼‰å°†å»ä¸­å¿ƒåŒ–èº«ä»½ï¼ˆDIDï¼‰å®šä¹‰ä¸ºä¸€ç§å¯éªŒè¯çš„ã€å»ä¸­å¿ƒåŒ–çš„æ•°å­—èº«ä»½å½¢å¼ã€‚DIDå¯ä»¥ä¸ºä»»ä½•å®ä½“åˆ›å»ºï¼ŒåŒ…æ‹¬ä¸€ä¸ªç»„ç»‡ã€ä¸ªäººï¼Œç”šè‡³ä¸€ä¸ªè®¾å¤‡ã€‚\n\nDIDæ—¨åœ¨ç”±ç”¨æˆ·æ§åˆ¶ï¼Œå­˜å‚¨åœ¨ä¸€ä¸ªå»ä¸­å¿ƒåŒ–çš„æ¶æ„ä¸­ï¼Œå¦‚ç‚¹å¯¹ç‚¹ç½‘ç»œæˆ–åˆ†å¸ƒå¼è´¦æœ¬ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªä¸­å¿ƒåŒ–çš„ç™»è®°è–„ã€‚å› æ­¤ï¼ŒDIDåœ¨å¯†ç å­¦ä¸Šæ˜¯å®‰å…¨çš„ï¼Œå¯ä»¥æŠµå¾¡å˜åŒ–ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸ä¾èµ–åŸå§‹å‘è¡Œè€…çš„æƒ…å†µä¸‹è¿›è¡ŒéªŒè¯ã€‚\n\n# å»ä¸­å¿ƒåŒ–èº«ä»½å’Œå¯éªŒè¯å‡­è¯\nå¯éªŒè¯å‡­è¯æ˜¯å¯¹DIDçš„è¡¥å……ï¼Œä¸ºå»ä¸­å¿ƒåŒ–èº«ä»½ç®¡ç†æä¾›æ”¯æŒã€‚W3Cå°†å¯éªŒè¯å‡­è¯å®šä¹‰ä¸ºâ€œå¯éªŒè¯å‡­è¯ä»£è¡¨å‘è¡Œäººä»¥é˜²ç¯¡æ”¹å’Œå°Šé‡éšç§çš„æ–¹å¼åšå‡ºçš„å£°æ˜â€ã€‚\n\nå½“ä¸€æ‰€å¤§å­¦é¢å‘å­¦æœ¯è¯ä¹¦æ—¶ï¼Œå®ƒæ˜¯åœ¨â€œç”³é¢†â€æ¥å—è€…å·²ç»æ¥å—äº†ä¸€å®šæ—¶æœŸçš„æ•™è‚²ã€‚åŒæ ·ï¼Œç–«è‹—æ¥ç§è¯ä¹¦æ˜¯ç”³é¢†äººå·²ç»æ¥å—äº†ç–«è‹—ã€‚è™½ç„¶è¿™äº›ç”³é¢†å·²ç»ä½œä¸ºå®ä½“æ–‡ä»¶å­˜åœ¨ï¼Œä½†åœ¨ç½‘ä¸Šä½¿ç”¨å®ƒä»¬ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ã€‚è®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨KYC(äº†è§£ä½ çš„å®¢æˆ·)è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä¸Šä¼ é©¾é©¶æ‰§ç…§æ¥éªŒè¯ä½ åœ¨KYCæ³¨å†Œæ—¶çš„å¹´é¾„ã€‚\n\n- é¦–å…ˆï¼ŒæœåŠ¡æä¾›è€…ä¸èƒ½ç¡®è®¤å‡­è¯çš„çœŸå®æ€§ã€‚\n- ç¬¬äºŒï¼Œä½ çš„ç§äººä¿¡æ¯ç°åœ¨è¢«å‚¨å­˜åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œå¢åŠ äº†èº«ä»½è¢«ç›—çš„é£é™©ã€‚\n- ç¬¬ä¸‰ï¼Œä½ éœ€è¦å­˜å­˜å¥½æ‰§ç…§çš„å®ä½“å‰¯æœ¬ï¼Œå› ä¸ºå¦‚æœå®ä½“æ‰§ç…§ä¸¢å¤±äº†ï¼Œé‚£ä¹ˆä½ å°±æ— æ³•è¯æ˜ä½ çš„èº«ä»½ã€‚\n  \nå¯éªŒè¯å‡­è¯å¯ä»ä¸‰ä¸ªæ–¹é¢è§£å†³è¿™äº›é—®é¢˜ï¼š\n- ä½¿ç”¨`é›¶çŸ¥è¯†è¯æ˜`æ¥è¯æ˜ç”³é¢†æ•°æ®çš„æœ‰æ•ˆæ€§è€Œä¸é€éœ²ç§äººä¿¡æ¯\n- ä½¿ç”¨å…¬é’¥å¯†ç å­¦æ¥éªŒè¯å‡­è¯å‘å¸ƒæœºæ„\n- å°†ä¿¡æ¯å­˜å‚¨åœ¨å¯éªŒè¯çš„æ•°æ®æ³¨å†Œå¤„ï¼ˆåŒºå—é“¾ã€åˆ†å¸ƒå¼å¸æœ¬ï¼‰\n  \nä½¿ç”¨æˆ‘ä»¬æœ€åˆçš„ä¾‹å­ï¼Œä½ å°±ä¸éœ€è¦åœ¨KYCæœŸé—´ä¸Šä¼ æ•´ä¸ªé©¾é©¶çƒ­ç…§ã€‚ç›¸åï¼Œä½ å¯ä»¥åªåˆ†äº«ä¸€ä¸ªå¯éªŒè¯å‡­è¯çš„é“¾æ¥ã€‚å¯éªŒè¯å‡­è¯ä½¿ç”¨é›¶çŸ¥è¯†è¯æ˜æ¥ä¿æŠ¤èº«ä»½æŒæœ‰äººçš„éšç§ã€‚é›¶çŸ¥è¯†è¯æ˜æœ‰åŠ©äºè¯æ˜ä¿¡æ¯çš„çœŸå®æ€§ï¼Œè€Œä¸ä¼šå°†æ•´ä¸ªä¿¡æ¯é€éœ²ç»™ç¬¬ä¸‰æ–¹ã€‚è®©æˆ‘ä»¬ç”¨é©¾é©¶æ‰§ç…§çš„ä¾‹å­æ¥è§£é‡Š`ZK-proof`å¦‚ä½•ä¿æŠ¤ä½ çš„éšç§ã€‚æœåŠ¡æä¾›è€…å®é™…ä¸Šä¸ä¼šçœ‹åˆ°é©¾ç…§ä¸Šåˆ—å‡ºçš„ä½ çš„å‡ºç”Ÿæ—¥æœŸã€‚ç„¶è€Œï¼Œè¯¥è¯ä¹¦å°†é€šè¿‡å…¬é’¥è¯†åˆ«å‘è¡Œè€…ï¼ˆDMV)ã€‚ç”±äºDMVåªå‘ä¸€å®šå¹´é¾„èŒƒå›´å†…çš„ä¸ªäººå‘æ”¾æ‰§ç…§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å‡è®¾ä½ çš„å¹´é¾„æ˜¯æ­£ç¡®çš„ã€‚ä¸‹å›¾å±•ç¤ºäº†å¯éªŒè¯å‡­è¯ï¼ˆVCï¼‰å¦‚ä½•å·¥ä½œã€‚\n  ![å¯éªŒè¯å‡­è¯ï¼ˆVCï¼‰å¦‚ä½•å·¥ä½œ](å»ä¸­å¿ƒåŒ–èº«ä»½-DID/2.jpeg)\n  \n  å¯éªŒè¯å‡­è¯å­˜å‚¨åœ¨ä¸å¯æ”¹å˜çš„åŒºå—é“¾ä¸Šï¼Œè¿™æ„å‘³ç€åªè¦ä½ æœ‰é’±åŒ…å’Œç§é’¥ï¼Œä½ å°±å¯ä»¥è®¿é—®å®ƒä»¬ã€‚å®ƒä»¬ä¸èƒ½è¢«ç ´åã€ä¿®æ”¹ã€å·çªƒæˆ–åˆ é™¤ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œå®ƒä»¬ä¸åœ¨å‘è¡Œæœºæ„çš„æ§åˆ¶ä¹‹ä¸‹ã€‚\n\n  å¯éªŒè¯å‡­è¯æ˜¯å»ä¸­å¿ƒåŒ–èº«ä»½ç®¡ç†çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ã€‚æœ‰äº†å¯éªŒè¯å‡­è¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºç‰©ç†å‡­è¯çš„æ•°å­—ç‰ˆæœ¬ï¼Œå¹¶åœ¨ç½‘ä¸Šä½¿ç”¨å®ƒä»¬ï¼Œè€Œä¸å¿…æŠ«éœ²è¶…è¿‡å¿…è¦çš„ä¿¡æ¯ã€‚ç¬¬ä¸‰æ–¹å¯ä»¥å¾ˆå®¹æ˜“åœ°ç¡®è®¤è¿™äº›å‡­è¯çš„çœŸå®æ€§ï¼Œè€Œä¸éœ€è¦ä¾èµ–å‘è¯æœºæ„ã€‚\n\n# ä»€ä¹ˆæ˜¯å»ä¸­å¿ƒåŒ–è®¤è¯ï¼Ÿ\nCOVID-19çš„å¤§æµè¡Œè¿…é€ŸåŠ é€Ÿäº†å‘æ•°å­—ç”Ÿæ´»æ–¹å¼çš„è½¬å˜ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥é€‰æ‹©åœ¨å®¶é‡Œåšé“¶è¡Œä¸šåŠ¡ã€è§†é¢‘ä¼šè®®ã€é€šä¿¡å’Œè´­ç‰©ç­‰äº‹æƒ…ã€‚\n\nè®¿é—®è¿™äº›å¹³å°éœ€è¦éªŒè¯ä½ çš„èº«ä»½è·å¾—ä½¿ç”¨è¿™äº›æœåŠ¡çš„è®¸å¯ä»¥ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªé“¶è¡Œç½‘ç«™å¯èƒ½è¦æ±‚ä½ æä¾›ä¸€ä¸ªç”µå­é‚®ä»¶åœ°å€å’Œå¯†ç ã€‚ç„¶è€Œï¼Œä¼ ç»Ÿçš„è®¤è¯å¯èƒ½ä¼šæœ‰ç›¸å½“å¤šçš„é—®é¢˜ã€‚ä½ ä¸ä»…è¦ä¸ºä¸åŒçš„æœåŠ¡åˆ›å»ºå¤šä¸ªç™»å½•åï¼Œè€Œä¸”å¿…é¡»è®°ä½æ¯ä¸€ä¸ªç™»å½•åï¼Œå¦åˆ™æœ‰å¯èƒ½å¤±å»è®¿é—®æƒã€‚ç”¨æˆ·å¯èƒ½åœ¨å¤šä¸ªç½‘ç«™ä¸Šé‡å¤ä½¿ç”¨å¯†ç ï¼Œä»¥ä½¿åœ¨çº¿è®¤è¯æ›´å®¹æ˜“ï¼Œä½†è¿™åªä¼šå¢åŠ èº«ä»½è¢«ç›—çš„é£é™©ã€‚å¦‚æœé»‘å®¢çªƒå–ä¸€ä¸ªå¯†ç ï¼Œä»–ä»¬å¯ä»¥è½»æ˜“åœ°åœ¨åå‡ ä¸ªä¸åŒçš„å¹³å°ä¸Šå†’å……ä½ ã€‚\n![åŸºäºå¯†ç è®¤è¯çš„é—®é¢˜](å»ä¸­å¿ƒåŒ–èº«ä»½-DID/3.jpeg)\nç»Ÿä¸€ç™»å½•è®¤è¯æ˜¯ç›®å‰çš„è§£å†³æ–¹æ¡ˆä¹‹ä¸€ï¼Œæ—¨åœ¨ä½¿åœ¨çº¿è®¤è¯æ›´å®¹æ˜“å’Œæ›´å®‰å…¨ã€‚åœ¨è¿™é‡Œï¼Œä¸€ç»„å®ä½“åŒæ„ä¾é ä¸€ä¸ªæ¥æºæ¥è·å¾—èº«ä»½ä¿¡æ¯ã€‚ç»Ÿä¸€ç™»å½•è®¤è¯çš„ä¸€ä¸ªå¾ˆå¥½çš„ä½ ä¾‹å­æ˜¯ç”¨ä½ çš„Facebookæˆ–è°·æ­Œå¸æˆ·ï¼ˆå›½å†…é€šå¸¸æ˜¯å¾®ä¿¡ï¼‰ç™»å½•ä¸€ä¸ªç½‘ç«™ã€‚\n\nä½†ç»Ÿä¸€ç™»å½•è®¤è¯å¹¶ä¸æ˜¯é“¶å¼¹ã€‚ä½ çš„èº«ä»½ä¿¡æ¯ä»ç„¶æ‰˜ç®¡åœ¨ä¸€ä¸ªä¸­å¤®æœåŠ¡å™¨ä¸Šï¼ˆFacebookå’ŒGoogleï¼‰ï¼Œæ‰€ä»¥æ•°æ®æ³„æ¼æˆ–èº«ä»½ç›—çªƒçš„é£é™©ä»ç„¶å­˜åœ¨ã€‚\n![ç»Ÿä¸€ç™»å½•è®¤è¯ç³»ç»Ÿä¾é ç¬¬ä¸‰æ–¹æœåŠ¡æ¥éªŒè¯èº«ä»½](å»ä¸­å¿ƒåŒ–èº«ä»½-DID/4.jpeg)\n\nåˆ†å¸ƒå¼è®¤è¯æ˜¯ä¸€ä¸ªè¾ƒæ–°çš„æ¦‚å¿µï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨å¯éªŒè¯å‡­è¯æ¥è®¿é—®åœ¨çº¿æœåŠ¡ã€‚å‡è®¾ä½ æƒ³è®¿é—®ä¸€ä¸ªç½‘ä¸Šé“¶è¡ŒæœåŠ¡ã€‚ä½ å¯ä»¥æäº¤ä¸€ä¸ªæ¥è‡ªæ”¿åºœæœºæ„çš„å¯éªŒè¯å‡­è¯æ¥è¯æ˜ä½ çš„èº«ä»½ï¼Œè€Œä¸æ˜¯æäº¤èº«ä»½è¯ä»¶ã€‚è¿™å°±ä¸éœ€è¦é“¶è¡Œåœ¨æˆäºˆè®¿é—®æƒä¹‹å‰è¦æ±‚å¹¶å­˜å‚¨ä½ çš„ä¿¡æ¯ã€‚è€Œä¸”ï¼Œä½ å°†æ¥ä¸éœ€è¦ä¸€ä¸ªè´¦æˆ·æ¥ç™»å½•ï¼Œå› ä¸ºæœåŠ¡æä¾›è€…å¯ä»¥ç­¾å‘ä¸€ä¸ªå¯éªŒè¯å‡­è¯æ¥è¿›è¡ŒæŒç»­éªŒè¯ã€‚ç™»å½•ç½‘ç«™å°†ä½è¿æ¥ä½ çš„æ•°å­—é’±åŒ…ä¸€æ ·ç®€å•ï¼\n![å»ä¸­å¿ƒåŒ–è®¤è¯ä¸ä¼ ç»Ÿè®¤è¯](å»ä¸­å¿ƒåŒ–èº«ä»½-DID/5.jpeg)\n\n# ä¸ºä»€ä¹ˆå»ä¸­å¿ƒåŒ–èº«ä»½å¾ˆé‡è¦ï¼Ÿ\nå»ä¸­å¿ƒåŒ–èº«ä»½æœ‰æœ›å½»åº•æ”¹å˜æˆ‘ä»¬çš„æ•°æ®å…±äº«æ–¹å¼ã€‚ä»¥ä¸‹æ˜¯å»ä¸­å¿ƒåŒ–èº«ä»½ç®¡ç†çš„ä¸€äº›å¥½å¤„ï¼š\n- æ›´å®¹æ˜“è®¤è¯\n---\nå»ä¸­å¿ƒåŒ–èº«ä»½å¯ä»¥æ¶ˆé™¤å¯†ç å’Œæ¼äººçš„å¤šå› ç´ è®¤è¯åè®®ã€‚æœ‰äº†æ— å¯†ç è®¤è¯ï¼Œä½¿ç”¨åœ¨çº¿æœåŠ¡å˜å¾—æ›´å®¹æ˜“å’Œæ›´å¿«ï¼Œå› ä¸ºä½ ä¸éœ€è¦è¾“å…¥é•¿å¯†ç ã€‚ç»„ç»‡æœºæ„å¯ä»¥å¿«é€ŸéªŒè¯ç”¨æˆ·èº«ä»½ï¼Œè€Œä¸å¼ºè¿«ä»–ä»¬æ¥å—ç¹ççš„KYCæµç¨‹ã€‚è´·æ¬¾ç”³è¯·ã€æ”¿åºœæ³¨å†Œã€ç½‘ç«™æ³¨å†Œï¼Œæ‰€æœ‰è¿™äº›éƒ½ä¼šæ›´å¿«å‘ç”Ÿï¼Œå› ä¸ºæœåŠ¡æä¾›è€…å¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹å·¥å…·æ¥éªŒè¯ä½ çš„èº«ä»½ã€‚\n\n- æ›´å¥½çš„æ•°æ®å®‰å…¨\n---\nå¦‚å‰æ‰€è¿°ï¼Œè®¸å¤šç»„ç»‡è¦æ±‚æ–°ç”¨æˆ·æäº¤èº«ä»½ä¿¡æ¯ã€‚è¿™ä¸ªä¹Ÿä¸æ˜¯å¤§é—®é¢˜ï¼Œä½†æ˜¯å¾ˆå¤šå…¬å¸åœ¨ä¿æŠ¤ç”¨æˆ·æ•°æ®æ–¹é¢è¢«è¯æ˜æ˜¯è‰ç‡çš„ã€‚ç°ä»£æ•°æ®ä¸­å¿ƒæ˜¯é»‘å®¢çš„èœœç½ï¼Œæ•°æ®æ³„éœ²å·²å¯¼è‡´ä¼ä¸šå’Œæ¶ˆè´¹è€…çš„å·¨å¤§æŸå¤±ã€‚\n\nä¸€ä¸ªå»ä¸­å¿ƒåŒ–èº«ä»½æ¡†æ¶æ¶ˆé™¤äº†é›†ä¸­å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„éœ€è¦ã€‚åœ¨å¤„ç†ä¸ªä¸ªèº«ä»½ä¿¡æ¯ï¼ˆPII:Personally Identifiable Informationï¼‰æ—¶ï¼Œè¿™ä¸€ç‚¹å°¤ä¸ºé‡è¦ï¼Œä¾‹å¦‚ä½ çš„åŒ»ç–—è®°å½•æˆ–ä¿¡ç”¨å¡ä¿¡æ¯ã€‚æ•æ„Ÿçš„èº«ä»½ä¿¡æ¯å°†è¢«å®‰å…¨åœ°å­˜å‚¨åœ¨ä½ çš„æ•°å­—é’±åŒ…ä¸­ï¼Œå…è®¸ä½ ä»…åœ¨å¿…è¦æ—¶åˆ†äº«å®ƒã€‚\n\nå»ä¸­å¿ƒåŒ–èº«ä»½ç³»ç»Ÿä¹Ÿå°†å‡å°‘èº«ä»½ç›—çªƒçš„æ¡ˆä¾‹ï¼Œä½ çš„ä¸ªäººä¿¡æ¯å’Œå‡­è¯ä¸ä¼šå¾…åœ¨æ•°æ®ä»“åº“é‡Œä¾›é»‘å®¢çªƒå–ã€‚ä½ ä¹Ÿä¸éœ€è¦å¯†ç æ¥è®¿é—®ç½‘ç«™ï¼Œæ‰€ä»¥ç½‘ç»œé’“é±¼æ”»å‡»å°†ä¸å¯é¿å…åœ°å¤±è´¥ã€‚\n\n![å»ä¸­å¿ƒåŒ–èº«ä»½å¯ä»¥å‡å°‘æ•°æ®æ³„æ¼å’ŒIDç›—çªƒ](å»ä¸­å¿ƒåŒ–èº«ä»½-DID/6.jpeg)\n\n# é™ä½æ•°æ®ç®¡ç†æˆæœ¬\næ ¹æ®ç»Ÿè®¡ï¼Œå…¨çƒä¼ä¸šåœ¨ç®¡ç†ç”¨æˆ·æ•°æ®ä¸Šçš„èŠ±è´¹å å…¶æ”¶å…¥çš„4-7%ï¼Œä¼ä¸šæ¯å¹´åœ¨æ•°æ®åº“ç®¡ç†ä¸ŠèŠ±æŸ¥å²—æ•°åäº¿ç¾å…ƒï¼Œä½†è¿™äº›èµ„é‡‘è‚¯å®šæœ‰æ›´å¥½çš„ç”¨é€”ã€‚\n\nå»ä¸­å¿ƒåŒ–èº«ä»½è®©ç”¨æˆ·å­˜å‚¨ä¸ªäººæ•°æ®ï¼Œä¸ºä¼ä¸šå‡è½»è´Ÿæ‹…ã€‚ç”±äºæ²¡æœ‰æ•°æ®ä¸­å¿ƒéœ€è¦ç®¡ç†ï¼ŒæœåŠ¡æä¾›è€…å¯ä»¥å‡å°‘è¿è¥æˆæœ¬ï¼Œå¹¶å°†èµ„é‡‘é‡æ–°æŠ•å…¥åˆ°æ”¹å–„æœåŠ¡äº§å“ä¸­ã€‚\n\n# ç›‘ç®¡åˆè§„\nä»æ¬§ç›Ÿåˆ°ç¾å›½ï¼ˆå›½å†…ä¹Ÿä¸€æ ·ï¼‰ï¼Œç›‘ç®¡æœºæ„æ­£åœ¨æ”¶ç´§æ•°æ®éšç§æ³•ã€‚ä¸éµå®ˆç”¨æˆ·éšç§ä¿æŠ¤çš„ä¼ä¸šï¼Œæˆ–å°†é¢ä¸´ä¸¥å‰åˆ¶è£ã€‚\n\nå»ä¸­å¿ƒåŒ–èº«ä»½æ¡†æ¶å…é™¤äº†ç»„ç»‡å»ºç«‹æ•°æ®åº“æ¥å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„è´£ä»»ã€‚å› æ­¤ï¼Œå…¬å¸å¯ä»¥æ›´å¥½åœ°éµæ•°æ®éšç§æ³•ï¼Œé¿å…å¼•èµ·ç›‘ç®¡æœºæ„çš„æ„¤æ€’ã€‚\n\n# æ›´ä¸°å¯Œçš„ç”¨æˆ·ä½“éªŒ\næƒ³ä¸€æƒ³ä¸ºä½ ä½¿ç”¨çš„å‡ åä¸ªæœåŠ¡ç®¡ç†ä¸åŒçš„èº«ä»½èµ„æ–™çš„å›°éš¾ã€‚å¦‚æœä½ å¯ä»¥åœ¨ä¸åŒçš„å¹³å°ä¸Šä½¿ç”¨ç›¸åŒçš„èº«ä»½ï¼Œè€Œä¸ç”¨æ‹…å¿ƒé‡å¤åˆ›å»ºæ–°çš„ç™»å½•ä¿¡æ¯ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿ\n\næœ‰äº†å»ä¸­å¿ƒåŒ–èº«ä»½ï¼Œä¸€ä¸ªå¯äº’æ“ä½œçš„äº’è”ç½‘ï¼Œä½ å¯ä»¥åœ¨ä¸åŒçš„ç½‘ç«™ä¸Šä½¿ç”¨ä¸€ä¸ªIDï¼Œè¿™å°†æˆä¸ºç°å®ã€‚ä½ å°†èƒ½å¤Ÿé€šè¿‡è¿æ¥ä½ çš„é’±åŒ…åœ¨ä¸åŒçš„æœåŠ¡ä¹‹é—´æ— ç¼åˆ‡æ¢ã€‚\n\n![å»ä¸­å¿ƒåŒ–èº«ä»½å¯ä»¥æ”¹å–„ç”¨æˆ·çš„åœ¨çº¿ä½“éªŒ](å»ä¸­å¿ƒåŒ–èº«ä»½-DID/7.jpeg)\n\n# ä¸ªäººå¯¹æ•°æ®çš„æ‰€æœ‰æƒå’Œæ§åˆ¶æƒ\nå»ä¸­å¿ƒåŒ–èº«ä»½è¢«æè¿°ä¸ºè‡ªæˆ‘ä¸»æƒèº«ä»½ï¼Œå› ä¸ºå®ƒæŠŠä¸ªäººæ•°æ®çš„æ§åˆ¶æƒæ”¾åœ¨ä¸ªäººæ‰‹ä¸­ã€‚ä½ çš„ç§äººä¿¡æ¯ä¸ä¼šæˆä¸ºç¬¬ä¸‰æ–¹çš„è´¢äº§ï¼Œè¢«å­˜åœ¨ä¸­å¿ƒæ•°æ®åº“ä¸­ã€‚\n\nåœ¨ä¸€ä¸ªå»ä¸­å¿ƒåŒ–èº«ä»½ç³»ç»Ÿä¸­ï¼Œä½ å†³å®šå“ªäº›ä¿¡æ¯ä¼šè¢«ç¬¬ä¸‰æ–¹çŸ¥æ™“ã€‚é›¶çŸ¥è¯†è¯æ˜é€šè¿‡æ¶ˆé™¤æŠ«éœ²æ•æ„Ÿä¿¡æ¯çš„éœ€è¦æ¥è¿›ä¸€æ­¥ä¿æŠ¤ä½ çš„éšç§ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è¯æ˜ä½ çš„å¹´é¾„ï¼Œè€Œæ— éœ€å‘æœåŠ¡æä¾›è€…å±•ç¤ºä½ çš„åœ°å€æˆ–å›½ç±ã€‚\n\nç”±äºå¯éªŒè¯å‡­è¯æ˜¯æ•°å­—åŒ–çš„ï¼Œä½ çš„èº«ä»½å˜å¾—å¯æºå¸¦ã€‚ä½ ä¸éœ€è¦éšèº«æºå¸¦é©¾é©¶æ‰§ç…§æˆ–å…ç–«è¯ä¹¦æ¥è¯æ˜ä½ çš„ç–«è‹—æ¥ç§æƒ…å†µã€‚\n\nå¯éªŒè¯å‡­è¯å¯ä»¥ç‹¬ç«‹éªŒè¯ï¼Œæ‰€ä»¥ä½ æ°¸è¿œä¸å¿…ä¾èµ–å‘è¡Œäººæ¥éªŒè¯ä½ çš„ä¿¡æ¯ã€‚åœ¨ä»»ä½•æ—¶å€™ï¼Œä½ çš„ä¸ªäººä¿¡æ¯å’Œå‡­è¯éƒ½åœ¨ä½ çš„æ§åˆ¶ä¹‹ä¸‹ã€‚\n![å»ä¸­å¿ƒåŒ–èº«ä»½å…è®¸ç”¨æˆ·ä¿ç•™å¯¹å‡­è¯çš„æ§åˆ¶](å»ä¸­å¿ƒåŒ–èº«ä»½-DID/8.jpeg)\n\n# åŠ å¼ºç»„ç»‡å’Œç”¨æˆ·ä¹‹é—´çš„ä¿¡ä»»\nä¿¡ä»»æ˜¯ç»´ç³»å…¬å¸å’Œå®¢æˆ·ä¹‹é—´å…³ç³»çš„èƒ¶æ°´ã€‚å½“åŒæ–¹ç›¸äº’ä¿¡ä»»æ—¶ï¼Œå¯ä»¥å»ºç«‹äº’åˆ©çš„å…³ç³»ã€‚\n\nç„¶è€Œï¼Œåœ¨æˆ‘ä»¬ä»Šå¤©çš„ä¸–ç•Œä¸Šï¼Œä¿¡ä»»æ˜¯ä¸€ç§ç¨€ç¼ºçš„å•†å“ã€‚æ¶ˆè´¹è€…ä¸ç›¸ä¿¡å…¬å¸ä¸ä¼šæ”¶é›†ä»–ä»¬çš„æ•°æ®--è€Œä¸”å¯èƒ½æ˜¯é”™è¯¯çš„ç®¡ç†ã€‚è€Œç»„ç»‡åˆ™å¯¹å¯èƒ½è¿›è¡Œèº«ä»½æ¬ºè¯ˆçš„ç”¨æˆ·å¾ˆè­¦æƒ•ï¼Œå› æ­¤ä»–ä»¬åœ¨æä¾›æœåŠ¡ä¹‹å‰éœ€è¦æ¼«é•¿çš„éªŒè¯è¿‡ç¨‹ã€‚\n\nå»ä¸­å¿ƒåŒ–èº«ä»½å¯ä»¥è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå¹¶åœ¨ç”¨æˆ·å’ŒæœåŠ¡æä¾›è€…ä¹‹é—´åˆ›é€ å‰æ‰€æœªæœ‰çš„ä¿¡ä»»æ°´å¹³ã€‚\n\nåŠ å¯†å®‰å…¨å’Œå¯éªŒè¯å‡­è¯å¯ä»¥å¸®åŠ©å…¬å¸éªŒè¯ç”¨æˆ·èº«ä»½ï¼ŒåŠ é€Ÿå®¢æˆ·è¿›å…¥ã€‚è€Œç”¨æˆ·åœ¨ä¸æœåŠ¡æä¾›è€…äº¤äº’æ—¶ä¹Ÿä¸ä¼šæ‹…å¿ƒæ•°æ®æ³„éœ²å’Œèº«ä»½è¢«ç›—ï¼Œè¿™å¯¹æ¯ä¸ªäººæ¥è¯´éƒ½æ˜¯åŒèµ¢ã€‚","tags":["DID","å»ä¸­å¿ƒåŒ–èº«ä»½"],"categories":["åŒºå—é“¾","åº”ç”¨"]},{"title":"ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0002","url":"/2023/01/13/ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0002/","content":"\n# å‡†å¤‡å¯åŠ¨é…ç½®æ–‡ä»¶\n`Fabric`ç½‘ç»œåœ¨å¯åŠ¨ä¹‹å‰ï¼Œéœ€è¦æå‰ç”Ÿæˆä¸€äº›ç”¨äºå¯åŠ¨çš„é…ç½®æ–‡ä»¶ï¼Œä¸»è¦åŒ…æ‹¬`MSP`ç›¸å…³èº«ä»½æ–‡ä»¶`(msp/*)`ã€`TLS`ç›¸å…³èº«ä»½æ–‡ä»¶`(tlsca/*)`ã€ç³»ç»Ÿé€šé“åˆå§‹åŒºå—`(orderer.genesis.block)`ã€æ–°å»ºåº”ç”¨é€šé“äº¤æ˜“æ–‡ä»¶`(businesschannel.tx)`ã€é”šèŠ‚ç‚¹é…ç½®æ›´æ–°äº¤æ˜“æ–‡ä»¶`(Org1MSPanchors.txå’ŒOrg2MSPanchors.tx)`ç­‰ã€‚\n\nå„å¯åŠ¨é…ç½®æ–‡ä»¶çš„åŠŸèƒ½å¦‚ä¸‹ï¼š\n![å¯åŠ¨é…ç½®æ–‡ä»¶](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0002/boostrap-config-files.jpeg)\n\n# é…ç½®æ–‡ä»¶çš„ç”Ÿæˆè¿‡ç¨‹\n## ç”Ÿæˆç»„ç»‡å…³ç³»å’Œèº«ä»½è¯ä¹¦\n`Fabric`ç½‘ç»œä½œä¸ºè”ç›Ÿé“¾ï¼Œéœ€è¦å¤šä¸ªæˆå‘˜ç»„ç»‡å…±åŒç»´æŠ¤ã€‚æˆå‘˜ä¹‹é—´é€šè¿‡èº«ä»½è¿›è¡Œè¯†åˆ«ï¼Œç½‘ç»œé€šè¿‡èº«ä»½æ¥é™åˆ¶è®¿é—®æƒé™ï¼Œå› æ­¤å„æˆå‘˜ç»„ç»‡éƒ½éœ€è¦æå‰å‡†å¤‡å¯¹åº”çš„èº«ä»½æ–‡ä»¶ï¼Œå¹¶éƒ¨ç½²åˆ°å…¶æ‰€æ‹¥æœ‰çš„èŠ‚ç‚¹å’Œå®¢æˆ·ç«¯ä¸Šã€‚\n\nç”¨æˆ·å¯é€šè¿‡æ ‡å‡†PKIæœåŠ¡ï¼ˆå¦‚æœä½¿ç”¨`Fabric CA`å®ç°ï¼‰æˆ–`OpenSSL`å·¥å…·ï¼Œæ‰‹åŠ¨ç”Ÿæˆå„ä¸ªå®ä½“çš„è¯ä¹¦å’Œç§é’¥ã€‚`Fabric`é¡¹ç›®è¿˜æä¾›äº†`cryptogen`å·¥å…·ï¼ˆåŸºäº`Go`è¯­è¨€`crypto`æ ‡å‡†åº“ï¼‰åœ¨æœ¬åœ°ç”Ÿæˆï¼Œéœ€è¦æå‰å‡†å¤‡`crypto-config.yaml`é…ç½®æ–‡ä»¶ã€‚\n\n`crypto-config.yaml`é…ç½®æ–‡ä»¶çš„ç»“æ„ååˆ†ç®€å•ï¼Œæ”¯æŒå®šä¹‰ä¸¤ç§ç±»å‹`(OrdererOrgså’ŒPeerOrgs)`çš„è‹¥å¹²ç»„ç»‡ã€‚æ¯ä¸ªç»„ç»‡ä¸­åˆå¯ä»¥å®šä¹‰å¤šä¸ªèŠ‚ç‚¹`(Spec)`å’Œç”¨æˆ·`(User)`ã€‚\n\næœ¬ç¤ºä¾‹çš„`crypo-config.yaml`é…ç½®æ–‡ä»¶ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ª`OrderderOrgs`ç±»å‹çš„ç»„ç»‡`example.com`ï¼ŒåŒ…æ‹¬3ä¸ªèŠ‚ç‚¹ï¼šä¸¤ä¸ª`PeerOrgs`ç±»å‹çš„ç»„ç»‡`org1.example.com`å’Œ`org2.example.com`ï¼Œåˆ†åˆ«åŒ…æ‹¬2ä¸ªèŠ‚ç‚¹å’Œ1ä¸ªæ™®é€šç”¨æˆ·èº«ä»½ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š\n```yaml\nOrdererOrgs:\n  - Name: Orderer\n    Domain: example.com\n    CA:\n        Country: US\n        Province: California\n        Locality: San Francisco\n    Specs:\n      - Hostname: orderer0\n      - Hostname: orderer1\n      - Hostname: orderer2\nPeerOrgs:\n  - Name: Org1\n    Domain: org1.example.com\n    EnableNodeOUs: true\n    CA:\n        Country: US\n        Province: California\n        Locality: San Francisco\n    Template:\n      Count: 2\n    Users:\n      Count: 1\n  - Name: Org2\n    Domain: org2.example.com\n    EnableNodeOUs: true\n    CA:\n        Country: US\n        Province: California\n        Locality: San Francisco\n    Template:\n      Count: 2\n    Users:\n      Count: 1\n```\n\nä½¿ç”¨è¯¥é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡å¦‚ä¸‹å‘½ä»¤å¯**ç”Ÿæˆ**æŒ‡å®šç»„ç»‡ç»“æ„çš„èº«ä»½æ–‡ä»¶ï¼Œå¹¶å­˜æ”¾åˆ°`crypto-config`ç›®å½•ä¸‹ï¼š\n```shell\ncryptogen generate \\\n    --config=./crypto-config.yaml \\\n    --output ./crypto-config\n```\nç”¨æˆ·ä¿®æ”¹é…ç½®åï¼Œè¿˜å¯ä»¥é€šè¿‡`extend`å­å‘½ä»¤æ¥**æ›´æ–°**`crypto-config`ç›®å½•ï¼š\n```shell\ncryptogen extend \\\n    --config=./crypto-config.yaml \\\n    --input ./crypto-config\n```\n\næŸ¥çœ‹åˆšç”Ÿæˆçš„`crypto-config`ç›®å½•ï¼Œç»“æ„å¦‚ä¸‹ï¼š\n```\n$ tree -L 4 crypto-config\ncrypto-config\n|-- ordererOrganizations\n|   `-- example.com\n|       |-- ca\n|       |   |-- 293def0fc6d07aab625308a3499cd97f8ffccbf9e9769bf4107d6781f5e8072b_sk\n|       |   `-- ca.example.com-cert.pem\n|       |-- msp\n|       |   |-- admincerts/\n|       |   |-- cacerts/\n|       |   `-- tlscacerts/\n|       |-- orderers\n|       |   `-- orderer0.example.com/\n|       |   `-- orderer1.example.com/\n|       |   `-- orderer2.example.com/\n|       |-- tlsca\n|       |   |-- 2be5353baec06ca695f7c3b04ca0932912601a4411939bfcfd44af18274d5a65_sk\n|       |   `-- tlsca.example.com-cert.pem\n|       `-- users\n|           `-- Admin@example.com/\n`-- peerOrganizations\n    |-- org1.example.com\n    |   |-- ca\n    |   |   |-- 501c5f828f58dfa3f7ee844ea4cdd26318256c9b66369727afe8437c08370aee_sk\n    |   |   `-- ca.org1.example.com-cert.pem\n    |   |-- msp\n    |   |   |-- admincerts/\n    |   |   |-- cacerts/\n    |   |   `-- tlscacerts/\n    |   |-- peers\n    |   |   |-- peer0.org1.example.com/\n    |   |   `-- peer1.org1.example.com/\n    |   |-- tlsca\n    |   |   |-- 592a08f84c99d6f083b3c5b9898b2ca4eb5fbb9d1e255f67df1fa14c123e4368_sk\n    |   |   `-- tlsca.org1.example.com-cert.pem\n    |   `-- users\n    |       |-- Admin@org1.example.com/\n    |       `-- User1@org1.example.com/\n    `-- org2.example.com\n        |-- ca\n        |   |-- 86d97f9eb601868611eab5dc7df88b1f6e91e129160651e683162b958a728162_sk\n        |   `-- ca.org2.example.com-cert.pem\n        |-- msp\n        |   |-- admincerts/\n        |   |-- cacerts/\n        |   `-- tlscacerts/\n        |-- peers\n        |   |-- peer0.org2.example.com/\n        |   `-- peer1.org2.example.com/\n        |-- tlsca\n        |   |-- 4b87c416978970948dffadd0639a64a2b03bc89f910cb6d087583f210fb2929d_sk\n        |   `-- tlsca.org2.example.com-cert.pem\n        `-- users\n            |-- Admin@org2.example.com/\n            `-- User1@org2.example.com/\n```\n\næŒ‰ç…§`crypto-config.yaml`ä¸­çš„å®šä¹‰ï¼Œ`crypto-config`ç›®å½•ä¸‹åŒ…æ‹¬å¤šçº§ç›®å½•ç»“æ„ã€‚å…¶ä¸­`orderer-Organization`ä¸‹åŒ…æ‹¬æ„æˆ`Orderer`ç»„ç»‡ï¼ˆåŒ…æ‹¬3ä¸ªæ’åºèŠ‚ç‚¹ï¼‰çš„èº«ä»½ä¿¡æ¯ï¼›`peerOrganizations`ä¸‹ä¸ºæ‰€æœ‰`Peer`èŠ‚ç‚¹ç»„ç»‡ï¼ˆåŒ…æ‹¬2ä¸ªç»„ç»‡ï¼Œ4ä¸ªèŠ‚ç‚¹ï¼‰çš„ç›¸å…³èº«ä»½ä¿¡æ¯ã€‚å„ä¸ªå®ä½“éƒ½å«æœ‰`msp`å’Œ`tls`ç›®å½•ï¼Œåˆ†åˆ«åŒ…æ‹¬å¯¹åº”çš„è®¤è¯èº«ä»½æ–‡ä»¶å’Œ`TLS`èº«ä»½æ–‡ä»¶ï¼ˆå…¬é’¥è¯ä¹¦ã€ç§é’¥ç­‰ï¼‰ã€‚\n\nå¯¹äºæ’åºèŠ‚ç‚¹æ¥è¯´ï¼Œéœ€è¦å°†`ordererOrganizations/example.com/Orderers/ordererX.example.com`ç›®å½•ä¸‹çš„å†…å®¹ï¼ˆåŒ…æ‹¬mspå’Œtlsä¸¤ä¸ªå­ç›®å½•ï¼‰**å¤åˆ¶**åˆ°å¯¹åº”æ’åºèŠ‚ç‚¹çš„é…ç½®è·¯å¾„(é»˜è®¤ä¸º/etc/hyperledger/fabric)ä¸‹ã€‚\n\nå¯¹äº`Peer`èŠ‚ç‚¹æ¥è¯´ï¼Œåˆ™éœ€è¦å¤åˆ¶`peerOrganizations`ä¸‹å¯¹åº”çš„èº«ä»½è¯ä¹¦æ–‡ä»¶ã€‚ä»¥`org1`çš„`peer0`ä¸ºä¾‹ï¼Œå°†`peerOrganizations/org1.example.com/peers/peer0.org1.example.com`ç›®å½•ä¸‹çš„å†…å®¹ï¼ˆåŒ…æ‹¬mspå’Œtlsï¼‰å¤åˆ¶åˆ°Peer0èŠ‚ç‚¹çš„é…ç½®è·¯å¾„ï¼ˆé»˜è®¤ä¸º`/etc/hyperledger/fabric`)ä¸‹ã€‚\n\nå¯¹äºå®¢æˆ·ç«¯èŠ‚ç‚¹æ¥è¯´ï¼Œéœ€è¦å¤åˆ¶å¯¹åº”èº«ä»½çš„ç”¨æˆ·ç›®å½•ï¼Œä¾‹å¦‚`Org1`çš„ç®¡ç†å‘˜èº«ä»½ä¸º`peer-Organizations/org1.example.com/users/Admin@org1.example.com/`ã€‚\n\n## ç”Ÿæˆç³»ç»Ÿé€šé“åˆå§‹åŒºå—\nç³»ç»Ÿé€šé“æ˜¯ç½‘ç»œå¯åŠ¨åçš„é¦–ä¸ªé€šé“ï¼Œè´Ÿè´£ç®¡ç†ç½‘ç»œæ•´ä½“é…ç½®ã€‚æ’åºèŠ‚ç‚¹åœ¨å¯åŠ¨åï¼Œå¯ä»¥ä½¿ç”¨åˆå§‹åŒºå—æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç½‘ç»œã€‚\n\nåˆå§‹åŒºå—ä¸­åŒ…æ‹¬äº†æ’åºæœåŠ¡çš„ç›¸å…³é…ç½®ä¿¡æ¯ï¼ˆå¦‚æ’åºèŠ‚ç‚¹ä¿¡æ¯ã€å—å¤§å°ã€æœ€å¤§é€šé“æ•°ã€é»˜è®¤ç­–ç•¥ç­‰ï¼‰å’Œç¤ºä¾‹è”ç›Ÿé…ç½®ã€‚å¯ä»¥ä½¿ç”¨`configtxgen`å·¥å…·ç”Ÿæˆã€‚ç”Ÿæˆè¿‡ç¨‹ä¾èµ–`configtx.yaml`æ–‡ä»¶ã€‚\n\n`configtx.yaml`é…ç½®æ–‡ä»¶å®šä¹‰äº†æ•´ä¸ªç½‘ç»œä¸­çš„ç›¸å…³é…ç½®å’Œæ‹“æ‰‘ç»“æ„ä¿¡æ¯ï¼Œç”¨æˆ·å¯å‚è€ƒ`sampleconfig/configtx.yaml`ç¤ºä¾‹æ–‡ä»¶è¿›è¡Œç¼–å†™ã€‚è¿™é‡Œé‡‡ç”¨å¦‚ä¸‹å†…å®¹ï¼š\n```yaml\nProfiles:\n    TwoOrgsOrdererGenesis:\n        <<: *ChannelDefaults\n        Capabilities:\n            <<: *ChannelCapabilities\n        Orderer:\n            <<: *OrdererDefaults\n            Organizations:\n                - *OrdererOrg\n            Capabilities:\n                <<: *OrdererCapabilities\n        Consortiums:\n            SampleConsortium:\n                Organizations:\n                    - *Org1\n                    - *Org2\n    TwoOrgsChannel:\n        Consortium: SampleConsortium\n        <<: *ChannelDefaults\n        Capabilities:\n            <<: *ChannelCapabilities\n        Application:\n            <<: *ApplicationDefaults\n            Organizations:\n                - *Org1\n                - *Org2\n            Capabilities:\n    <<: *ApplicationCapabilities\nOrganizations:\n    - &OrdererOrg\n        Name: OrdererOrg\n        SkipAsForeign: false\n        ID: OrdererMSP\n        MSPDir: msp\n        Policies:\n            Readers:\n                Type: Signature\n                Rule: \"OR('OrdererMSP.member')\"\n            Writers:\n                Type: Signature\n                Rule: \"OR('OrdererMSP.member')\"\n            Admins:\n                Type: Signature\n                Rule: \"OR('OrdererMSP.admin')\"\n        OrdererEndpoints:\n            - \"orderer0.example.com:7050\"\n            - \"orderer1.example.com:7050\"\n            - \"orderer2.example.com:7050\"\n    - &Org1\n        Name: Org1MSP\n        SkipAsForeign: false\n        ID: Org1MSP\n        MSPDir: msp\n        Policies:\n            Readers:\n                Type: Signature\n                Rule: \"OR('Org1MSP.admin', 'Org1MSP.peer', 'Org1MSP.client')\"\n            Writers:\n                Type: Signature\n                Rule: \"OR('Org1MSP.admin', 'Org1MSP.client')\"\n            Admins:\n                Type: Signature\n                Rule: \"OR('Org1MSP.admin')\"\n            Endorsement:\n                Type: Signature\n                Rule: \"OR('Org1MSP.member')\"\n        AnchorPeers:\n            - Host: peer0.org1.example.com\n              Port: 7051\n    - &Org2\n        â€¦â€¦\nCapabilities:\n    Channel: &ChannelCapabilities\n        V2_0: true\n    Orderer: &OrdererCapabilities\n        V2_0: true\n    Application: &ApplicationCapabilities\n        V2_0: true\nApplication: &ApplicationDefaults\n    ACLs: &ACLsDefault\n        _lifecycle/CheckCommitReadiness: /Channel/Application/Writers\n        _lifecycle/CommitChaincodeDefinition: /Channel/Application/Writers\n        _lifecycle/QueryChaincodeDefinition: /Channel/Application/Readers\n        _lifecycle/QueryChaincodeDefinitions: /Channel/Application/Readers\n        lscc/ChaincodeExists: /Channel/Application/Readers\n        lscc/GetDeploymentSpec: /Channel/Application/Readers\n        lscc/GetChaincodeData: /Channel/Application/Readers\n        lscc/GetInstantiatedChaincodes: /Channel/Application/Readers\n        qscc/GetChainInfo: /Channel/Application/Readers\n        qscc/GetBlockByNumber: /Channel/Application/Readers\n        qscc/GetBlockByHash: /Channel/Application/Readers\n        qscc/GetTransactionByID: /Channel/Application/Readers\n        qscc/GetBlockByTxID: /Channel/Application/Readers\n        cscc/GetConfigBlock: /Channel/Application/Readers        \n        peer/Propose: /Channel/Application/Writers\n        peer/ChaincodeToChaincode: /Channel/Application/Readers\n        event/Block: /Channel/Application/Readers\n        event/FilteredBlock: /Channel/Application/Readers\n    Organizations:\n    Policies:\n        LifecycleEndorsement:\n            Type: ImplicitMeta\n            Rule: \"MAJORITY Endorsement\"\n        Endorsement:\n            Type: ImplicitMeta\n            Rule: \"MAJORITY Endorsement\"\n        Readers:\n            Type: ImplicitMeta\n            Rule: \"ANY Readers\"\n        Writers:\n            Type: ImplicitMeta\n            Rule: \"ANY Writers\"\n        Admins:\n            Type: ImplicitMeta\n            Rule: \"MAJORITY Admins\"\n    Capabilities:\n        <<: *ApplicationCapabilities\nOrderer: &OrdererDefaults\n    OrdererType: etcdraft\n    Addresses:\n        - orderer0.example.com:7050\n        - orderer1.example.com:7050\n        - orderer2.example.com:7050\n    BatchTimeout: 2s\n    BatchSize:\n        MaxMessageCount: 500\n        AbsoluteMaxBytes: 10 MB\n        PreferredMaxBytes: 2 MB\n    MaxChannels: 0\n    EtcdRaft:\n        Consenters:\n            - Host: orderer0.example.com\n              Port: 7050\n              ClientTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/tls/server.crt\n              ServerTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/tls/server.crt\n            - Host: orderer1.example.com\n              Port: 7050\n              ClientTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/tls/server.crt\n              ServerTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer1.example.com/tls/server.crt\n            - Host: orderer2.example.com\n              Port: 7050\n              ClientTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer2.example.com/tls/server.crt\n              ServerTLSCert: crypto-config/ordererOrganizations/example.com/orderers/orderer2.example.com/tls/server.crt\n        Options:\n  TickInterval: 500ms\n            ElectionTick: 10\n            HeartbeatTick: 1\n            MaxInflightBlocks: 5\n            SnapshotIntervalSize: 16 MB\n    Organizations:\n    Policies:\n        Readers:\n            Type: ImplicitMeta\n            Rule: \"ANY Readers\"\n        Writers:\n            Type: ImplicitMeta\n            Rule: \"ANY Writers\"\n        Admins:\n            Type: ImplicitMeta\n            Rule: \"MAJORITY Admins\"\n        BlockValidation:\n            Type: ImplicitMeta\n            Rule: \"ANY Writers\"\n    Capabilities:\n        <<: *OrdererCapabilities\nChannel: &ChannelDefaults\n    Policies:\n        Readers:\n            Type: ImplicitMeta\n            Rule: \"ANY Readers\"\n        Writers:\n            Type: ImplicitMeta\n            Rule: \"ANY Writers\"\n        Admins:\n            Type: ImplicitMeta\n            Rule: \"MAJORITY Admins\"\n    Capabilities:\n        <<: *ChannelCapabilities\n```\n\nè¯¥é…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸¤ä¸ªæ¨¡æ¿ï¼š`TwoOrgsOrderGenesis`å’Œ`TwoOrgsChannel`ã€‚å…¶ä¸­å‰è€…å®šä¹‰äº†ç³»ç»Ÿé€šé“é…ç½®ï¼Œå¯ä»¥ç”¨æ¥åˆ›å»ºç³»ç»Ÿé€šé“çš„åˆå§‹åŒºå—æ–‡ä»¶ï¼›åè€…å®šä¹‰äº†åº”ç”¨é€šé“é…ç½®ï¼Œå¯ä»¥ç”¨æ¥æ–°å»ºåº”ç”¨é€šé“ã€‚æ’åºæœåŠ¡çš„å…±è¯†ç±»å‹æŒ‡å®šä¸º`Raft`æ¨¡å¼ã€‚\n\né€šè¿‡å¦‚ä¸‹å‘½ä»¤æŒ‡å®šä½¿ç”¨`TwoOrgsOrdererGenesisæ¨¡æ¿ï¼Œæ¥ç”Ÿæˆç³»ç»Ÿé€šé“åˆå§‹åŒ–åŒºå—æ–‡ä»¶ï¼š\n```shell\nexport SYS_CHANNEL=testchainid\nexport ORDERER_GENESIS_PROFILE=TwoOrgsOrdererGenesis\nexport ORDERER_GENESIS=orderer.genesis.block\nconfigtxgen \\\n    -configPath ./ \\\n    -channelID ${SYS_CHANNEL} \\\n    -profile ${ORDERER_GENESIS_PROFILE} \\\n    -outputBlock ${ORDERER_GENESIS}\n```\nå°†æ‰€ç”Ÿæˆçš„åˆå§‹åŒºå—æ–‡ä»¶å¤åˆ¶åˆ°æ’åºèŠ‚ç‚¹`ORDERER_GENERAL_BOOTSTRAPFILE`è·¯å¾„ï¼ˆé»˜è®¤ä¸º`/etc/hyperledger/fabric`)ä¸‹ï¼Œä¾›å¯åŠ¨æ’åºèŠ‚ç‚¹ä½¿ç”¨ã€‚\n\n# ç”Ÿæˆæ–°å»ºåº”ç”¨é€šé“äº¤æ˜“\næ–°å»ºåº”ç”¨é€šé“éœ€è¦å…ˆç”Ÿæˆé…ç½®äº¤æ˜“æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…æ‹¬å±äºè¯¥é€šé“çš„ç»„ç»‡ç»“æ„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¼šå†™å…¥è¯¥åº”ç”¨é€šé“çš„åˆå§‹åŒºå—ä¸­ã€‚\n\nåŒæ ·éœ€è¦`configtx.yaml`é…ç½®æ–‡ä»¶å’Œ`configtxgen`å·¥å…·ï¼Œæ³¨æ„è¿™é‡Œä½¿ç”¨`TwoOrgsChannel`æ¨¡æ¿ã€‚\n\né‡‡ç”¨å¦‚ä¸‹å‘½ä»¤æ¥ç”Ÿæˆæ–°å»ºé€šé“äº¤æ˜“æ–‡ä»¶ï¼Œé€šé“ä¸­åŒ…æ‹¬ä¸¤ä¸ªåˆå§‹æˆå‘˜ï¼š`Org1`å’Œ`Org2`:\n```shell\nexport APP_CHANNEL=businesschannel\nexport APP_CHANNEL_PROFILE=TwoOrgsChannel\nconfigtxgen \\\n    -configPath ./ \\\n    -channelID ${APP_CHANNEL} \\\n    -profile ${APP_CHANNEL_PROFILE} \\\n    -outputCreateChannelTx ${APP_CHANNEL}.tx\n```\n\n> æ³¨æ„:\n> çŠ¶æ€æ•°æ®åº“å¦‚æœé€‰æ‹©`CouchDB`ç±»å‹ï¼Œåº”ç”¨é€šé“åç§°åªèƒ½åŒ…æ‹¬å°å†™çš„ASCIIå­—ç¬¦ã€ç‚¹æˆ–ä¸­åˆ’çº¿ï¼Œå¹¶ä¸”é¦–å­—ç¬¦ä¸ºå­—æ¯ï¼Œæ€»é•¿åº¦ä¸è¶…è¿‡249ä¸ªå­—ç¬¦ã€‚è¯¥é™åˆ¶è¯¦æƒ…å¯å‚è€ƒ`FAB-2487`ã€‚\n\n# ç”Ÿæˆé”šèŠ‚ç‚¹é…ç½®æ›´æ–°æ–‡ä»¶\né”šèŠ‚ç‚¹ç”¨æ¥è¾…åŠ©å‘ç°é€šé“å†…å¤šä¸ªç»„ç»‡ä¹‹é—´çš„èŠ‚ç‚¹ï¼Œä¿®æ”¹é”šèŠ‚ç‚¹éœ€è¦å‘é€æ›´æ–°é€šé“é…ç½®äº¤æ˜“ã€‚\n\nåŒæ ·éœ€è¦`configtx.yaml`é…ç½®æ–‡ä»¶ï¼Œä¸ºæ¯ä¸ªç»„ç»‡éƒ½ç”Ÿæˆé…ç½®æ–‡ä»¶ï¼Œæ³¨æ„éœ€è¦æŒ‡å®šå¯¹åº”çš„ç»„ç»‡èº«ä»½ã€‚`outputAnchorPeersUpdates`å­å‘½ä»¤åœ¨2.xç‰ˆæœ¬ä¸­è®¡åˆ’å¼ƒç”¨ï¼Œå±Šæ—¶ç”¨æˆ·éœ€è¦ä½¿ç”¨é€šé“é…ç½®æ›´æ–°å‘½ä»¤å®Œæˆï¼š\n```shell\nexport UPDATE_ANCHOR_ORG1_TX=Org1MSPanchors.tx\nexport UPDATE_ANCHOR_ORG2_TX=Org2MSPanchors.tx\nconfigtxgen \\\n    -configPath ./ \\\n    -channelID ${APP_CHANNEL} \\\n    -profile ${APP_CHANNEL_PROFILE} \\\n    -asOrg Org1MSP \\\n    -outputAnchorPeersUpdate ${UPDATE_ANCHOR_ORG1_TX}\n\nconfigtxgen \\\n    -configPath ./ \\\n    -channelID ${APP_CHANNEL} \\\n    -profile ${APP_CHANNEL_PROFILE} \\\n    -asOrg Org2MSP \\\n    -outputAnchorPeersUpdate ${UPDATE_ANCHOR_ORG2_TX}\n```\n\n# å¯åŠ¨æ’åºèŠ‚ç‚¹\né¦–å…ˆï¼Œæ£€æŸ¥é…ç½®è·¯å¾„ï¼ˆé»˜è®¤ä¸º`/etc/hyperledger/fabric`ï¼‰ä¸‹æ‰€éœ€æ–‡ä»¶æ˜¯å¦å°±ç»ªï¼š\n- é…ç½®æ–‡ä»¶`orderer.yaml`ï¼ˆå¯å‚è€ƒsampleconfig/orderer.yaml), åŒ…æ‹¬æ’åºèŠ‚ç‚¹é…ç½®ä¿¡æ¯ã€‚\n- mspæ–‡ä»¶ç›®å½•ã€tlsæ–‡ä»¶ç›®å½•ï¼Œç”¨æ¥å­˜æ”¾èº«ä»½è¯ä¹¦æ–‡ä»¶å’Œç§é’¥æ–‡ä»¶ã€‚\n- ç³»ç»Ÿé€šé“åˆå§‹åŒºå—æ–‡ä»¶ï¼Œç”¨æ¥å¯åŠ¨ç³»ç»Ÿé€šé“ã€‚\n\næ’åºèŠ‚ç‚¹é…ç½®å¯é€šè¿‡é…ç½®æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡æ–¹å¼æŒ‡å®šï¼Œéƒ¨åˆ†å¸¸è§é…ç½®å¦‚ä¸‹ï¼š\n![æ’åºèŠ‚ç‚¹é…ç½®](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0002/orderer-config.jpeg)\n\nä¹‹åï¼Œç”¨æˆ·å¯ä»¥é‡‡ç”¨å¦‚ä¸‹å‘½ä»¤æ¥å¯åŠ¨æ’åºèŠ‚ç‚¹ã€‚å¯åŠ¨æˆåŠŸåå¯ä»¥çœ‹åˆ°æœ¬åœ°è¾“å‡ºå¼€å§‹æä¾›æœåŠ¡çš„æ¶ˆæ¯ï¼Œæ­¤æ—¶`Orderer`é‡‡ç”¨æŒ‡å®šçš„åˆå§‹åŒºå—æ–‡ä»¶æˆåŠŸåˆ›å»ºäº†ç³»ç»Ÿé€šé“ï¼Œä»£ç å¦‚ä¸‹ï¼š\n```\n$ orderer start\n[orderer/common/server] prettyPrintStruct -> INFO 002 Orderer config values:\n    General.LedgerType = \"file\"\n    General.ListenAddress = \"0.0.0.0\"\n    General.ListenPort = 7050\n    General.TLS.Enabled = true\n...\n[orderer/common/server] Start -> INFO 007 Beginning to serve requests\n...\n```\n\n# å¯åŠ¨PeerèŠ‚ç‚¹\né¦–å…ˆï¼Œæ£€æŸ¥é…ç½®è·¯å¾„ï¼ˆé»˜è®¤ä¸º`/etc/hyperledger/fabric)ä¸‹æ‰€éœ€æ–‡ä»¶æ˜¯å¦å°±ç»ªï¼š\n- é…ç½®æ–‡ä»¶`core.yaml`ï¼ˆå¯ä»¥å‚è€ƒsampleconfig/core.yaml),æŒ‡å®šPeerèŠ‚ç‚¹é…ç½®ã€‚\n- mspæ–‡ä»¶ç›®å½•ã€tlsæ–‡ä»¶ç›®å½•ï¼Œç”¨äºå­˜æ”¾èº«ä»½è¯ä¹¦æ–‡ä»¶å’Œç§é’¥æ–‡ä»¶ã€‚\n\nPeerèŠ‚ç‚¹é…ç½®å¯é€šè¿‡é…ç½®æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡æ–¹å¼è¿›è¡ŒæŒ‡å®šï¼Œå¸¸è§è®¾ç½®å¦‚ä¸‹ï¼š\n![PeerèŠ‚ç‚¹é…ç½®](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0002/peer-config.jpeg)\n\né…ç½®å®Œæˆåï¼Œç”¨æˆ·å¯ä»¥é‡‡ç”¨å¦‚ä¸‹å‘½ä»¤åœ¨å¤šä¸ªæœåŠ¡å™¨ä¸Šåˆ†åˆ«å¯åŠ¨PeeræœåŠ¡ï¼š\n```\n$ peer node start\nUTC [ledgermgmt] initialize -> INFO 002 Starting peer:\n  Version: 2.0.0\n  Commit SHA: development build\n  Go version: go1.13.4\n  OS/Arch: linux/amd64\n  Chaincode:\n    Base Docker Namespace: hyperledger\n    Base Docker Label: org.hyperledger.fabric\n    Docker Namespace: hyperledger\"\n...\nUTC [nodeCmd] serve -> INFO 01e Started peer with ID=[name:\"peer0.org1.\nexample.com\" ], network ID=[dev], address=[peer0.org1.example.com:7051]\n...\n```\nå¯åŠ¨æˆåŠŸåå¯ä»¥çœ‹åˆ°æœ¬åœ°è¾“å‡ºçš„æ—¥å¿—æ¶ˆæ¯ã€‚\næ­¤æ—¶ï¼ŒPeerèŠ‚ç‚¹å·²ç»å¯åŠ¨èµ·æ¥ï¼Œä¼šå°è¯•é€šè¿‡gossipå‘ç°é‚»å±…èŠ‚ç‚¹ã€‚\n\n# åˆ›å»ºé€šé“\nç½‘ç»œå¯åŠ¨ååªæœ‰æ’åºèŠ‚ç‚¹ç»´æŠ¤çš„ç³»ç»Ÿé€šé“ï¼Œè¿˜æœªåˆ›å»ºåº”ç”¨é€šé“ã€‚å®¢æˆ·ç«¯éœ€è¦å‘é€è¯·æ±‚ç»™Ordereråˆ›å»ºåº”ç”¨é€šé“ï¼Œä»¥è®©PeerèŠ‚ç‚¹åŠ å…¥ä½¿ç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰è”ç›Ÿä¸­æˆå‘˜ç»„ç»‡çš„ç®¡ç†å‘˜èº«ä»½æ‰å¯ä»¥åˆ›å»ºåº”ç”¨é€šé“ã€‚\n\nä¾‹å¦‚ï¼Œä½¿ç”¨Org1çš„**ç®¡ç†å‘˜èº«ä»½**æ¥åˆ›å»ºæ–°çš„åº”ç”¨é€šé“ï¼Œéœ€è¦æŒ‡å®šmspçš„IDã€mspæ–‡ä»¶æ‰€åœ¨è·¯å¾„ã€æ’åºæœåŠ¡åœ°å€ã€åº”ç”¨é€šé“åç§°å’Œæ–°å»ºé€šé“äº¤æ˜“æ–‡ä»¶ï¼Œå¦‚æœå¯ç”¨äº†TLS,è¿˜éœ€è¦æŒ‡å®šæ’åºæœåŠ¡çš„TLSCAçš„è¯ä¹¦ä½ç½®ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š\n```shell\nAPP_CHANNEL=businesschannel\nTIMEOUT=30\nCORE_PEER_LOCALMSPID=\"Org1MSG\" \\\nCORE_PEER_MSPCONFIGPATH=/etc/hyperledger/fabric/crypto-config/peerOrgnizations/org1.example.com/users/Admin@org1.example.com/msg \\\npeer channel create \\\n    -o orderer0.example.com:7070 \\\n    -c ${APP_CHANNEL} \\\n    -f ./$APP_CHANNEL.tx \\\n    --timeout \"${TIMEOUT}s\" \\\n    --tls \\\n    --cafile /etc/hyperledger/fabric/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem\n```\né€šé“åˆ›å»ºæˆåŠŸåï¼Œä¼šåœ¨æœ¬åœ°ç”Ÿæˆå…¶åˆå§‹åŒºå—æ–‡ä»¶ï¼ˆbusinesschannel.blockï¼‰ï¼Œå…¶ä¸­å¸¦æœ‰é€šé“çš„åˆå§‹é…ç½®ä¿¡æ¯å’Œæ’åºæœåŠ¡ä¿¡æ¯ç­‰ã€‚åªæœ‰æ‹¥æœ‰è¯¥æ–‡ä»¶çš„PeerèŠ‚ç‚¹å¯èƒ½åŠ å…¥å¯¹åº”çš„é€šé“ä¸­ã€‚\n\n# åŠ å…¥é€šé“\nåº”ç”¨é€šé“çš„æˆå‘˜ç»„ç»‡çš„Peeréƒ½å¯ä»¥åŠ å…¥é€šé“ä¸­ã€‚åœ¨å®¢æˆ·ç«¯ä½¿ç”¨**ç®¡ç†å‘˜èº«ä»½**ä¾æ¬¡è®©ç»„ç»‡Org1å’ŒOrg2ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½åŠ å…¥æ–°çš„åº”ç”¨é€šé“ã€‚æ“ä½œéœ€è¦æŒ‡å®šæ‰€æ“ä½œçš„Peerçš„åœ°å€ï¼Œä»¥åŠé€šé“çš„åˆå§‹åŒºå—ã€‚\n\nä»¥Org1ä¸­çš„Peer0èŠ‚ç‚¹ä¸ºä¾‹ï¼Œå¯ä»¥æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š\n```shell\nCORE_PEER_LOCALMSPID=\"Org1MSP\" \\\nCORE_PEER_MSPCONFIGPATH=/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp \\\nCORE_PEER_ADDRESS=peer0.org1.example.com:7051 \\\npeer channel join \\\n-b ${APP_CHANNEL}.block\n```\n\næ­¤æ—¶ï¼Œæ‰€æ“ä½œçš„Peerï¼ˆå¦‚æœæˆä¸ºç»„ç»‡çš„Gossip Leaderï¼‰ä¼šè‡ªåŠ¨è¿æ¥åˆ°åº”ç”¨é€šé“æŒ‡å®šçš„æ’åºæœåŠ¡ï¼Œå¼€å§‹æ¥æ”¶åŒºå—ã€‚\n\n# æ›´æ–°é”šèŠ‚ç‚¹é…ç½®\né”šèŠ‚ç‚¹ï¼ˆä½œä¸ºç»„ç»‡å†…æˆå‘˜ä»£è¡¨ï¼‰è´Ÿè´£ä¸å…¶å®ƒç»„ç»‡èŠ‚ç‚¹è¿›è¡Œä¿¡æ¯äº¤æ¢ã€‚é€šé“é…ç½®å†…ä¼šè®°å½•å„ç»„ç»‡çš„é”šèŠ‚ç‚¹åˆ—è¡¨ä¿¡æ¯ï¼ŒPeeré€šè¿‡è®¿é—®å…¶å®ƒç»„ç»‡çš„é”šèŠ‚ç‚¹æ¥è·å–å…¶å®ƒç»„ç»‡å†…çš„Peerä¿¡æ¯ã€‚\n\nä½¿ç”¨é€šé“é…ç½®æ›´æ–°æ–‡ä»¶ï¼Œç»„ç»‡ç®¡ç†å‘˜å¯ä»¥æ›´æ–°é€šé“æŒ‡å®šé…ç½®ã€‚ä¾‹å¦‚ï¼Œåœ¨å®¢æˆ·ç«¯ä½¿ç”¨Org1çš„ç®¡ç†å‘˜èº«ä»½æ¥æ›´æ–°é”šèŠ‚ç‚¹ï¼Œå¦‚ä¸‹ï¼š\n```shell\nCORE_PEER_LOCALMSPID=\"Org1MSP\" \\\nCORE_PEER_MSPCONFIGPATH=/etc/hyperledger/fabric/crypto-config/peerOrganizations/org1.example.com/users/Amdin@org1.example.com/msp \\\npeer channel update \\\n-o orderer0.example.com:7050 \\\n-c ${APP_CHANNEL} \\\n-f ${UPDATE_ANCHOR_ORG1_TX} \\\n--tls \\\n--cafile /etc/hyperledger/fabric/crypto-config/ordererOrganizations/example.com/orderers/orderer0.example.com/msp/tlscacerts/tlsca.example.com-cert.pem\n```\n\né”šèŠ‚ç‚¹é…ç½®æ›´æ–°åï¼ŒåŒä¸€é€šé“å†…ä¸åŒç»„ç»‡ä¹‹é—´çš„Peerä¹Ÿå¯ä»¥è¿›è¡ŒGossipé€šä¿¡ï¼Œå…±åŒç»´æŠ¤é€šé“å¸æœ¬ã€‚åç»­ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æ™ºèƒ½åˆçº¦ä½¿ç”¨é€šé“å¸æœ¬ã€‚","tags":["Hyperledger","Fabric","å¯åŠ¨é…ç½®æ–‡ä»¶"],"categories":["åŒºå—é“¾","Fabric","é˜…è¯»æ‘˜å½•"]},{"title":"ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0001","url":"/2023/01/12/ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0001/","content":"\n# ç½‘ç»œåŸºæœ¬ç»“æ„\nFaricç½‘ç»œä¸­å­˜åœ¨å››ç§ä¸åŒè§’è‰²çš„æœåŠ¡èŠ‚ç‚¹ï¼Œå½¼æ­¤åä½œå®Œæˆæ•´ä¸ªåŒºå—é“¾ç³»ç»Ÿçš„è®°è´¦åŠŸèƒ½ã€‚\n- èƒŒä¹¦èŠ‚ç‚¹(Endorser Peer):ä¸€äº›ç‰¹æ®Šçš„PeerèŠ‚ç‚¹ï¼Œå¯¹äº¤æ˜“ææ¡ˆï¼ˆTransaction Proposalï¼‰è¿›è¡Œæ£€æŸ¥ï¼Œæ‰§è¡Œæ™ºèƒ½åˆçº¦ï¼Œè®¡ç®—äº¤æ˜“æ‰§è¡Œç»“æœï¼ˆè¯»å†™é›†åˆï¼‰å¹¶å¯¹å…¶è¿›è¡ŒèƒŒä¹¦ã€‚\n- è®°å¸èŠ‚ç‚¹(Committer Peer):è´Ÿè´£ç»´æŠ¤è´¦æœ¬çš„PeerèŠ‚ç‚¹ï¼Œæ£€æŸ¥æ’åºåäº¤æ˜“ç»“æœçš„åˆæ³•æ€§ï¼Œå¹¶æ›´æ–°åˆ°æœ¬åœ°è´¦æœ¬ã€‚ç›®å‰æ‰€æœ‰Peeré»˜è®¤éƒ½æ˜¯è®°è´¦èŠ‚ç‚¹ã€‚\n- æ’åºèŠ‚ç‚¹(Orderer):è´Ÿè´£æ¥æ”¶äº¤æ˜“ï¼Œå¹¶å¯¹ç½‘ç»œä¸­æ‰€æœ‰äº¤æ˜“è¿›è¡Œæ’åºï¼Œæ•´ç†ä¸ºåŒºå—ç»“æ„ã€‚è®°è´¦èŠ‚ç‚¹ä¼šä»æ’åºèŠ‚ç‚¹æ‹‰å–æ–°åŒºå—å¹¶æäº¤åˆ°æœ¬åœ°è´¦æœ¬ã€‚\n- è¯ä¹¦èŠ‚ç‚¹(CA):æä¾›æ ‡å‡†çš„PKIæœåŠ¡ï¼Œè´Ÿè´£å¯¹ç½‘ç»œä¸­æ‰€æœ‰çš„è¯ä¹¦è¿›è¡Œç®¡ç†ï¼ŒåŒ…æ‹¬ç­¾å‘å’Œæ’¤é”€ã€‚ä¸å‚ä¸ç½‘ç»œä¸­çš„äº¤æ˜“è¿‡ç¨‹ã€‚\n\nè§’è‰²åˆ’åˆ†æ˜¯Fabricè®¾è®¡çš„ä¸€ä¸ªç‰¹è‰²ã€‚æ ¹æ®æ€§èƒ½å’Œå®‰å…¨éœ€æ±‚ï¼Œä¸åŒçš„èŠ‚ç‚¹å¯ä»¥ç”±ä¸åŒç»„ç»‡åˆ†åˆ«ç®¡ç†ï¼Œå…±åŒæ„å»ºè”ç›Ÿé“¾ã€‚\n\næ­¤å¤–ï¼Œç½‘ç»œæ”¯æŒå¤šä¸ªè´¦æœ¬ç»‘å®šå¯¹åº”é€šé“(Channel)ã€‚æ¯ä¸ªé€šé“å†…çš„æˆå‘˜å¯ä»¥å…±äº«è´¦æœ¬ï¼Œä¸åŒé€šé“çš„è´¦æœ¬å½¼æ­¤éš”ç¦»ã€‚å®¢æˆ·ç«¯å¯ä»¥å‘é€šé“å‘é€äº¤æ˜“ï¼Œç»è¿‡å…±è¯†åè¢«é€šé“å†…çš„PeerèŠ‚ç‚¹æ¥æ”¶å¹¶æ›´æ–°åˆ°æœ¬åœ°è´¦æœ¬ã€‚\n\n# Fabricä¸­çš„é…ç½®è¾…åŠ©å·¥å…·\n- cryptogen(æœ¬åœ°ç”Ÿæˆç»„ç»‡ç»“æ„å’Œèº«ä»½æ–‡ä»¶)\n- configtxgen(ç”Ÿæˆé…ç½®åŒºå—å’Œé…ç½®äº¤æ˜“)\n- configtxlator(è§£æè½¬æ¢é…ç½®ä¿¡æ¯)\n- discover(æ‹“æ‰‘æ¢æµ‹)\n- idemixgen(Idemixè¯ä¹¦ç”Ÿæˆ)\n\n# fabricé¡¹ç›®ç›¸å…³çš„dockeré•œåƒ\nè¿™äº›é•œåƒéƒ½åœ¨hyperledgerä»“åº“ä¸­ï¼Œå®ƒä»¬ä¹‹é—´çš„ç›¸äº’ä¾èµ–å…³ç³»å¦‚ä¸‹å›¾ï¼š\n![Fabric Docker é•œåƒ](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0001/FabricDockerImages.jpeg)\n\næ ¹æ®ä¸åŒç”¨é€”ï¼ŒDockeré•œåƒå¯ä»¥å¤§è‡´åˆ†ä¸ºä¸‰ç±»ï¼šæ ¸å¿ƒé•œåƒã€è¾…åŠ©é•œåƒå’Œç¬¬ä¸‰æ–¹é•œåƒã€‚\n- æ ¸å¿ƒé•œåƒ\n   \n   æä¾›Fabricç½‘ç»œè¿è¡Œçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œç›®å‰åŒ…æ‹¬`fabric-peer`ã€`fabric-orderer`ã€`fabric-ca`ã€`fabric-baseos`ã€`fabric-ccenv`ã€`fabric-javaenv`ã€`fabric-nodeenv`å…±7ä¸ªé•œåƒï¼Œå¦‚ä¸‹å›¾ï¼š\n   ![images-01](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0001/images-01.jpeg)\n   ![images-02](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0001/images-02.jpeg)\n- è¾…åŠ©é•œåƒ\n  \n  æä¾›æ”¯æŒåŠŸèƒ½ï¼Œç›®å‰åŒ…æ‹¬`fabric-baseimage`ã€`fabric-tools`é•œåƒï¼Œå¦‚ä¸‹å›¾\n  ![images-03](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0001/images-03.jpeg)\n\n- ç¬¬3æ–¹é•œåƒ\n  \n  ä¸»è¦æ˜¯ç”±ä¸€äº›ç¬¬3æ–¹å¼€æºè½¯ä»¶æä¾›æ”¯æŒåŠŸèƒ½ï¼Œç›®å‰åŒ…æ‹¬`fabric-couchdb`ã€`fabric-kafka`ã€`fabric-zookeeper`3ä¸ªé•œåƒã€‚å¦‚ä¸‹å›¾ï¼š\n  ![images-04](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0001/images-04.jpeg)\n\n# ä»æºç ç”ŸæˆDockeré•œåƒ\nå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤åœ¨æœ¬åœ°å¿«é€Ÿç”Ÿæˆ`fabric-baseos`ã€`fabric-peer`ã€`fabric-orderer`ã€`fabric-ccenv`ã€`fabric-tools`ç­‰å¤šä¸ªDockeré•œåƒï¼š\n```shell\nmake docker\n```\n\n# ç”¨æœ¬åœ°æ–¹å¼å¯åŠ¨Fabricç½‘ç»œ\nå¯åŠ¨ä¸€ä¸ªFabricç½‘ç»œä¸»è¦åŒ…æ‹¬å¦‚ä¸‹æ­¥éª¤ï¼š\n- **è§„åˆ’åˆå§‹ç½‘ç»œæ‹“æ‰‘**ã€‚æ ¹æ®è”ç›Ÿçš„éœ€æ±‚è§„åˆ’æ‹“æ‰‘ä¿¡æ¯ï¼ŒåŒ…æ‹¬è”ç›Ÿæˆå‘˜ã€æ’åºæœåŠ¡é›†ç¾¤ã€åº”ç”¨é€šé“åˆå§‹æˆå‘˜ç­‰ï¼›\n- **å‡†å¤‡å¯åŠ¨é…ç½®æ–‡ä»¶**ã€‚åŒ…æ‹¬ç½‘ç»œä¸­ç»„ç»‡ç»“æ„å’Œå¯¹åº”çš„èº«ä»½è¯ä¹¦ï¼ˆå¯ä½¿ç”¨`cryptogen`å·¥å…·æˆ–`fabric-ca`å®Œæˆï¼‰ã€ç³»ç»Ÿé€šé“çš„åˆå§‹é…ç½®åŒºå—æ–‡ä»¶ï¼ˆå¯ä½¿ç”¨`configtxgen`å·¥å…·å®Œæˆï¼‰ã€‚\n- **å¯åŠ¨æ’åºèŠ‚ç‚¹**ã€‚ä½¿ç”¨ç³»ç»Ÿé€šé“çš„åˆå§‹åŒºå—æ–‡ä»¶å¯åŠ¨æ’åºæœåŠ¡ï¼Œæ’åºæœåŠ¡å¯åŠ¨åè‡ªåŠ¨æŒ‰ç…§æŒ‡å®šé…ç½®åˆ›å»ºç³»ç»Ÿé€šé“ã€‚\n- **å¯åŠ¨PeerèŠ‚ç‚¹**ã€‚ä¸åŒçš„ç»„ç»‡æŒ‰ç…§é¢„ç½®è§’è‰²åˆ†åˆ«å¯åŠ¨PeerèŠ‚ç‚¹ã€‚\n- **åˆ›å»ºé€šé“**ã€‚å®¢æˆ·ç«¯ä½¿ç”¨æ–°å»ºåº”ç”¨é€šé“çš„é…ç½®æ›´æ–°äº¤æ˜“æ–‡ä»¶ï¼Œå‘ç³»ç»Ÿé€šé“å‘é€äº¤æ˜“ï¼Œåˆ›å»ºæ–°çš„åº”ç”¨é€šé“ã€‚\n- **åŠ å…¥é€šé“**ã€‚`Peer`èŠ‚ç‚¹åˆ©ç”¨åˆå§‹åŒºå—åŠ å…¥æ‰€åˆ›å»ºçš„åº”ç”¨é€šé“ã€‚\nä¸»è¦æ­¥éª¤å¦‚ä¸‹å›¾ï¼š\n![å¯åŠ¨æ­¥éª¤](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0001/bootstrap.jpeg)\n\n# è§„åˆ’åˆå§‹ç½‘ç»œæ‹“æ‰‘\nç¤ºä¾‹ç½‘ç»œæ‹“æ‰‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒåŒ…æ‹¬3ä¸ª`Orderer`èŠ‚ç‚¹å’Œ4ä¸ª`Peer`èŠ‚ç‚¹ï¼Œä»¥åŠ1ä¸ªå®¢æˆ·ç«¯æ“ä½œèŠ‚ç‚¹ï¼ˆè´Ÿè´£ç”Ÿæˆç›¸å…³å¯åŠ¨æ–‡ä»¶ï¼Œåœ¨ç½‘ç»œå¯åŠ¨åä½œä¸ºå®¢æˆ·ç«¯æ‰§è¡Œå‘½ä»¤ï¼‰ã€‚\n\nå…¶ä¸­ï¼Œ`Orderer`æœåŠ¡é‡‡ç”¨`Raft`æ¨¡å¼ï¼Œæ‰€æœ‰èŠ‚ç‚¹éƒ½åŠ å…¥æ–°å»ºçš„`businesschannel`ä¸­ã€‚4ä¸ª`Peer`èŠ‚ç‚¹åˆ†å±ä¸¤ä¸ªç»„ç»‡:`Org1`å’Œ`Org2`ï¼Œä¹Ÿéƒ½æ˜¯åº”ç”¨é€šé“æˆå‘˜ã€‚æ¯ä¸ªç»„ç»‡ä¸­çš„peer0èŠ‚ç‚¹ä½œä¸ºé”šèŠ‚ç‚¹è´Ÿè´£ä¸å…¶å®ƒç»„ç»‡èŠ‚ç‚¹åˆ†äº«ä¿¡æ¯ã€‚\n![ç¤ºä¾‹æ‹“æ‰‘](ã€ŠåŒºå—é“¾åŸç†ã€è®¾è®¡ä¸åº”ç”¨ã€‹é˜…è¯»æ‘˜å½•-0001/topology.jpeg)\n","tags":["Hyperledger","Fabric","ç½‘ç»œç»“æ„"],"categories":["åŒºå—é“¾","Fabric","é˜…è¯»æ‘˜å½•"]},{"title":"Fabricå¼€å‘æ¨¡å¼è¿è¡Œ","url":"/2023/01/10/Fabricå¼€å‘æ¨¡å¼è¿è¡Œ/","content":"åŸºæœ¬æŠ„è¢­è‡ª[Goland/Vscodeè°ƒè¯•Hyperledger Fabric 2.0æºç ã€å•æœºç½‘ç»œï¼ˆå‚»ç“œå¼è°ƒè¯•ï¼‰](https://blog.51cto.com/u_14834727/3031542)\n# å¼•è¨€\nfabricä»£ç ä¿®æ”¹åï¼Œæƒ³è¦åœ¨æœ¬åœ°è°ƒè¯•ï¼Œæ­å»ºè°ƒè¯•ç¯å¢ƒè§‰å¾—éƒ½æŒºéº»çƒ¦çš„ã€‚å®˜æ–¹æ–‡æ¡£ç»“åˆè°·æ­Œï¼Œè®°å½•ä¸€ä¸‹`solo`æ¨¡å¼çš„ä¸€ä¸ªæ–¹æ¡ˆã€‚ç›®å‰å®˜æ–¹æœ€æ–°ç‰ˆçš„fabricä»£ç å·²ç»ä¸æ”¯æŒ`solo`æ¨¡å¼äº†ã€‚æ‰€ä»¥ï¼Œæœ¬æ–‡é€‚åˆæ”¯æŒ`solo`æ¨¡å¼çš„`Fabric`ç‰ˆæœ¬ã€‚\n\n## ç›®æ ‡ï¼š\n- å¯åŠ¨ä¸€ä¸ª`peer`å’Œä¸€ä¸ª`orderer`\n- ä½¿ç”¨fabric/sampleconfigä¸‹çš„é…ç½®æ–‡ä»¶ï¼ˆä¸€ä¸ªç»„ç»‡SampleOrgï¼‰,ç”Ÿæˆåˆ›ä¸–å—å’Œé€šé“é…ç½®\n- åˆ›å»ºé€šé“`myc`, `peer` åŠ å…¥é€šé“\n- ç”¨`fabric-sample`ä¸­çš„`fabcar`ä½œä¸ºä¾‹å­ï¼Œæ‰“åŒ…ã€å®‰è£…ã€å®¡æ ¸ã€æäº¤é“¾ç ï¼Œå†åˆå§‹åŒ–è´¦æœ¬ï¼Œåˆ›å»ºä¸€è¾†`car`,æŸ¥è¯¢æ‰€æœ‰`car`ã€‚\n- æ‰€æœ‰å‘½ä»¤æ‰§è¡Œéƒ½ä½¿ç”¨`debug`æ¨¡å¼ï¼Œæ— éœ€æ‰‹åŠ¨è¾“å…¥ä»»ä½•`peer`å‘½ä»¤ã€‚\n- å¯è°ƒè¯•é“¾ç \n\n# å‡†å¤‡å·¥ä½œ\n\n## fabricä»£ç \næ‹‰å–ä»£ç åï¼Œåœ¨ä»£ç ç›®å½•ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶ç›®å½•\n    ```shell\n    cd fabric\n    mkidr -p dev-network/config\n    ```\n## æ‹·è´é…ç½®æ–‡ä»¶ã€å¤–éƒ¨æ„å»ºç¨‹åºã€é“¾ç demo\n    ```shell\n    cp -r sampleconfig/* dev-network/\n    cp -r integration/externalbuilders dev-network/\n    cp -r $GOPATH/src/github.com/hyperledger/fabric-samples/chaincode $GOPATH/src/github.com/hyperledger/fabric/dev-network/\n    ```\n## æ‹·è´å®Œådev-networkç›®å½•ç»“æ„å¦‚ä¸‹:\n    ```\n    â”œâ”€â”€ chaincode\n    â”‚   â”œâ”€â”€ abac\n    â”‚   â”œâ”€â”€ abstore\n    â”‚   â”œâ”€â”€ fabcar\n    â”‚   â”œâ”€â”€ marbles02\n    â”‚   â”œâ”€â”€ marbles02_private\n    â”‚   â””â”€â”€ sacc\n    â”œâ”€â”€ config\n    â”œâ”€â”€ configtx.yaml\n    â”œâ”€â”€ core.yaml\n    â”œâ”€â”€ externalbuilders\n    â”‚   â”œâ”€â”€ binary\n    â”‚   â””â”€â”€ golang\n    â”œâ”€â”€ msp\n    â”‚   â”œâ”€â”€ admincerts\n    â”‚   â”œâ”€â”€ cacerts\n    â”‚   â”œâ”€â”€ config.yaml\n    â”‚   â”œâ”€â”€ keystore\n    â”‚   â”œâ”€â”€ signcerts\n    â”‚   â”œâ”€â”€ tlscacerts\n    â”‚   â””â”€â”€ tlsintermediatecerts\n    â””â”€â”€ orderer.yaml\n    ```\n## ä¿®æ”¹peeré…ç½®æ–‡ä»¶dev-network/core.yaml\næ‰¾åˆ°fileSystemPathï¼Œä¿®æ”¹å­˜å‚¨è·¯å¾„\n```yaml\npeer:\n    fileSystemPath: $GOPATH/src/github.com/hyperledger/fabric/dev-network/production/peer\n```\n\nä½¿ç”¨dockerè·‘é“¾ç é…ç½®ï¼ˆä¸æ”¯æŒè°ƒè¯•chaincodeï¼‰ï¼špeerä¼šè°ƒç”¨docker apiæ‰§è¡Œæ„å»ºã€è¿è¡Œé“¾ç ç­‰æ“ä½œã€‚\næ‰¾åˆ°vm,ä¿®æ”¹endpointå’Œdockeré…ç½®ï¼ˆè¯·æ ¹æ®å®é™…æƒ…å†µï¼Œä¿®æ”¹æˆä½ è‡ªå·±dockeré…ç½®ï¼‰**è¿™ä¸ªæ²¡éªŒè¯è¿‡**\n```yaml\nvm:\n    endpoint: tcp://192.168.99.100:2376\n    docker:\n        tls:\n            enabled: true\n            ca:\n                file: /Users/USER/.docker/machine/machines/demo/ca.pem\n            cert:\n                file: /Users/USER/.docker/machine/machines/demo/cert.pem\n            key:\n                file: /Users/USER/.docker/machine/machines/demo/key.pem\n```\n\nå¤–éƒ¨è·‘é“¾ç é…ç½®ï¼ˆæ”¯æŒè°ƒè¯•chaincode)\n```yaml\nchaincode:\n    externalBuilders:\n    - path: $GOPATH/src/github.com/hyperledger/fabric/dev-network/externalbuilders/golang\n    name: external-golang\n    environmentWhitelist:\n    - GOPROXY\n    - GOCACHE\n    - GOPATH\n```\n\n>æ³¨æ„ï¼špackageçš„æ—¶å€™labelæ ‡ç­¾éœ€è¦ä»¥-externalç»“å°¾ï¼Œeg:--label fabcarv1-externalï¼Œå¦‚æœéœ€è¦ä¿®æ”¹é»˜è®¤çš„è§„åˆ™ï¼Œè¯·ä¿®æ”¹dev-network/externalbuilders/golang/bin/detectè„šæœ¬\n```shell\nif [[ \"$(jq -r .label \"$2/metadata.json\")\" != *-external* ]]; then\n    >&2 echo \"only golang chaincode named with an '-external' suffix is supported\"\n    exit 1\nfi\n```\n\n## ä¿®æ”¹ordereré…ç½®æ–‡ä»¶dev-network/orderer.yaml\n\n    ä¿®æ”¹åˆ›ä¸–å—æ–‡ä»¶ä½ç½®ï¼ˆOPTï¼Œå¯ä¸ä¿®æ”¹ï¼Œåé¢01 ordererè°ƒè¯•é…ç½®ä¸­æœ‰ç¯å¢ƒå˜é‡ORDERER_GENERAL_GENESISMETHODå’ŒORDERER_GENERAL_GENESISFILEæŒ‡å®šäº†åˆ›ä¸–å—çš„ä½ç½®ï¼‰\n    ```yaml\n    General:\n        BootstrapFile: $GOPATH/src/github.com/hyperledger/fabric/dev-network/config/orderer.block\n    ```\n    ä¿®æ”¹è´¦æœ¬æ•°æ®ç›®å½•\n    ```yaml\n    FileLedger:\n        Location: $GOPATH/src/github.com/hyperledger/fabric/dev-network/production/orderer\n    ```\n## ç”Ÿæˆåˆ›ä¸–å—å’Œé€šé“é…ç½®\n    ```shell\n    cd dev-netwok\n    # åˆ›ä¸–å—\n    $GOPATH/src/github.com/hyperledger/fabric/build/bin/configtxgen -profile SampleDevModeSolo -channelID sys-channel -outputBlock ./config/orderer.block\n    # é€šé“é…ç½®\n    $GOPATH/src/github.com/hyperledger/fabric/build/bin/configtxgen -profile SampleSingleMSPChannel -outputCreateChannelTx ./config/myc.tx -channelID myc\n    ```\n## å¯¼å…¥é¡¹ç›®\n  - ç”¨golandæ‰“å¼€`$GOPATH/src/github.com/hyperledger/fabric`ç›®å½•ï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹è‡ªåŠ¨ç”Ÿæˆ`.idea`ç›®å½•\n  - ä¿®æ”¹golangé¡¹ç›®é…ç½®\n    ```shell\n    cd $GOPATH/src/github.com/hyperledger/fabric\n    vim .idea/workspace.xml\n    ```\n  - åœ¨`workspace.xml`ä¸­çš„`project`èŠ‚ç‚¹ä¸‹æ·»åŠ RunManagerç»„ä»¶ï¼ˆç”¨äºè°ƒè¯•æˆ–è¿è¡Œpeer å’Œordererç­‰ç›¸å…³å‘½ä»¤ï¼‰\n    ```xml\n    <component name=\"RunManager\" selected=\"Go Build.14 chaincode  fabcar QueryAllCars\">\n        <configuration name=\"01 orderer\" type=\"GoApplicationRunConfiguration\" factoryName=\"Go Application\">\n        <module name=\"fabric\" />\n        <working_directory value=\"$PROJECT_DIR$/\" />\n        <envs>\n            <env name=\"FABRIC_CFG_PATH\" value=\"dev-network\" />\n            <env name=\"ORDERER_GENERAL_LOCALMSPID\" value=\"SampleOrg\" />\n            <env name=\"ORDERER_GENERAL_GENESISFILE\" value=\"config/orderer.block\" />\n            <env name=\"ORDERER_GENERAL_GENESISMETHOD\" value=\"file\" />\n            <env name=\"ORDERER_GENERAL_LISTENADDRESS\" value=\"0.0.0.0\" />\n        </envs>\n        <kind value=\"FILE\" />\n        <filePath value=\"$PROJECT_DIR$/cmd/orderer/main.go\" />\n        <package value=\"github.com/hyperledger/fabric\" />\n        <directory value=\"$PROJECT_DIR$/\" />\n        <method v=\"2\" />\n        </configuration>\n        <configuration name=\"02 peer\" type=\"GoApplicationRunConfiguration\" factoryName=\"Go Application\">\n        <module name=\"fabric\" />\n        <working_directory value=\"$PROJECT_DIR$/\" />\n        <parameters value=\"node start --peer-chaincodedev=true\" />\n        <envs>\n            <env name=\"CORE_PEER_LOCALMSPID\" value=\"SampleOrg\" />\n            <env name=\"CORE_PEER_ID\" value=\"peer\" />\n            <env name=\"CORE_PEER_ADDRESS\" value=\"192.168.2.5:7051\" />\n            <env name=\"FABRIC_CFG_PATH\" value=\"dev-network\" />\n            <env name=\"GOCACHE\" value=\"$USER_HOME$/Library/Caches/go-build\" />\n        </envs>\n        <kind value=\"FILE\" />\n        <filePath value=\"$PROJECT_DIR$/cmd/peer/main.go\" />\n        <package value=\"github.com/hyperledger/fabric\" />\n        <directory value=\"$PROJECT_DIR$/\" />\n        <method v=\"2\" />\n        </configuration>\n        <configuration name=\"03 channel create \" type=\"GoApplicationRunConfiguration\" factoryName=\"Go Application\">\n        <module name=\"fabric\" />\n        <working_directory value=\"$PROJECT_DIR$/\" />\n        <parameters value=\"channel create -c myc -f dev-network/config/myc.tx -o 127.0.0.1:7050\" />\n        <envs>\n            <env name=\"CORE_PEER_LOCALMSPID\" value=\"SampleOrg\" />\n            <env name=\"CORE_PEER_ID\" value=\"cli\" />\n            <env name=\"CORE_PEER_ADDRESS\" value=\"127.0.0.1:7051\" />\n            <env name=\"FABRIC_CFG_PATH\" value=\"dev-network\" />\n        </envs>\n        <kind value=\"FILE\" />\n        <filePath value=\"cmd/peer/main.go\" />\n        <package value=\"github.com/hyperledger/fabric\" />\n        <directory value=\"$PROJECT_DIR$/\" />\n        <method v=\"2\" />\n        </configuration>\n        <configuration name=\"04 channel join \" type=\"GoApplicationRunConfiguration\" factoryName=\"Go Application\">\n        <module name=\"fabric\" />\n        <working_directory value=\"$PROJECT_DIR$/\" />\n        <parameters value=\"channel join -b myc.block\" />\n        <envs>\n            <env name=\"CORE_PEER_LOCALMSPID\" value=\"SampleOrg\" />\n            <env name=\"CORE_PEER_ID\" value=\"cli\" />\n            <env name=\"CORE_PEER_ADDRESS\" value=\"127.0.0.1:7051\" />\n            <env name=\"FABRIC_CFG_PATH\" value=\"dev-network\" />\n        </envs>\n        <kind value=\"FILE\" />\n        <filePath value=\"cmd/peer/main.go\" />\n        <package value=\"github.com/hyperledger/fabric\" />\n        <directory value=\"$PROJECT_DIR$/\" />\n        <method v=\"2\" />\n        </configuration>\n        <configuration name=\"05 chaincode package (docker )\" type=\"GoApplicationRunConfiguration\" factoryName=\"Go Application\">\n        <module name=\"fabric\" />\n        <working_directory value=\"$PROJECT_DIR$/\" />\n        <useCustomBuildTags value=\"true\" />\n        <parameters value=\"lifecycle chaincode package fabcar.tar.gz --path $PROJECT_DIR$/dev-network/chaincode/fabcar/go --lang golang --label fabcarv1\" />\n        <envs>\n            <env name=\"CORE_PEER_LOCALMSPID\" value=\"SampleOrg\" />\n            <env name=\"CORE_PEER_ID\" value=\"cli\" />\n            <env name=\"CORE_PEER_ADDRESS\" value=\"127.0.0.1:7051\" />\n            <env name=\"FABRIC_CFG_PATH\" value=\"dev-network\" />\n        </envs>\n        <kind value=\"FILE\" />\n        <filePath value=\"cmd/peer/main.go\" />\n        <package value=\"github.com/hyperledger/fabric\" />\n        <directory value=\"$PROJECT_DIR$/\" />\n        <method v=\"2\" />\n        </configuration>\n        <configuration name=\"05 chaincode package (externalbuilder)\" type=\"GoApplicationRunConfiguration\" factoryName=\"Go Application\">\n        <module name=\"fabric\" />\n        <working_directory value=\"$PROJECT_DIR$/\" />\n        <useCustomBuildTags value=\"true\" />\n        <parameters value=\"lifecycle chaincode package fabcar.tar.gz --path $PROJECT_DIR$/dev-network/chaincode/fabcar/go --lang golang --label fabcarv1-external\" />\n        <envs>\n            <env name=\"CORE_PEER_LOCALMSPID\" value=\"SampleOrg\" />\n            <env name=\"CORE_PEER_ID\" value=\"cli\" />\n            <env name=\"CORE_PEER_ADDRESS\" value=\"127.0.0.1:7051\" />\n            <env name=\"FABRIC_CFG_PATH\" value=\"dev-network\" />\n        </envs>\n        <kind value=\"FILE\" />\n        <filePath value=\"cmd/peer/main.go\" />\n        <package value=\"github.com/hyperledger/fabric\" />\n        <directory value=\"$PROJECT_DIR$/\" />\n        <method v=\"2\" />\n        </configuration>\n        <configuration name=\"06 chaincode install\" type=\"GoApplicationRunConfiguration\" factoryName=\"Go Application\">\n        <module name=\"fabric\" />\n        <working_directory value=\"$PROJECT_DIR$/\" />\n        <useCustomBuildTags value=\"true\" />\n        <parameters value=\"lifecycle chaincode install fabcar.tar.gz\" />\n        <envs>\n            <env name=\"CORE_PEER_LOCALMSPID\" value=\"SampleOrg\" />\n            <env name=\"CORE_PEER_ID\" value=\"cli\" />\n            <env name=\"CORE_PEER_ADDRESS\" value=\"127.0.0.1:7051\" />\n            <env name=\"FABRIC_CFG_PATH\" value=\"dev-network\" />\n        </envs>\n        <kind value=\"FILE\" />\n        <filePath value=\"cmd/peer/main.go\" />\n        <package value=\"github.com/hyperledger/fabric\" />\n        <directory value=\"$PROJECT_DIR$/\" />\n        <method v=\"2\" />\n        </configuration>\n        <configuration name=\"07 chaincode queryinstalled\" type=\"GoApplicationRunConfiguration\" factoryName=\"Go Application\">\n        <module name=\"fabric\" />\n        <working_directory value=\"$PROJECT_DIR$/\" />\n        <useCustomBuildTags value=\"true\" />\n        <parameters value=\"lifecycle chaincode queryinstalled\" />\n        <envs>\n            <env name=\"CORE_PEER_LOCALMSPID\" value=\"SampleOrg\" />\n            <env name=\"CORE_PEER_ID\" value=\"cli\" />\n            <env name=\"CORE_PEER_ADDRESS\" value=\"127.0.0.1:7051\" />\n            <env name=\"FABRIC_CFG_PATH\" value=\"dev-network\" />\n        </envs>\n        <kind value=\"FILE\" />\n        <filePath value=\"cmd/peer/main.go\" />\n        <package value=\"github.com/hyperledger/fabric\" />\n        <directory value=\"$PROJECT_DIR$/\" />\n        <method v=\"2\" />\n        </configuration>\n        <configuration name=\"08 chaincode approve (externalbuilder)\" type=\"GoApplicationRunConfiguration\" factoryName=\"Go Application\">\n        <module name=\"fabric\" />\n        <working_directory value=\"$PROJECT_DIR$/\" />\n        <useCustomBuildTags value=\"true\" />\n        <parameters value=\"lifecycle chaincode approveformyorg --channelID myc --name fabcar --version 1.0 --init-required --package-id fabcarv1-external:71e92900aae6b5ed64d53f83940608c9235cd41decf370b346f4833cf3b83345 --sequence 1 --waitForEvent\" />\n        <envs>\n            <env name=\"CORE_PEER_LOCALMSPID\" value=\"SampleOrg\" />\n            <env name=\"CORE_PEER_ID\" value=\"cli\" />\n            <env name=\"CORE_PEER_ADDRESS\" value=\"127.0.0.1:7051\" />\n            <env name=\"FABRIC_CFG_PATH\" value=\"dev-network\" />\n        </envs>\n        <kind value=\"FILE\" />\n        <filePath value=\"cmd/peer/main.go\" />\n        <package value=\"github.com/hyperledger/fabric\" />\n        <directory value=\"$PROJECT_DIR$/\" />\n        <method v=\"2\" />\n        </configuration>\n        <configuration name=\"08 chaincode approve ï¼ˆdockerï¼‰\" type=\"GoApplicationRunConfiguration\" factoryName=\"Go Application\">\n        <module name=\"fabric\" />\n        <working_directory value=\"$PROJECT_DIR$/\" />\n        <useCustomBuildTags value=\"true\" />\n        <parameters value=\"lifecycle chaincode approveformyorg --channelID myc --name fabcar --version 1.0 --init-required --package-id fabcarv1:759e143166fb106f7f150c1e99ee7236eb57fd328b6d9d43b004afbeca9aa475 --sequence 1 --waitForEvent\" />\n        <envs>\n            <env name=\"CORE_PEER_LOCALMSPID\" value=\"SampleOrg\" />\n            <env name=\"CORE_PEER_ID\" value=\"cli\" />\n            <env name=\"CORE_PEER_ADDRESS\" value=\"127.0.0.1:7051\" />\n            <env name=\"FABRIC_CFG_PATH\" value=\"dev-network\" />\n        </envs>\n        <kind value=\"FILE\" />\n        <filePath value=\"cmd/peer/main.go\" />\n        <package value=\"github.com/hyperledger/fabric\" />\n        <directory value=\"$PROJECT_DIR$/\" />\n        <method v=\"2\" />\n        </configuration>\n        <configuration name=\"09 chaincode checkcommitreadiness\" type=\"GoApplicationRunConfiguration\" factoryName=\"Go Application\">\n        <module name=\"fabric\" />\n        <working_directory value=\"$PROJECT_DIR$/\" />\n        <useCustomBuildTags value=\"true\" />\n        <parameters value=\"lifecycle chaincode checkcommitreadiness --channelID myc --name fabcar --version 1.0 --init-required --sequence 1\" />\n        <envs>\n            <env name=\"CORE_PEER_LOCALMSPID\" value=\"SampleOrg\" />\n            <env name=\"CORE_PEER_ID\" value=\"cli\" />\n            <env name=\"CORE_PEER_ADDRESS\" value=\"127.0.0.1:7051\" />\n            <env name=\"FABRIC_CFG_PATH\" value=\"dev-network\" />\n        </envs>\n        <kind value=\"FILE\" />\n        <filePath value=\"cmd/peer/main.go\" />\n        <package value=\"github.com/hyperledger/fabric\" />\n        <directory value=\"$PROJECT_DIR$/\" />\n        <method v=\"2\" />\n        </configuration>\n        <configuration name=\"10 chaincode commit\" type=\"GoApplicationRunConfiguration\" factoryName=\"Go Application\">\n        <module name=\"fabric\" />\n        <working_directory value=\"$PROJECT_DIR$/\" />\n        <useCustomBuildTags value=\"true\" />\n        <parameters value=\"lifecycle chaincode commit --channelID myc --name fabcar --version 1.0 --sequence 1 --init-required --waitForEvent\" />\n        <envs>\n            <env name=\"CORE_PEER_LOCALMSPID\" value=\"SampleOrg\" />\n            <env name=\"CORE_PEER_ID\" value=\"cli\" />\n            <env name=\"CORE_PEER_ADDRESS\" value=\"127.0.0.1:7051\" />\n            <env name=\"FABRIC_CFG_PATH\" value=\"dev-network\" />\n        </envs>\n        <kind value=\"FILE\" />\n        <filePath value=\"cmd/peer/main.go\" />\n        <package value=\"github.com/hyperledger/fabric\" />\n        <directory value=\"$PROJECT_DIR$/\" />\n        <method v=\"2\" />\n        </configuration>\n        <configuration name=\"11 chaincode querycommit\" type=\"GoApplicationRunConfiguration\" factoryName=\"Go Application\">\n        <module name=\"fabric\" />\n        <working_directory value=\"$PROJECT_DIR$/\" />\n        <useCustomBuildTags value=\"true\" />\n        <parameters value=\"lifecycle chaincode querycommitted --channelID myc --output json\" />\n        <envs>\n            <env name=\"CORE_PEER_LOCALMSPID\" value=\"SampleOrg\" />\n            <env name=\"CORE_PEER_ID\" value=\"cli\" />\n            <env name=\"CORE_PEER_ADDRESS\" value=\"127.0.0.1:7051\" />\n            <env name=\"FABRIC_CFG_PATH\" value=\"dev-network\" />\n        </envs>\n        <kind value=\"FILE\" />\n        <filePath value=\"cmd/peer/main.go\" />\n        <package value=\"github.com/hyperledger/fabric\" />\n        <directory value=\"$PROJECT_DIR$/\" />\n        <method v=\"2\" />\n        </configuration>\n        <configuration name=\"12 chaincode  fabcar initLedger\" type=\"GoApplicationRunConfiguration\" factoryName=\"Go Application\">\n        <module name=\"fabric\" />\n        <working_directory value=\"$PROJECT_DIR$/\" />\n        <useCustomBuildTags value=\"true\" />\n        <parameters value=\"chaincode invoke -C myc -n fabcar --isInit -c &quot;{\\&quot;function\\&quot;:\\&quot;initLedger\\&quot;,\\&quot;Args\\&quot;:[\\&quot;\\&quot;]}&quot;\" />\n        <envs>\n            <env name=\"CORE_PEER_LOCALMSPID\" value=\"SampleOrg\" />\n            <env name=\"CORE_PEER_ID\" value=\"cli\" />\n            <env name=\"CORE_PEER_ADDRESS\" value=\"127.0.0.1:7051\" />\n            <env name=\"FABRIC_CFG_PATH\" value=\"dev-network\" />\n        </envs>\n        <kind value=\"FILE\" />\n        <filePath value=\"cmd/peer/main.go\" />\n        <package value=\"github.com/hyperledger/fabric\" />\n        <directory value=\"$PROJECT_DIR$/\" />\n        <method v=\"2\" />\n        </configuration>\n        <configuration name=\"13 chaincode  fabcar create car\" type=\"GoApplicationRunConfiguration\" factoryName=\"Go Application\">\n        <module name=\"fabric\" />\n        <working_directory value=\"$PROJECT_DIR$/\" />\n        <useCustomBuildTags value=\"true\" />\n        <parameters value=\"chaincode invoke -C myc -n fabcar -c &quot;{\\&quot;function\\&quot;:\\&quot;CreateCar\\&quot;,\\&quot;Args\\&quot;:[\\&quot;CAR9\\&quot;,\\&quot;BYD\\&quot;,\\&quot;å”dm\\&quot;,\\&quot;Red\\&quot;,\\&quot;Pld\\&quot;]}&quot;\" />\n        <envs>\n            <env name=\"CORE_PEER_LOCALMSPID\" value=\"SampleOrg\" />\n            <env name=\"CORE_PEER_ID\" value=\"cli\" />\n            <env name=\"CORE_PEER_ADDRESS\" value=\"127.0.0.1:7051\" />\n            <env name=\"FABRIC_CFG_PATH\" value=\"dev-network\" />\n        </envs>\n        <kind value=\"FILE\" />\n        <filePath value=\"cmd/peer/main.go\" />\n        <package value=\"github.com/hyperledger/fabric\" />\n        <directory value=\"$PROJECT_DIR$/\" />\n        <method v=\"2\" />\n        </configuration>\n        <configuration name=\"14 chaincode  fabcar QueryAllCars\" type=\"GoApplicationRunConfiguration\" factoryName=\"Go Application\">\n        <module name=\"fabric\" />\n        <working_directory value=\"$PROJECT_DIR$/\" />\n        <useCustomBuildTags value=\"true\" />\n        <parameters value=\"chaincode invoke -C myc -n fabcar -c &quot;{\\&quot;function\\&quot;:\\&quot;QueryAllCars\\&quot;,\\&quot;Args\\&quot;:[\\&quot;\\&quot;]}&quot;\" />\n        <envs>\n            <env name=\"CORE_PEER_LOCALMSPID\" value=\"SampleOrg\" />\n            <env name=\"CORE_PEER_ID\" value=\"cli\" />\n            <env name=\"CORE_PEER_ADDRESS\" value=\"127.0.0.1:7051\" />\n            <env name=\"FABRIC_CFG_PATH\" value=\"dev-network\" />\n        </envs>\n        <kind value=\"FILE\" />\n        <filePath value=\"cmd/peer/main.go\" />\n        <package value=\"github.com/hyperledger/fabric\" />\n        <directory value=\"$PROJECT_DIR$/\" />\n        <method v=\"2\" />\n        </configuration>\n        <configuration name=\"15 chaincode debug fabcar\" type=\"GoApplicationRunConfiguration\" factoryName=\"Go Application\">\n        <module name=\"fabric\" />\n        <working_directory value=\"$PROJECT_DIR$/dev-network/chaincode/fabcar/go\" />\n        <useCustomBuildTags value=\"true\" />\n        <parameters value=\"-peer.address=192.168.2.5:7052\" />\n        <envs>\n            <env name=\"CORE_CHAINCODE_ID_NAME\" value=\"fabcarv1-external:71e92900aae6b5ed64d53f83940608c9235cd41decf370b346f4833cf3b83345\" />\n            <env name=\"CORE_PEER_TLS_ENABLED\" value=\"false\" />\n        </envs>\n        <kind value=\"FILE\" />\n        <filePath value=\"fabcar.go\" />\n        <package value=\"github.com/hyperledger/fabric\" />\n        <directory value=\"$PROJECT_DIR$/\" />\n        <method v=\"2\" />\n        </configuration>\n        <list>\n        <item itemvalue=\"Go Build.01 orderer\" />\n        <item itemvalue=\"Go Build.02 peer\" />\n        <item itemvalue=\"Go Build.03 channel create \" />\n        <item itemvalue=\"Go Build.04 channel join \" />\n        <item itemvalue=\"Go Build.05 chaincode package (docker )\" />\n        <item itemvalue=\"Go Build.05 chaincode package (externalbuilder)\" />\n        <item itemvalue=\"Go Build.06 chaincode install\" />\n        <item itemvalue=\"Go Build.07 chaincode queryinstalled\" />\n        <item itemvalue=\"Go Build.08 chaincode approve ï¼ˆdockerï¼‰\" />\n        <item itemvalue=\"Go Build.08 chaincode approve (externalbuilder)\" />\n        <item itemvalue=\"Go Build.09 chaincode checkcommitreadiness\" />\n        <item itemvalue=\"Go Build.10 chaincode commit\" />\n        <item itemvalue=\"Go Build.11 chaincode querycommit\" />\n        <item itemvalue=\"Go Build.12 chaincode  fabcar initLedger\" />\n        <item itemvalue=\"Go Build.13 chaincode  fabcar create car\" />\n        <item itemvalue=\"Go Build.14 chaincode  fabcar QueryAllCars\" />\n        <item itemvalue=\"Go Build.15 chaincode debug fabcar\" />\n        </list>\n    </component> \n    ```\n    å¦‚æœæ²¡é—®é¢˜çš„è¯ï¼Œåœ¨golandä¸­çš„ Run/Debug Configurationsæ¡†ä¸­ä¼šå‡ºç°ä¸‹å›¾ï¼š\n    ![Run/Debug Configurations](Fabricå¼€å‘æ¨¡å¼è¿è¡Œ/fabric-debug.jpg)\n\n>vscodeçš„è°ƒè¯•é…ç½®ä¸æƒ³æŠ„äº†ï¼Œé¡¶éƒ¨é“¾æ¥çš„åŸæ–‡ä¸­å»çœ‹å§\n\n# å¼€å§‹è°ƒè¯•\n\n    ä¾æ¬¡è¿è¡Œ01~14é…ç½®ï¼Œåœ¨éœ€è¦çš„åœ°æ–¹è®¾ç½®æ–­ç‚¹ï¼Œè§‚å¯Ÿæ§åˆ¶å°å˜åŒ–\n  - å°†é…ç½®02 peerä¸­ç¯å¢ƒå˜é‡CORE_PEER_ADDRESSçš„å€¼ä¿®æ”¹æˆä½ ç½‘å¡ipåœ°å€ï¼ˆä¸èƒ½ä½¿ç”¨127.0.0.1ä¹‹ç±»çš„å›ç¯åœ°å€ï¼‰ï¼Œå¦åˆ™é“¾ç æ— æ³•è¿æ¥åˆ°peeré“¾ç æœåŠ¡\n  - å°†é…ç½®02 peerä¸­ç¯å¢ƒå˜é‡GOCACHEçš„å€¼ä¿®æ”¹æˆgo env GOCACHEè·å–çš„å€¼ï¼Œå¦åˆ™externalbuilderæ— æ³•build\n  - 05 chaincode package æœ‰ä¸¤ä¸ªé…ç½®ï¼Œéœ€è¦è°ƒè¯•é“¾ç è¯·è·‘externalbuilder\n  - æ‰§è¡Œ06 chaincode installæˆ–07 chaincode queryinstalled åéœ€è®°å½•ä¸‹Package IDï¼Œæ‰§è¡Œ08 chaincode approveæ›¿æ¢package-idçš„å€¼,é“¾ç å’Œæ ‡ç­¾ä¿®æ”¹éƒ½ä¼šå¯¼è‡´package-idå‘ç”Ÿå˜åŒ–\n  - å¦‚æœä½¿ç”¨dockerè·‘é“¾ç ï¼Œæ‰§è¡Œ10 chaincode commitåï¼Œæ‰§è¡Œdocker psæŸ¥çœ‹é“¾ç å®¹å™¨æ˜¯å¦å¯åŠ¨ï¼Œå¦‚æœæ²¡æœ‰å¯åŠ¨é“¾ç æ— æ³•è°ƒç”¨ï¼›å¦‚æœä½¿ç”¨externalbuilderè·‘é“¾ç ï¼Œæ‰§è¡Œps -ef | grep fabcarv1-externalæ£€æŸ¥é“¾ç è¿›ç¨‹æ˜¯å¦å¯åŠ¨\n\n>è°ƒè¯•é“¾ç ç›¸å…³çš„ä¹Ÿä¸æƒ³æŠ„äº†ï¼Œçœ‹é¡¶éƒ¨é“¾æ¥çš„åŸæ–‡å§ï¼Œæˆ‘åªæ˜¯æƒ³èƒ½è°ƒè¯•è¿è¡Œå¸®åŠ©é˜…è¯»fabricæºç è€Œå·²","tags":["Solo"],"categories":["åŒºå—é“¾","Fabric"]},{"title":"Linux-æƒé™è§£æ","url":"/2023/01/09/Linux-æƒé™è§£æ/","content":"\n# æƒé™ç®€ä»‹\nLinuxç³»ç»Ÿä¸Šå¯¹æ–‡ä»¶çš„æƒé™æœ‰ç€ä¸¥æ ¼çš„æ§åˆ¶ï¼Œå¦‚æœæƒ³å¯¹æŸä¸ªæ–‡ä»¶æ‰§è¡ŒæŸç§æ“ä½œï¼Œå¿…é¡»å…·æœ‰å¯¹åº”çš„æƒé™æ–¹å¯æ‰§è¡ŒæˆåŠŸã€‚Linuxä¸‹æ–‡ä»¶çš„`æƒé™ç±»å‹`ä¸€èˆ¬åŒ…æ‹¬ï¼šè¯»ï¼Œå†™ï¼Œæ‰§è¡Œã€‚å¯¹åº”å­—æ¯ä¸ºï¼šrã€wã€xã€‚\nLinuxä¸‹`æƒé™ç²’åº¦`æœ‰ï¼šæ‹¥æœ‰è€…ã€ç¾¤ç»„ã€å…¶å®ƒç»„ä¸‰ç§ã€‚æ¯ä¸ªæ–‡ä»¶éƒ½å¯ä»¥é’ˆå¯¹ä¸‰ä¸ªç²’åº¦ï¼Œè®¾ç½®ä¸åŒçš„rwx(è¯»å†™æ‰§è¡Œ)æƒé™ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ–‡ä»¶åªèƒ½å½’å±äºä¸€ä¸ªç”¨æˆ·å’Œç»„ï¼Œ å¦‚æœå…¶å®ƒçš„ç”¨æˆ·æƒ³æœ‰è¿™ä¸ªæ–‡ä»¶çš„æƒé™ï¼Œåˆ™å¯ä»¥å°†è¯¥ç”¨æˆ·åŠ å…¥å…·å¤‡æƒé™çš„ç¾¤ç»„ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥åŒæ—¶å½’å±äºå¤šä¸ªç»„ã€‚\nLinuxä¸Šé€šå¸¸ä½¿ç”¨chmodå‘½ä»¤å¯¹æ–‡ä»¶çš„æƒé™è¿›è¡Œè®¾ç½®å’Œæ›´æ”¹ã€‚\n\n# æ›´æ”¹æ–‡ä»¶æƒé™\n`chmod`å‘½ä»¤\n## å‘½ä»¤æ ¼å¼\n```shell\nchmod [å¯é€‰é¡¹] <mode> <file...>\n```\n## ç¤ºä¾‹\nè®¾ç½®æ‰€æœ‰ç”¨æˆ·å¯è¯»å–`a.conf`\n```shell\nchmod a+r a.conf    # aè¡¨ç¤ºæ‰€æœ‰ï¼ˆç”¨æˆ·ã€ç¾¤ç»„ã€å…¶å®ƒç»„ï¼‰ï¼Œ+rè¡¨ç¤ºè¯»å–æƒé™\n```\næˆ–\n```shell\nchmod ugo+r a.conf   # ugo3ä¸ªå­—æ¯åˆ†åˆ«è¡¨ç¤ºç”¨æˆ·ï¼Œç¾¤ç»„ã€å…¶å®ƒç»„ï¼Œ+rè¡¨ç¤ºè¯»å–æƒé™\n```\n\nè®¾ç½®`b.sh`åªæœ‰æ‹¥æœ‰è€…ï¼ˆå³`u`)æœ‰è¯»å†™ã€æ‰§è¡Œæƒé™\n```shell\nchmod u+rwx b.sh \n```\n\nè®¾ç½®æ–‡ä»¶`a.conf`ä¸`c.xml`æƒé™ä¸ºæ‹¥æœ‰è€…ä¸å…¶æ‰€å±åŒä¸€ä¸ªç¾¤ç»„å¯è¯»å†™ï¼Œå…¶å®ƒç»„å¯è¯»ä¸å¯å†™\n```shell\nchmod a+r,ug+w,o-w a.conf c.xml\n```\n\nè®¾ç½®å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ¡£æ¡ˆä¸å­ç›®å½•çš†è®¾ä¸ºä»»ä½•äººå¯è¯»å†™\n```shell\nchmod -R a+rw *\n```\n---\n## æ•°å­—æƒé™ä½¿ç”¨æ ¼å¼\nåœ¨è¿™ç§ä½¿ç”¨æ–¹å¼ä¸­ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£æ•°å­—å¦‚ä½•è¡¨ç¤ºæƒé™ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬è§„å®šæ•°å­—`4`ã€`2`å’Œ`1`è¡¨ç¤ºè¯»ã€å†™ã€æ‰§è¡Œæƒé™ï¼Œå³`r=4`ï¼Œ`w=2`ï¼Œ`x=1` ã€‚æ­¤æ—¶å…¶ä»–çš„æƒé™ç»„åˆä¹Ÿå¯ä»¥ç”¨å…¶ä»–çš„å…«è¿›åˆ¶æ•°å­—è¡¨ç¤ºå‡ºæ¥ï¼Œ\n\nå¦‚ï¼š\n\nrwx = 4 + 2 + 1 = 7\n\nrw = 4 + 2 = 6\n\nrx = 4 +1 = 5\n\nå³\n\nè‹¥è¦åŒæ—¶è®¾ç½® rwx (å¯è¯»å†™è¿è¡Œï¼‰ æƒé™åˆ™å°†è¯¥æƒé™ä½ è®¾ç½® ä¸º 4 + 2 + 1 = 7\n\nè‹¥è¦åŒæ—¶è®¾ç½® rw- ï¼ˆå¯è¯»å†™ä¸å¯è¿è¡Œï¼‰æƒé™åˆ™å°†è¯¥æƒé™ä½ è®¾ç½® ä¸º 4 + 2 = 6\n\nè‹¥è¦åŒæ—¶è®¾ç½® r-x ï¼ˆå¯è¯»å¯è¿è¡Œä¸å¯å†™ï¼‰æƒé™åˆ™å°†è¯¥æƒé™ä½ è®¾ç½® ä¸º 4 +1 = 5\n\nä¸Šé¢æˆ‘ä»¬æåˆ°ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½å¯ä»¥é’ˆå¯¹ä¸‰ä¸ªç²’åº¦ï¼Œè®¾ç½®ä¸åŒçš„rwx(è¯»å†™æ‰§è¡Œ)æƒé™ã€‚å³æˆ‘ä»¬å¯ä»¥ç”¨ç”¨ä¸‰ä¸ª`8è¿›åˆ¶æ•°å­—`åˆ†åˆ«è¡¨ç¤º`æ‹¥æœ‰è€…`ã€`ç¾¤ç»„`ã€`å…¶å®ƒç»„`( uã€ g ã€o)çš„æƒé™è¯¦æƒ…ï¼Œå¹¶ç”¨chmodç›´æ¥åŠ ä¸‰ä¸ª`8è¿›åˆ¶`æ•°å­—çš„æ–¹å¼ç›´æ¥æ”¹å˜æ–‡ä»¶æƒé™ã€‚è¯­æ³•æ ¼å¼ä¸ºï¼š\n```shell\nchmod <abc> file...\n```\n```\nå…¶ä¸­a,b,cå„ä¸ºä¸€ä¸ªæ•°å­—ï¼Œåˆ†åˆ«ä»£è¡¨Userã€Groupã€åŠOtherçš„æƒé™ã€‚ç›¸å½“äºç®€åŒ–ç‰ˆçš„\nchmod u=æƒé™,g=æƒé™,o=æƒé™ file...\nè€Œæ­¤å¤„çš„æƒé™å°†ç”¨8è¿›åˆ¶çš„æ•°å­—æ¥è¡¨ç¤ºUserã€Groupã€åŠOtherçš„è¯»ã€å†™ã€æ‰§è¡Œæƒé™\n```\n\n## ç¤ºä¾‹\nè®¾ç½®æ‰€æœ‰äººå¯ä»¥è¯»å†™åŠæ‰§è¡Œ\n```shell\nchmod 777 a.sh # (ç­‰ä»·äº  chmod u=rwx,g=rwx,o=rwx a.sh æˆ–  chmod a=rwx a.sh)\n```\n\nè®¾ç½®æ‹¥æœ‰è€…å¯è¯»å†™ï¼Œå…¶ä»–äººä¸å¯è¯»å†™æ‰§è¡Œ\n```shell\nchmod 600 a.sh (ç­‰ä»·äºchmod u=rw,g=---,o=--- a.sh æˆ– chmod u=rw,go-rwx a.sh)\n```\n\n| æƒé™ | 8è¿›åˆ¶å€¼ | æè¿° |\n| -- | -- | -- |\n| --- | 0 | æ²¡æœ‰ä»»ä½•æƒé™ |\n| --x | 1 | åªæœ‰æ‰§è¡Œæƒé™ |\n| -w- | 2 | åªæœ‰å†™å…¥æƒé™ |\n| -wx | 3 | æœ‰å†™å…¥å’Œæ‰§è¡Œæƒé™ |\n| r-- | 4 | æœ‰è¯»å–æƒé™ |\n| r-x | 5 | æœ‰è¯»å–å’Œæ‰§è¡Œæƒé™ |\n| rw- | 6 | æœ‰è¯»å–å’Œå†™å…¥æƒé™ |\n| rwx | 7 | æœ‰å…¨éƒ¨æƒé™ |\n\n> æ³¨ï¼šæƒé™rwx3ä¸ªâ€œä½â€ï¼Œå€¼åˆ†åˆ«æ˜¯4ï¼Œ2ï¼Œ1 å¯¹åº”çš„äºŒè¿›åˆ¶å€¼ä¸º 100ï¼Œ010ï¼Œ001ã€‚è®¾è®¡æˆè¿™æ ·çš„å€¼æ–¹ä¾¿è¿›è¡Œâ€œä½æˆ–â€æ“ä½œï¼ˆå…¶å®å°±ç›¸å½“äº+ï¼‰ã€‚ç”¨è¿™æ ·çš„è®¾è®¡ï¼Œåœ¨è¿›è¡Œä½æˆ–æ“ä½œæ—¶ï¼Œå°±èƒ½å½¢æˆä¸ä¼šé‡å¤çš„ç»“æœåˆ†åˆ«ç”¨æ¥è¡¨ç¤ºä¸åŒçš„ç»„åˆã€‚","tags":["æƒé™","æƒé™ç±»å‹","æƒé™ç²’åº¦"],"categories":["Linux"]},{"title":"é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00005","url":"/2023/01/08/é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00005/","content":"\n# å‰è¨€\nä»¥æŠ½è±¡æ–¹å¼è€¦åˆæ˜¯ä¾èµ–å€’è½¬åŸåˆ™çš„å…³é”®ã€‚ç”±äºæŠ½è±¡è€¦åˆå…³ç³»æ€»è¦æ¶‰åŠå…·ä½“ç±»ä»æŠ½è±¡ç±»ç»§æ‰¿ï¼Œå¹¶ä¸”éœ€è¦ä¿è¯ä»»ä½•å¼•ç”¨åˆ°åŸºç±»çš„åœ°æ–¹éƒ½å¯ä»¥æ”¹æ¢æˆå…¶å­ç±»ï¼Œå› æ­¤é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯ä¾èµ–å€’è½¬åŸåˆ™çš„åŸºç¡€ã€‚\n\nåœ¨æŠ½è±¡å±‚æ¬¡ä¸Šçš„è€¦åˆè™½ç„¶æœ‰çµæ´»æ€§ï¼Œä½†ä¹Ÿå¸¦æ¥äº†é¢å¤–çš„å¤æ‚æ€§ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªå…·ä½“ç±»å‘ç”Ÿå˜åŒ–çš„å¯èƒ½æ€§éå¸¸å°ï¼Œé‚£ä¹ˆæŠ½è±¡è€¦åˆèƒ½å‘æŒ¥çš„å¥½å¤„ä¾¿ååˆ†æœ‰é™ï¼Œè¿™æ—¶ä½¿ç”¨å…·ä½“è€¦åˆåè€Œä¼šæ›´å¥½ã€‚\n\nä¾èµ–å€’è½¬åŸåˆ™æ˜¯`OO`è®¾è®¡çš„æ ¸å¿ƒåŸåˆ™ï¼Œè®¾è®¡æ¨¡å¼çš„ç ”ç©¶å’Œåº”ç”¨æ˜¯ä»¥ä¾èµ–å€’è½¬åŸåˆ™ä¸ºæŒ‡å¯¼åŸåˆ™çš„ã€‚ä¸‹é¢å°±ä¸¾å‡ ä¸ªè®¾è®¡æ¨¡å¼çš„ä¾‹å­åŠ ä»¥è¯´æ˜ã€‚\n\n# å·¥å‚æ–¹æ³•æ¨¡å¼\næ­£å¦‚å‰é¢æ‰€è°ˆåˆ°çš„ï¼Œåº”å½“ä½¿æ¶ˆè´¹ä¸€ä¸ªå¯¹è±¡çš„å®¢æˆ·ç«¯åªä¾èµ–äºå¯¹è±¡çš„æŠ½è±¡ç±»å‹ï¼Œè€Œä¸æ˜¯å®ƒçš„å…·ä½“ç±»å‹ã€‚ä½†æ˜¯`Java`è¯­è¨€è¦æ±‚åœ¨å°†ä¸€ä¸ªï¼ˆå…·ä½“ï¼‰ç±»å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå¿…é¡»è°ƒç”¨è¿™ä¸ªå…·ä½“ç±»çš„æ„é€ å­ï¼Œæ‰€ä»¥`Java`è¯­è¨€ç»™å‡ºçš„ç±»çš„å®ä¾‹åŒ–æ–¹æ³•æ— æ³•åšåˆ°åªä¾èµ–äºæŠ½è±¡ç±»å‹ã€‚\n\nä½†æ˜¯è®¾è®¡æ¨¡å¼ç»™å‡ºäº†è§£å†³è¿™ä¸ªé—®é¢˜çš„å¯è¡Œæ–¹æ¡ˆï¼Œå…¶ä¸­æœ€é‡è¦çš„æ–¹æ¡ˆå°±æ˜¯å·¥å‚æ¨¡å¼ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼æ˜¯å‡ ä¸ªå·¥å‚æ¨¡å¼ä¸­æœ€ä¸ºå…¸å‹çš„ä¸€ä¸ªï¼Œä¸‹å›¾æ‰€ç¤ºå°±æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼çš„ç®€ç•¥ç±»å›¾ã€‚\n![å·¥å‚æ–¹æ³•æ¨¡å¼ç®€ç•¥ç±»å›¾](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00005/FactoryMethod.jpg)\n\nå·¥å‚æ¨¡å¼å°†åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹çš„è¿‡ç¨‹å°è£…èµ·æ¥ï¼Œæ¶ˆè´¹è¿™ä¸ªå®ä¾‹çš„å®¢æˆ·ç«¯ä»…ä»…å¾—åˆ°å®ä¾‹åŒ–çš„ç»“æœï¼Œä»¥åŠè¿™ä¸ªå®ä¾‹çš„æŠ½è±¡ç±»å‹ã€‚å½“ç„¶ï¼Œä»»ä½•æ–¹æ³•éƒ½æ— æ³•å›é¿`Java`è¯­è¨€æ‰€è¦æ±‚çš„`new`å…³é”®å­—å’Œç›´æ¥è°ƒç”¨å…·ä½“ç±»çš„æ„é€ å­çš„åšæ³•ã€‚ç®€å•å·¥å‚æ¨¡å¼å°†è¿™ä¸ªè¿åâ€œå¼€-é—­â€åŸåˆ™ä»¥åŠä¾èµ–å€’è½¬åŸåˆ™çš„åšæ³•å°è£…åˆ°ä¸€ä¸ªç±»é‡Œé¢ï¼Œè€Œå·¥å‚æ–¹æ³•æ¨¡å¼å°†è¿™ä¸ªè¿ååŸåˆ™çš„åšæ³•æ¨è¿Ÿåˆ°äº†å…·ä½“å·¥å‚è§’è‰²ä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n![å·¥å‚æ–¹æ³•æ¨¡å¼ç®€ç•¥ç±»å›¾](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00005/FactoryMethod1.jpg)\n\nè¿™æ ·ï¼Œé€šè¿‡é€‚å½“åœ°å°è£…ï¼Œå·¥å‚æ¨¡å¼å¯ä»¥å‡€åŒ–å¤§éƒ¨åˆ†çš„ç»“æ„ï¼Œè€Œå°†è¿ååŸåˆ™çš„åšæ³•å­¤ç«‹åˆ°æ˜“äºæ§åˆ¶çš„åœ°æ–¹ã€‚\n\n# æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼\nåœ¨æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼é‡Œé¢ï¼Œæœ‰ä¸€ä¸ªæŠ½è±¡ç±»å°†é‡è¦çš„å®è§‚é€»è¾‘ä»¥`å…·ä½“æ–¹æ³•`ä»¥åŠ`å…·ä½“æ„é€ å­`çš„å½¢å¼å®ç°ï¼Œç„¶åå£°æ˜ä¸€äº›æŠ½è±¡æ–¹æ³•æ¥è¿«å­ç±»å®ç°å‰©ä½™çš„å…·ä½“ç»†èŠ‚ä¸Šçš„é€»è¾‘ã€‚ä¸åŒçš„å­ç±»å¯ä»¥ä»¥ä¸åŒçš„æ–¹å¼å®ç°è¿™äº›æŠ½è±¡æ–¹æ³•ï¼Œä»è€Œå¯¹**å‰©ä½™çš„é€»è¾‘**æœ‰ä¸åŒçš„å®ç°ã€‚æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼æ”¯æŒä¾èµ–å€’è½¬åŸåˆ™ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n![æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼ç®€ç•¥ç±»å›¾](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00005/TemplateMethod.jpg)\n\nå…·ä½“å­ç±»ä¸èƒ½å½±å“æŠ½è±¡ç±»çš„å®è§‚é€»è¾‘ï¼Œè€ŒæŠ½è±¡é€»è¾‘çš„æ”¹å˜åˆ™ä¼šå¯¼è‡´ç»†èŠ‚é€»è¾‘çš„æ”¹å˜ã€‚\n\n# è¿­ä»£å­æ¨¡å¼\nè¿­ä»£å­æ¨¡å¼ç”¨ä¸€ä¸ªå·¥å‚æ–¹æ³•å‘å®¢æˆ·ç«¯æä¾›ä¸€ä¸ªèšé›†çš„å†…éƒ¨è¿­ä»£åŠŸèƒ½ï¼Œå®¢æˆ·ç«¯å¾—åˆ°çš„æ˜¯ä¸€ä¸ª`Iterator`æŠ½è±¡ç±»å‹ï¼Œå¹¶ä¸çŸ¥é“è¿­ä»£å­çš„å…·ä½“å®ç°ä»¥åŠèšé›†å¯¹è±¡çš„å†…éƒ¨ç»“æ„ã€‚è¿­ä»£å­æ¨¡å¼çš„ç®€ç•¥ç±»å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n![è¿­ä»£å­æ¨¡å¼ç®€ç•¥ç±»å›¾](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00005/Iterator1.jpg)\n\nè¿™æ ·ä¸€æ¥ï¼Œèšé›†çš„å†…éƒ¨ç»“æ„çš„æ”¹å˜å°±ä¸ä¼šæ³¢åŠåˆ°å®¢æˆ·ç«¯ï¼Œä»è€Œå®ç°äº†å¯¹æŠ½è±¡æ¥å£çš„ä¾èµ–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n![è¿­ä»£å­æ¨¡å¼ç®€ç•¥ç±»å›¾](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00005/Iterator2.jpg)","categories":["è®¾è®¡æ¨¡å¼","è®¾è®¡åŸåˆ™çš„ä½“ç°"]},{"title":"Webå¼€å‘åŸºç¡€-çŸ¥è¯†ç‚¹-1","url":"/2023/01/06/Webå¼€å‘åŸºç¡€-çŸ¥è¯†ç‚¹-1/","content":"\n# ä»€ä¹ˆæ˜¯åå‘ä»£ç†\n`åå‘ä»£ç†`æ˜¯ä½äº`WebæœåŠ¡å™¨`å‰é¢çš„æœåŠ¡å™¨ï¼Œå…¶å°†`å®¢æˆ·ç«¯`ï¼ˆä¾‹å¦‚`Webæµè§ˆå™¨`ï¼‰è¯·æ±‚è½¬å‘åˆ°è¿™äº›`WebæœåŠ¡å™¨`ã€‚åå‘ä»£ç†é€šå¸¸ç”¨äºå¸®åŠ©æé«˜å®‰å…¨æ€§ã€æ€§èƒ½å’Œå¯é æ€§ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£åå‘ä»£ç†çš„å·¥ä½œåŸç†ä»¥åŠå®ƒå¯ä»¥æä¾›çš„å¥½å¤„ï¼Œæˆ‘ä»¬æ¥é¦–å…ˆå®šä¹‰ä»€ä¹ˆæ˜¯`ä»£ç†æœåŠ¡å™¨`ã€‚\n\n# ä»€ä¹ˆæ˜¯ä»£ç†æœåŠ¡å™¨ï¼Ÿ\n`è½¬å‘ä»£ç†`ï¼Œé€šå¸¸ç§°ä¸º`ä»£ç†`ã€`ä»£ç†æœåŠ¡å™¨`æˆ–`Webä»£ç†`ï¼Œæ˜¯ä½äºä¸€ç»„å®¢æˆ·ç«¯è®¡ç®—æœºä¹‹å‰çš„æœåŠ¡å™¨ã€‚å½“è¿™äº›è®¡ç®—æœºå‘`Internet`ä¸Šçš„ç«™ç‚¹å’ŒæœåŠ¡å‘å‡ºè¯·æ±‚æ—¶ï¼Œä»£ç†æœåŠ¡å™¨å°†æ‹¦æˆªè¿™äº›è¯·æ±‚ï¼Œç„¶åä»£è¡¨å®¢æˆ·ç«¯ä¸`WebæœåŠ¡å™¨`è¿›è¡Œé€šä¿¡ï¼Œèµ·åˆ°ä¸­é—´è®¾å¤‡çš„ä½œç”¨ã€‚\n\nä¾‹å¦‚ï¼Œå…¸å‹çš„è½¬å‘ä»£ç†é€šä¿¡ä¸­æ¶‰åŠ3å°è®¡ç®—æœºï¼š\n- Aï¼šè¿™æ˜¯ç”¨æˆ·çš„å®¶ç”¨è®¡ç®—æœº\n- Bï¼šè¿™æ˜¯ä¸€ä¸ªè½¬å‘ä»£ç†æœåŠ¡å™¨\n- Cï¼šè¿™æ˜¯ç½‘ç«™çš„æºç«™ï¼ˆç”¨äºå­˜å‚¨ç½‘ç«™æ•°æ®ï¼‰\n\n![è½¬å‘ä»£ç†](Webå¼€å‘åŸºç¡€-çŸ¥è¯†ç‚¹-1/forward-proxy-flow.svg)\n\nåœ¨æ ‡å‡†çš„äº’è”ç½‘é€šä¿¡ä¸­ï¼Œ`è®¡ç®—æœºA`å°†ç›´æ¥ä¸`è®¡ç®—æœºC`ä¿æŒè”ç³»ï¼Œ`å®¢æˆ·ç«¯`å°†è¯·æ±‚å‘é€åˆ°`æºæœåŠ¡å™¨`ï¼Œå¹¶ä¸”`æºæœåŠ¡å™¨`å°†å“åº”`å®¢æˆ·ç«¯`ã€‚å½“å­˜åœ¨è½¬å‘ä»£ç†æ—¶ï¼Œ`A` å°†è¯·æ±‚å‘é€åˆ° `B`ï¼Œ`B` éšåå°†è¯·æ±‚è½¬å‘ç»™ `C`ã€‚`C` å°†å‘ `B` å‘é€å“åº”ï¼Œè€Œ `B` åˆ™å°†å“åº”è½¬å‘ç»™ `A`ã€‚\n\nä¸ºä»€ä¹ˆè¦å°†è¿™ä¸ªå¤šä½™çš„ä¸­é—´è®¾å¤‡æ·»åŠ åˆ° Internet æ´»åŠ¨ä¸­ï¼Ÿä½¿ç”¨è½¬å‘ä»£ç†å¯èƒ½æœ‰å‡ ä¸ªåŸå› ï¼š\n- ä¸ºé¿å…æµè§ˆé™åˆ¶: ä¸€äº›æ”¿åºœã€å­¦æ ¡å’Œå…¶ä»–ç»„ç»‡ä½¿ç”¨é˜²ç«å¢™æ¥ä½¿ç”¨æˆ·è®¿é—®å—é™ç‰ˆæœ¬çš„äº’è”ç½‘ã€‚è½¬å‘ä»£ç†å¯ç”¨äºç»•è¿‡è¿™äº›é™åˆ¶ï¼Œå› ä¸ºå®ƒä»¬ä½¿ç”¨æˆ·å¯ä»¥è¿æ¥åˆ°ä»£ç†ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿æ¥åˆ°ä»–ä»¬æ­£åœ¨è®¿é—®çš„ç«™ç‚¹ã€‚\n- é˜»æ­¢è®¿é—®æŸäº›å†…å®¹: ç›¸å¯¹çš„ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä»£ç†ä»¥é˜»æ­¢ç‰¹å®šç”¨æˆ·ç¾¤è®¿é—®æŸäº›ç«™ç‚¹ã€‚ä¾‹å¦‚ï¼Œå­¦æ ¡ç½‘ç»œå¯èƒ½é…ç½®ä¸ºé€šè¿‡å¯ç”¨å†…å®¹ç­›é€‰è§„åˆ™çš„ä»£ç†è¿æ¥åˆ° Webï¼Œä»¥æ‹’ç»è½¬å‘æ¥è‡ª Facebook å’Œå…¶ä»–ç¤¾äº¤åª’ä½“ç½‘ç«™çš„å“åº”ã€‚\n- ä¿æŠ¤è‡ªå·±çš„åœ¨çº¿èº«ä»½â€”: åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¸¸è§„äº’è”ç½‘ç”¨æˆ·å¸Œæœ›å¢åŠ åœ¨çº¿åŒ¿åæ€§ï¼Œä½†åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œäº’è”ç½‘ç”¨æˆ·å±…ä½åœ¨æ”¿åºœå¯èƒ½å¯¹æ”¿æ²»å¼‚è®®è€…æ–½åŠ ä¸¥é‡åæœçš„åœ°æ–¹ã€‚åœ¨ç½‘ç»œè®ºå›æˆ–ç¤¾äº¤åª’ä½“ä¸Šæ‰¹è¯„æ”¿åºœå¯èƒ½ä¼šå¯¼è‡´è¿™äº›ç”¨æˆ·å—åˆ°ç½šæ¬¾æˆ–ç›‘ç¦ã€‚å¦‚æœæŒä¸åŒæ”¿è§è€…ä½¿ç”¨è½¬å‘ä»£ç†è¿æ¥åˆ°ä»–ä»¬å‘å¸ƒæ”¿æ²»æ•æ„Ÿè¯„è®ºçš„ç½‘ç«™ï¼Œåˆ™ç”¨äºå‘è¡¨è¯„è®ºçš„`IPåœ°å€`å°†æ›´éš¾è¿½æº¯åˆ°æŒä¸åŒæ”¿è§è€…ã€‚ä»…`ä»£ç†æœåŠ¡å™¨`çš„`IPåœ°å€`å°†å¯¹ä»–äººå¯è§ã€‚\n\n# åå‘ä»£ç†æœ‰ä½•ä¸åŒ?\nåå‘ä»£ç†æ˜¯ä½äºä¸€ä¸ªæˆ–å¤šä¸ª`WebæœåŠ¡å™¨`å‰é¢çš„æœåŠ¡å™¨ï¼Œæ‹¦æˆªæ¥è‡ª`å®¢æˆ·ç«¯`çš„è¯·æ±‚ã€‚è¿™ä¸è½¬å‘ä»£ç†ä¸åŒ:åœ¨è½¬å‘ä»£ç†ä¸­ï¼Œ`ä»£ç†`ä½äº`å®¢æˆ·ç«¯`çš„å‰é¢ã€‚ä½¿ç”¨`åå‘ä»£ç†`ï¼Œå½“`å®¢æˆ·ç«¯`å°†è¯·æ±‚å‘é€åˆ°ç½‘ç«™çš„`æºæœåŠ¡å™¨`æ—¶ï¼Œ`åå‘ä»£ç†æœåŠ¡å™¨`ä¼šåœ¨ç½‘ç»œè¾¹ç¼˜æ‹¦æˆªè¿™äº›è¯·æ±‚ã€‚ç„¶åï¼Œ`åå‘ä»£ç†æœåŠ¡å™¨`å°†å‘`æºæœåŠ¡å™¨`å‘é€è¯·æ±‚å¹¶ä»`æºæœåŠ¡å™¨`æ¥æ”¶å“åº”ã€‚\n\n`è½¬å‘ä»£ç†`å’Œ`åå‘ä»£ç†`ä¹‹é—´çš„åŒºåˆ«éå¸¸ç»†å¾®ï¼Œä½†éå¸¸é‡è¦ã€‚ç®€å•æ¦‚æ‹¬è€Œè¨€ï¼Œ`è½¬å‘ä»£ç†`ä½äºå®¢æˆ·ç«¯çš„å‰é¢ï¼Œç¡®ä¿æ²¡æœ‰æºç«™ç›´æ¥ä¸è¯¥ç‰¹å®šå®¢æˆ·ç«¯é€šä¿¡ï¼›è€Œ`åå‘ä»£ç†æœåŠ¡å™¨`ä½äºæºç«™å‰é¢ï¼Œç¡®ä¿æ²¡æœ‰å®¢æˆ·ç«¯ç›´æ¥ä¸è¯¥æºç«™é€šä¿¡ã€‚\n\nè¿™ä¸€æ¬¡ï¼Œæ‰€æ¶‰åŠçš„è®¡ç®—æœºåŒ…æ‹¬ï¼š\n- Dï¼šä»»æ„æ•°é‡çš„ç”¨æˆ·å®¶ç”¨è®¡ç®—æœº\n- Eï¼šè¿™æ˜¯åå‘ä»£ç†æœåŠ¡å™¨\n- Fï¼šä¸€å°æˆ–å¤šå°æºç«™\n  \n![åå‘ä»£ç†](Webå¼€å‘åŸºç¡€-çŸ¥è¯†ç‚¹-1/reverse-proxy-flow.svg)\n\né€šå¸¸ï¼Œæ¥è‡ª`D`çš„æ‰€æœ‰è¯·æ±‚éƒ½å°†ç›´æ¥å‘é€åˆ°`F`ï¼Œè€Œ`F`ä¼šç›´æ¥å°†å“åº”å‘é€åˆ°`D`ã€‚ä½¿ç”¨`åå‘ä»£ç†`ï¼Œæ¥è‡ª`D`çš„æ‰€æœ‰è¯·æ±‚éƒ½å°†ç›´æ¥å‘é€ç»™`E`ï¼Œè€Œ`E`ä¼šå°†å…¶è¯·æ±‚å‘é€åˆ°`F`å¹¶ä»`F`æ¥æ”¶å“åº”ï¼Œç„¶åå°†é€‚å½“å“åº”ä¼ é€’ç»™`D`ã€‚\n\nä¸‹é¢æ˜¯åå‘ä»£ç†çš„ä¸€äº›å¥½å¤„ï¼š\n- è´Ÿè½½å‡è¡¡: ä¸€ä¸ªæ¯å¤©å¸å¼•æ•°ç™¾ä¸‡ç”¨æˆ·çš„çƒ­é—¨ç½‘ç«™å¯èƒ½æ— æ³•ä½¿ç”¨å•ä¸ªæºæœåŠ¡å™¨å¤„ç†æ‰€æœ‰ä¼ å…¥ç«™ç‚¹æµé‡ã€‚ä½†è¯¥ç«™ç‚¹å¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒæœåŠ¡å™¨çš„æ± ä¸­ï¼Œè®©æ‰€æœ‰æœåŠ¡å™¨éƒ½å¤„ç†åŒä¸€ç«™ç‚¹çš„è¯·æ±‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåå‘ä»£ç†å¯ä»¥æä¾›ä¸€ç§è´Ÿè½½å‡è¡¡è§£å†³æ–¹æ¡ˆï¼Œåœ¨ä¸åŒæœåŠ¡å™¨ä¹‹é—´å¹³å‡åˆ†é…ä¼ å…¥æµé‡ï¼Œä»¥é˜²æ­¢å•ä¸ªæœåŠ¡å™¨è¿‡è½½ã€‚å¦‚æœæŸå°æœåŠ¡å™¨å®Œå…¨æ— æ³•è¿è½¬ï¼Œåˆ™å…¶ä»–æœåŠ¡å™¨å¯ä»¥ä»£ä¸ºå¤„ç†æµé‡ã€‚\n- é˜²èŒƒæ”»å‡»: é…å¤‡åå‘ä»£ç†åï¼Œç½‘ç«™æˆ–æœåŠ¡æ— éœ€é€éœ²å…¶æºæœåŠ¡å™¨çš„`IPåœ°å€`ã€‚è¿™ä½¿å¾—æ”»å‡»è€…æ›´éš¾åˆ©ç”¨é’ˆå¯¹æ€§æ”»å‡»ï¼Œä¾‹å¦‚`DDoS`æ”»å‡»ã€‚è¿™æ—¶å€™ï¼Œæ”»å‡»è€…åªèƒ½é’ˆå¯¹åå‘ä»£ç†ã€‚\n- å…¨å±€æœåŠ¡å™¨è´Ÿè½½å¹³è¡¡(GSLB): åœ¨è¿™ç§è´Ÿè½½å‡è¡¡å½¢å¼ä¸­ï¼Œä¸€ä¸ªç½‘ç«™å¯ä»¥åˆ†å¸ƒåœ¨å…¨çƒå„åœ°çš„å¤šä¸ªæœåŠ¡å™¨ä¸Šï¼Œåå‘ä»£ç†ä¼šå°†å®¢æˆ·ç«¯å‘é€åˆ°åœ°ç†ä½ç½®ä¸Šæœ€æ¥è¿‘å®ƒä»¬çš„æœåŠ¡å™¨ã€‚è¿™æ ·å¯ä»¥å‡å°‘è¯·æ±‚å’Œå“åº”ä¼ æ’­çš„è·ç¦»ï¼Œä»è€Œæœ€å¤§ç¨‹åº¦åœ°å‡å°‘åŠ è½½æ—¶é—´ã€‚\n- ç¼“å­˜: åå‘ä»£ç†è¿˜å¯ä»¥ç¼“å­˜å†…å®¹ï¼Œä»è€Œæé«˜é€Ÿåº¦ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå·´é»çš„ç”¨æˆ·è®¿é—®ä½¿ç”¨åå‘ä»£ç†è€Œ`WebæœåŠ¡å™¨`ä½äºæ´›æ‰çŸ¶çš„ç½‘ç«™ï¼Œåˆ™è¯¥ç”¨æˆ·å®é™…ä¸Šå¯èƒ½è¿æ¥åˆ°å·´é»æœ¬åœ°çš„`åå‘ä»£ç†æœåŠ¡å™¨`ï¼Œç„¶åè¯¥æœ¬åœ°`åå‘ä»£ç†æœåŠ¡å™¨`å¿…é¡»ä¸æ´›æ‰çŸ¶çš„`æºæœåŠ¡å™¨`è¿›è¡Œé€šä¿¡ã€‚ä¹‹åï¼Œ`ä»£ç†æœåŠ¡å™¨`å¯ä»¥ç¼“å­˜ï¼ˆæˆ–ä¸´æ—¶ä¿å­˜ï¼‰å“åº”æ•°æ®ã€‚éšåæµè§ˆè¯¥ç«™ç‚¹çš„å·´é»ç”¨æˆ·å°†ä»å·´é»`åå‘ä»£ç†æœåŠ¡å™¨`å¤„è·å–æœ¬åœ°ç¼“å­˜çš„å“åº”ï¼Œä»è€Œäº«å—åˆ°æ›´å¿«çš„æ€§èƒ½ã€‚\n- SSLåŠ å¯†: åŠ å¯†å’Œè§£å¯†æ¯ä¸ªå®¢æˆ·ç«¯çš„`SSLï¼ˆæˆ– TLSï¼‰`é€šä¿¡å¯¹äºæºæœåŠ¡å™¨å¯èƒ½éœ€è¦è€—è´¹å¤§é‡è®¡ç®—èµ„æºã€‚å¯ä»¥é…ç½®ç”±åå‘ä»£ç†è§£å¯†æ‰€æœ‰ä¼ å…¥è¯·æ±‚å¹¶åŠ å¯†æ‰€æœ‰ä¼ å‡ºå“åº”ï¼Œè…¾å‡ºæºæœåŠ¡å™¨ä¸Šçš„å®è´µèµ„æºã€‚\n  \n","tags":["è½¬å‘ä»£ç†","åå‘ä»£ç†"],"categories":["Webå¼€å‘","åŸºç¡€çŸ¥è¯†"]},{"title":"Golangå­¦ä¹ -çŸ¥è¯†ç‚¹-1","url":"/2023/01/04/Golangå­¦ä¹ -çŸ¥è¯†ç‚¹-1/","content":"\n# å‰è¨€\nGolangåè¨€ï¼šä½¿ç”¨é€šä¿¡æ¥å…±äº«å†…å­˜ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å…±äº«å†…å­˜æ¥é€šä¿¡ã€‚Golangä¸­æœ‰`sync`åŒ…æä¾›äº†ä¼ ç»Ÿæ–¹å¼çš„é”æœºåˆ¶ã€‚ä½†æ›´æ¨èä½¿ç”¨`channel`æ¥è§£å†³å¹¶å‘é—®é¢˜ã€‚\n\n# channelçš„ç”¨æ³•\n## ä»€ä¹ˆæ˜¯channel\n`channel`æ˜¯`goroutine`ä¹‹é—´ç”¨æ¥æ¥æ”¶æˆ–å‘é€æ¶ˆæ¯çš„å®‰å…¨æ¶ˆæ¯é˜Ÿåˆ—ã€‚`channel`å°±åƒæ˜¯å®ƒçš„å­—é¢æ„æ€ï¼šé€šé“ã€‚å®ƒå°±æ˜¯ä¸¤ä¸ª`goroutine`ä¹‹é—´ç”¨æ¥åŒæ­¥èµ„æºçš„ä¸€ä¸ªé€šé“ã€‚\n![channelç¤ºæ„å›¾](Golangå­¦ä¹ -çŸ¥è¯†ç‚¹-1/1.jpg)\n\n```go\nfunc main() {\n\tch := make(chan int, 1) // åˆ›å»ºä¸€ä¸ªç±»å‹ä¸ºint,ç¼“å†²åŒºå¤§å°ä¸º1çš„channel\n\tch <-2 // å°†2å‘é€åˆ°channelä¸­\n\tn, ok := <-ch // nä»channelä¸­æ¥æ”¶æ•°æ®\n\tif ok {\n\t\tfmt.Println(n) // 2\n\t}\n\tclose(ch) // å…³é—­channel\n}\n```\n\n## ä½¿ç”¨æ—¶çš„æ³¨æ„ç‚¹\n- å‘ä¸€ä¸ª`nil channel`å‘é€æ¶ˆæ¯ä¼šä¸€ç›´é˜»å¡\n\n    Code:\n    ```go\n    package main\n\n    import (\n        \"fmt\"\n        \"time\"\n    )\n\n    func main() {\n        var ch chan int\n\n        go send(ch)\n        <-ch\n        time.Sleep(time.Second * 1)\n    }\n\n    func send(ch chan int) {\n        fmt.Println(\"Sending value to channnel start\")\n        ch <- 1\n        fmt.Println(\"Sending value to channnel finish\")\n    }\n    ```\n    Output:\n    ```\n    Sending value to channnel start\n    fatal error: all goroutines are asleep - deadlock!\n    goroutine 1 [chan receive (nil chan)]:\n    goroutine 18 [chan send (nil chan)]:\n    ```\n    åˆ†æï¼šä¸Šè¿°ä»£ç åªæ˜¯å£°æ˜äº†channelï¼Œå®ƒçš„é»˜è®¤åˆå§‹å€¼ä¸ºnil, åœ¨ä¸€ä¸ªgoroutineä¸­å‘è¿™ä¸ª nil channel å‘é€æ¶ˆæ¯ï¼Œè¿™ä¸ªgoroutine å°±ä¼šä¸€ç›´é˜»å¡,è€Œåœ¨mainå‡½æ•°ä¸­(ä¸»routine)ä¸­æƒ³ä»channelä¸­è·å–è¿™ä¸ªæ¶ˆæ¯ä¹Ÿæ˜¯ä¼šè¢«é˜»å¡ä½ï¼Œæ‰€ä»¥æ•´ä¸ªè¿›è¡Œå°±ç›¸å½“äºå¤„ç†æ­»é”çŠ¶æ€ã€‚\n\n- å‘ä¸€ä¸ªå·²å…³é—­çš„`channel`å‘é€æ¶ˆæ¯ä¼šå¼•å‘è¿è¡Œæ—¶`panic`\n- `channel`å…³é—­åä¸å¯ä»¥ç»§ç»­å‘å®ƒå‘é€æ¶ˆæ¯ï¼Œä½†å¯ä»¥ç»§ç»­ä»å®ƒæ¥æ”¶æ¶ˆæ¯\n- å½“`channel`å…³é—­åå¹¶ä¸”ç¼“å†²åŒºä¸ºç©ºæ—¶ï¼Œç»§ç»­ä»å®ƒæ¥æ”¶æ¶ˆæ¯ä¼šå¾—åˆ°ä¸€ä¸ªå¯¹åº”ç±»å‹çš„é›¶å€¼\n\n# unbuffered channelsä¸buffered channels\n- `unbuffered channel`æ˜¯ç¼“å†²åŒºå¤§å°ä¸º0çš„`channel`ï¼Œè¿™ç§`channel`çš„æ¥æ”¶è€…ä¼šé˜»å¡ç›´è‡³æ¥æ”¶åˆ°æ¶ˆæ¯ï¼›å‘é€è€…ä¼šé˜»å¡ç›´è‡³æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œè¿™ç§æœºåˆ¶å¯ä»¥ç”¨äºä¸¤ä¸ª`goroutine`è¿›è¡ŒçŠ¶æ€åŒæ­¥ã€‚\n- `buffered channel`æ‹¥æœ‰ç¼“å†²åŒºï¼Œå½“ç¼“å†²åŒºå·²æ»¡æ—¶ï¼Œå‘é€è€…ä¼šé˜»å¡ï¼Œå½“ç¼“å†²åŒºä¸ºç©ºæ—¶ï¼Œæ¥æ”¶è€…ä¼šé˜»å¡ã€‚\n  \nå¼•ç”¨[The Nature Of Channels In Go](https://www.ardanlabs.com/blog/2014/02/the-nature-of-channels-in-go.html)ä¸­çš„ä¸¤å¼ å›¾æ¥è¯´æ˜`Unbuffered channels`ä¸`Buffered channels`\n\n## Unbuffered channels\n![Unbuffered channels](Golangå­¦ä¹ -çŸ¥è¯†ç‚¹-1/2.png)\n\n\n## Buffered channels\n![Buffered channels](Golangå­¦ä¹ -çŸ¥è¯†ç‚¹-1/3.png)\n\n### unbuffered channelç¤ºä¾‹\nè®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç¤ºä¾‹ç¨‹åºï¼Œå®ƒä½¿ç”¨å››ä¸ª goroutine å’Œä¸€ä¸ªé€šé“æ¥æ¨¡æ‹Ÿæ¥åŠ›èµ›ã€‚æ¯”èµ›ä¸­çš„å‚èµ›è€…å°†è¢«ç§°ä¸ºâ€œ Goroutinesâ€ï¼Œé€šé“å°†è¢«ç”¨æ¥åœ¨æ¯ä¸ªå‚èµ›è€…ä¹‹é—´äº¤æ¢æ¥åŠ›æ£’ã€‚è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œè¯´æ˜äº†å¦‚ä½•åœ¨ goroutines ä¹‹é—´ä¼ é€’èµ„æºï¼Œä»¥åŠé€šé“å¦‚ä½•æ§åˆ¶ä¸ä¹‹äº¤äº’çš„ goroutines çš„è¡Œä¸ºã€‚\n\n```go\nfunc Runner(baton chan int) {\n\tvar newRunner int\n\n\t// Wait to receive the baton\n\trunner := <-baton\n\n\t// Start running around the track\n\tfmt.Printf(\"Runner %d Running With Baton\\n\", runner)\n\n\t// New runner to the line\n\tif runner != 4 {\n\t\tnewRunner = runner + 1\n\t\tfmt.Printf(\"Runner %d To The Line\\n\", newRunner)\n\t\tgo Runner(baton)\n\t}\n\n\t// Running around the track\n\ttime.Sleep(100 * time.Millisecond)\n\n\t// Is the race over\n\tif runner == 4 {\n\t\tfmt.Printf(\"Runner %d Finished, Race Over\\n\", runner)\n\t\treturn\n\t}\n\n\t// Exchange the baton for the next runner\n\tfmt.Printf(\"Runner %d Exchange With Runner %d\\n\", runner, newRunner)\n\tbaton <- newRunner\n}\n\nfunc main() {\n\t// Create an unbufferd channel\n\tbaton := make(chan int)\n\n\t// First runner to his mark\n\tgo Runner(baton)\n\n\t// Start the race\n\tbaton <- 1\n\n\t// Give the runners time to race\n\ttime.Sleep(500 * time.Millisecond)\n}\n```\nè¿è¡Œç»“æœï¼š\n```\nRunner 1 Running With Baton\nRunner 2 To The Line\nRunner 1 Exchange With Runner 2\nRunner 2 Running With Baton\nRunner 3 To The Line\nRunner 2 Exchange With Runner 3\nRunner 3 Running With Baton\nRunner 4 To The Line\nRunner 3 Exchange With Runner 4\nRunner 4 Running With Baton\nRunner 4 Finished, Race Over\n```\n\n## channelçš„éå†\n### é˜»å¡å‹çš„éå†æ–¹å¼\n```go\nfunc main() {\n\tci := make(chan int, 5)\n\tfor i := 1; i <= 5; i++ {\n\t\tci <- i\n\t}\n\tclose(ci)\n\t\n\tfor i := range ci {\n\t\tfmt.Println(i)\n\t}\n}\n```\n>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šåœ¨éå†channelå‰ï¼Œå¦‚æœchannelæ²¡æœ‰å…³é—­ï¼Œéå†ä¼šè¢«é˜»å¡ï¼Œä¼šå‡ºç°deadlockçš„é”™è¯¯ï¼›å¦‚æœåœ¨éå†æ—¶channelå·²ç»å…³é—­ï¼Œé‚£ä¹ˆä¼šéå†å®Œæ•°æ®åé€€å‡ºéå†ï¼›ä¹Ÿå°±æ˜¯è¯´for rangeçš„éå†æ–¹å¼æ˜¯é˜»å¡å‹çš„éå†æ–¹å¼ã€‚\n\n### éé˜»å¡å‹çš„éå†æ–¹å¼\n`select`å¯ç”¨äºéé˜»å¡å¼æ¶ˆæ¯å‘é€ã€æ¥æ”¶åŠå¤šè·¯é€‰æ‹©\n```go\nfunc main() {\n\tci := make(chan int, 2)\n\tfor i := 1; i <= 2; i++ {\n\t\tci <- i\n\t}\n\tclose(ci)\n\n\tcs := make(chan string, 2)\n\tcs <- \"hi\"\n\tcs <- \"golang\"\n\tclose(cs)\n\n\tciClosed, csClosed := false, false\n\tfor {\n\t\tif ciClosed && csClosed {\n\t\t\treturn\n\t\t}\n\t\tselect {\n\t\tcase i, ok := <-ci:\n\t\t\tif ok {\n\t\t\t\tfmt.Println(i)\n\t\t\t} else {\n\t\t\t\tciClosed = true\n\t\t\t\tfmt.Println(\"ci data fetching finished\")\n\t\t\t}\n\t\tcase s, ok := <-cs:\n\t\t\tif ok {\n\t\t\t\tfmt.Println(s)\n\t\t\t} else {\n\t\t\t\tcsClosed = true\n\t\t\t\tfmt.Println(\"cs data fetching finished\")\n\t\t\t}\n\t\tdefault:\n\t\t\tfmt.Println(\"wating...\")\n\t\t}\n\t}\n}\n```\n>`select`ä¸­æœ‰`case`ä»£ç å—ï¼Œç”¨äº`channel`å‘é€æˆ–æ¥æ”¶æ¶ˆæ¯ï¼Œä»»æ„ä¸€ä¸ª`case`ä»£ç å—å‡†å¤‡å¥½æ—¶ï¼Œæ‰§è¡Œå…¶å¯¹åº”å†…å®¹ï¼›å¤šä¸ª`case`ä»£ç å—å‡†å¤‡å¥½æ—¶ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ª`case`ä»£ç å—å¹¶æ‰§è¡Œï¼›æ‰€æœ‰`case`ä»£ç å—éƒ½æ²¡æœ‰å‡†å¤‡å¥½ï¼Œåˆ™ç­‰å¾…ï¼›è¿˜å¯ä»¥æœ‰ä¸€ä¸ª`default`ä»£ç å—ï¼Œæ‰€æœ‰`case`ä»£ç å—éƒ½æ²¡æœ‰å‡†å¤‡å¥½æ—¶æ‰§è¡Œdefaultä»£ç å—ã€‚è¿™é‡Œçš„æ‰€è°“çš„æ²¡æœ‰å‡†å¤‡å¥½ï¼ŒæŒ‡çš„å°±æ˜¯channelæ²¡æœ‰å…³é—­ã€‚å½“æ‰§è¡Œäº†close()å‡½æ•°åï¼Œå°±æ˜¯æ‰€è°“çš„å‡†å¤‡å¥½äº†ã€‚","tags":["channel"],"categories":["Golang","åŸºç¡€"]},{"title":"é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00004","url":"/2023/01/02/é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00004/","content":"\nå®ç°â€œå¼€-é—­â€åŸåˆ™çš„å…³é”®æ˜¯æŠ½è±¡åŒ–ï¼Œå¹¶ä¸”ä»æŠ½è±¡åŒ–å¯¼å‡ºå…·ä½“åŒ–å®ç°ã€‚å¦‚æœè¯´â€œå¼€-é—­â€åŸåˆ™æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„ç›®æ ‡çš„è¯ï¼Œä¾èµ–å€’ç½®åŸåˆ™å°±æ˜¯è¿™ä¸ªé¢å‘å¯¹è±¡è®¾è®¡çš„ä¸»è¦æœºåˆ¶ã€‚\n\n# ä¸ºä½•è€Œâ€œå€’è½¬â€\nä¼ ç»Ÿçš„è¿‡ç¨‹æ€§ç³»ç»Ÿçš„è®¾è®¡åŠæ³•å€¾å‘äºä½¿é«˜å±‚æ¬¡ä¾èµ–äºä½å±‚æ¬¡çš„æ¨¡å—ï¼›æŠ½è±¡å±‚æ¬¡ä¾èµ–äºå…·ä½“å±‚æ¬¡ã€‚å€’è½¬åŸåˆ™æ˜¯è¦æŠŠè¿™ä¸ªé”™è¯¯çš„ä¾èµ–å…³ç³»å€’è½¬è¿‡æ¥ï¼Œè¿™å°±æ˜¯â€œä¾èµ–å€’è½¬åŸåˆ™â€çš„æ¥ç”±ã€‚\n\næŠ½è±¡å±‚ä¾èµ–äºå…·ä½“å±‚æ¬¡çš„å«ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼ŸæŠ½è±¡å±‚æ¬¡åŒ…å«çš„æ˜¯åº”ç”¨ç³»ç»Ÿçš„å•†åŠ¡é€»è¾‘å’Œå®è§‚çš„ã€å¯¹æ•´ä¸ªç³»ç»Ÿæ¥è¯´é‡è¦çš„æˆ˜ç•¥æ€§å†³å®šï¼Œæ˜¯å¿…ç„¶æ€§çš„ä½“ç°ï¼›è€Œå…·ä½“å±‚æ¬¡åˆ™å«æœ‰ä¸€äº›æ¬¡è¦çš„ä¸å®ç°æœ‰å…³çš„ç®—æ³•å’Œé€»è¾‘ï¼Œä»¥åŠæˆ˜æœ¯æ€§çš„å†³å®šï¼Œå¸¦æœ‰ç›¸å½“å¤§çš„å¶ç„¶æ€§é€‰æ‹©ã€‚å…·ä½“å±‚æ¬¡çš„ä»£ç æ˜¯ä¼šç»å¸¸æœ‰å˜åŠ¨çš„ï¼Œä¸èƒ½é¿å…å‡ºç°é”™è¯¯ã€‚æŠ½è±¡å±‚æ¬¡ä¾èµ–äºå…·ä½“å±‚æ¬¡ï¼Œä½¿è®¸å¤šå…·ä½“å±‚æ¬¡çš„ç»†èŠ‚çš„ç®—æ³•å˜åŒ–ç«‹å³å½±å“åˆ°æŠ½è±¡å±‚æ¬¡çš„å®è§‚å•†åŠ¡é€»è¾‘ï¼Œå¯¼è‡´å¾®è§‚å†³å®šå®è§‚ï¼Œæˆ˜æœ¯å†³å®šæˆ˜ç•¥ï¼Œå¶ç„¶å†³å®šå¿…ç„¶ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n![é”™è¯¯çš„å±‚æ¬¡ä¾èµ–å…³ç³»](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00004/1.jpg)\n\nä¾èµ–å€’è½¬åŸåˆ™(Dependence Inversion Principleæˆ–ç®€ç§°ä¸ºDIP)ï¼Œå°±æ˜¯è¦æŠŠé”™è¯¯çš„ä¾èµ–å…³ç³»å†å€’è½¬è¿‡æ¥ï¼Œå¦‚ä¸‹å›¾ï¼š\n![ä¾èµ–å€’è½¬çš„å…³ç³»å›¾](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00004/2.jpg)\n>ä¾èµ–å€’è½¬åŸåˆ™æ˜¯COM/CORBA/JavaBeanä»¥åŠEJBç­‰æ„å»ºè®¾è®¡æ¨¡å‹èƒŒåçš„åŸºæœ¬åŸåˆ™ã€‚\n\n# å¤ç”¨ä¸å¯ç»´æŠ¤æ€§çš„â€œå€’è½¬â€\nä»å¤ç”¨çš„è§’åº¦æ¥çœ‹ï¼Œé«˜å±‚æ¬¡çš„æ¨¡å—æ˜¯è®¾è®¡è€…åº”å½“å¤ç”¨çš„ã€‚ä½†æ˜¯åœ¨ä¼ ç»Ÿçš„è¿‡ç¨‹æ€§è®¾è®¡ä¸­ï¼Œå¤ç”¨å´ä¾§é‡äºå…·ä½“å±‚æ¬¡æ¨¡å—çš„å¤ç”¨ï¼Œæ¯”å¦‚ç®—æ³•çš„å¤ç”¨ã€æ•°æ®ç»“æ„çš„å¤ç”¨ã€å‡½æ•°åº“çš„å¤ç”¨ç­‰ï¼Œéƒ½ä¸å¯é¿å…æ˜¯å…·ä½“å±‚æ¬¡æ¨¡å—é‡Œé¢çš„å¤ç”¨ã€‚è¾ƒé«˜å±‚æ¬¡çš„ç»“æ„ä¾èµ–äºè¾ƒä½å±‚æ¬¡çš„ç»“æ„ï¼Œè¾ƒä½å±‚æ¬¡çš„ç»“æ„åˆè¿›ä¸€æ­¥ä¾èµ–äºæ›´ä½å±‚æ¬¡çš„ç»“æ„ï¼Œå¦‚æ­¤ç»§ç»­ï¼Œç›´åˆ°ä¾èµ–äºæ¯ä¸€è¡Œçš„ä»£ç ã€‚è¾ƒä½å±‚æ¬¡ä¸Šçš„ä¿®æ”¹ï¼Œä¼šé€ æˆè¾ƒé«˜å±‚æ¬¡çš„ä¿®æ”¹ï¼Œç›´åˆ°é«˜å±‚æ¬¡é€»è¾‘çš„ä¿®æ”¹ã€‚\n\nåŒæ ·ï¼Œä¼ ç»Ÿçš„åšæ³•ä¹Ÿå¼ºè°ƒå…·ä½“å±‚æ¬¡ä¸Šçš„å¯ç»´æŠ¤æ€§ï¼ŒåŒ…æ‹¬ä¸€ä¸ªå‡½æ•°ã€æ•°æ®ç»“æ„ç­‰çš„å¯ç»´æŠ¤æ€§ï¼Œè€Œä¸æ˜¯é«˜çº§å±‚æ¬¡ä¸Šçš„å¯ç»´æŠ¤æ€§ã€‚\n\nä»å¤ç”¨çš„æ„ä¹‰ä¸Šè®²ï¼Œæ—¢ç„¶æŠ½è±¡å±‚æ¬¡å«æœ‰ä¸€ä¸ªåº”ç”¨ç³»ç»Ÿæœ€é‡è¦çš„å®è§‚å•†åŠ¡é€»è¾‘ï¼Œæ˜¯åšæˆ˜ç•¥æ€§åˆ¤æ–­å’Œå†³å®šçš„åœ°æ–¹ï¼Œé‚£ä¹ˆæŠ½è±¡å±‚æ¬¡å°±åº”å½“æ˜¯è¾ƒä¸ºç¨³å®šçš„ï¼Œåº”å½“æ˜¯å¤ç”¨çš„é‡ç‚¹ã€‚ç”±äºç°æœ‰çš„å¤ç”¨ä¾§é‡äºå…·ä½“æ¨¡å—å’Œç»†èŠ‚çš„å¤ç”¨ï¼Œå› æ­¤â€œå€’è½¬â€ä¸€è¯åˆ™æ˜¯æŒ‡å¤ç”¨åº”å½“å°†å¤ç”¨çš„é‡ç‚¹æ”¾åœ¨æŠ½è±¡å±‚æ¬¡ä¸Šã€‚å¦‚æœæŠ½è±¡å±‚æ¬¡çš„æ¨¡å—ç›¸å¯¹ç‹¬ç«‹äºå…·ä½“å±‚æ¬¡çš„æ¨¡å—çš„è¯ï¼Œé‚£ä¹ˆæŠ½è±¡å±‚æ¬¡çš„æ¨¡å—çš„å¤ç”¨ä¾¿æ˜¯ç›¸å¯¹è¾ƒä¸ºå®¹æ˜“çš„äº†ã€‚\n\n# ä¾èµ–å€’è½¬åŸåˆ™\n## ä¾èµ–ï¼ˆæˆ–è€…è€¦åˆï¼‰å…³ç³»\n- é›¶è€¦åˆ(Nil Coupling)å…³ç³»ï¼šå¦‚æœä¸¤ä¸ªç±»æ²¡æœ‰è€¦åˆå…³ç³»ï¼Œå°±ç§°ä¹‹ä¸ºé›¶è€¦åˆã€‚\n- å…·ä½“è€¦åˆ(Concrete Coupling)å…³ç³»ï¼šå…·æœ¬æ€§è€¦åˆå‘ç”Ÿåœ¨ä¸¤ä¸ªå…·ä½“çš„ï¼ˆå¯å®ä¾‹åŒ–çš„ï¼‰ç±»ä¹‹é—´ï¼Œç»ç”±ä¸€ä¸ªç±»å¯¹å¦ä¸€ä¸ªå…·ä½“ç±»çš„ç›´æ¥å¼•ç”¨é€ æˆ\n- æŠ½è±¡è€¦åˆ(Abstract Coupling)å…³ç³»ï¼šæŠ½è±¡è€¦åˆå…³ç³»å‘ç”Ÿåœ¨ä¸€ä¸ªå…·ä½“ç±»å’Œä¸€ä¸ªæŠ½è±¡ç±»ï¼ˆæˆ–è€…Javaæ¥å£ï¼‰ä¹‹é—´ï¼Œä½¿ä¸¤ä¸ªå¿…é¡»å‘ç”Ÿå…³ç³»çš„ç±»ä¹‹é—´å­˜æœ‰æœ€å¤§çš„çµæ´»æ€§ã€‚\n\n# ä»€ä¹ˆæ˜¯ä¾èµ–å€’è½¬åŸåˆ™\nç®€å•åœ°è¯´ï¼Œä¾èµ–å€’è½¬åŸåˆ™(Dependency Inversion Principle)è¦æ±‚å®¢æˆ·ç«¯ä¾èµ–äºæŠ½è±¡è€¦åˆã€‚ä¾èµ–å€’è½¬åŸåˆ™çš„è¡¨è¿°æ˜¯ï¼š\n- è¡¨è¿°1ï¼šæŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºç»†èŠ‚ï¼›ç»†èŠ‚åº”å½“ä¾èµ–äºæŠ½è±¡ã€‚(Abstractions should not depend upon details.Details should depend upon abstractions)\n- è¡¨è¿°2ï¼šè¦é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œä¸è¦é’ˆå¯¹å®ç°ç¼–ç¨‹ã€‚ï¼ˆProgram to an interface, not an implementation)\n\né’ˆå¯¹æ¥å£ç¼–ç¨‹çš„æ„æ€å°±æ˜¯è¯´ï¼Œåº”å½“ä½¿ç”¨Javaæ¥å£å’ŒJavaæŠ½è±¡ç±»è¿›è¡Œå˜é‡çš„ç±»å‹å£°æ˜ã€å‚é‡çš„ç±»å‹å£°æ˜ã€æ–¹æ³•çš„è¿”è¿˜ç±»å‹å£°æ˜ï¼Œä»¥åŠæ•°æ®ç±»å‹çš„è½¬æ¢ç­‰ã€‚\n\nä¸è¦é’ˆå¯¹å®ç°ç¼–ç¨‹çš„æ„æ€å°±æ˜¯è¯´ï¼Œä¸åº”å½“ä½¿ç”¨Javaå…·ä½“ç±»è¿›è¡Œå˜é‡çš„ç±»å‹å£°æ˜ã€å‚é‡çš„ç±»å‹å£°æ˜ã€æ–¹æ³•çš„è¿”è¿˜ç±»å‹å£°æ˜ï¼Œä»¥åŠæ•°æ®ç±»å‹çš„è½¬æ¢ç­‰ã€‚\n\n<font color=red>**è¦ä¿è¯åšåˆ°è¿™ä¸€ç‚¹ï¼Œä¸€ä¸ªå…·ä½“ç±»åº”å½“åªå®ç°æ¥å£å’ŒæŠ½è±¡ç±»ä¸­å£°æ˜è¿‡çš„æ–¹æ³•ï¼Œè€Œä¸åº”å½“ç»™å‡ºå¤šä½™çš„æ–¹æ³•ã€‚**</font>\n\nå€’è½¬ä¾èµ–å…³ç³»å¼ºè°ƒä¸€ä¸ªç³»ç»Ÿå†…çš„å®ä½“ä¹‹é—´å…³ç³»çš„çµæ´»æ€§ã€‚åŸºæœ¬ä¸Šï¼Œå¦‚æœè®¾è®¡å¸ˆå¸Œæœ›éµå®ˆâ€œå¼€-é—­â€åŸåˆ™ï¼Œé‚£ä¹ˆå€’è½¬ä¾èµ–åŸåˆ™ä¾¿æ˜¯è¾¾åˆ°è¦æ±‚çš„é€”å¾„ã€‚\n\n# å˜é‡çš„é™æ€ç±»å‹å’ŒçœŸå®ç±»å‹\nå˜é‡è¢«å£°æ˜æ—¶çš„ç±»å‹å«åšå˜é‡çš„é™æ€ç±»å‹(Static Type)ï¼Œæœ‰äº›åœ°æ–¹æŠŠé™æ€ç±»å‹å«åšæ˜æ˜¾ç±»å‹(Apparent Type)ï¼Œå˜é‡æ‰€å¼•ç”¨çš„å¯¹è±¡çš„çœŸå®ç±»å‹å«åšå˜é‡çš„å®é™…ç±»å‹(Actual Type)ã€‚ä¾‹å¦‚ï¼š\n```java\nList employees = new Vector();\n```\n`Vector`æ˜¯ä¸€ä¸ªå…·ä½“ç±»ï¼ˆå®é™…ç±»å‹ï¼‰ï¼Œè€Œ`List`æ˜¯ä¸€ä¸ªæ¥å£ï¼ˆé™æ€ç±»å‹ï¼‰ã€‚\n\n# å¼•ç”¨å¯¹è±¡çš„æŠ½è±¡ç±»å‹\nåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä¸€ä¸ªJavaç¨‹åºéœ€è¦å¼•ç”¨ä¸€ä¸ªå¯¹è±¡ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªæŠ½è±¡ç±»å‹çš„è¯ï¼Œåº”å½“ä½¿ç”¨è¿™ä¸ªæŠ½è±¡ç±»å‹ä½œä¸ºå˜é‡çš„é™æ€ç±»å‹ã€‚è¿™å°±æ˜¯é’ˆå¯¹æ¥å£ç¼–ç¨‹çš„å«ä¹‰ã€‚\n\n","tags":["ä¾èµ–å€’ç½®åŸåˆ™","DIP"],"categories":["è®¾è®¡æ¨¡å¼","è®¾è®¡åŸåˆ™çš„ä½“ç°"]},{"title":"é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00003","url":"/2022/12/31/é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00003/","content":"\n# è®¾è®¡åŸåˆ™åœ¨å¸¸ç”¨è®¾è®¡æ¨¡å¼ä¸­çš„ä½“ç°\n\n## ç­–ç•¥æ¨¡å¼å¯¹â€œå¼€-é—­â€åŸåˆ™çš„æ”¯æŒ\nç­–ç•¥æ¨¡å¼è®²çš„æ˜¯ï¼Œå¦‚æœæœ‰ä¸€ç»„ç®—æ³•ï¼Œé‚£ä¹ˆå°±å°†æ¯ä¸€ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œä½¿å¾—å®ƒä»¬å¯ä»¥äº’æ¢ã€‚ç­–ç•¥æ¨¡å¼å°±æ˜¯ä»å¯¹å¯å˜æ€§çš„å°è£…åŸåˆ™å‡ºå‘ï¼Œè¾¾åˆ°â€œå¼€-é—­â€åŸåˆ™çš„èŒƒä¾‹\n\n{% mermaid %}\n\nclassDiagram\nclass DiscountStrategy {\n    <<abstract>>\n-price:single\n-copies:int\n+calculateDiscount():single\n}\n\nclass NoDiscountStrategy {\n    -price:single\n    -copies:int\n    +calculateDiscount():single\n}\n\nclass FlatRateStrategy {\n    -price:single\n    -copies:int\n    -amount:single\n    +calculateDiscount():single\n}\n\nclass PercentageStrategy {\n    -price:single\n    -copies:int\n    -percent:single\n    +calculateDiscount():single\n}\n\nNoDiscountStrategy --|> DiscountStrategy\nFlatRateStrategy --|> DiscountStrategy\nPercentageStrategy --|> DiscountStrategy\n\n{% endmermaid %}\n\n\n## ç®€å•å·¥å‚æ¨¡å¼\nâ€œå¼€-é—­â€åŸåˆ™è¦æ±‚ç³»ç»Ÿå…è®¸æ–°çš„äº§å“åŠ å…¥ç³»ç»Ÿä¸­è€Œæ— éœ€å¯¹ç°æœ‰ä»£ç è¿›è¡Œä¿®æ”¹ã€‚åœ¨ç®€å•å·¥å‚æ¨¡å¼ä¸­ï¼Œè¿™å¯¹äºäº§å“æ¶ˆè´¹è§’è‰²æ˜¯æˆç«‹çš„ï¼Œè€Œå¯¹äºå·¥å‚æ¨¡å¼æ˜¯ä¸æˆç«‹çš„ã€‚ç®€å•å·¥å‚æ¨¡å¼ç»“æ„å¦‚ä¸‹å›¾ï¼š\n![ç®€å•å·¥å‚æ¨¡å¼](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00003/SimpleFactory.jpg)\n\n## å·¥å‚æ–¹æ³•æ¨¡å¼\nåœ¨å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­ï¼Œå…·ä½“çš„å·¥å‚ç±»éƒ½æœ‰å…±åŒçš„æ¥å£ï¼Œå®ƒä»¬â€œç”Ÿäº§â€å‡ºå¾ˆå¤šå¤„äºåŒä¸€ç­‰çº§ç»“æ„ä¸­çš„äº§å“å¯¹è±¡ã€‚ä½¿å¾—è¿™ä¸ªç³»ç»Ÿå¯ä»¥åŠ å…¥æ–°çš„äº§å“ç±»å‹ï¼ˆå¢åŠ äº§å“çš„å…·ä½“å·¥å‚ï¼‰ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼çš„ç®€ç•¥ç±»å›¾å¦‚ä¸‹ï¼š\n![å·¥å‚æ–¹æ³•æ¨¡å¼](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00003/FactoryMethod.jpg)\n\n## æŠ½è±¡å·¥å‚æ¨¡å¼\næŠ½è±¡å·¥å‚æ¨¡å¼å°è£…äº†äº§å“å¯¹è±¡å®¶æ—çš„å¯å˜æ€§ï¼Œä»è€Œä¸€æ–¹é¢å¯ä»¥ä½¿ç³»ç»ŸåŠ¨æ€åœ°å†³å®šå°†å“ªä¸€ä¸ªäº§å“æ—çš„äº§å“å¯¹è±¡å®ä¾‹åŒ–ï¼Œå¦ä¸€æ–¹é¢å¯ä»¥å°†æ–°çš„äº§å“å¼•è¿›åˆ°å·²æœ‰ç³»ç»Ÿä¸­è€Œä¸å¿…ä¿®æ”¹å·²æœ‰çš„ç³»ç»Ÿã€‚æŠ½è±¡å·¥å‚æ¨¡å¼çš„ç®€ç•¥å›¾å¦‚ä¸‹ï¼š\n![æŠ½è±¡å·¥å‚æ¨¡å¼](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00003/AbstractFactory.jpg)\n\n## å»ºé€ æ¨¡å¼\nå»ºé€ æ¨¡å¼å°è£…äº†å»ºé€ ä¸€ä¸ªæœ‰å†…éƒ¨ç»“æ„çš„äº§å“å¯¹è±¡çš„è¿‡ç¨‹ï¼Œå› æ­¤è¿™æ ·çš„ç³»ç»Ÿæ˜¯å‘äº§å“å†…éƒ¨è¡¨è±¡çš„æ”¹å˜å¼€æ”¾çš„ã€‚\n![æŠ½è±¡å·¥å‚æ¨¡å¼](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00003/Build.jpg)\n\n## æ¡¥æ¢æ¨¡å¼\næ¡¥æ¢æ¨¡å¼æ˜¯â€œå¯¹å¯å˜æ€§çš„å°è£…åŸåˆ™â€çš„æå¥½ä¾‹å­ã€‚åœ¨æ¡¥æ¢æ¨¡å¼ä¸­ï¼Œå…·ä½“å®ç°åŒ–ç±»ä»£è¡¨ä¸åŒçš„å®ç°é€»è¾‘ï¼Œä½†æ˜¯æ‰€æœ‰çš„å…·ä½“å®ç°åŒ–ç±»åˆæœ‰å…±åŒçš„æ¥å£ã€‚æ–°çš„å®ç°é€»è¾‘å¯ä»¥é€šè¿‡åˆ›å»ºæ–°çš„å…·ä½“å®ç°åŒ–ç±»åŠ å…¥åˆ°ç³»ç»Ÿé‡Œé¢ã€‚æ¡¥æ¢æ¨¡å¼çš„ç®€ç•¥ç±»å›¾å¦‚ä¸‹ï¼š\n![æ¡¥æ¢æ¨¡å¼](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00003/Bridge.jpg)\n\n## é—¨é¢æ¨¡å¼\nå‡è®¾ä¸€ä¸ªç³»ç»Ÿå¼€å§‹çš„æ—¶å€™ä¸æŸä¸€ä¸ªå­ç³»ç»Ÿè€¦åˆåœ¨ä¸€èµ·ï¼Œåæ¥åˆä¸å¾—ä¸æ¢æˆå¦å¤–ä¸€ä¸ªå­ç³»ç»Ÿï¼Œé‚£ä¹ˆé—¨é¢æ¨¡å¼ä¾¿å¯ä»¥å‘æŒ¥é—¨é¢æ¨¡å¼å’Œé€‚é…å™¨æ¨¡å¼ä¸¤ç§ä½œç”¨ï¼Œå°†æ–°çš„å­ç³»ç»Ÿä»ç„¶ä¸æœ¬ç³»ç»Ÿè€¦åˆåœ¨ä¸€èµ·ã€‚è¿™æ ·ä¸€æ¥ï¼Œä½¿ç”¨é—¨é¢æ¨¡å¼ä¾¿å¯ä»¥æ”¹å˜å­ç³»ç»Ÿå†…éƒ¨åŠŸèƒ½è€Œä¸ä¼šå½±å“åˆ°å®¢æˆ·ç«¯ã€‚é—¨é¢æ¨¡å¼çš„ç®€ç•¥ç±»å›¾å¦‚ä¸‹ï¼š\n![é—¨é¢æ¨¡å¼](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00003/Facade.jpg)\n\n## è¿­ä»£å­æ¨¡å¼\nè¿­ä»£å­æ¨¡å¼å°†è®¿é—®èšé›†å…ƒç´ çš„é€»è¾‘å°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿å®ƒç‹¬ç«‹äºèšé›†å¯¹è±¡çš„å°è£…ã€‚è¿™å°±æä¾›äº†èšé›†å­˜å‚¨é€»è¾‘ä¸è¿­ä»£é€»è¾‘ç‹¬ç«‹æ¼”å˜çš„ç©ºé—´ï¼Œä½¿ç³»ç»Ÿå¯ä»¥åœ¨æ— éœ€ä¿®æ”¹æ¶ˆè´¹è¿­ä»£å­çš„å®¢æˆ·ç«¯çš„æƒ…å†µä¸‹ï¼Œå¯¹èšé›†å¯¹è±¡çš„å†…éƒ¨ç»“æ„è¿›è¡ŒåŠŸèƒ½æ‰©å±•ã€‚è¿­ä»£å­æ¨¡å¼çš„ç®€ç•¥ç±»å›¾å¦‚ä¸‹ï¼š\n![è¿­ä»£å­æ¨¡å¼](é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00003/Iterator.jpg)\n\n>å½“å­¦ä¹ è®¾è®¡æ¨¡å¼çš„æ—¶å€™ï¼Œè¦å­¦ä¼šé—®ä¸€ä¸ªé—®é¢˜ï¼šè¿™ä¸ªè®¾è®¡æ¨¡å¼å¯ä»¥å¯¹ä»€ä¹ˆæ ·çš„å˜æ¢å¼€æ”¾ï¼Œä»¥åŠå®ƒåšåˆ°è¿™ä¸€ç‚¹æ‰€ä»˜å‡ºçš„ä»£ä»·æ˜¯ä»€ä¹ˆã€‚é€šè¿‡è¿™æ ·çš„æ€è€ƒï¼Œå¯ä»¥æ›´åŠ é€å½»åœ°äº†è§£è¿™ç§æ¨¡å¼å¯¹â€œå¼€-é—­â€åŸåˆ™çš„æ”¯æŒç¨‹åº¦ï¼Œä»¥åŠè¿™ç§è®¾è®¡æ¨¡å¼æœ¬èº«ã€‚","categories":["è®¾è®¡æ¨¡å¼","è®¾è®¡åŸåˆ™çš„ä½“ç°"]},{"title":"Golangé¡¹ç›®Swaggeræ¥å£æ–‡æ¡£","url":"/2022/12/21/Golangé¡¹ç›®Swaggeræ¥å£æ–‡æ¡£/","content":"\n# å®‰è£…swagger\n[swagger githubåœ°å€](https://github.com/swaggo/swag/blob/master/README.md)\n>go1.17ç‰ˆæœ¬åï¼Œä½¿ç”¨go install å®‰è£…swag\n```shell\ngo install github.com/swaggo/swag/cmd/swag@latest\n```\n\n>éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸï¼ˆä¼šåœ¨$GOPATH/bin)ç›®å½•ä¸‹ç”Ÿæˆswagå¯æ‰§è¡Œæ–‡ä»¶\n```shell\nswag -v\n```\n\n# å¯¹ginæ¡†æ¶çš„æ”¯æŒ\n```shell\ngo get -u github.com/swaggo/gin-swagger\ngo get -u github.com/swaggo/files\n```\n\n# æ³¨è§£\n## APIæ¥å£çš„æ³¨è§£\n| æ³¨è§£ | æè¿° |\n| -- | -- |\n| @Summary | æ‘˜è¦ |\n| @Produce | APIå¯ä»¥äº§ç”Ÿçš„MIMEç±»å‹åˆ—è¡¨ã€‚æˆ‘ä»¬å¯ä»¥æŠŠMIMEç±»å‹ç®€å•åœ°ç†è§£ä¸ºå“åº”ç±»å‹ï¼Œå¦‚JSON/XML/HTMLç­‰ |\n| @Param | å‚æ•°æ ¼å¼ï¼Œä»å·¦åˆ°å³åˆ†åˆ«ä¸ºï¼šå‚æ•°åã€å…¥å‚ç±»å‹ã€æ•°æ®ç±»å‹ã€æ˜¯å¦å¿…å¡«å’Œæ³¨é‡Š |\n| @Success | å“åº”æˆåŠŸï¼Œä»å·¦åˆ°å³åˆ†åˆ«ä¸ºï¼šçŠ¶æ€ç ã€å‚æ•°ç±»å‹ã€æ•°æ®ç±»å‹å’Œæ³¨é‡Š |\n| @Failure | å“åº”å¤±è´¥ï¼Œä»å·¦åˆ°å³åˆ†åˆ«ä¸ºï¼šçŠ¶æ€ç ã€å‚æ•°ç±»å‹ã€æ•°æ®ç±»å‹å’Œæ³¨é‡Š |\n| @Router | è·¯ç”±ï¼Œä»å·¦åˆ°å³åˆ†åˆ«ä¸ºï¼šè·¯ç”±åœ°å€å’ŒHTTPæ–¹æ³• |\n\n## ä¾‹å­\n```go\n// @Summary è·å–å¤šä¸ªæ ‡ç­¾\n// @Produce json\n// @Param name query string false \"æ ‡ç­¾åç§°\" maxlength(100)\n// @Param state query int false \"çŠ¶æ€\" Enums(0, 1) default(1)\n// @Param page query int false \"é¡µç \"\n// @Param page_size query int false \"æ¯é¡µæ•°é‡\"\n// @Success 200 {object} model.TagSwagger \"æˆåŠŸ\"\n// @Failure 400 {object} errcode.Error \"è¯·æ±‚é”™è¯¯\"\n// @Failure 500 {object} errcode.Error \"å†…éƒ¨é”™è¯¯\"\n// @Router /api/v1/tags [get]\nfunc (t Tag) List(c *gin.Context) {\n\n}\n\n// @Summary æ–°å¢æ ‡ç­¾\n// @Produce json\n// @Param name body string true \"æ ‡ç­¾åç§°\" minlength(3) maxlength(100)\n// @Param state body int false \"çŠ¶æ€\" Enums(0, 1) default(1)\n// @Param created_by body string false \"åˆ›å»ºè€…\" minlength(3) maxlength(100)\n// @Success 200 {object} model.Tag \"æˆåŠŸ\"\n// @Failure 400 {object} errcode.Error \"è¯·æ±‚é”™è¯¯\"\n// @Failure 500 {object} errcode.Error \"å†…éƒ¨é”™è¯¯\"\n// @Router /api/v1/tags [post]\nfunc (t Tag) Create(c *gin.Context) {\n\n}\n\n// @Summary æ›´æ–°æ ‡ç­¾\n// @Produce json\n// @Param id path int true \"æ ‡ç­¾ID\"\n// @Param name body string false \"æ ‡ç­¾åç§°\" minlength(3) maxlength(100)\n// @Param state body int false \"çŠ¶æ€\" Enums(0, 1) default(1)\n// @Param modified_by body string true \"ä¿®æ”¹è€…\" minlength(3) maxlength(100)\n// @Success 200 {array} model.Tag \"æˆåŠŸ\"\n// @Failure 400 {object} errcode.Error \"è¯·æ±‚é”™è¯¯\"\n// @Failure 500 {object} errcode.Error \"å†…éƒ¨é”™è¯¯\"\n// @Router /api/v1/tags/{id} [put]\nfunc (t Tag) Update(c *gin.Context) {\n\n}\n\n// @Summary åˆ é™¤æ ‡ç­¾\n// @Produce json\n// @Param id path int true \"æ ‡ç­¾ID\"\n// @Success 200 {string} string \"æˆåŠŸ\"\n// @Failure 400 {object} errcode.Error \"è¯·æ±‚é”™è¯¯\"\n// @Failure 500 {object} errcode.Error \"å†…éƒ¨é”™è¯¯\"\n// @Router /api/v1/tags/{id} [delete]\nfunc (t Tag) Delete(c *gin.Context) {\n\n}\n```\n\n# main æ–¹æ³•\næ—¢ç„¶æ¥å£æ–¹æ³•æœ¬èº«æœ‰äº†æ³¨è§£ï¼Œé‚£ä¹ˆé’ˆå¯¹è¿™ä¸ªé¡¹ç›®ï¼Œèƒ½ä¸èƒ½å†™æ³¨è§£å‘¢ï¼Ÿå¦‚æœæœ‰å¾ˆå¤šä¸ªé¡¹ç›®ï¼Œå¦‚ä½•çŸ¥é“è¿™ä¸ªé¡¹ç›®å…·ä½“æ˜¯å“ªä¸ªå‘¢ï¼Ÿå®é™…ä¸Šæ˜¯å¯ä»¥è¯†åˆ«å‡ºæ¥çš„ï¼Œåªéœ€é’ˆå¯¹mainæ–¹æ³•å†™å…¥å¦‚ä¸‹æ³¨è§£å³å¯ï¼š\n```go\n// @title åšå®¢ç³»ç»Ÿ\n// @version 1.0\n// @description Go ç¼–ç¨‹ä¹‹æ—…ï¼šä¸€èµ·ç”¨Goåšé¡¹ç›®\n// @termsOfService https://github.com/go-programming-tour-book\nfunc main() {\n\n}\n\n```\n\n# ç”Ÿæˆ\n```shell\nswag init\n```","tags":["swagger","swaggo","æ¥å£æ–‡æ¡£"],"categories":["Golang","åº“","swaggo"]},{"title":"é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00002","url":"/2022/12/17/é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00002/","content":"\n# ä»€ä¹ˆæ˜¯â€œå¼€-é—­â€åŸåˆ™\nâ€œå¼€-é—­â€åŸåˆ™è®²çš„æ˜¯ï¼šä¸€ä¸ªè½¯ä»¶å®ä½“åº”å½“å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚\n>Software entities should be open for extension, but closed for modification.\n\nè¿™ä¸ªåŸåˆ™è¯´çš„æ˜¯ï¼Œåœ¨è®¾è®¡ä¸€ä¸ªæ¨¡å—çš„æ—¶å€™ï¼Œåº”å½“ä½¿è¿™ä¸ªæ¨¡å—å¯ä»¥åœ¨ä¸è¢«ä¿®æ”¹çš„å‰æä¸‹è¢«æ‰©å±•ã€‚æ¢è¨€ä¹‹ï¼Œåº”å½“å¯ä»¥åœ¨ä¸å¿…ä¿®æ”¹æºä»£ç çš„æƒ…å†µä¸‹æ”¹å˜è¿™ä¸ªæ¨¡å—çš„è¡Œä¸ºã€‚\n\næ»¡è¶³â€œå¼€-é—­â€åŸåˆ™çš„è®¾è®¡å¯ä»¥ç»™ä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿä¸¤ä¸ªæ— å¯æ¯”æ‹Ÿçš„ä¼˜è¶Šæ€§ï¼š\n- é€šè¿‡æ‰©å±•å·²æœ‰çš„è½¯ä»¶ç³»ç»Ÿï¼Œå¯ä»¥æä¾›æ–°çš„è¡Œä¸ºï¼Œä»¥æ»¡è¶³å¯¹è½¯ä»¶çš„æ–°éœ€æ±‚ï¼Œä½¿å˜åŒ–ä¸­çš„è½¯ä»¶ç³»ç»Ÿä¸­æœ‰ä¸€å®šçš„é€‚åº”æ€§å’Œçµæ´»æ€§ã€‚\n- å·²æœ‰çš„è½¯ä»¶æ¨¡å—ï¼Œç‰¹åˆ«æ˜¯æœ€é‡è¦çš„æŠ½è±¡å±‚æ¨¡å—ä¸èƒ½å†ä¿®æ”¹ï¼Œè¿™å°±ä½¿å˜åŒ–ä¸­çš„è½¯ä»¶ç³»ç»Ÿæœ‰ä¸€å®šçš„ç¨³å®šæ€§å’Œå»¶ç»­æ€§ã€‚\n\n# æŠ½è±¡åŒ–æ˜¯å…³é”®\nè§£å†³é—®é¢˜çš„å…³é”®åœ¨äºæŠ½è±¡åŒ–ã€‚é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€é‡Œé¢ï¼Œå¯ä»¥ç»™ç³»ç»Ÿå®šä¹‰å‡ºä¸€ä¸ªä¸€åŠ³æ°¸é€¸ã€ä¸å†æ›´æ”¹çš„æŠ½è±¡è®¾è®¡ï¼Œæ­¤è®¾è®¡å…è®¸æœ‰æ— ç©·æ— å°½çš„è¡Œä¸ºåœ¨å®ç°å±‚è¢«å®ç°ã€‚è¿™ä¸ªæŠ½è±¡å±‚é¢„è§äº†æ‰€æœ‰çš„å¯èƒ½æ‰©å±•ï¼Œå› æ­¤ï¼Œåœ¨ä»»ä½•æ‰©å±•æƒ…å†µä¸‹éƒ½ä¸ä¼šæ”¹å˜ã€‚è¿™å°±ä½¿å¾—ç³»ç»Ÿçš„æŠ½è±¡å±‚ä¸éœ€ä¿®æ”¹ï¼Œä»è€Œæ»¡è¶³äº†â€œå¼€-é—­â€åŸåˆ™çš„ç¬¬äºŒæ¡ï¼šå¯¹ä¿®æ”¹å…³é—­ã€‚\n\nåŒæ—¶ï¼Œç”±äºä»æŠ½è±¡å±‚å¯¼å‡ºä¸€ä¸ªæˆ–å¤šä¸ªæ–°çš„å…·ä½“ç±»å¯ä»¥æ”¹å˜ç³»ç»Ÿçš„è¡Œä¸ºï¼Œå› æ­¤ç³»ç»Ÿçš„è®¾è®¡å¯¹æ‰©å±•æ˜¯å¼€æ”¾çš„ï¼Œè¿™å°±æ»¡è¶³äº†â€œå¼€-é—­â€åŸåˆ™çš„ç¬¬ä¸€æ¡ã€‚\n\n# å¯¹å¯å˜æ€§çš„å°è£…åŸåˆ™\nâ€œå¼€-é—­â€åŸåˆ™å¦‚æœä»å¦å¤–ä¸€ä¸ªè§’åº¦è®²è¿°ï¼Œå°±æ˜¯æ‰€è°“çš„â€œå¯¹å¯å˜æ€§çš„å°è£…åŸåˆ™â€ï¼ˆPrinciple of Encapsulation of Variationï¼Œå¸¸å¸¸ç•¥å†™åšEVP).\"\n\nå¯å˜æ€§åŸåˆ™çš„æ€è·¯ï¼šè€ƒè™‘çš„ä¸æ˜¯ä»€ä¹ˆä¼šå¯¼è‡´è®¾è®¡æ”¹å˜ï¼Œè€Œæ˜¯è€ƒè™‘ä½ å…è®¸ä»€ä¹ˆå‘ç”Ÿå˜åŒ–è€Œä¸è®©è¿™ä¸€å˜åŒ–å¯¼è‡´é‡æ–°è®¾è®¡ã€‚\n\n[SHALL01]å°†è¿™ä¸€æ€æƒ³ç”¨ä¸€å¥è¯æ€»ç»“ä¸ºï¼šæ‰¾åˆ°ä¸€ä¸ªç³»ç»Ÿçš„å¯å˜å› ç´ ï¼Œå°†å®ƒå°è£…èµ·æ¥ï¼Œå¹¶å°†å®ƒå‘½åä¸ºâ€œå¯¹å¯å˜æ€§çš„å°è£…åŸåˆ™â€ï¼Œå¯¹å¯å˜æ€§çš„å°è£…åŸåˆ™æ„å‘³ç€ä¸¤ç‚¹ï¼š\n- ä¸€ç§å¯å˜æ€§ä¸åº”å½“æ•£è½åœ¨ä»£ç çš„å¾ˆå¤šè§’è½é‡Œï¼Œè€Œåº”å½“è¢«å°è£…åˆ°ä¸€ä¸ªå¯¹è±¡é‡Œé¢ã€‚åŒä¸€ç§å¯å˜æ€§çš„ä¸åŒè¡¨è±¡æ„å‘³ç€åŒä¸€ç»§æ‰¿ç­‰çº§ç»“æ„ä¸­çš„å…·ä½“å­ç±»ã€‚\n- ä¸€ç§å¯å˜æ€§ä¸åº”å½“ä¸å¦ä¸€ç§å¯å˜æ€§æ··åˆåœ¨ä¸€èµ·ã€‚å³ç±»å›¾ä¸­çš„ç»§æ‰¿ç»“æ„ä¸€èˆ¬éƒ½ä¸ä¼šè¶…è¿‡ä¸¤å±‚ã€‚ä¸ç„¶å°±æ„å‘³ç€å°†ä¸¤ç§ä¸åŒçš„å¯å˜æ€§æ··åˆåœ¨äº†ä¸€èµ·ã€‚\n\n>æ˜¾ç„¶ï¼Œâ€å¯¹å¯å˜æ€§çš„å°è£…åŸåˆ™â€œä»å·¥ç¨‹çš„è§’åº¦è®²è§£äº†å¦‚ä½•å®ç°â€å¼€-é—­â€œåŸåˆ™ã€‚\n\n# ä¸å…¶å®ƒè®¾è®¡åŸåˆ™çš„å…³ç³»\nåšåˆ°â€å¼€-é—­â€œåŸåˆ™ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ï¼Œä½†æ˜¯ä¹Ÿæ˜¯æœ‰å¾ˆå¤šè§„å¾‹å¯å¾ªçš„ã€‚è¿™äº›è§„å¾‹ä¹ŸåŒæ ·ä»¥è®¾è®¡åŸåˆ™çš„èº«ä»½å‡ºç°ï¼Œä½†æ˜¯å®ƒä»¬éƒ½æ˜¯â€å¼€-é—­â€œåŸåˆ™çš„æ‰‹æ®µå’Œå·¥å…·ï¼Œæ˜¯é™„å±äºâ€å¼€-é—­â€œåŸåˆ™çš„ã€‚\n\n## é‡Œæ°ä»£æ¢åŸåˆ™\n**é‡Œæ°ä»£æ¢åŸåˆ™ä¸­è¯´ï¼Œä»»ä½•åŸºç±»å¯ä»¥å‡ºç°çš„åœ°æ–¹ï¼Œå­ç±»ä¸€å®šå¯ä»¥å‡ºç°ã€‚**\n\né‡Œæ°ä»£æ¢åŸåˆ™æ˜¯å¯¹â€å¼€-é—­â€œåŸåˆ™çš„è¡¥å……ã€‚æ­£å¦‚å‰é¢æ‰€è°ˆåˆ°çš„ï¼Œå®ç°â€å¼€-é—­â€œåŸåˆ™çš„å…³é”®æ­¥éª¤å°±æ˜¯æŠ½è±¡åŒ–ã€‚è€ŒåŸºç±»ä¸å­ç±»çš„ç»§æ‰¿å…³ç³»å°±æ˜¯æŠ½è±¡åŒ–çš„å…·ä½“ä½“ç°ï¼Œæ‰€ä»¥é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯å¯¹å®ç°æŠ½è±¡åŒ–çš„å…·ä½“æ­¥éª¤çš„è§„èŒƒã€‚\n\nä¸€èˆ¬è€Œè¨€ï¼Œè¿åé‡Œæ°ä»£æ¢åŸåˆ™çš„ï¼Œä¹Ÿè¿èƒŒâ€å¼€-é—­â€œåŸåˆ™ï¼Œåè¿‡æ¥å¹¶ä¸ä¸€å®šæˆç«‹ã€‚\n\n## ä¾èµ–å€’è½¬åŸåˆ™\n**ä¾èµ–å€’è½¬åŸåˆ™è®²çš„æ˜¯ï¼Œè¦ä¾èµ–äºæŠ½è±¡ï¼Œä¸è¦ä¾èµ–äºå®ç°ã€‚**\n\nçœ‹ä¸Šå»å’Œâ€å¼€-é—­â€åŸåˆ™æœ‰å¾ˆå¤§çš„ç›¸ä¼¼ä¹‹å¤„ï¼Œå®é™…ä¸Šï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»æ˜¯ç›®æ ‡å’Œæ‰‹æ®µçš„å…³ç³»ã€‚â€œå¼€-é—­â€åŸåˆ™æ˜¯ç›®æ ‡ï¼Œè€Œè¾¾åˆ°è¿™ä¸€ç›®æ ‡çš„æ‰‹æ®µæ˜¯ä¾èµ–å€’è½¬åŸåˆ™ã€‚\n\næ¢è¨€ä¹‹ï¼Œè¦æƒ³å®ç°â€œå¼€-é—­â€åŸåˆ™ï¼Œå°±åº”å½“åšæŒä¾èµ–å€’è½¬åŸåˆ™ï¼Œè¿åä¾èµ–å€’è½¬åŸåˆ™ï¼Œå°±ä¸å¯èƒ½è¾¾åˆ°â€œå¼€-é—­â€åŸåˆ™çš„è¦æ±‚ã€‚\n\n## åˆæˆ/èšåˆå¤ç”¨åŸåˆ™\n**åˆæˆ/èšåˆå¤ç”¨åŸåˆ™è®²çš„æ˜¯ï¼Œè¦å°½é‡ä½¿ç”¨åˆæˆ/èšåˆï¼Œè€Œä¸æ˜¯ç»§æ‰¿å…³ç³»è¾¾åˆ°å¤ç”¨çš„ç›®çš„ã€‚**\n\nåˆæˆ/èšåˆå¤ç”¨åŸåˆ™æ˜¯ä¸é‡Œæ°ä»£æ¢åŸåˆ™ç›¸è¾…ç›¸æˆçš„ï¼Œä¸¤è€…åˆéƒ½æ˜¯å¯¹å®ç°â€œå¼€-é—­â€åŸåˆ™çš„å…·ä½“æ­¥éª¤çš„è§„èŒƒã€‚\n\néµå®ˆåˆæˆ/èšåˆå¤ç”¨åŸåˆ™æ˜¯å®ç°â€œå¼€-é—­â€åŸåˆ™çš„å¿…è¦æ¡ä»¶ï¼›è¿åäº†è¿™ä¸€åŸåˆ™å°±æ— æ³•ä½¿ç³»ç»Ÿå®ç°â€œå¼€-é—­â€åŸåˆ™è¿™ä¸€ç›®æ ‡ã€‚\n\n## è¿ªç±³ç‰¹æ³•åˆ™\n**è¿ªç±³ç‰¹æ³•åˆ™è®²çš„æ˜¯ï¼Œä¸€ä¸ªè½¯ä»¶å®ä½“åº”å½“ä¸å°½å¯èƒ½å°‘çš„å…¶å®ƒå®ä½“å‘ç”Ÿç›¸äº’ä½œç”¨ã€‚**\n\nå½“ä¸€ä¸ªç³»ç»Ÿé¢ä¸´åŠŸèƒ½æ‰©å±•æ—¶ï¼Œå…¶ä¸­ä¼šæœ‰ä¸€äº›æ¨¡å—ï¼Œå®ƒä»¬éœ€è¦ä¿®æ”¹çš„å‹åŠ›æ¯”å…¶å®ƒä¸€äº›æ¨¡å—è¦å¤§ã€‚æœ€åçš„ç»“æœå¯èƒ½æ˜¯è¿™äº›æ¨¡å—éœ€è¦ä¿®æ”¹æˆ–è€…ä¸éœ€è¦ä¿®æ”¹ã€‚ä½†æ˜¯ä¸è®ºæ˜¯å“ªä¸€ç§æƒ…å†µï¼Œå¦‚æœè¿™äº›æ¨¡å—æ˜¯ç›¸å¯¹å­¤ç«‹çš„ï¼Œé‚£ä¹ˆå®ƒä»¬å°±ä¸ä¼šå°†ä¿®æ”¹çš„å‹åŠ›ä¼ é€’ç»™å…¶å®ƒçš„æ¨¡å—ã€‚\n\nè¿™å°±æ˜¯è¯´ï¼Œä¸€ä¸ªéµå®ˆè¿ªç±³ç‰¹åŸåˆ™è®¾è®¡å‡ºæ¥çš„ç³»ç»Ÿåœ¨åŠŸèƒ½éœ€è¦æ‰©å±•æ—¶ï¼Œä¼šç›¸å¯¹æ›´å®¹æ˜“åœ°åšåˆ°å¯¹ä¿®æ”¹çš„åŠé—­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿ªç±³ç‰¹æ³•åˆ™æ˜¯ä¸€æ¡é€šå‘â€œå¼€-é—­â€åŸåˆ™çš„é“è·¯ã€‚\n\n## æ¥å£éš”ç¦»åŸåˆ™\n**æ¥å£éš”ç¦»åŸåˆ™è®²çš„æ˜¯ï¼Œåº”å½“ä¸ºå®¢æˆ·ç«¯æä¾›å°½å¯èƒ½å°çš„å•ç‹¬æ¥å£ï¼Œè€Œä¸è¦æä¾›å¤§çš„æ€»æ¥å£ã€‚**\n\næ˜¾ç„¶ï¼Œæ¥å£éš”ç¦»åŸåˆ™ä¸å¹¿ä¹‰çš„è¿ªç±³ç‰¹æ³•åˆ™éƒ½æ˜¯å¯¹ä¸€ä¸ªè½¯ä»¶å®ä½“ä¸å…¶å®ƒçš„è½¯ä»¶å®ä½“çš„é€šä¿¡çš„é™åˆ¶ã€‚å¹¿ä¹‰çš„è¿ªç±³ç‰¹æ³•åˆ™è¦æ±‚å°½å¯èƒ½é™åˆ¶é€šä¿¡çš„å®½åº¦å’Œæ·±åº¦ã€‚æ¥å£éš”ç¦»åŸåˆ™æ‰€é™åˆ¶çš„æ˜¯é€šä¿¡çš„å®½åº¦ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé€šä¿¡åº”å½“å°½å¯èƒ½åœ°çª„ã€‚\n\néµå¾ªéš”ç¦»åŸåˆ™ä¸è¿ªç±³ç‰¹æ³•åˆ™ï¼Œä¼šä½¿ä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿåœ¨åŠŸèƒ½æ‰©å±•çš„è¿‡ç¨‹å½“ä¸­ï¼Œä¸ä¼šå°†ä¿®æ”¹çš„å‹åŠ›ä¼ é€’åˆ°å…¶å®ƒå¯¹è±¡ã€‚\n\n","tags":["å¼€é—­åŸåˆ™","OCP"],"categories":["è®¾è®¡æ¨¡å¼","åŸºæœ¬æ¦‚å¿µ"]},{"title":"é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00001","url":"/2022/12/16/é‡è¯»ã€ŠJAVAä¸æ¨¡å¼ã€‹ç¬”è®°ç³»åˆ—-00001/","content":"\n# ç±»å›¾ä¸­çš„å…³ç³»\nåœ¨ç±»ä¸ç±»ä¹‹é—´ï¼Œä¼šæœ‰è¿çº¿æŒ‡æ˜å®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼Œç±»å’Œç±»ã€ç±»å’Œæ¥å£ã€æ¥å£å’Œæ¥å£ä¹‹é—´å¯ä»¥å»ºç«‹ä»¥ä¸‹å‡ ç§å…³ç³»ï¼šä¸€èˆ¬åŒ–å…³ç³»ã€å…³è”å…³ç³»ã€èšåˆå…³ç³»ã€åˆæˆå…³ç³»å’Œä¾èµ–å…³ç³»ï¼Œè¿™å‡ ç§å…³ç³»éƒ½æ˜¯é™æ€çš„ã€‚\n\n## ä¸€èˆ¬åŒ–å…³ç³»\nä¸€èˆ¬åŒ–(Generalization)å…³ç³»è¡¨ç¤ºç±»ä¸ç±»ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ï¼Œæ¥å£ä¸æ¥å£ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ï¼Œæˆ–ç±»å¯¹æ¥å£çš„å®ç°å…³ç³»ã€‚ä¸€èˆ¬åŒ–çš„å…³ç³»æ˜¯ä»å­ç±»æŒ‡å‘çˆ¶ç±»çš„ï¼Œæˆ–ä»å®ç°æ¥å£çš„ç±»æŒ‡å‘è¢«å®ç°çš„æ¥å£ï¼Œä¸ç»§æ‰¿æˆ–å®ç°çš„æ–¹å‘ç›¸åï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n\n{% mermaid %}\n\nclassDiagram\nclass Interface1 {\n\t<<interface>>\n}\nInterface1 <|.. Class1\nInterface1 <|.. Class2\n\nParentClass <|-- ChildClass1\nParentClass <|-- ChildClass2\n\n{% endmermaid %}\n\n## å…³è”å…³ç³»\nå…³è”(Association)å…³ç³»æ˜¯ç±»ä¸ç±»ä¹‹é—´çš„è”æ¥ï¼Œå®ƒä½¿ä¸€ä¸ªç±»çŸ¥é“å¦ä¸€ä¸ªç±»çš„å±æ€§å’Œæ–¹æ³•ã€‚å…³è”å¯ä»¥æ˜¯åŒå‘çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯å•å‘çš„ã€‚åŒå‘çš„å…³è”å¯ä»¥æœ‰ä¸¤ä¸ªç®­å¤´æˆ–è€…æ²¡æœ‰ç®­å¤´ã€‚å•å‘çš„å…³è”æœ‰ä¸€ä¸ªç®­å¤´ï¼Œè¡¨ç¤ºå…³è”çš„æ–¹å‘ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å•å‘çš„å…³è”æ›´ä¸ºæ™®éï¼Œé€šå¸¸ä¸é¼“åŠ±ä½¿ç”¨åŒå‘çš„å…³è”ã€‚\n\n{% mermaid %}\n\nclassDiagram\nDriver --> Car : Drives\nclass Dirver {\n    -car : Car \n}\n\n{% endmermaid %}\n\nå…³è”å…³ç³»æ˜¯ä½¿ç”¨å®ä¾‹å˜é‡å®ç°çš„ï¼Œæ¯”å¦‚ä¸Šé¢çš„`Driver`ç±»ä¸­ï¼Œå°±å‡ºç°äº†ä¸‹ä¸ªç±»å‹ä¸º`Car`çš„å®ä¾‹å˜é‡ï¼Œè¿™ä¸ªå˜é‡å®ç°äº†è¿™ä¸¤ä¸ªç±»ä¹‹é—´çš„å…³è”å…³ç³»ã€‚æ¯ä¸€ä¸ªå…³è”éƒ½æœ‰ä¸€ä¸ªåå­—ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­é‡Œï¼Œå…³è”çš„åå­—æ˜¯`Drives`ã€‚\n\nåœ¨æ¯ä¸€ä¸ªå…³è”çš„ç«¯ç‚¹ï¼Œè¿˜å¯ä»¥æœ‰ä¸€ä¸ªåŸºæ•°(Multiplicity)ï¼Œè¡¨æ˜è¿™ä¸€ç«¯çš„ç±»å¯ä»¥æœ‰å‡ ä¸ªå®ä¾‹ã€‚æ¯”å¦‚ï¼Œå”åƒ§å’Œä»–çš„å¾’å¼Ÿå½¢æˆä¸€ä¸ªå…³è”å…³ç³»ï¼Œåœ¨è¿™ä¸ªå…³ç³»é‡Œé¢ï¼Œå”åƒ§åªèƒ½æœ‰ä¸€ä¸ªï¼Œè€Œå¾’å¼Ÿå¯ä»¥æœ‰å¥½å‡ ä¸ªï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n{% mermaid %}\n\nclassDiagram\nå”åƒ§ \"1\" --> \"*\" å¾’å¼Ÿ\n\nå¾’å¼Ÿ <|-- æ‚Ÿç©º \nå¾’å¼Ÿ <|-- æ‚Ÿèƒ½\nå¾’å¼Ÿ <|-- æ‚Ÿå‡€\n\n{% endmermaid %}\n>å”åƒ§å’Œå¾’å¼Ÿä¹‹é—´çš„ç®­å¤´åº”è¯¥æ˜¯ 1 --> * ï¼ˆä¸€å¯¹å¤šçš„å…³ç³»ï¼‰\n\n>å”åƒ§ç±»ä¸­åº”åŒ…å«å¾’å¼Ÿçš„é›†åˆï¼Œå½¢æˆå…³è”å…³ç³»\n\n| åŸºæ•° | å«ä¹‰ |\n| -- | -- |\n| 0..1 | 0ä¸ªæˆ–è€…1ä¸ªå®ä¾‹ |\n| 0..* | å¯¹å®ä¾‹çš„æ•°ç›®æ²¡æœ‰é™åˆ¶ï¼ˆå¯ä»¥æ˜¯0ï¼‰|\n| 1 | åªæœ‰ä¸€ä¸ªå®ä¾‹ |\n| 1..* | è‡³å°‘æœ‰ä¸€ä¸ªå®ä¾‹ |\n\nä¸€ä¸ªå…³è”å…³ç³»å¾€å¾€å¯ä»¥è¿›ä¸€æ­¥ç¡®å®šä¸ºèšåˆå…³ç³»æˆ–è€…åˆæˆå…³ç³»ã€‚æ¯”å¦‚ï¼Œå”åƒ§ä¸ä»–çš„å¾’å¼Ÿçš„å…³ç³»å°±å¯ä»¥ è¿›ä¸€æ­¥ç¡®å®šä¸ºèšåˆå…³ç³»ã€‚\n\n# èšåˆå…³ç³»\nèšåˆï¼ˆAggregation)å…³ç³»æ˜¯å…³è”å…³ç³»çš„ä¸€ç§ï¼Œæ˜¯å¼ºçš„å…³è”å…³ç³»ã€‚èšåˆæ˜¯æ•´ä½“å’Œä¸ªä½“ä¹‹é—´çš„å…³ç³»ã€‚\n\n{% mermaid %}\n\nclassDiagram\nCar \"1\" o--> \"1\" Engine\nCar \"0\" o--> \"0..*\" Tire\nclass Car {\n    -engine : Engine \n}\n\n{% endmermaid %}\n\n# åˆæˆå…³ç³»\nåˆæˆ(Composition)å…³ç³»æ˜¯å…³è”å…³ç³»çš„ä¸€ç§ï¼Œæ˜¯æ¯”èšåˆå…³ç³»å¼ºçš„å…³ç³»ã€‚å®ƒè¦æ±‚æ™®é€šçš„èšåˆå…³ç³»ä¸­ä»£è¡¨æ•´ä½“çš„å¯¹è±¡è´Ÿè´£ä»£è¡¨éƒ¨åˆ†çš„å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œåˆæˆå…³ç³»æ˜¯ä¸èƒ½å…±äº«çš„ã€‚\n\nä»£è¡¨æ•´ä½“çš„å¯¹è±¡éœ€è¦è´Ÿè´£ä¿æŒéƒ¨åˆ†å¯¹è±¡çš„å­˜æ´»ï¼Œåœ¨ä¸€äº›æƒ…å†µä¸‹è´Ÿè´£å°†ä»£è¡¨éƒ¨åˆ†çš„å¯¹è±¡æ¹®ç­æ‰ã€‚ä»£è¡¨æ•´ä½“çš„å¯¹è±¡å¯ä»¥å°†ä»£è¡¨éƒ¨åˆ†çš„å¯¹è±¡ä¼ é€’ç»™å¦ä¸€ä¸ªå¯¹è±¡ï¼Œç”±åè€…è´Ÿè´£æ­¤å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚æ¢è¨€ä¹‹ï¼Œä»£è¡¨éƒ¨åˆ†çš„å¯¹è±¡åœ¨æ¯ä¸€ä¸ªæ—¶åˆ»åªèƒ½ä¸ä¸€ä¸ªå¯¹è±¡å‘ç”Ÿåˆæˆå…³ç³»ï¼Œç”±åè€…æ’ä»–åœ°è´Ÿè´£å…¶ç”Ÿå‘½å‘¨æœŸã€‚èšåˆå…³ç³»å’Œåˆæˆå…³ç³»çš„ç±»å›¾å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n{% mermaid %}\n\nclassDiagram\n\nclass MonkeyKing{\n    -limb : Limb[] \n    -staff : GoldRingedStaff \n}\nMonkeyKing \"1\" *--> \"4\" Limb\nMonkeyKing \"1\" o--> \"1\" GoldRingedStaff\n\n{% endmermaid %}\n\nåœ¨ä¸Šé¢çš„ç±»å›¾ä¸­ï¼Œæ˜¾ç¤ºäº†ç¾çŒ´ç‹ï¼ˆMonkeyKingï¼‰ä»¥åŠä»–çš„å››è‚¢ï¼ˆLimbï¼‰å’Œä»–çš„é‡‘ç®æ£’ï¼ˆGoldRingedStaff)ä¹‹é—´çš„å…³ç³»ã€‚å¯ä»¥çœ‹å‡ºï¼ŒMonkeyKingä¸GoldRingedStaffä¹‹é—´æ˜¯èšåˆå…³ç³»ï¼›è€ŒMonkeyKingä¸Limbä¹‹é—´çš„å…³ç³»è¦æ¯”å‰è€…æ›´å¼ºï¼Œæ˜¯åˆæˆå…³ç³»ï¼Œå› ä¸ºç¾çŒ´ç‹çš„å››è‚¢å®Œå…¨ç”±ç¾çŒ´ç‹è‡ªå·±è´Ÿè´£ï¼Œå¹¶ä¸”ä¸èƒ½å…±äº«ã€‚\n\nå¦‚æœä¸èƒ½ç¡®å®šä¸€ä¸ªå…³ç³»æ˜¯ä¸æ˜¯åˆæˆå…³ç³»ï¼Œå¯ä»¥å°†ä¹‹è®¾ç½®ä¸ºèšåˆå…³ç³»ï¼Œç”šè‡³å…³è”å…³ç³»ã€‚\n\n# ä¾èµ–å…³ç³»\nä¾èµ–ï¼ˆDependency)ä¹Ÿæ˜¯ç±»ä¸ç±»ä¹‹é—´çš„è¿æ¥ï¼Œ**ä¾èµ–æ€»æ˜¯å•å‘çš„**ã€‚ä¾èµ–å…³ç³»è¡¨ç¤ºä¸€ä¸ªç±»ä¾èµ–äºå¦ä¸€ä¸ªç±»çš„å®šä¹‰ã€‚ä¸€ä¸ªäººï¼ˆPersonï¼‰å¯ä»¥ä¹°è½¦ï¼ˆCarï¼‰å’Œæˆ¿å­ï¼ˆHouseï¼‰ï¼ŒPersonç±»ä¾èµ–äºCarç±»å’ŒHouseç±»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\n\n{% mermaid %}\n\nclassDiagram\nPerson ..> Car : Buys\nPerson ..> House : Buys\nPerson : +buy(...) void\nPerson : +buy(...) void\n\n{% endmermaid %}\n\nç”¨golangä»£ç è¡¨è¾¾ä¸€ä¸‹ä¸Šé¢çš„ç±»å›¾å°±æ˜¯ï¼š\n\n```go\ntype Car struct {\n\n}\n\ntype House struct {\n\n}\n\ntype Person struct {\n\n}\n\nfunc (p *Person) BuyCar()  {\n\n}\n\nfunc (p *Person) BuyHouse()  {\n\n}\n```\n\nä¸€èˆ¬è€Œè¨€ï¼Œä¾èµ–å…³ç³»ä½“ç°ä¸ºå±€éƒ¨å˜é‡ã€æ–¹æ³•çš„å‚æ•°ï¼Œä»¥åŠå¯¹é™æ€æ–¹æ³•çš„è°ƒç”¨ã€‚æ¢è¨€ä¹‹ï¼Œä¸€ä¸ªç±»Açš„æŸä¸€ä¸ªå±€éƒ¨å˜é‡çš„ç±»å‹æ˜¯å¦ä¸€ä¸ªç±»Bï¼Œé‚£ä¹ˆç±»Aå°±ä¾èµ–äºç±»Bã€‚å¦‚æœä¸€ä¸ªæ–¹æ³•çš„å‚æ•°æ˜¯å¦ä¸€ä¸ªç±»Bçš„å®ä¾‹ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•æ‰€åœ¨çš„ç±»Aä¾èµ–äºç±»Bã€‚\n\nå¦‚æœç±»Bå‡ºç°åœ¨ç±»Açš„å®ä¾‹å˜é‡ä¸­ï¼Œé‚£ä¹ˆç±»Aä¸ç±»Bçš„å…³ç³»å°±è¶…è¶Šäº†ä¾èµ–å…³ç³»ï¼Œè€Œå˜æˆäº†æŸä¸€ç§å…³è”å…³ç³»ã€‚\n\n\n","tags":["è®¾è®¡æ¨¡å¼","ç±»å›¾ä¸­çš„å…³ç³»","å…³è”å…³ç³»","èšåˆå…³ç³»","åˆæˆå…³ç³»","ä¾èµ–å…³ç³»"],"categories":["è®¾è®¡æ¨¡å¼","åŸºæœ¬æ¦‚å¿µ"]},{"title":"æ±‡ç¼–ä¸­å¸¸è§æŒ‡ä»¤æœºå™¨ç ","url":"/2022/12/16/æ±‡ç¼–ä¸­å¸¸è§æŒ‡ä»¤æœºå™¨ç /","content":"\n# popå’Œpush\n\n| popæœºå™¨ç  | å«ä¹‰ | pushæœºå™¨ç  | å«ä¹‰ |\n| -- | -- | -- | -- |\n| 5f | pop edi | 57 | push edi |\n| 5e | pop esi | 56 | push esi |\n| 5d | pop ebp | 55 | push ebp |\n| 5c | pop esp | 54 | push esp |\n| 5b | pop ebx | 53 | push ebx |\n| 5a | pop edx | 52 | push edx |\n| 59 | pop ecx | 51 | push ecx |\n| 58 | pop eax | 50 | push eax |\n\n\n# call \n```x86asm\ncall (short) eax\n; 1.å°†å½“å‰æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å‹æ ˆ\n; 2.JMPåˆ°eaxè¿™ä¸ªåœ°å€\n```\n\n```x86asm\ncall (long) eax\n; 1.å°†CSå‹æ ˆ\n; 2.å°†å½“å‰æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€å‹æ ˆ\n; 3.JMPåˆ°eaxè¿™ä¸ªåœ°å€\n```\n\n# retn å’Œ retf\n```x86asm\nretn\n; 1.å°†å½“å‰çš„ESPä¸­æŒ‡å‘çš„åœ°å€å‡ºæ ˆ\n; 2.JMPåˆ°è¿™ä¸ªåœ°å€\n```\n\n```x86asm\nretn k\n; 1.å°†å½“å‰çš„ESPä¸­æŒ‡å‘çš„åœ°å€å‡ºæ ˆ\n; 2.JMPåˆ°è¿™ä¸ªåœ°å€\n; 3.å¼¹å‡ºæ ˆé¡¶çš„kä¸ªå­—èŠ‚çš„æ•°æ®\n```\n\n```x86asm\nretf\n; 1.å°†å½“å‰çš„ESPä¸­æŒ‡å‘çš„åœ°å€å‡ºæ ˆç»™EIP\n; 2.å°†å½“å‰çš„ESPä¸­æŒ‡å‘çš„åœ°å€å‡ºæ ˆç»™CS\n; 3.JMPåˆ°è¿™ä¸ªåœ°å€\n```\n\n# jmp\n\n```x86asm\n; jmp çŸ­è·³\n\\xeb\\xf6: jmp short $-8 ;(å…¶ä¸­$æŒ‡ä»£å½“å‰EIP)\n\n; åœ¨Asm2MachineCode(x86)ä¸­å¦‚æœè¦å°è¯•jmp short $-8,æ˜¯ä¸å¯èƒ½å®ç°çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ï¼š\n; 1. ImageBase (hex) è®¾ç½®ä¸º0012ff60 (æ­¤å¤„ä¸ºå½“å‰çš„EIPåœ°å€)\n; 2. jmp short 0012FF58\n```\n\n```x86asm\n; jmpé•¿è·³\n\\xE9\\x2B\\xFF\\xFF\\xFF\\xFF: jmp 0x0012FF30\n\n; åœ¨Asm2MachineCode(x86)ä¸­å¦‚æœè¦å°è¯•jmp short $-8ï¼Œæ˜¯ä¸å¯èƒ½å®ç°çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ï¼š\n; 1. ImageBaseï¼ˆhexï¼‰è®¾ç½®ä¸º0012ff58 (æ­¤å¤„ä¸ºå½“å‰çš„EIPåœ°å€)\n; 2. jmp 0012FE88\n```\n\n# cmp\n```x86asm\ncmp op1, op2\n```\n\n```\nZF=1 è¿™ä¸ªç®€å•ï¼Œè¯´æ˜ä¸¤ä¸ªæ“ä½œæ•°ç›¸ç­‰\n\nå½“æ— ç¬¦å·æ—¶ï¼š\nCF=1 åˆ™è¯´æ˜äº†æœ‰è¿›ä½æˆ–å€Ÿä½ï¼Œcmpæ˜¯è¿›è¡Œçš„å‡æ“ä½œï¼Œæ•…å¯ä»¥çœ‹å‡ºä¸ºå€Ÿä½ï¼Œæ‰€ä»¥ï¼Œæ­¤æ—¶oprd1<oprd2\nCF=0 åˆ™è¯´æ˜äº†æ— å€Ÿä½ï¼Œä½†æ­¤æ—¶è¦æ³¨æ„ZFæ˜¯å¦ä¸º0ï¼Œè‹¥ä¸º0ï¼Œåˆ™è¯´æ˜ç»“æœä¸ä¸º0ï¼Œæ•…æ­¤æ—¶oprd1>oprd2\n\nå½“æœ‰ç¬¦å·æ—¶ï¼š\nè‹¥SF=0ï¼ŒOF=0 åˆ™è¯´æ˜äº†æ­¤æ—¶çš„å€¼ä¸ºæ­£æ•°ï¼Œæ²¡æœ‰æº¢å‡ºï¼Œå¯ä»¥ç›´è§‚çš„çœ‹å‡ºï¼Œoprd1>oprd2\nè‹¥SF=1ï¼ŒOF=0 åˆ™è¯´æ˜äº†æ­¤æ—¶çš„å€¼ä¸ºè´Ÿæ•°ï¼Œæ²¡æœ‰æº¢å‡ºï¼Œåˆ™ä¸ºoprd1<oprd2\nè‹¥SF=0ï¼ŒOF=1 åˆ™è¯´æ˜äº†æ­¤æ—¶çš„å€¼ä¸ºæ­£æ•°ï¼Œæœ‰æº¢å‡ºï¼Œå¯ä»¥çœ‹å‡ºoprd1<oprd2\nè‹¥SF=1ï¼ŒOF=1åˆ™è¯´æ˜äº†æ­¤æ—¶çš„å€¼ä¸ºè´Ÿæ•°ï¼Œæœ‰æº¢å‡ºï¼Œå¯ä»¥çœ‹å‡ºoprd1>oprd2\n\næœ€åä¸¤ä¸ªå¯ä»¥ä½œå‡ºè¿™ç§åˆ¤æ–­çš„åŸå› æ˜¯ï¼Œæº¢å‡ºçš„æœ¬è´¨é—®é¢˜ï¼š\nä¸¤æ•°åŒä¸ºæ­£ï¼Œç›¸åŠ ï¼Œå€¼ä¸ºè´Ÿï¼Œåˆ™è¯´æ˜æº¢å‡º\nä¸¤æ•°åŒä¸ºè´Ÿï¼Œç›¸åŠ ï¼Œå€¼ä¸ºæ­£ï¼Œåˆ™è¯´æ˜æº¢å‡º\næ•…æœ‰ï¼Œæ­£æ­£å¾—è´Ÿåˆ™æº¢å‡ºï¼Œè´Ÿè´Ÿå¾—æ­£åˆ™æº¢å‡º\n```\n\n# leave\nleaveåœ¨32ä½æ±‡ç¼–ä¸‹ç›¸å½“äº\n```x86asm\nmove esp, ebp\npop ebp\n```\n\n# les\nLES( load ES)æŒ‡ä»¤çš„åŠŸèƒ½æ˜¯ï¼šæŠŠå†…å­˜ä¸­æŒ‡å®šä½ç½®çš„åŒå­—æ“ä½œæ•°çš„ä½ä½å­—è£…å…¥æŒ‡ä»¤ä¸­æŒ‡å®šçš„å¯„å­˜å™¨ã€é«˜ä½å­—è£…å…¥ESå¯„å­˜å™¨ã€‚\n```x86asm\nLES DSETï¼ŒSRC\nLES REGï¼ŒMEM\n; DESTä¸ºdestination(ç›®çš„åœ°å€)ï¼ŒSRCä¸ºsource(æºåœ°å€)ï¼›\n; REGä¸ºregister(CPUå¯„å­˜å™¨)ï¼ŒMEMä¸ºmemory(å†…å­˜åœ°å€)ã€‚\n```\n\n```\nDEST=WORD PTR[SRC]\n\nES=WORD PTR[SRC+2]\n\nDESTèµ‹å€¼ä¸ºSRCå¤„åŒå­—çš„ä½ä½ï¼›\n\nESèµ‹å€¼ä¸ºSRCå¤„åŒå­—çš„é«˜ä½ï¼›\n```\n\n# æ¯”è¾ƒ\n```\nAï¼ˆaboveï¼‰å¤§äºã€Bï¼ˆbelowï¼‰å°äºã€Eï¼ˆequalï¼‰ç­‰äºï¼Œç”¨äºæ¯”è¾ƒæ— ç¬¦å·æ•°\n\nGï¼ˆgreatï¼‰å¤§äºã€Lï¼ˆless thanï¼‰å°äºã€Eï¼ˆequalï¼‰ç­‰äºï¼Œç”¨äºæ¯”è¾ƒå¸¦ç¬¦å·æ•°\n\nå…¶å®è¿™äº›åœ°æ–¹ä¹Ÿæ˜¯æ¼æ´ç‚¹ï¼Œæœ‰æ—¶å€™æ¯”è¾ƒæ²¡æœ‰å¯¹æ˜¯å¦æœ‰ç¬¦å·è¿›è¡Œç¡®å®šï¼Œæ‰€ä»¥å¯èƒ½ä¼šå‡ºé—®é¢˜ã€‚\n```\n\n# lods/stos\n```\nlodsbæŒ‡ä»¤ï¼Œå°†esiæŒ‡å‘çš„åœ°å€å¤„çš„æ•°æ®å–å‡ºæ¥èµ‹ç»™ALå¯„å­˜å™¨, esi=esi+1ï¼›\n\nlodswæŒ‡ä»¤åˆ™å–å¾—æ˜¯ä¸€ä¸ªå­—ã€‚\n\nlodsdæŒ‡ä»¤ï¼Œå–å¾—æ˜¯åŒå­—èŠ‚ï¼Œå³mov eaxï¼Œ[esi]ï¼Œesi=esi+4ï¼›\n\nstosbæŒ‡ä»¤ï¼Œå°†ALå¯„å­˜å™¨çš„å€¼å–å‡ºæ¥èµ‹ç»™ediæ‰€æŒ‡å‘çš„åœ°å€å¤„ã€‚mov [edi]ï¼ŒALï¼›edi=edi+1ï¼›\n\nstoswæŒ‡ä»¤å»çš„æ˜¯ä¸€ä¸ªå­—ã€‚\n\nstosdæŒ‡ä»¤ï¼Œå–å¾—æ˜¯åŒå­—èŠ‚ï¼Œmov [edi]ï¼Œeaxï¼›edi=edi+4ï¼›\n```","tags":["æ±‡ç¼–","æŒ‡ä»¤","æœºå™¨ç "],"categories":["æ±‡ç¼–","æŒ‡ä»¤"]},{"title":"cobraåŸºæœ¬å‘½ä»¤","url":"/2022/12/15/cobraåŸºæœ¬å‘½ä»¤/","content":"\n# åŸºæœ¬å‘½ä»¤ä½¿ç”¨\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"github.com/spf13/cobra\"\n\t\"strings\"\n)\n\nfunc main() {\n\t// å®šä¹‰ä¸€ä¸ªå‘½ä»¤\n\techoCmd := cobra.Command {\n\t\t//å‘½ä»¤åç§°\n\t\tUse: \"echo\",\n\t\t// å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ï¼ŒåŠŸèƒ½å°±æ˜¯ç›´æ¥æ‰“å°å‡ºå‘½ä»¤è¡Œä¸­çš„è¾“å…¥å‚æ•°\n\t\tRun: func(cmd *cobra.Command, args []string) {\n\t\t\tfmt.Println(strings.Join(args, \" \"))\n\t\t},\n\t}\n\t// æ‰§è¡Œå‘½ä»¤\n\techoCmd.Execute()\n}\n\n```\n\n# cobraä¸­çš„Cmdç»“æ„ä½“\n```go\ntype Command struct {\n\t// å•è¡Œçš„æè¿°ä¿¡æ¯ï¼Œæè¿°è¿™ä¸ªå‘½ä»¤çš„ä½œç”¨ï¼Œè¿™æ®µè¯çš„ç¬¬ä¸€ä¸ªå•è¯ä¼šè¢«ä½œä¸ºå‘½ä»¤çš„åç§°ï¼Œ è¿™ä¸ªåªèƒ½äºå­å‘½åˆæœ‰æ„ä¹‰ï¼Œ\n\t// å¯¹äºæ ¹å‘½ä»¤æ²¡æœ‰æ„ä¹‰\n\tUse string\n\n\t// Alias å¯ä»¥ç”¨æ¥ç»™å­å‘½ä»¤å®šä¹‰åˆ«åï¼Œé™¤äº†ä½¿ç”¨ Use ä¸­çš„ç¬¬ä¸€ä¸ªå•è¯ä½œä¸ºå­å‘½ä»¤å¤–ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨è¿™ä¸ª Alias\n\t// é‡Œé¢å®šä¹‰çš„ä»»ä½•ä¸€ä¸ªåç§°ä½œä¸ºå­å‘½ä»¤åç§°\n\tAliases []string\n\n\t// å½“è¾“å…¥çš„å‘½ä»¤å’ŒçœŸæ­£çš„å‘½ä»¤åæˆ–åˆ«åä¸åŒ¹é…æ—¶ï¼Œä¼šåœ¨SuggestForæ•°ç»„ä¸­å»åŒ¹é…ï¼Œå§‹æœåŒ¹é…åˆ°äº†ï¼Œç„¶åæç¤ºæ˜¯å¦\n\t// éœ€è¦è¾“å…¥xxxå‘½ä»¤, ä¹Ÿå°±æ˜¯è¯´SuggestForæ•°ç»„ä¸­é¢„å…ˆè®¾ç½®ä¸€äº›å’Œå‘½ä»¤åæˆ–åˆ«åç›¸ä¼¼åº¦è¾ƒé«˜çš„å­—ç¬¦ä¸²ï¼Œ\n\t// åœ¨ç”¨æˆ·è¯¯è¾“å…¥æ—¶å¯ä»¥ç”¨æ¥æé†’ä»–\n\tSuggestFor []string\n\n\t// åœ¨å­å‘½ä»¤çš„helpä¿¡æ¯ä¸­æ‰“å°å‡ºæ¥ä¸€ä¸²ç®€çŸ­çš„å‘½ä»¤æè¿°\n\tShort string\n\n\t// åœ¨å­å‘½ä»¤çš„helpä¿¡æ¯ä¸­æ‰“å°å‡ºæ¥ä¸€ä¸²è¾ƒè¯¦ç»†çš„å‘½ä»¤æè¿°ï¼Œå¯ä»¥å¤šè¡Œ\n\tLong string\n\n\t// Example ç”¨æ¥å®šä¹‰å­å‘½ä»¤ä½¿ç”¨çš„å…·ä½“ç¤ºä¾‹ï¼Œå¯ä»¥åœ¨é‡Œé¢å®šä¹‰å¤šè¡Œä¸åŒçš„å‘½ä»¤ä½¿ç”¨æ ·ä¾‹ï¼Œä¾›ç”¨æˆ·å‚è€ƒï¼Œè¿™ä¸€ç‚¹åœ¨\n\t// Kubectl å‘½ä»¤ä¸­ä½“ç°çš„éå¸¸æ˜æ˜¾ï¼Œå› ä¸º Kubectl å‘½ä»¤å¾ˆå¤æ‚ï¼Œå‚æ•°ä¹Ÿå¾ˆå¤šï¼Œæ ·ä¾‹ä¼šæå¤§æ–¹ä¾¿ç”¨æˆ·\n\tExample string\n\n\t// ValidArgs æ˜¯ä¸€ç»„å¯ç”¨åœ¨ Bash è¡¥å…¨ä¸­çš„åˆæ³•çš„Non-Flagå‚æ•°\n\tValidArgs []string\n\n\t// Args è¡¨ç¤ºæœŸæœ›çš„å‚æ•°\n\tArgs PositionalArgs\n\n\t// ArgAliases æ˜¯ ValidArgs çš„ä¸€ç»„åˆ«å\n\t// è¿™äº›å‚æ•°ä¸ä¼šåœ¨ Bash è¡¥å…¨ä¸­æç¤ºç»™ç”¨æˆ·ï¼Œä½†æ˜¯å¦‚æœæ‰‹åŠ¨è¾“å…¥çš„è¯ï¼Œä¹Ÿæ˜¯å…è®¸çš„\n\tArgAliases []string\n\n\t// BashCompletionFunction æ˜¯ Bash è‡ªåŠ¨è¡¥å…¨ç”Ÿæˆå™¨ä½¿ç”¨çš„è‡ªå®šä¹‰å‡½æ•°\n\tBashCompletionFunction string\n\n\t// Deprecated ä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œåœ¨å‘½ä»¤æ‰§è¡Œæ—¶éƒ½ä¼šæç¤ºå‘½ä»¤å·²åºŸå¼ƒï¼Œå¹¶ä¸”è¾“å‡ºè¿™æ®µæ–‡å­—\n\tDeprecated string\n\n\t// Hidden å‚æ•°è®¾ç½®ä¸º true çš„æ—¶å€™ï¼Œå°†æ— æ³•åœ¨å‘½ä»¤å¸®åŠ©åˆ—è¡¨ä¸­çœ‹åˆ°è¿™ä¸ªå‘½ä»¤ï¼Œä½†æ˜¯å®é™…è¿™ä¸ªå‘½ä»¤ä»ç„¶æ˜¯å¯ç”¨çš„ï¼Œä¸€èˆ¬ç”¨äº\n\t// å¯¹å‘½ä»¤åšå‘ä¸‹å…¼å®¹çš„å¤„ç†ï¼Œåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­å¦‚æœè¿™ä¸ªå‘½ä»¤ä¼šåºŸå¼ƒï¼Œé‚£ä¹ˆå…ˆè®©å®ƒéšè—èµ·æ¥ä¼šæ¯”ç›´æ¥åˆ é™¤è¾ƒå¥½\n\tHidden bool\n\n\t// Annotations å®šä¹‰ä¸€äº›é”®å€¼å¯¹ï¼Œåº”ç”¨å¯ä»¥ç”¨è¿™äº›æ³¨è§£æ¥åˆ†ç»„å‘½ä»¤ï¼Œä¸»è¦ç”¨äºæ ‡æ³¨ä¸Šé¢çš„åˆ†ç»„\n\tAnnotations map[string]string\n\n\t// Version å®šä¹‰è¿™ä¸ªå‘½ä»¤çš„ç‰ˆæœ¬ã€‚å½“ Version å€¼ä¸ä¸ºç©ºï¼Œä¸”å‘½ä»¤æ²¡æœ‰å®šä¹‰ version é€‰é¡¹çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨ç»™è¿™ä¸ªå‘½ä»¤å¢åŠ ä¸€ä¸ª\n\t// boolean ç±»å‹ï¼Œåç§°ä¸º version çš„é€‰é¡¹ã€‚å¦‚æœæŒ‡å®šè¿™ä¸ªé€‰é¡¹ï¼Œå°±ä¼šè¾“å‡ºè¿™é‡Œ Version çš„å€¼ã€‚\n\tVersion string\n\n\t// ä¸‹é¢çš„è¿™ç»„ Run å‡½æ•°æ‰§è¡Œé¡ºåºä¸ºï¼š\n\t// * PersistentPreRun()\n\t// * PreRun()\n\t// * Run()\n\t// * PostRun()\n\t// * PersistentPostRun()\n\t// æ‰€æœ‰çš„å‡½æ•°ä¼ å…¥çš„å‚æ•°éƒ½ç›¸åŒï¼Œéƒ½æ˜¯å‘½ä»¤åç§°ä¹‹åçš„å‚æ•°\n\n\t// PersistentPreRun è¿™ä¸ªå‘½ä»¤çš„å­å‘½ä»¤éƒ½å°†ç»§æ‰¿å¹¶æ‰§è¡Œè¿™ä¸ªå‡½æ•°\n\tPersistentPreRun func(cmd *Command, args []string)\n\t// PersistentPreRunE å’Œ PersistentPreRun ä¸€æ ·ï¼Œä½†æ˜¯é‡åˆ°é”™è¯¯æ—¶å¯ä»¥è¿”å›ä¸€ä¸ªé”™è¯¯\n\t// ä¸€æ—¦è¿™ä¸ªå‡½æ•°è¿”å›çš„ error ä¸ä¸º nilï¼Œé‚£ä¹ˆæ‰§è¡Œå°±ä¸­æ–­äº†ã€‚æ‰€ä»¥ä½ å¯ä»¥åœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢\n\t// åšè¯¸å¦‚æƒé™éªŒè¯ç­‰ç­‰å…¨å±€æ€§çš„å·¥ä½œ\n\tPersistentPreRunE func(cmd *Command, args []string) error\n\n\t// PreRun è¿™ä¸ªå‘½ä»¤çš„å­å‘½ä»¤ä¸ä¼šç»§æ‰¿å’Œè¿è¡Œè¿™ä¸ªå‡½æ•°\n\tPreRun func(cmd *Command, args []string)\n\t// PreRunE å’Œ PreRun ä¸€æ ·ï¼Œä½†æ˜¯é‡åˆ°é”™è¯¯æ—¶å¯ä»¥è¿”å›ä¸€ä¸ªé”™è¯¯\n\t// ä¸€æ—¦è¿™ä¸ªå‡½æ•°è¿”å›çš„ error ä¸ä¸º nilï¼Œé‚£ä¹ˆæ‰§è¡Œå°±ä¸­æ–­äº†ã€‚æ‰€ä»¥ä½ å¯ä»¥åœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢\n\t// åšä¸€äº›å’Œè¯¥å‘½ä»¤ç›¸å…³çš„è¾“å…¥å‚æ•°æ£€æµ‹ä¹‹ç±»çš„å·¥ä½œ\n\tPreRunE func(cmd *Command, args []string) error\n\n\t// Run å‘½ä»¤æ ¸å¿ƒå·¥ä½œæ‰€åœ¨çš„å‡½æ•°ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹åªå®ç°è¿™ä¸ªå‘½ä»¤å³å¯\n\tRun func(cmd *Command, args []string)\n\t// RunE å’Œ Run ä¸€æ ·ï¼Œä½†æ˜¯é‡åˆ°é”™è¯¯æ—¶å¯ä»¥è¿”å›ä¸€ä¸ªé”™è¯¯\n\t// ä¸€æ—¦è¿™ä¸ªå‡½æ•°è¿”å›çš„ error ä¸ä¸º nilï¼Œé‚£ä¹ˆæ‰§è¡Œå°±ä¸­æ–­äº†ã€‚\n\tRunE func(cmd *Command, args []string) error\n\n\t// PostRun åœ¨ Run å‡½æ•°æ‰§è¡Œä¹‹åæ‰§è¡Œ\n\tPostRun func(cmd *Command, args []string)\n\t// PostRunE åœ¨ PostRun ä¹‹åæ‰§è¡Œï¼Œä½†æ˜¯å¯ä»¥è¿”å›ä¸€ä¸ªé”™è¯¯\n\t// ä¸€æ—¦è¿™ä¸ªå‡½æ•°è¿”å›çš„ error ä¸ä¸º nilï¼Œé‚£ä¹ˆæ‰§è¡Œå°±ä¸­æ–­äº†ã€‚\n\tPostRunE func(cmd *Command, args []string) error\n\n\t// PersistentPostRun åœ¨ PostRun ä¹‹åæ‰§è¡Œï¼Œè¿™ä¸ªå‘½ä»¤çš„å­å‘½ä»¤éƒ½å°†ç»§æ‰¿å¹¶æ‰§è¡Œè¿™ä¸ªå‡½æ•°\n\tPersistentPostRun func(cmd *Command, args []string)\n\t// PersistentPostRunE å’Œ PersistentPostRun ä¸€æ ·ï¼Œä½†æ˜¯å¯ä»¥è¿”å›ä¸€ä¸ªé”™è¯¯\n\t// ä¸€æ—¦è¿™ä¸ªå‡½æ•°è¿”å›çš„ error ä¸ä¸º nilï¼Œé‚£ä¹ˆæ‰§è¡Œå°±ä¸­æ–­äº†ã€‚\n\tPersistentPostRunE func(cmd *Command, args []string) error\n\n\t// SilenceErrors è®¾ç½®ä¸º true æ—¶å¯ä»¥åœ¨å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é”™è¯¯æ—¶ï¼Œä¸æ˜¾ç¤ºé”™è¯¯\n\tSilenceErrors bool\n\n\t// SilenceUsage è®¾ç½®ä¸º true æ—¶å¯ä»¥åœ¨å‘½ä»¤æ‰§è¡Œé‡åˆ°è¾“å…¥é”™è¯¯æ—¶ï¼Œä¸æ˜¾ç¤ºä½¿ç”¨æ–¹æ³•ï¼ˆæ­£ç¡®çš„ä½¿ç”¨æ–¹å¼ï¼‰\n\tSilenceUsage bool\n\n\t// DisableFlagParsing è®¾ç½®ä¸º true æ—¶å°†ç¦ç”¨é€‰é¡¹è§£æåŠŸèƒ½ï¼Œè¿™æ ·å‘½ä»¤ä¹‹åæ‰€æœ‰çš„å†…å®¹\n\t// éƒ½å°†ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‘½ä»¤\n\tDisableFlagParsing bool\n\n\t// DisableAutoGenTag åœ¨ç”Ÿæˆå‘½ä»¤æ–‡æ¡£çš„æ—¶å€™æ˜¯å¦æ˜¾ç¤º gen tag(\"Auto generated by spf13/cobra...\")\n\tDisableAutoGenTag bool\n\n\t// DisableFlagsInUseLine è®¾ç½®ä¸º true çš„æ—¶å€™ï¼Œå°†ä¸ä¼šåœ¨å‘½ä»¤å¸®åŠ©ä¿¡æ¯æˆ–è€…æ–‡æ¡£ä¸­æ˜¾ç¤ºå‘½ä»¤æ”¯æŒçš„é€‰é¡¹\n\tDisableFlagsInUseLine bool\n\n\t// DisableSuggestions ç¦ç”¨å‘½ä»¤æç¤º\n\tDisableSuggestions bool\n\n\t// SuggestionsMinimumDistance å®šä¹‰æ˜¾ç¤ºå‘½ä»¤æç¤ºçš„æœ€å°çš„ Levenshtein è·ç¦»\n\tSuggestionsMinimumDistance int\n\n\t// TraverseChildren åœ¨æ‰§è¡Œè¯¥å‘½ä»¤å­å‘½ä»¤å‰ï¼Œè§£ææ‰€æœ‰çˆ¶å‘½ä»¤çš„é€‰é¡¹\n\tTraverseChildren bool\n\n\t// FParseErrWhitelist å®šä¹‰å¯ä»¥è¢«å¿½ç•¥çš„è§£æé”™è¯¯\n\tFParseErrWhitelist FParseErrWhitelist\n\n\t// commands is the list of commands supported by this program.\n\tcommands []*Command\n\t// parent is a parent command for this command.\n\tparent *Command\n\t// Max lengths of commands' string lengths for use in padding.\n\tcommandsMaxUseLen         int\n\tcommandsMaxCommandPathLen int\n\tcommandsMaxNameLen        int\n\t// commandsAreSorted defines, if command slice are sorted or not.\n\tcommandsAreSorted bool\n\t// commandCalledAs is the name or alias value used to call this command.\n\tcommandCalledAs struct {\n\t\tname   string\n\t\tcalled bool\n\t}\n\n\t// args is actual args parsed from flags.\n\targs []string\n\t// flagErrorBuf contains all error messages from pflag.\n\tflagErrorBuf *bytes.Buffer\n\t// flags is full set of flags.\n\tflags *flag.FlagSet\n\t// pflags contains persistent flags.\n\tpflags *flag.FlagSet\n\t// lflags contains local flags.\n\tlflags *flag.FlagSet\n\t// iflags contains inherited flags.\n\tiflags *flag.FlagSet\n\t// parentsPflags is all persistent flags of cmd's parents.\n\tparentsPflags *flag.FlagSet\n\t// globNormFunc is the global normalization function\n\t// that we can use on every pflag set and children commands\n\tglobNormFunc func(f *flag.FlagSet, name string) flag.NormalizedName\n\n\t// output is an output writer defined by user.\n\toutput io.Writer\n\t// usageFunc is usage func defined by user.\n\tusageFunc func(*Command) error\n\t// usageTemplate is usage template defined by user.\n\tusageTemplate string\n\t// flagErrorFunc is func defined by user and it's called when the parsing of\n\t// flags returns an error.\n\tflagErrorFunc func(*Command, error) error\n\t// helpTemplate is help template defined by user.\n\thelpTemplate string\n\t// helpFunc is help func defined by user.\n\thelpFunc func(*Command, []string)\n\t// helpCommand is command with usage 'help'. If it's not defined by user,\n\t// cobra uses default help command.\n\thelpCommand *Command\n\t// versionTemplate is the version template defined by user.\n\tversionTemplate string\n}\n```\n\n# åŠ å¼ºç‰ˆä¾‹å­\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"github.com/spf13/cobra\"\n\t\"strings\"\n)\n\nfunc main() {\n\trootCmd := cobra.Command{\n\t\t// å®šä¹‰é»˜è®¤è¾“å‡ºå¸®åŠ©ä¿¡æ¯\n\t\tRun: func(cmd *cobra.Command, args []string) {\n\t\t\tcmd.Help()\n\t\t},\n\t}\n\t// å®šä¹‰å­å‘½ä»¤\n\techoCmd := cobra.Command{\n\t\t// å­å‘½ä»¤æè¿°ï¼Œç¬¬ä¸€ä¸ªå•è¯ä½œä¸ºå­å‘½ä»¤çš„åç§°\n\t\tUse: \"echo inputs\",\n\t\t// å­å‘½ä»¤åˆ«åï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½•ä¸€ä¸ªåˆ«åæ›¿ä»£ä¸Šé¢çš„echoæ¥è¿è¡Œå­å‘½ä»¤\n\t\tAliases: []string{\n\t\t\t\"copy\",\n\t\t\t\"repeat\",\n\t\t},\n\t\t// å‘½ä»¤æç¤ºï¼Œé»˜è®¤æƒ…å†µå¦‚æœè¾“å…¥å­å‘½ä»¤ä¸å­˜åœ¨ä¼šæç¤º unknown cmd.\n\t\t// ä½†æ˜¯å¦‚æœå®šä¹‰äº†SuggestFor çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè¾“å…¥çš„å‘½ä»¤ä¸å­˜åœ¨ï¼Œä¼šå»SuggestFor\n\t\t// é‡Œé¢æŸ¥æ‰¾æ˜¯å¦æœ‰åˆ‡å°”è¥¿çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæœ‰ï¼Œåˆ™æç¤ºæ˜¯å¦æœŸæœ›è¾“å…¥çš„æ˜¯ echo å‘½ä»¤\n\t\tSuggestFor: []string{\n\t\t\t\"ech\", \"cp\", \"rp\",\n\t\t},\n\t\tDisableSuggestions: true,\n\t\tSuggestionsMinimumDistance: 2,\n\t\tDisableFlagsInUseLine: true,\n\t\t// ç®€å•æ‰¼è¦æ¦‚æ‹¬ä¸‹å‘½ä»¤ç”¨é€”\n\t\tShort: \"echo is a command to echo command line inputs\",\n\t\t// æƒ³è¯´ä»€ä¹ˆå°±åœ¨è¿™é‡Œè¯´å§ï¼Œè¶Šè¯¦ç»†è¶Šå¥½ï¼Œå¯ä»¥ç”¨``æ¥è·¨è¡Œè¾“å…¥\n\t\tLong: `echo is a command to echo command line inputs.\nIt is a very simple command used to display how to implement command line tools\nusing cobra, which is a very famous library to build command line interface tools.\n`,\n\t\t// å½“ä½ æ–°ç‰ˆæœ¬åºŸå¼ƒè¿™ä¸ªå‘½ä»¤çš„æ—¶å€™ï¼Œå¯ä»¥å…ˆéšè—ï¼Œè®©ç”¨æˆ·ä¼˜å…ˆä½¿ç”¨æ›¿ä»£å“æˆ–è€…çœ‹ä¸åˆ°ï¼Œ\n\t\t// ä½†æ˜¯å¤„äºå‘ä¸‹å…¼å®¹ç›®çš„ï¼Œè¿™ä¸ªå‘½ä»¤ä»ç„¶æ˜¯å¯ä»¥ç”¨çš„ï¼Œåªæ˜¯åœ¨å¸®åŠ©åˆ—è¡¨é‡Œé¢çœ‹ä¸åˆ°\n\t\t//Hidden: true,\n\t\t// å½“ä½ éœ€è¦åºŸå¼ƒè¿™ä¸ªå‘½ä»¤çš„æ—¶å€™è®¾ç½®ã€‚åºŸå¼ƒçš„æ„æ€æ„å‘³ç€æœªæ¥ç‰ˆæœ¬å¯èƒ½åˆ é™¤è¿™ä¸ªå‘½ä»¤ã€‚\n\t\t// æ ‡æ³¨ä¸ºåºŸå¼ƒçš„å‘½ä»¤åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œéƒ½ä¼šæ‰“å°å‘½ä»¤å·²åºŸå¼ƒçš„æç¤ºä¿¡æ¯ä»¥åŠè¿™ä¸ªè®¾ç½®çš„æç¤ºä¿¡æ¯ã€‚\n\t\t//Deprecated: \"will be deleted in version 2.0\",\n\t\t// æ³¨è§£ï¼Œç”¨äºä»£ç å±‚é¢çš„å‘½ä»¤åˆ†ç»„ï¼Œä¸ä¼šæ˜¾ç¤ºåœ¨å‘½ä»¤è¡Œè¾“å‡ºä¸­\n\t\tAnnotations: map[string]string{\n\t\t\t\"group\": \"user\",\n\t\t\t\"require-auth\": \"none\",\n\t\t},\n\t\tSilenceErrors: true,\n\t\t//SilenceUsage: true,\n\t\t// Version å®šä¹‰ç‰ˆæœ¬\n\t\tVersion: \"1.0.0\",\n\t\t// æ˜¯å¦ç¦ç”¨é€‰é¡¹è§£æ\n\t\t//DisableFlagParsing: true,\n\t\t//PersistentPreRun: func(cmd *cobra.Command, args []string) {\n\t\t//\tfmt.Println(\"haha! let me check echo\")\n\t\t//},\n\t\tPersistentPostRunE: func(cmd *cobra.Command, args []string) error {\n\t\t\t//return errors.New(\"invalid parameter\")\n\t\t\treturn nil\n\t\t},\n\t\t// å­å‘½ä»¤æ‰§è¡Œè¿‡ç¨‹\n\t\t//Run: func(cmd *cobra.Command, args []string) {\n\t\t//\tfmt.Println(strings.Join(args, \" \"))\n\t\t//},\n\t\tRunE: func(cmd *cobra.Command, args []string) error {\n\t\t\tfmt.Println(strings.Join(args, \" \"))\n\t\t\treturn nil\n\t\t},\n\t\tPostRun: func(cmd *cobra.Command, args []string) {\n\t\t\tfmt.Println(\"i am post run\")\n\t\t},\n\t}\n\n\t// æŠŠå­å‘½ä»¤æ·»åŠ åˆ°æ ¹å‘½ä»¤ä¸‹é¢\n\trootCmd.AddCommand(&echoCmd)\n\t// æ‰§è¡Œæ ¹å‘½ä»¤\n\trootCmd.Execute()\n}\n```","tags":["cobra"],"categories":["Golang","åº“","cobra"]},{"title":"Druid-ç¨‹åºéª¨æ¶","url":"/2022/12/11/Druid-ç¨‹åºéª¨æ¶/","content":"\n# Cargo.toml\n```toml\n[package]\nname = \"druid-gui-app\"\nversion = \"0.1.0\"\nedition = \"2021\"\n\n# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html\n\n[dependencies]\ndruid = { git = \"https://github.com/linebender/druid.git\" }\ntracing = { version = \"0.1.22\" }\n\n[[bin]]\nname = \"druid-gui-app\"\npath = \"./src/main.rs\"\n\n[[bin]]\nname = \"example\"\npath = \"./previews/example.rs\"\n```\n>æœ‰ä¸¤ä¸ª[[bin]]ï¼Œexampleå¯ä»¥ç”¨æ¥ç¼–å†™ä¸€äº›ç¤ºä¾‹ç”¨æ¥é¢„è§ˆæ•ˆæœï¼Œå¦å¤–ä¸€ä¸ªæ˜¯çœŸæ­£çš„éœ€è¦ç¼–å†™çš„ç¨‹åºã€‚åˆ†åˆ«ç”¨ä¸‹é¢çš„å‘½ä»¤è¿è¡Œ\n```shell\ncargo run --bin example # è¿è¡Œç¤ºä¾‹ç¨‹åº\ncargo run --bin druid-gui-app # è¿è¡Œä¸»ç¨‹åº\n```\n\n# main.rs\n```rust\n#![windows_subsystem = \"windows\"]\n\nuse druid::widget::prelude::*;\nuse druid::widget::{Align, BackgroundBrush, Button, Controller, ControllerHost, Flex, Label, Padding, TextBox};\nuse druid::Target::Global;\nuse druid::{commands as sys_cmds, AppDelegate, AppLauncher, Application, Color, Command, Data, DelegateCtx, Handled, LocalizedString, Menu, MenuItem, Target, WindowDesc, WindowHandle, WindowId, WidgetExt, lens};\nuse tracing::{\n    info, warn, error,\n};\n\n///å¯ä»¥å®šä¹‰å¤šä¸ªè¿™æ ·çš„ç»“æ„ä½“ï¼Œç”¨æ¥è‡ªå®šä¹‰æ•°æ®å’Œç»„ä»¶è¿›è¡Œä¸€ä¸ªâ€œç»‘å®šâ€\n///æŠŠè¿™ä¸ªç»“æ„ä½“å’Œç»„ä»¶çš„dataå˜é‡è¿›è¡Œä¸€ä¸ªå…³è”\n#[derive(Data, Clone)]\nstruct AppData {\n    data: String,\n}\n\n///ç¨‹åºå…¥å£å‡½æ•°\npub fn main() {\n    // window ç»‘å®šèœå•æ \n    // let window = WindowDesc::new(ui_builder()).menu(make_menu);\n    let window = WindowDesc::new(ui_builder()).window_size((900.,600.)).title(\"çª—å£æ ‡é¢˜\").menu(make_menu);\n    AppLauncher::with_window(window)\n        .log_to_console()\n        .delegate(Delegate { windows: vec![] })\n        .launch(AppData {\n            data: String::new(),\n        })\n        .unwrap();\n}\n\n///\n///æ„å»ºä¸»ç•Œé¢\n///\nfn ui_builder() -> impl Widget<AppData> {\n    let data = lens!(AppData, data);\n    let text = TextBox::new().lens(data).expand().controller(ContextMenuController {});\n    text\n}\n\n/// å®šä¹‰è¿™ä¸ªç»“æ„ä½“ï¼Œå®ç° Controller Traitï¼Œå¯ä»¥åœ¨å®ç°å¯¹ç›¸å…³éƒ¨ä»¶çš„äº‹ä»¶å¤„ç†\nstruct ContextMenuController;\n\n///ä¿å­˜ç¨‹åºä¸­æ‰€æœ‰çš„çª—å£çš„IDåˆ°Vec\nstruct Delegate {\n    windows: Vec<WindowId>, \n}\n\n///\n///Controller æ˜¯ä¸€ç§ç®¡ç†å­ç»„ä»¶ã€é‡å†™æˆ–è‡ªå®šä¹‰å…¶äº‹ä»¶å¤„ç†æˆ–æ›´æ–°è¡Œä¸ºçš„ç±»å‹\n///è¿™é‡ŒHookä¸»ç•Œé¢çš„çš„é‚£ä¸ªTexBoxç»„ä»¶çš„äº‹ä»¶ï¼Œç„¶åè¿›è¡Œç›¸åº”çš„å¤„ç†\n///\nimpl<W: Widget<AppData>> Controller<AppData, W> for ContextMenuController {\n    fn event(\n        &mut self,\n        child: &mut W,\n        ctx: &mut EventCtx,\n        event: &Event,\n        data: &mut AppData,\n        env: &Env,\n    ) {\n        match event {//äº‹ä»¶åŒ¹é…\n            Event::MouseDown(ref mouse) if mouse.button.is_right() => {//è¿™ä¸ªè¯­æ³•...æ¯”è¾ƒä¸æ»‘, ä½†å’Œå…¶å®ƒè¯­è¨€ç¡®å®ä¸å¤ªä¸€æ ·\n                ctx.show_context_menu(make_context_menu(), mouse.pos);\n            }\n            _ => child.event(ctx, event, data, env),\n        }\n    }\n}\n\n///è¿™é‡Œæ˜¯Hooké¡¶å±‚äº‹ä»¶ï¼Œå¯ä»¥Hooké¡¶å±‚äº‹ä»¶è¿›è¡Œè‡ªå®šä¹‰å¤„ç†ï¼Œå¯ä»¥å–å‡ºcmdçš„å€¼ï¼Œåˆ¤æ–­æ˜¯ä»€ä¹ˆäº‹ä»¶\nimpl AppDelegate<AppData> for Delegate {\n    fn command(\n        &mut self,\n        ctx: &mut DelegateCtx,\n        _target: Target,\n        cmd: &Command,\n        data: &mut AppData,\n        _env: &Env,\n    ) -> Handled {\n        info!(\"u can handle system command here...\");\n        Handled::No\n    }\n\n    fn window_added(\n        &mut self,\n        id: WindowId,\n        _handle: WindowHandle,\n        _data: &mut AppData,\n        _env: &Env,\n        _ctx: &mut DelegateCtx,\n    ) {\n        info!(\"Window added, id: {:?}\", id);\n        self.windows.push(id);\n    }\n\n    fn window_removed(\n        &mut self,\n        id: WindowId,\n        _data: &mut AppData,\n        _env: &Env,\n        _ctx: &mut DelegateCtx,\n    ) {\n        info!(\"Window removed, id: {:?}\", id);\n        if let Some(pos) = self.windows.iter().position(|x| *x == id) {\n            self.windows.remove(pos);\n        }\n        if self.windows.len() == 0 {\n            Application::global().quit(); // è¿™é‡Œå¦‚æœæ‰€æœ‰çª—å£éƒ½å·²å…³é—­ï¼Œé‚£å°±é€€å‡ºAPP\n        }\n    }\n}\n\n///ä¸»èœå•çš„æ„å»º\n#[allow(unused_assignments)]\nfn make_menu(_: Option<WindowId>, data: &AppData, _: &Env) -> Menu<AppData> {\n    let mut base = Menu::empty();\n    #[cfg(target_os = \"macos\")]\n    {\n        // base = druid::platform_menus::mac::menu_bar();\n    }\n    #[cfg(any(\n    target_os = \"windows\",\n    target_os = \"freebsd\",\n    target_os = \"linux\",\n    target_os = \"openbsd\"\n    ))]\n    {\n        base = base.entry(druid::platform_menus::win::file::default());\n    }\n    base = base.entry(MenuItem::new(\"æ–°å»º\").on_activate(|_ctx, data: &mut AppData, _env| {\n        info!(\"appdata:{}\", data.data);\n    }));\n    base\n}\n\n///ä¸»ç•Œé¢ä¸­çš„TextBoxç»„ä»¶çš„å³é”®èœå•çš„æ„å»º\nfn make_context_menu() -> Menu<AppData> {\n    Menu::empty()\n        .entry(\n            MenuItem::new(\"å³é”®èœå•1\")\n                .on_activate(|_ctx, data: &mut AppData, _env| {\n                    info!(\"å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ å³é”®èœå•1çš„å“åº”äº‹ä»¶\");\n                }),\n        )\n}    \n```\n","tags":["Rust","GUI"],"categories":["Rust","GUI"]},{"title":"C++ GUI--imguiåº“ä½¿ç”¨æ ·æ¿CMakefile","url":"/2022/12/08/Cpp-GUI-imguiåº“ä½¿ç”¨æ ·æ¿CMakefile/","content":"\n# imgui\n\nå…ˆä¸Šé“¾æ¥ï¼š[githubåœ°å€](https://github.com/ocornut/imgui)\n\n`imgui`æ˜¯ä¸€ä¸ªè½»é‡çº§ï¼Œä½†æ˜¯å°è€Œå…¨çš„ä¸€ä¸ª`cpp`ç•Œé¢åº“ã€‚ä½œè€…åº”è¯¥æ˜¯æ¸¸æˆå¼€å‘è¡Œä¸šçš„ï¼Œè¿™ä¸ªåº“ç”¨æ¥å®ç°å¼€å‘æ¸¸æˆè¿˜æ˜¯æ¯”è¾ƒé€‚åˆçš„ã€‚è™½ç„¶å®ƒæ˜¯è·¨å¹³å°çš„ï¼Œä½†æ˜¯ä¾‹å­ä»£ç å…¨æ˜¯ç”¨`visual studio`çš„å·¥ç¨‹ã€‚åœ¨macæˆ–linuxä¸‹è¿˜ä¸èƒ½åšåˆ°å®Œå…¨çš„å¼€ç®±å³ç”¨ã€‚æ‰€ä»¥åœ¨ç½‘ä¸Šæœç´¢äº†ä¸€ç•ªï¼Œæ‰¾åˆ°äº†ä¸€ä¸ª[CMakeFile.txt](https://github.com/tashaxing/imgui_cmake_starter)å¯ä»¥è·¨å¹³å°çš„ï¼Œæˆ‘åœ¨`Mac`ä¸‹å°è¯•ç¼–è¯‘äº†ä¸€ä¸‹ï¼Œå®Œå…¨å¯ä»¥ï¼Œéå¸¸æ„Ÿè°¢ï¼\n\nä½†æ˜¯å®ƒçš„å·¥ç¨‹ä¸­ä½¿ç”¨çš„imguiä¸æ˜¯æœ€æ–°çš„ï¼Œæˆ‘å°±æ‹‰å–äº†ä¸€ä¸‹imguiä»£ç ï¼Œæ›¿æ¢æ‰å®ƒè¿™ä¸ªå·¥ç¨‹ä¸­çš„imguiï¼Œç„¶åç›®å½•ç»“æ„ä¹Ÿç¨ä½œäº†ä¸€ä¸‹è°ƒæ•´ã€‚CMakeFileä¹Ÿç¨ç›¸åº”åœ°ä½œäº†ä¸€ä¸‹è°ƒæ•´ã€‚\n\n# CMakeFile.txt\n```makefile\ncmake_minimum_required(VERSION 3.0)\n\nproject(imgui_cmake_starter)\n\n# add header path\ninclude_directories(\n\t${CMAKE_CURRENT_SOURCE_DIR}/3rd/imgui\n\t${CMAKE_CURRENT_SOURCE_DIR}/3rd/imgui/backends\n)\n\nif (APPLE)\n    # for <GLFW/glfw3.h>\n    include_directories(\n        /usr/local/include\n        /opt/local/include\n        /opt/homebrew/include\n    )\nendif()\n\n# set common source\nfile(GLOB SRC\n    ./3rd/imgui/*.h\n    ./3rd/imgui/*.cpp\n)\n\n# set specific source and other option for platform\nif (WIN32)\n    file (GLOB PLATFORM_SRC\n        ./3rd/imgui/backends/imgui_impl_win32.*\n        ./3rd/imgui/backends/imgui_impl_dx12.*\n        ./src/win/main.cpp\n    )\nelseif (UNIX)\n    # support both mac and linux\n    add_definitions(-DIMGUI_IMPL_OPENGL_LOADER_GL3W)\n\n    include_directories(\n        ${CMAKE_CURRENT_SOURCE_DIR}/3rd/imgui/examples/libs/gl3w # for GL/gl3w.h\n    )\n\n    file (GLOB PLATFORM_SRC\n        ./3rd/imgui/examples/libs/gl3w/GL/gl3w.*\n        ./3rd/imgui/backends/imgui_impl_glfw.*\n        ./3rd/imgui/backends/imgui_impl_opengl3.*\n        ./src/unix/main.cpp\n    )\nendif()\n\n# add link path\nif (APPLE)\n    link_directories(\n        /usr/local/lib\n        /opt/homebrew/lib\n#       è¿™ä¸‹é¢æ ¹æ®éœ€è¦æ·»åŠ libè·¯å¾„\n#       /opt/local/lib\n    )\nendif()\n\n# specify the C++ standard\nset(CMAKE_CXX_STANDARD 11)\nset(CMAKE_CXX_STANDARD_REQUIRED True)\n\n# generate binary\nadd_executable(${PROJECT_NAME} ${SRC} ${PLATFORM_SRC})\n\n# link lib, should install glfw first or prebuild lib and embed in project\nif (WIN32)\n    target_link_libraries(${PROJECT_NAME}\n        d3d12.lib\n        d3dcompiler.lib\n        dxgi.lib\n    )\nelseif (APPLE)\n    # mac: brew install glfw3\n    find_library(OPENGL_LIBRARY OpenGL REQUIRED)\n    find_library(COCOA_LIBRARY Cocoa REQUIRED)\n    find_library(IOKIT_LIBRARY IOKit REQUIRED)\n    find_library(COREVID_LIBRARY CoreVideo REQUIRED)\n    message(${COCOA_LIBRARY})\n    message(${IOKIT_LIBRARY})\n    message(${COREVID_LIBRARY})\n\n    target_link_libraries(${PROJECT_NAME}\n        ${OPENGL_LIBRARY}\n        ${COCOA_LIBRARY}\n        ${IOKIT_LIBRARY}\n        ${COREVID_LIBRARY}\n        glfw # use this lib name\n    )\nelseif (UNIX AND NOT APPLE)\n    # linux: sudo apt install libglfw3-dev\n    target_link_libraries(${PROJECT_NAME}\n        GL\n        glfw # use this lib name\n        dl\n    )\nendif()\n\n```\n\n>ä»¥ä¸Šçš„CMakeFile.txtæ–‡ä»¶å†…å®¹æˆ‘ç¨ä½œè°ƒæ•´ï¼šimguiæˆ‘git pulläº†æœ€æ–°çš„ä»£ç ä¸‹æ¥ï¼Œæ”¾åœ¨äº†å·¥ç¨‹ç›®å½•ä¸‹çš„3rdç›®å½•ä¸‹é¢ï¼›æˆ‘ä½¿ç”¨macç¼–è¯‘è¿™ä¸ªå·¥ç¨‹æœ€åˆ°ä¸¤ä¸ªå°é—®é¢˜ï¼Œç¨ä½œè®°å½•\n\n## é—®é¢˜1\n- é—®é¢˜æè¿°ï¼šæˆ‘æ‹‰å–çš„imguiç‰ˆæœ¬ä½¿ç”¨çš„è¯­æ³•éœ€è¦C++11æ ‡å‡†çš„æ”¯æ’‘ï¼Œå¦‚æœç‰ˆæœ¬ç¼–è¯‘å™¨çš„C++æ ‡å‡†è¾ƒä½åˆ™ä¼šå‡ºç°ç¼–è¯‘é—®é¢˜\n- è§£å†³åŠæ³•ï¼šåœ¨CMakeFile.txtä¸­æŒ‡å®šC++æ ‡å‡†\n    ```\n    # specify the C++ standard\n    set(CMAKE_CXX_STANDARD 11)\n    set(CMAKE_CXX_STANDARD_REQUIRED True)\n    ```\n\n## é—®é¢˜2\n- é—®é¢˜æè¿°ï¼šæˆ‘æ‹‰å–çš„imguiä»£ç ç›®å½•`imgui/examples/libs/gl3w` æ˜¯ä¸å­˜åœ¨çš„ï¼Œç¼–è¯‘æ—¶`main.cpp`ä¸­ä»¥ä¸‹è¯­å¥ä¼šæŠ¥é”™\n\n    ```cpp\n\n    #include <GL/gl3w.h>    \n\n    ```\n- é—®é¢˜è§£å†³ï¼šç¼ºä»€ä¹ˆè¡¥ä»€ä¹ˆï¼Œå°±ç¼ºä¸€ä¸ªç›®å½•åŠå‡ ä¸ªæ–‡ä»¶ï¼Œç»™å®ƒé…é½å°±å¥½\n\n# è·¨å¹³å°ç©è€èµ·æ¥\nä»¥ä¸Šéƒ¨åˆ†å·²ç»å®Œæˆäº†ï¼Œ[ä»£ç ](https://github.com/Lost-Temple/imgui-starter)\nè¦ç”¨imguiè¿›è¡Œè·¨å¹³å°å¼€å‘æ¡Œé¢åº”ç”¨å•¥çš„ï¼Œç›´æ¥æ‹‰å–ä»£ç åå½“ä½œä¸ªè„šæ‰‹æ¶å°±å¯ä»¥å¼€å¹²äº†ã€‚\n","tags":["cmake","c++","cpp","mac","è·¨å¹³å°"],"categories":["C++","GUI"]},{"title":"Fabric SDKç›¸å…³","url":"/2022/12/05/Fabric-SDKç›¸å…³/","content":"\n# Fabric SDK ä»‹ç»\n`Fabric`çš„`Peer`èŠ‚ç‚¹å’Œ`Orderer`èŠ‚ç‚¹éƒ½æä¾›äº†åŸºäº`gRPC`åè®®çš„æ¥å£ï¼Œç”¨äºå’Œ`Peer`èŠ‚ç‚¹ä¸`Orderer`èŠ‚ç‚¹è¿›è¡Œå‘½ä»¤/æ•°æ®äº¤äº’ã€‚ä¸ºäº†ç®€åŒ–å¼€å‘ï¼Œä¸ºå¼€å‘äººå‘˜å¼€å‘åº”ç”¨ç¨‹åºæä¾›æ“ä½œ`Fabric`åŒºå—é“¾ç½‘ç»œçš„APIï¼ŒFabricå®˜æ–¹æä¾›äº†å¤šç§è¯­è¨€ç‰ˆæœ¬çš„SDKã€‚\nFabricæä¾›äº†å¤šç§è¯­è¨€ç‰ˆæœ¬çš„SDKï¼š\n- [fabric-sdk-java](https://github.com/hyperledger/fabric-sdk-java)\n- [fabric-sdk-go](https://github.com/hyperledger/fabric-sdk-go)\n- [fabric-sdk-node](https://github.com/hyperledger/fabric-sdk-node)\n- [fabric-sdk-py](https://github.com/hyperledger/fabric-sdk-py)\n\n`Fabric`åŒºå—é“¾åº”ç”¨å¯ä»¥é€šè¿‡SDKè®¿é—®`Fabric`åŒºå—é“¾ç½‘ç»œä¸­çš„å¤šç§èµ„æºï¼ŒåŒ…æ‹¬è´¦æœ¬ã€äº¤æ˜“ã€é“¾ç ã€äº‹ä»¶ã€æƒé™ç®¡ç†ç­‰ã€‚åº”ç”¨ç¨‹åºä»£è¡¨ç”¨æˆ·ä¸`Fabric`åŒºå—é“¾ç½‘ç»œè¿›è¡Œäº¤äº’ï¼Œ`Fabric SDK API`æä¾›äº†å¦‚ä¸‹åŠŸèƒ½ï¼š\n- åˆ›å»ºé€šé“\n- å°†`Peer`èŠ‚ç‚¹åŠ å…¥é€šé“\n- åœ¨`Peer`èŠ‚ç‚¹å®‰è£…é“¾ç \n- åœ¨é€šé“å®ä¾‹åŒ–é“¾ç \n- é€šè¿‡é“¾ç è°ƒç”¨äº¤æ˜“\n- æŸ¥è¯¢äº¤æ˜“æˆ–åŒºå—çš„è´¦æœ¬\n\n# Fabric SDK å®‰è£…\n```shell\ngo get -u github.com/hyperledger/fabric-sdk-go\n```\n\n# Fabric Go SDK æºç ç»“æ„\n```\ntotal 624\n-rw-r--r--   1 mao  staff   170K Aug 15 14:45 CHANGELOG.md\n-rw-r--r--   1 mao  staff   108B Aug 15 14:45 CODEOWNERS\n-rw-r--r--   1 mao  staff   577B Aug 15 14:45 CODE_OF_CONDUCT.md\n-rw-r--r--   1 mao  staff   661B Aug 15 14:45 CONTRIBUTING.md\n-rw-r--r--   1 mao  staff    11K Aug 15 14:45 LICENSE\n-rw-r--r--   1 mao  staff   910B Nov  2 08:36 MAINTAINERS.md\n-rw-r--r--   1 mao  staff    33K Aug 15 14:45 Makefile\n-rw-r--r--   1 mao  staff   7.3K Aug 15 14:45 README.md\n-rw-r--r--   1 mao  staff   1.0K Aug 15 14:45 SECURITY.md\ndrwxr-xr-x   4 mao  staff   128B Aug 15 14:45 ci\n-rw-r--r--   1 mao  staff   143B Aug 15 14:45 ci.properties\n-rw-r--r--   1 mao  staff   2.3K Aug 15 14:45 doc.go\n-rw-r--r--   1 mao  staff   1.2K Aug 15 14:45 go.mod\n-rw-r--r--   1 mao  staff    45K Aug 15 14:45 go.sum\n-rwxr-xr-x   1 mao  staff   1.6K Aug 15 14:45 golangci.yml\ndrwxr-xr-x   3 mao  staff    96B Aug 15 14:45 internal\ndrwxr-xr-x  11 mao  staff   352B Aug 15 14:45 pkg\ndrwxr-xr-x   5 mao  staff   160B Aug 15 14:45 scripts\ndrwxr-xr-x   7 mao  staff   224B Aug 15 14:45 test\ndrwxr-xr-x   3 mao  staff    96B Aug 15 14:45 third_party\n```\n\n- `pkg/fabsdk`: Fabric SDKçš„ä¸»è¦åŒ…ã€å…è®¸åŸºäºé…ç½®åˆ›å»ºä¸Šä¸‹æ–‡ã€‚ä¸Šä¸‹æ–‡ç”±å®¢æˆ·ç«¯è½¯ä»¶åŒ…ä½¿ç”¨ã€‚\n- `pkg/client/channel`: æä¾›é€šé“äº¤æ˜“ç›¸å…³åŠŸèƒ½\n- `pkg/client/event`: æä¾›é€šé“äº‹ä»¶ç›¸å…³åŠŸèƒ½\n- `pkg/client/ledger`: å¯ç”¨å¯¹é€šé“åº•å±‚è´¦æœ¬çš„æŸ¥è¯¢ç›¸å…³åŠŸèƒ½\n- `pkg/client/resmgmt`: æä¾›èµ„æºç®¡ç†åŠŸèƒ½ï¼Œä¾‹å¦‚å®‰è£…é“¾ç \n- `pkg/client/msp`: å¯ç”¨èº«ä»½ç®¡ç†ç›¸å…³åŠŸèƒ½\n\n# Fabric SDKåŠŸèƒ½æ¨¡å—\n## API\nå¯¹äºåº”ç”¨å¼€å‘è€…æ¥è¯´ï¼Œæ’ä»¶åŒ–çš„APIå¯ä»¥æ”¯æŒSDKæä¾›çš„å…³é”®æ¥å£çš„å¯é€‰å®ç°ã€‚å¯¹äºæ¯ä¸ªæ¥å£ï¼Œéƒ½æœ‰å†…ç½®çš„é»˜è®¤å®ç°ï¼Œä¹Ÿå¯ä»¥çµæ´»è‡ªå®šä¹‰ã€‚\n\n## fabric-client\n`fabric-client`æ¨¡å—æä¾›APIä¸åŸºäº`Hypreledger Fabric`åŒºå—é“¾ç½‘ç»œçš„æ ¸å¿ƒç»„ä»¶ï¼ˆå³`peer`ï¼Œ`order`å’Œ`äº‹ä»¶æµ`ï¼‰è¿›è¡Œäº¤äº’ï¼Œä¸»è¦åŠŸèƒ½å¦‚ä¸‹ï¼š\n- åˆ›å»º`channel`\n- è¯·æ±‚`Peer`èŠ‚ç‚¹åŠ å…¥é€šé“\n- åœ¨`Peer`èŠ‚ç‚¹ä¸­å®‰è£…é“¾ç \n- åœ¨é€šé“ä¸­å®ä¾‹åŒ–é“¾ç \n- é€šè¿‡è°ƒç”¨é“¾ç æ¥è°ƒç”¨äº‹åŠ¡\n- å¤šç§æŸ¥è¯¢\n- ç›‘å¬äº‹ä»¶\n\n## fabric-ca-client\n`fabric-ca-client`æ¨¡å—æä¾›ä¸å¯é€‰ç»„ä»¶`fabric-ca`è¿›è¡Œäº¤äº’çš„APIï¼Œ`fabric-ca`æä¾›æˆå‘˜ç®¡ç†æœåŠ¡ã€‚`fabric-ca-client`æ¨¡å—ä¸»è¦åŠŸèƒ½å¦‚ä¸‹ï¼š\n- æ³¨å†Œæ–°ç”¨æˆ·\n- æ³¨å†Œç”¨æˆ·ä»¥è·å¾—ç”±`Fabric CA`ç­¾åçš„æ³¨å†Œè¯ä¹¦\n- é€šè¿‡æ³¨å†ŒIDæ’¤é”€ç°æœ‰ç”¨æˆ·æˆ–æ’¤æ¶ˆè¯ä¹¦\n- å¯å®šåˆ¶çš„æŒä¹…åŒ–å­˜å‚¨","tags":["é€šé“","é“¾ç ","Peer","Orderer","gRPC"],"categories":["åŒºå—é“¾","Fabric"]},{"title":"x64å¯„å­˜å™¨","url":"/2022/12/04/x64å¯„å­˜å™¨/","content":"\n| 64ä½å¯„å­˜å™¨ | ä½32ä½ | ä½16ä½ | ä½8ä½ |\n| -- | -- | -- | -- |\n|raxã€€|ã€€ã€€ã€€eaxã€€|ã€€ã€€ã€€axã€€ã€€|ã€€ã€€  al|\n|rcxã€€|ã€€ã€€ã€€ecxã€€|ã€€ã€€ã€€cxã€€ã€€|ã€€ã€€  cl|\n|rdxã€€|ã€€ã€€ã€€edxã€€|ã€€ã€€ã€€dxã€€ã€€|ã€€ã€€  dl|\n|rbxã€€ã€€|ã€€ã€€ebxã€€ã€€|ã€€ã€€bxã€€ã€€ã€€|ã€€  bl|\n|rspã€€ã€€|ã€€ã€€espã€€ã€€ã€€|ã€€spã€€ã€€ã€€|   spl |\n|rbpã€€ã€€|ã€€ã€€ebpã€€ã€€|ã€€ã€€bpã€€ã€€ã€€|   bpl|\n|rsiã€€ã€€|ã€€ã€€esiã€€ã€€|ã€€ã€€siã€€ã€€ã€€|ã€€ sil|\n|rdiã€€ã€€|ã€€ã€€ediã€€ã€€|ã€€ã€€diã€€ã€€ã€€ã€€| dil|\n|r8ã€€ã€€ã€€|ã€€ r8d    |  r8w     |  r8b|\n|r9ã€€ã€€ã€€|ã€€ r9d ã€€ã€€|ã€€r9wã€€ã€€ã€€|ã€€ r9b|\n|r10  ã€€|ã€€ r10d ã€€ã€€| r10w  ã€€ã€€| r10b|\n|r11   |ã€€ã€€r11d ã€€ã€€| r11w    |  r11b|\n|r12ã€€ã€€|ã€€ r12dã€€ã€€ã€€| r12w  ã€€|ã€€r12b|\n|r13  ã€€|ã€€ r13d ã€€ã€€ã€€|r13w    | r13b|\n|r14   |   r14d    |  r14w    |  r14b|\n|r15   |   r15d    |  r15w    |  r15b|\n\n>æ­¤å¤–è¿˜æœ‰ripï¼Œ xmm0~xmm15çš„å¤šåª’ä½“ç”¨å¯„å­˜å™¨ï¼Œrflagsã€‚","tags":["å¯„å­˜å™¨","x64"],"categories":["æ±‡ç¼–","æŒ‡ä»¤"]},{"title":"NOPæŒ‡ä»¤","url":"/2022/12/03/NOPæŒ‡ä»¤/","content":"\n>Jdk9 æºç æœ‰ä¸€æ®µå…³äºNOPæ±‡ç¼–æŒ‡ä»¤çš„æ³¨é‡Šï¼Œæ‘˜æŠ„è®°å½•ä¸€ä¸‹\n\n# Intel[æºç é“¾æ¥](http://hg.openjdk.java.net/jdk9/jdk9/hotspot/file/31e4d11eab11/src/cpu/x86/vm/assembler_x86.cpp#l2792)\n```\n    // Using multi-bytes nops \"0x0F 0x1F [address]\" for Intel\n    //  1: 0x90\n    //  2: 0x66 0x90\n    //  3: 0x66 0x66 0x90 (don't use \"0x0F 0x1F 0x00\" - need patching safe padding)\n    //  4: 0x0F 0x1F 0x40 0x00\n    //  5: 0x0F 0x1F 0x44 0x00 0x00\n    //  6: 0x66 0x0F 0x1F 0x44 0x00 0x00\n    //  7: 0x0F 0x1F 0x80 0x00 0x00 0x00 0x00\n    //  8: 0x0F 0x1F 0x84 0x00 0x00 0x00 0x00 0x00\n    //  9: 0x66 0x0F 0x1F 0x84 0x00 0x00 0x00 0x00 0x00\n    // 10: 0x66 0x66 0x0F 0x1F 0x84 0x00 0x00 0x00 0x00 0x00\n    // 11: 0x66 0x66 0x66 0x0F 0x1F 0x84 0x00 0x00 0x00 0x00 0x00\n\n    // The rest coding is Intel specific - don't use consecutive address nops\n\n    // 12: 0x0F 0x1F 0x84 0x00 0x00 0x00 0x00 0x00 0x66 0x66 0x66 0x90\n    // 13: 0x66 0x0F 0x1F 0x84 0x00 0x00 0x00 0x00 0x00 0x66 0x66 0x66 0x90\n    // 14: 0x66 0x66 0x0F 0x1F 0x84 0x00 0x00 0x00 0x00 0x00 0x66 0x66 0x66 0x90\n    // 15: 0x66 0x66 0x66 0x0F 0x1F 0x84 0x00 0x00 0x00 0x00 0x00 0x66 0x66 0x66 0x90\n```\n\n# AMD[æºç é“¾æ¥](http://hg.openjdk.java.net/jdk9/jdk9/hotspot/file/31e4d11eab11/src/cpu/x86/vm/assembler_x86.cpp#l2876)\n```\n    // Using multi-bytes nops \"0x0F 0x1F [address]\" for AMD.\n    //  1: 0x90\n    //  2: 0x66 0x90\n    //  3: 0x66 0x66 0x90 (don't use \"0x0F 0x1F 0x00\" - need patching safe padding)\n    //  4: 0x0F 0x1F 0x40 0x00\n    //  5: 0x0F 0x1F 0x44 0x00 0x00\n    //  6: 0x66 0x0F 0x1F 0x44 0x00 0x00\n    //  7: 0x0F 0x1F 0x80 0x00 0x00 0x00 0x00\n    //  8: 0x0F 0x1F 0x84 0x00 0x00 0x00 0x00 0x00\n    //  9: 0x66 0x0F 0x1F 0x84 0x00 0x00 0x00 0x00 0x00\n    // 10: 0x66 0x66 0x0F 0x1F 0x84 0x00 0x00 0x00 0x00 0x00\n    // 11: 0x66 0x66 0x66 0x0F 0x1F 0x84 0x00 0x00 0x00 0x00 0x00\n\n    // The rest coding is AMD specific - use consecutive address nops\n\n    // 12: 0x66 0x0F 0x1F 0x44 0x00 0x00 0x66 0x0F 0x1F 0x44 0x00 0x00\n    // 13: 0x0F 0x1F 0x80 0x00 0x00 0x00 0x00 0x66 0x0F 0x1F 0x44 0x00 0x00\n    // 14: 0x0F 0x1F 0x80 0x00 0x00 0x00 0x00 0x0F 0x1F 0x80 0x00 0x00 0x00 0x00\n    // 15: 0x0F 0x1F 0x84 0x00 0x00 0x00 0x00 0x00 0x0F 0x1F 0x80 0x00 0x00 0x00 0x00\n    // 16: 0x0F 0x1F 0x84 0x00 0x00 0x00 0x00 0x00 0x0F 0x1F 0x84 0x00 0x00 0x00 0x00 0x00\n    //     Size prefixes (0x66) are added for larger sizes\n```","tags":["æ±‡ç¼–","æŒ‡ä»¤"],"categories":["æ±‡ç¼–","æŒ‡ä»¤"]},{"title":"Golangå•å…ƒæµ‹è¯•å’ŒåŸºå‡†æµ‹è¯•","url":"/2022/12/02/Golangå•å…ƒæµ‹è¯•å’ŒåŸºå‡†æµ‹è¯•/","content":"\n# å•å…ƒæµ‹è¯•\n- æµ‹è¯•éœ€è¦ç”¨åˆ°çš„æ–­è¨€ï¼Œä¾èµ–\n`github.com/stretchr/testify`\n\n- ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œæ–‡ä»¶å‘½åå¸¦`_test.go`\n`helloworld_test.go`\n```go\nimport \"testing\"\nfunc TestHelloWorld(t *testing.T) {\n    t.Log(\"hello world\")\n}\n```\n- æµ‹è¯•æ‰€æœ‰ç”¨ä¾‹\n```shell\ngo test -v helloworld_test.go\n```\n- æŒ‡å®šç”¨ä¾‹\n``` shell\ngo test -v -run TestHelloWorld helloworld_test.go\n```\n- æµ‹è¯•æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰çš„æµ‹è¯•ç”¨ä¾‹\n```shell\ngo test -v ./directory\n```\n\n# åŸºå‡†æµ‹è¯•\n- éå¹¶å‘æ–¹å¼\n`benchmark_test.go`\n```go\nfunc Benchmark_Add(b *testing.B) {\n    var n int\n    for i := 0; i < b.N; i++ {\n        n++\n    }\n}\n```\n>**æ³¨ï¼šb.N ç”±åŸºå‡†æµ‹è¯•æ¡†æ¶æä¾›ã€‚æµ‹è¯•ä»£ç éœ€è¦ä¿è¯å‡½æ•°å¯é‡å…¥æ€§åŠæ— çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæµ‹è¯•ä»£ç ä¸ä½¿ç”¨å…¨å±€å˜é‡ç­‰å¸¦æœ‰è®°å¿†æ€§è´¨çš„æ•°æ®ç»“æ„ã€‚é¿å…å¤šæ¬¡è¿è¡ŒåŒä¸€æ®µä»£ç æ—¶çš„ç¯å¢ƒä¸ä¸€è‡´ï¼Œä¸èƒ½å‡è®¾ N å€¼èŒƒå›´ã€‚**\n\n- å¹¶å‘æ–¹å¼\n```go\nfunc Benchmark_Dosomething(b *testing.B) {\n\tb.SetParallelism(8)\n\tb.RunParallel(func(pb *testing.PB) {\n\t\tfor pb.Next() {\n\t\t\tDosomething()\n\t\t}\n\t})\n}\n```\n>**æ³¨ï¼šSetParallelismç”¨æ¥è®¾ç½®åç¨‹æ•°é‡**\n\n# åŸºå‡†æµ‹è¯•è„šæœ¬ç¼–å†™\n```shell\n#!/bin/sh\ngo test -bench=. -run=none \\\n  -benchtime=300s \\\n  -benchmem -memprofile=mem.pprof \\\n  -cpuprofile=cpu.pprof \\\n  -cpu=8 \\\n  -timeout=0 \\\n  -blockprofile=block.pprof ./directory/\n```\n\n>**åŸºå‡†æµ‹è¯•é»˜è®¤10åˆ†é’Ÿï¼Œå¦‚æœæµ‹è¯•æ€»æ—¶é•¿è¶…è¿‡10åˆ†é’Ÿï¼Œæµ‹è¯•çš„è¿›ç¨‹ä¼šè¢«killæ‰ï¼Œæ‰€ä»¥æŒ‡å®štimeout=0è¡¨ç¤ºä¸é™æ—¶é•¿**\n\n# goåŸºå‡†æµ‹è¯•æºç ä¸­`benchmark.go`\næœ‰è¿™ä¹ˆä¸€ä¸ªæ ¸å¿ƒæ–¹æ³•\n```go\n// launch launches the benchmark function. It gradually increases the number\n// of benchmark iterations until the benchmark runs for the requested benchtime.\n// launch is run by the doBench function as a separate goroutine.\n// run1 must have been called on b.\nfunc (b *B) launch() {\n\t// Signal that we're done whether we return normally\n\t// or by FailNow's runtime.Goexit.\n\tdefer func() {\n\t\tb.signal <- true\n\t}()\n\n\t// Run the benchmark for at least the specified amount of time.\n\tif b.benchTime.n > 0 { // è¿™é‡Œè¡¨ç¤ºæµ‹è¯•æ—¶æ˜¯ä½¿ç”¨äº†æ¬¡æ•°é™åˆ¶ï¼Œä¾‹å¦‚æŒ‡å®šäº†å‚æ•°-benchtime=1000xè¡¨ç¤ºæ‰§è¡Œ1000æ¬¡\n\t\t// We already ran a single iteration in run1.\n\t\t// If -benchtime=1x was requested, use that result.\n\t\t// See https://golang.org/issue/32051.\n\t\tif b.benchTime.n > 1 {\n\t\t\tb.runN(b.benchTime.n)\n\t\t}\n\t} else { // è¿™ä¸ªåˆ†æ”¯è¡¨ç¤ºæŒ‡å®šçš„æ˜¯æ—¶é—´é™åˆ¶ï¼ˆåŒºåˆ«äºæ¬¡æ•°é™åˆ¶ï¼‰ï¼Œä¾‹å¦‚æŒ‡å®šäº†å‚æ•°-benchtime=5sç»™ç¤ºæ¯ä¸ªç”¨ä¾‹æ‰§è¡Œ5sï¼ˆè¿™é‡Œä¼šæ ¹æ®å®é™…æƒ…å†µè¿è¡Œï¼Œè€Œéç²¾ç¡®çš„5sï¼‰\n\t\td := b.benchTime.d\n        // æ³¨æ„ä¸‹é¢å¾ªç¯æ¡ä»¶ä¸­çš„nçš„å€¼çš„ä¸Šé™\n\t\tfor n := int64(1); !b.failed && b.duration < d && n < 1e9; {\n\t\t\tlast := n\n\t\t\t// Predict required iterations.\n\t\t\tgoalns := d.Nanoseconds()\n\t\t\tprevIters := int64(b.N)\n\t\t\tprevns := b.duration.Nanoseconds()\n\t\t\tif prevns <= 0 {\n\t\t\t\t// Round up, to avoid div by zero.\n\t\t\t\tprevns = 1\n\t\t\t}\n\t\t\t// Order of operations matters.\n\t\t\t// For very fast benchmarks, prevIters ~= prevns.\n\t\t\t// If you divide first, you get 0 or 1,\n\t\t\t// which can hide an order of magnitude in execution time.\n\t\t\t// So multiply first, then divide.\n\t\t\tn = goalns * prevIters / prevns\n\t\t\t// Run more iterations than we think we'll need (1.2x).\n\t\t\tn += n / 5\n\t\t\t// Don't grow too fast in case we had timing errors previously.\n\t\t\tn = min(n, 100*last)\n\t\t\t// Be sure to run at least one more than last time.\n\t\t\tn = max(n, last+1)\n\t\t\t// Don't run more than 1e9 times. (This also keeps n in int range on 32 bit platforms.)\n\t\t\tn = min(n, 1e9)\n\t\t\tb.runN(int(n))\n\t\t}\n\t}\n\tb.result = BenchmarkResult{b.N, b.duration, b.bytes, b.netAllocs, b.netBytes, b.extra}\n}\n```\n\n>åœ¨åŸºå‡†æµ‹è¯•æ—¶ï¼Œå¦‚æœè®¾å®šçš„æ˜¯æ—¶é—´é™åˆ¶ï¼Œå³æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå¤šå°‘æ—¶é—´ã€‚å› ä¸ºæ¯æ¬¡æ‰§è¡Œçš„æ—¶é—´éƒ½ä¸å¯èƒ½å®Œå…¨ä¸€è‡´ï¼Œæ‰€ä»¥ç”¨ä¾‹çš„æ‰§è¡Œæ¬¡æ•°åˆ°åº•åº”è¯¥ä¸ºå¤šå°‘æ¬¡ï¼Œè¿™ä¸ªå€¼æ˜¯ä¼šè¢«ä¼°ç®—å‡ºæ¥çš„ï¼Œä¼°ç®—çš„è¿‡ç¨‹å°±æ˜¯åœ¨ä»¥ä¸‹çš„å¾ªç¯ä¸­ã€‚\n```go\nfor n := int64(1); !b.failed && b.duration < d && n < 1e9; {\n    // æ¯ä¸€æ¬¡å¾ªç¯ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºä»¥ä¸‹è¿‡ç¨‹çš„ä¸€è½®ï¼Œæ¯ä¸€è½®æ€»çš„åˆ†ä¸º2ä¸ªæ­¥éª¤\n    // 1.ä¼°ç®—ä¸€ä¸‹nï¼Œnå³æ˜¯æ¥ä¸‹æ¥ç”¨ä¾‹éœ€è¦æ‰§è¡Œå¤šå°‘æ¬¡ï¼Ÿ\n    // 2.ä¼°ç®—å¥½åï¼Œè°ƒç”¨b.runN(int(n)) nçš„å€¼ä¸ºå¤šå°‘ï¼Œç”¨ä¾‹è¿™ä¸€è½®å°±è¢«è°ƒç”¨äº†å¤šå°‘æ¬¡\n}\n```\n\n- æ˜ç¡®äº†å¤§ä½“çš„æµç¨‹åï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ç»†èŠ‚ï¼š\n  - nçš„ä¸Šé™é—®é¢˜\n    >è®¾å®šçš„ç”¨ä¾‹æ‰§è¡Œæ—¶é—´è¿˜æ²¡åˆ°ï¼Œä½†æ˜¯ç”¨ä¾‹æ‰§è¡Œæ¬¡æ•°å·²åˆ°ï¼Œé‚£å°±åªæœ‰æå‰ç»“æŸå¾ªç¯ï¼Œä¹Ÿå°±æ„å‘³ç€æ²¡æ³•å†é©±åŠ¨b.runN(int(n))çš„è°ƒç”¨ï¼›ä¹Ÿå°±ä¼šå‡ºç°è¿˜æ²¡åˆ°è®¾å®šæ—¶é—´ï¼Œç”¨ä¾‹æå‰ç»“æŸäº†ã€‚è¯´æ˜ç”¨ä¾‹æ‰§è¡Œè¾ƒå¿«ã€‚è¿™ç§æƒ…å†µæ¢æ‰§è¡Œæ¬¡æ•°é™å®šæ¯”è¾ƒåˆé€‚ï¼Ÿ\n\n  - nçš„ä¼°ç®—ä¸­æœ‰ä¸€ä¸ªå…¬å¼çš„é—®é¢˜\n\n    `n = goalns * prevIters / prevns`\n\n    - `goalns`æ˜¯ç”¨ä¾‹æ‰§è¡Œçš„ç›®æ ‡æ—¶é—´ï¼Œå•ä½ns\n    - `prevIters`æ˜¯`ä¸Šä¸€è½®`ç”¨ä¾‹çš„æ‰§è¡Œæ¬¡æ•°\n    - `prevens`æ˜¯`ä¸Šä¸€è½®`ç”¨ä¾‹çš„æ‰§è¡Œæ—¶é—´ï¼Œå•ä½ns\n\n    >é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šå¦‚æœgoalnsçš„å€¼è¾ƒå¤§ï¼ˆè®¾ç½®äº†æ¯”è¾ƒé•¿çš„ç”¨ä¾‹æµ‹è¯•æ—¶é—´ï¼Œä¸Šä¸€è½®çš„æµ‹è¯•æ¬¡æ•°ä¹Ÿè¾ƒå¤§ï¼Œä½†æ˜¯ä¸Šä¸€è½®çš„ç”¨ä¾‹æµ‹è¯•æ—¶é—´å¾ˆçŸ­ï¼Œé‚£æ ¹æ®å…¬å¼ï¼Œä¼°ç®—å‡ºæ¥çš„nå¯èƒ½å¾ˆå¤§ï¼Œå¯èƒ½æ¯”int64çš„åŒºé—´èŒƒå›´è¦å¤§ï¼Œæº¢å‡ºåå°±ä¼šå˜æˆä¸€ä¸ªè´Ÿå€¼ã€‚\n    >å˜æˆè´Ÿå€¼ä¹‹å,nçš„å¢é•¿é€»è¾‘å°±ä¸ä¸€æ ·äº†ï¼Œåˆ†æä¸€ä¸‹ï¼š\n    >n += n / 5  -> nè¿˜æ˜¯è´Ÿå€¼\n    >n = min(n, 100*last) -> nçš„å€¼è¿˜æ˜¯n\n    >n = max(n, last+1) -> å˜ä¸ºä¸Šä¸€è½®ä¼°ç®—çš„å€¼+1 == (last + 1)\n    >n = min(n, 1e9) -> n == (last + 1)\n    >åŒç†ï¼Œæ¯ä¸€è½®ä¼°ç®—ï¼Œä¼°ç®—å€¼éƒ½æ˜¯ä»¥1æ­¥è¿›ï¼Œé—®é¢˜å°±å‡ºç°äº†ï¼šä»nå€¼æº¢å‡ºå¼€å§‹ï¼Œå‡è®¾è¿™ä¸ªæ—¶å€™lastçš„å€¼ä¸º 1e8ï¼Œé‚£nçš„å€¼å˜åŒ–è§„ç‡ä¸º100000001, 100000002, 100000003, ...,è¿™æ ·å¦‚æœæƒ³è®©\bnè¾¾åˆ°1e9ï¼Œè¦`1e9 - 1e8` è½®, è€Œä¸”æ¯è½®è¦æ‰§è¡Œç”¨ä¾‹næ¬¡ã€‚æ³¨æ„ï¼šè¿™åªæ˜¯ä¸€ä¸ªä¼°ç®—çš„è¿‡ç¨‹ï¼Œè¿˜æ²¡çœŸæ­£å¼€å§‹åšåŸºå‡†æµ‹è¯•å‘¢...è¿™ä¸ªä¼°ç®—æ‰§è¡Œæ¬¡æ•°çš„è¿‡ç¨‹å°±å·²ç»å¾ˆæ¶ˆè€—æ—¶é—´äº†,æœ€ç»ˆæœ‰å¯èƒ½è¶…è¿‡10minï¼Œå› ä¸ºgo benchmarkçš„é»˜è®¤æ‰§è¡Œæ—¶é—´å°±æ˜¯10minï¼Œè¿™ä¸ªæ—¶å€™æµ‹è¯•è¿›ç¨‹ä¼šè¢«å¼ºæ€ï¼Œå¹¶æç¤ºæ‰§è¡Œè¶…æ—¶çš„é”™è¯¯ã€‚\n\n# åŸºå‡†æµ‹è¯•é—®é¢˜é‡ç°æ–¹æ³•\n- å†™ä¸€ä¸ªè€—æ—¶å¾ˆçŸ­çš„ç”¨ä¾‹\n- è®¾ç½®ä¸€ä¸ªè¾ƒé•¿çš„ç”¨ä¾‹æµ‹è¯•æ—¶é—´ï¼ˆä¸ç”¨å¤ªé•¿ï¼Œæ¯”å¦‚200så°±è¡Œï¼Œåªè¦æƒ³åŠæ³•è®©nå€¼æº¢å‡ºå³å¯ï¼‰\n- æ‰§è¡Œä¸€ä¸‹...å°±ç­‰ç€10miné’Ÿä»¥åå§\n\n# è§£å†³åŠæ³•\n- 1. ä¸Šé¢æåˆ°çš„næº¢å‡ºé—®é¢˜ï¼Œè™½ç„¶è§‰å¾—benchmark.goé‡Œé¢çš„ä»£ç ç¡®å®æœ‰ç‚¹é—®é¢˜ï¼Œå¯ä»¥æŠŠnçš„æ•°æ®ç±»å‹å†æ”¹å¤§ä¸€äº›å¦‚float64ï¼Œåœ¨æ–¹æ³•ä¸­å¢åŠ åˆ¤æ–­æº¢å‡ºåè¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚\n- 2. å‡ºç°è¿™ç§æƒ…å†µï¼Œè¯´æ˜è¢«æµ‹è¯•çš„ç”¨ä¾‹åšé•¿æ—¶é—´æµ‹è¯•çš„å¿…è¦æ€§å€¼å¾—å•†æ¦·\n\n# å¦å¤–\n>func (b *B) launch() æ˜¯éå¹¶è¡Œæ¨¡å¼ä¸‹ä¼šè¢«è°ƒç”¨çš„æ–¹æ³•ï¼›åŒæ ·åœ¨å¹¶è¡Œæ¨¡å¼ä¸‹ï¼Œè°ƒç”¨çš„æ˜¯func (b *B) RunParallel(body func(*PB)) åº”è¯¥åŒæ ·å­˜åœ¨ç±»ä¼¼é—®é¢˜ã€‚\n","tags":["unit test","benchmark test"],"categories":["Golang","æµ‹è¯•"]},{"title":"centos å¤šgccç‰ˆæœ¬ç¯å¢ƒ","url":"/2022/11/30/centos-å¤šgccç‰ˆæœ¬ç¯å¢ƒ/","content":"# èƒŒæ™¯\n- åœ¨æœ¬åœ°PCä½¿ç”¨`Jetbrains gateway`æ–°å»ºsshè¿œç¨‹å¼€å‘, æ‰“å¼€æœåŠ¡å™¨ä¸Šçš„ä»£ç è¿›è¡Œå¼€å‘\n- CentOS ç³»ç»Ÿä¸­çš„`gcc`å’Œ`g++`ç‰ˆæœ¬å¤ªä½ã€‚ä¸æ”¯æŒ`c++11`æ ‡å‡†ï¼Œéœ€è¦å®‰è£…æ–°çš„å¼€å‘ç¯å¢ƒ\n- CLion é¡¹ç›®ä¸­çš„`CMakeList.txt`éœ€è¦é…ç½®èƒ½ç¼–è¯‘`c++11æ ‡å‡†`çš„`gcc`å’Œ`g++`\n    \n# ç¼–è¯‘å·¥å…·å®‰è£…\n```shell\n    sudo yum install centos-release-scl-rh\n    sudo yum install devtoolset-11-gcc-c++\n```\n> å®‰è£…å®Œæˆåï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯ä»¥åˆ‡æ¢åˆ°æ–°çš„ç¼–è¯‘ç¯å¢ƒ\n```shell\n    sudo scl enable devtoolset-11 bash\n```\n> å¯ä»¥æŸ¥çœ‹devtoolset-11ç›¸å…³å·¥å…·çš„ç‰ˆæœ¬åŠå®ƒä»¬çš„è·¯å¾„\n```shell\n    g++ --version\n    gcc --version\n```\n```shell\n    which g++\n    which gcc\n```\n\n# å¼€å‘å·¥å…·ä¸­çš„é…ç½®ä¿®æ”¹\n> éœ€è¦æŒ‡å®šç¼–è¯‘å™¨è·¯å¾„(**æ ¹æ®è‡ªå·±ç¼–è¯‘å™¨è·¯å¾„è¿›è¡Œä¿®æ”¹**)\n```\n    SET(CMAKE_C_COMPILER \"/opt/rh/devtoolset-11/root/usr/bin/gcc\")\n    SET(CMAKE_CXX_COMPILER \"/opt/rh/devtoolset-11/root/usr/bin/g++\")\n```\n\n# è°ƒç”¨åŠ¨æ€åº“éœ€è¦æ³¨æ„çš„ç‚¹\n> åœ¨åŠ è½½`so`åº“çš„æ¨¡å—ç›¸åº”çš„`.h`æ–‡ä»¶ä¸­è¦ #include <dlfcn.h>\n> åœ¨CMakefile.txté‡Œé¢æ·»åŠ ç¼–è¯‘é€‰é¡¹ï¼Œå¦‚ï¼š\n> TARGET_LINK_LIBRARIES(projName dl)\n> å…¶ä¸­`projName`ä¸ºé¡¹ç›®çš„åç§°","tags":["c++","cenos","CLion","Jetbrains gateway","è¿œç¨‹å¼€å‘"],"categories":["Linux"]},{"title":"CGOå†…å­˜è¸©å‘è®°å½•","url":"/2022/11/24/CGOå†…å­˜è¸©å‘è®°å½•/","content":"\n# åº”ç”¨åœºæ™¯\n\nå°† Go å†…å­˜ä¸­çš„å­—ç¬¦ä¸²æˆ–å­—èŠ‚åˆ‡ç‰‡ä¼ å…¥ C è¯­è¨€å‡½æ•°çš„åº”ç”¨åœºæ™¯ã€‚\n\n# é‡Œé¢çš„å‘\n\nå‡è®¾ä¸€ä¸ªæç«¯åœºæ™¯ï¼šæˆ‘ä»¬å°†ä¸€å—ä½äºæŸ `goroutine` çš„æ ˆä¸Šçš„` Go `è¯­è¨€å†…å­˜ä¼ å…¥äº† `C `è¯­è¨€å‡½æ•°åï¼Œåœ¨æ­¤` C `è¯­è¨€å‡½æ•°æ‰§è¡Œæ—¶ï¼Œå¦‚æœ `goroutinue `çš„æ ˆå› ä¸ºç©ºé—´ä¸è¶³çš„åŸå› å‘ç”Ÿäº†**æ‰©å±•**ï¼Œä¹Ÿå°±æ˜¯å¯¼è‡´äº†åŸæ¥çš„ `Go `è¯­è¨€å†…å­˜è¢«ç§»åŠ¨åˆ°äº†æ–°çš„ä½ç½®ã€‚ä½†æ˜¯è¿™æ—¶` C `è¯­è¨€å‡½æ•°å¹¶ä¸çŸ¥é“è¯¥ `Go `è¯­è¨€å†…å­˜å·²ç»ç§»åŠ¨äº†ä½ç½®ï¼Œä»ç„¶ç”¨ä¹‹å‰çš„åœ°å€æ¥æ“ä½œè¯¥å†…å­˜â€”â€”ä¹Ÿå°±æ˜¯**â€œé‡æŒ‡é’ˆâ€**ã€‚ä¸æ˜¯å¿…ç°ï¼Œè¦çœ‹å†…å­˜ä¸­çš„æ•°æ®æ˜¯å¦å‘ç”Ÿç§»åŠ¨ã€‚\n\nä»¥ä¸Šæ“ä½œæœ¬è´¨ä¸Šçœ‹æ˜¯ä¸€ç§**â€œä¼ å¼•ç”¨â€**ï¼Œå¯ä»¥å€ŸåŠ© C è¯­è¨€å†…å­˜ç¨³å®šçš„ç‰¹æ€§ï¼ˆè°`malloc`å°±ç”±è°æ¥`free`ï¼Œä»£ç ç¼–å†™è€…è‡ªå·±å¯¹å†…å­˜è¿›è¡Œç®¡ç†ï¼‰ï¼Œåœ¨ C è¯­è¨€ç©ºé—´å…ˆå¼€è¾ŸåŒæ ·å¤§å°çš„å†…å­˜ï¼Œç„¶åå°† Go çš„å†…å­˜å¡«å……åˆ° C çš„å†…å­˜ç©ºé—´ï¼ˆ**å¤åˆ¶äº†ä¸€ä¸ªå‰¯æœ¬è¿‡å»**ï¼‰ã€‚ä¸‹é¢çš„ä¾‹å­æ˜¯è¿™ç§æ€è·¯çš„å…·ä½“å®ç°ï¼š\n\n# ä¾‹1\n\n```go\npackage main\n\n/*\n#include <stdlib.h>\n#include <stdio.h>\n\nvoid printString(const char* s) {\n    printf(\"%s\", s);\n}\n*/\nimport \"C\"\nimport \"unsafe\"\n\nfunc printString(s string) {\n    cs := C.CString(s) // è¿™é‡Œä¼šåœ¨Cçš„å†…å­˜ç©ºé—´é‡Œé¢å¼€è¾Ÿä¸€å—ç©ºé—´ï¼ŒæŠŠGOä¸­çš„å­—ç¬¦ä¸²sçš„å€¼æ‹·è´è¿‡å»\n    defer C.free(unsafe.Pointer(cs)) // è¿™é‡Œç”¨defer è¿›è¡Œå»¶è¿Ÿæ“ä½œï¼Œé‡Šæ”¾è¿™å—åœ¨Cé‡Œé¢å¼€è¾Ÿçš„ç©ºé—´ï¼Œä¸ç„¶å°±æ˜¯å†…å­˜æ³„æ¼\n\n    C.printString(cs)\n}\n\nfunc main() {\n    s := \"hello\"\n    printString(s)\n}\n```\n\nè¿™ç§æ–¹å¼è™½ç„¶è§£å†³äº†é—®é¢˜ï¼Œä½†æ˜¯ï¼Œå†™æ³•æœ‰ç‚¹å•°å—¦ï¼Œè¿˜è¦è‡ªå·±æ‰‹åŠ¨`C.free`ã€‚æœ€ä¸»è¦çš„æ˜¯ï¼šæ€§èƒ½æ•ˆç‡æœ‰æŸå¤±ï¼Œå› ä¸ºè¦ä»`GO`ç¯å¢ƒæŠŠå†…å­˜å¤åˆ¶åˆ°`C`è¯­è¨€ç¯å¢ƒå†…å­˜ä¸­ã€‚\n\n# ä¾‹2\n\n```go\npackage main\n\n/*\n#include<stdio.h>\n\nvoid printString(const char* s, int n) {\n    int i;\n    for(i = 0; i < n; i++) {\n        putchar(s[i]);\n    }\n    putchar('\\n');\n}\n*/\nimport \"C\"\n\nfunc printString(s string) {\n    p := (*reflect.StringHeader)(unsafe.Pointer(&s)) // æŠŠå­—ç¬¦ä¸²çš„å†…å­˜åœ°å€èµ‹å€¼ç»™äº†p\n    C.printString((*C.char)(unsafe.Pointer(p.Data)), C.int(len(s))) // ä¼ å…¥å‚æ•°\n}\n\nfunc main() {\n    s := \"hello\"\n    printString(s)\n}\n```\n\nç°åœ¨çš„å¤„ç†æ–¹å¼æ›´åŠ ç›´æ¥ï¼Œä¸”é¿å…äº†åˆ†é…é¢å¤–çš„å†…å­˜ï¼Œè€Œä¸”CGOä¼šä¿è¯åœ¨Cå‡½æ•°è°ƒç”¨æœŸé—´ï¼ˆä»Cè¯­è¨€å‡½æ•°è¢«è°ƒç”¨åˆ°Cè¯­è¨€å‡½æ•°è°ƒç”¨ç»“æŸï¼‰ï¼Œä¼ å…¥çš„æŒ‡é’ˆæŒ‡å‘çš„è¿™å—GOè¯­è¨€å¼€è¾Ÿçš„å†…å­˜ä¸ä¼šè¢«ç§»åŠ¨ã€‚æ³¨æ„ï¼š~~**`CGOåªä¼šä¿è¯åœ¨Cå‡½æ•°è°ƒç”¨æœŸé—´`**ã€‚~~ åœ¨ç½‘ä¸Šæœ‰çœ‹åˆ°è¿™ä¸ªè¯´æ³•ï¼Œä½†æ˜¯æˆ‘å®è·µä¸­ä¼¼ä¹æœ‰å‡ºå…¥ã€‚æˆ‘å®è·µä¸­å°±æ˜¯ç”¨è¿™ä¸ªç”¨æ³•ï¼Œç»“æœGGäº†ï¼Œæˆ‘å®è·µä¸­å®ƒå¥½åƒä¹Ÿä¸èƒ½ä¿è¯è¿™ä¸€ç‚¹ï¼Œè¿™ä¸ªåç»­å†ç ”ç©¶ç ”ç©¶ã€‚\n\nå°±ç®—CGOä¼šä¿è¯åœ¨Cå‡½æ•°è°ƒç”¨æœŸé—´ä¿è¯å†…å­˜ä¸ä¼šè¢«ç§»åŠ¨ï¼Œè¿™é‡Œè¿˜æœ‰æœ‰ä¸€ä¸ªå®¹æ˜“è¸©çš„å‘ï¼š\n\n```go\n// é”™è¯¯çš„ä»£ç \np := (*reflect.StringHeader)(unsafe.Pointer(&s)) // æŠŠå­—ç¬¦ä¸²çš„å†…å­˜åœ°å€èµ‹å€¼ç»™äº†p\ntmp := uintptr(p)\nptr := (*reflect.StringHeader)(unsafe.Pointer(tmp))\nC.printString((*C.char)(unsafe.Pointer(ptr.Data)), C.int(len(s))) // ä¼ å…¥å‚æ•°\n```\n\nå› ä¸º tmp å¹¶ä¸æ˜¯æŒ‡é’ˆç±»å‹(å®ƒåªæ˜¯è¡¨ç¤ºå†…å­˜åœ°å€ï¼Œä½†å¹¶æ²¡æœ‰æŒ‡é’ˆçš„**è¯­ä¹‰**ï¼ŒæŒ‡é’ˆå’Œå†…å­˜åœ°å€è¿˜æ˜¯æœ‰ç‚¹å·®åˆ«çš„ï¼Œå·®åˆ«åœ¨äºæŒ‡é’ˆæ˜¯æœ‰æ•°æ®ç±»å‹çš„ï¼Œæ˜¯å’ŒæŒ‡å‘çš„å†…å­˜ä¸­çš„æ•°æ®è¿›è¡Œäº†â€œç»‘å®šçš„â€ï¼Œè€Œå†…å­˜åœ°å€ä»…ä»…æ˜¯åœ°å€è€Œå·²)ã€‚åœ¨å®ƒè·å–åˆ°` Go `å¯¹è±¡åœ°å€ä¹‹å`s`å¯¹è±¡å¯èƒ½ä¼šè¢«ç§»åŠ¨ï¼Œä½†æ˜¯å› ä¸ºä¸æ˜¯`tmp`æ²¡æœ‰æŒ‡é’ˆè¯­ä¹‰ï¼Œæ‰€ä»¥ä¸ä¼šè¢«` Go` è¯­è¨€è¿è¡Œæ—¶æ›´æ–°æˆæ–°å†…å­˜çš„åœ°å€(`s`å¯¹è±¡æ–°çš„ç§»åŠ¨åçš„ä½ç½®ï¼‰ã€‚åœ¨`tmp`ä¸­ä¿æŒ `Go` å¯¹è±¡çš„åœ°å€ï¼Œå’Œåœ¨` C` è¯­è¨€ç¯å¢ƒä¿æŒ` Go` å¯¹è±¡çš„åœ°å€çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼šå¦‚æœåŸå§‹çš„` Go `å¯¹è±¡å†…å­˜å‘ç”Ÿäº†ç§»åŠ¨ï¼ŒGo è¯­è¨€è¿è¡Œæ—¶å¹¶ä¸ä¼šåŒæ­¥æ›´æ–°å®ƒä»¬ã€‚è¿™æ ·å°±è¿˜æ˜¯ä¼šè§¦å‘ä¸€å¼€å§‹çš„é‚£ä¸ªé—®é¢˜ã€‚\n\næ‰€ä»¥ï¼Œè¿˜æ˜¯æ…ç”¨ä¾‹2çš„æ–¹æ³•å§\n\n**ç»­ï¼š**æˆ‘å»çœ‹äº†`StringHeader`çš„æ•°æ®ç»“æ„å’Œ`SliceHeader`æ•°æ®ç»“æ„\n\n```go\n// StringHeader is the runtime representation of a string.\n// It cannot be used safely or portably and its representation may\n// change in a later release.\n// Moreover, the Data field is not sufficient to guarantee the data\n// it references will not be garbage collected, so programs must keep\n// a separate, correctly typed pointer to the underlying data.\ntype StringHeader struct {\n\tData uintptr\n\tLen  int\n}\n\n// SliceHeader is the runtime representation of a slice.\n// It cannot be used safely or portably and its representation may\n// change in a later release.\n// Moreover, the Data field is not sufficient to guarantee the data\n// it references will not be garbage collected, so programs must keep\n// a separate, correctly typed pointer to the underlying data.\ntype SliceHeader struct {\n\tData uintptr\n\tLen  int\n\tCap  int\n}\n```\n\nçœ‹åˆ°`Data`çš„ç±»å‹æ˜¯`uintptr`å°±æ„Ÿè§‰ä¸å¦™äº†...è¿™é‡Œè‡ªå·±å®ç°ä¸€ä¸ªå¯èƒ½èƒ½è§£å†³é—®é¢˜ï¼Œæˆ‘èƒ½æƒ³åˆ°çš„ï¼Œgoæ ‡å‡†åº“çš„å¼€å‘è€…ä¼šæƒ³ä¸å—ï¼Ÿè‚¯å®šæ˜¯æœ‰ä»€ä¹ˆåŸå› çš„ã€‚æ‰€ä»¥ï¼Œè¿˜æ˜¯æœ€å¥½ä¸ç”¨`StringHeader`äº†ã€‚\n\n```go\ntype StringHeader struct {\n\tData unsafe.Pointer\n\tLen  int\n}\n```\n\n","tags":["CGO","å†…å­˜"],"categories":["Golang","CGO"]},{"title":"Rustå­¦ä¹ -çŸ¥è¯†ç‚¹-7","url":"/2022/11/20/Rustå­¦ä¹ -çŸ¥è¯†ç‚¹-7/","content":"\n[å‰æ–¹é«˜èƒ½ï¼Œè¿‡ä»½å¸…æ°”](https://github.com/usagi/rust-memory-container-cs)\n\n![rust-memory-container-cs-3840x2160-dark-back.png](https://s2.loli.net/2022/11/20/iIUBf4FDuCOs7jq.png)\n","tags":["å†…å­˜","memory"],"categories":["Rust","åŸºç¡€"]},{"title":"Rustå­¦ä¹ -çŸ¥è¯†ç‚¹-6","url":"/2022/11/19/Rustå­¦ä¹ -çŸ¥è¯†ç‚¹-6/","content":"\n# è¯­å¥å’Œè¡¨è¾¾å¼\n\n- å‡½æ•°ä½“ç”±ä¸€ç³»åˆ—è¯­å¥ç»„æˆ\n- å‡½æ•°å¯ä»¥ç”±ä¸€ä¸ªè¡¨è¾¾å¼ç»“æŸï¼ˆè¿™ç§æƒ…å†µä¸‹ï¼Œè¡¨è¾¾å¼çš„å€¼ä¸ºå‡½æ•°çš„è¿”å›å€¼ï¼‰\n- `rust`æ˜¯åŸºäºè¡¨è¾¾å¼çš„è¯­è¨€\n- è¯­å¥æ˜¯æ‰§è¡Œä¸€äº›åŠ¨ä½œçš„æŒ‡ä»¤\n- è¡¨è¾¾å¼ä¼šè®¡ç®—äº§ç”Ÿä¸€ä¸ªå€¼\n\n```rust\nfn main() {\n  let x = 0;\n  let y = {\n    let x = 1; // æˆ‘å°±æ˜¯ç¬¬5è¡Œ\n    x + 1\n  };\n}\n```\n\n**æ³¨ï¼šç¬¬5è¡Œï¼Œ x + 1 åé¢çš„æ— `;`ã€‚è¿™é‡Œ`x + 1`å°±æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå®ƒçš„è®¡ç®—ç»“æœå°±è¿”å›èµ‹å€¼ç»™äº†`y`ã€‚**\n\né‚£å¦‚æœ`x + 1`åé¢åŠ ä¸Š`;`å‘¢ï¼Ÿå³ï¼š\n\n```rust\nfn main() {\n  let x = 0;\n  let y = {\n    let x = 1; // æˆ‘å°±æ˜¯ç¬¬5è¡Œ\n    x + 1;\n  };\n}\n```\n\nè¿™ä¸ªç¼–è¯‘å‡ºæ˜¯å¯ä»¥é€šè¿‡çš„ï¼Œè¿™ä¸ªæ—¶å€™`y`çš„æ•°æ®ç±»å‹æ˜¯`ç©ºçš„å…ƒç»„`ç±»å‹ï¼Œä¹Ÿå°±æ˜¯`()`ï¼› ç±»ä¼¼çš„ï¼š`rust`ä¸­æ²¡æœ‰æ˜¾ç¤ºæŒ‡å®šå‡½æ•°è¿”å›å€¼çš„ï¼Œé‚£è¿™ä¸ªå‡½æ•°è¿”å›å€¼ç±»å‹ä¸º`()`ã€‚å°±ç›¸å½“äº`c++`é‡Œé¢çš„è¿”å›ç±»å‹ä¸º`void`çš„å‡½æ•°\n\nçœ‹ä¸‹é¢ä¸€ä¸ªä¾‹å­ï¼š\n\n```rust\nfn main() {\n  let mut counter = 0;\n  let result = loop {\n    counter += 1;\n    if counter == 10 {\n      break counter * 2; // ç¬¬6è¡Œ\n    }\n  };\n}\n```\n\n`loop`ä¸ºæ­»å¾ªç¯ï¼Œä¸€ä¸ªæ­»å¾ªç¯èµ‹å€¼ç»™äº†`result`, æ˜¯ä¸æ˜¯æœ‰ç‚¹è´¹è§£ï¼Œè¿™é‡Œå°±è¦ç†è§£ç¬¬6è¡Œçš„ä»£ç çš„æ„æ€äº†ã€‚è¿™é‡Œé¢ä½¿ç”¨äº†`break`è¯­å¥ã€‚\n\n`break count * 2;`çš„æ„æ€å°±æ˜¯è·³å‡ºå¾ªç¯ï¼Œå¹¶è¿”å›`break`åé¢çš„è¡¨è¾¾å¼çš„å€¼ã€‚è¿™é‡Œæœ‰äººä¼šç–‘æƒ‘ï¼Œåˆšæ‰ä¸æ˜¯è¯´è¡¨è¾¾å¼æ˜¯ä¸å¸¦`;`çš„å—ï¼Ÿé‚£ç°åœ¨`counter * 2;`è¿™é‡Œä¸æ˜¯æœ‰`;`å—ï¼Ÿ`break counter * 2;` æ˜¯ä¸ªè¯­å¥ï¼Œå®ƒæ˜¯éœ€è¦`;`çš„ã€‚æ‰€ä»¥è¿™é‡Œçš„`;`æ˜¯æ•´ä¸ªè¯­å¥çš„åˆ†å·ï¼Œè¿™ä¸ªè¯­å¥æ˜¯ç”¨`break`è·³å‡ºå¾ªç¯å¹¶è¿”å›è¡¨è¾¾å¼`counter * 2`ï¼Œæ²¡æ¯›ç—…ã€‚\n\n**æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼Œå­¦æµ·æ— æ¶¯ï¼**\n","tags":["loop","break","è¯­å¥","è¡¨è¾¾å¼"],"categories":["Rust","åŸºç¡€"]},{"title":"Golangè°ƒç”¨Cè¯­è¨€ç¼–å†™çš„åŠ¨æ€åº“","url":"/2022/11/18/Golangè°ƒç”¨Cè¯­è¨€ç¼–å†™çš„åŠ¨æ€åº“/","content":"\n# ç”¨Cè¯­è¨€ç¼–å†™ä¸€ä¸ªåŠ¨æ€åº“\n## ç¼–å†™Cè¯­è¨€å¤´æ–‡ä»¶`sample_so.h`\n\nåœ¨å¤´æ–‡ä»¶ä¸­å£°æ˜å‡½æ•°\n\n```c\nint export_func_add(int a, int b);\n```\n\n## ç¼–å†™å‡½æ•°çš„å®ç°ä»£ç `sample_so.c`\n\nåœ¨æºæ–‡ä»¶ä¸­å®ç°å‡½æ•°\n\n```c\n#include \"sample_so.h\"\n\nint export_func_add(int a, int b)\n{\n  return a + b;\n}\n```\n\n# ç¼–è¯‘ç”ŸæˆåŠ¨æ€é“¾æ¥åº“\n\n```shell\ngcc -c -fPIC -o sample_so.o sample_so.c # å…ˆç”Ÿæˆ.oæ–‡ä»¶\ngcc -shared -o libsample_so.so sample_o.o # å†ç”Ÿæˆ.soæ–‡ä»¶\n```\n\n# golang è°ƒç”¨åŠ¨æ€åº“\n\n## å…ˆç”¨cè¯­è¨€ç¼–å†™ä¸€ä¸ªåŠ¨æ€åº“çš„` è°ƒç”¨ä»£ç†`ï¼ˆåå­—çå–çš„ï¼‰\n\n`loadso.h`\n\n```c\nint call_export_func(int a, int b);\n```\n\n`loadso.c`\n\n```c\n#include \"loadso.h\"\n#include <dlfcn.h>\n\nchar dllname[] = \"/path/of/the/so/sample_so.so\";\n\nint call_export_func(int a, int b) {\n    void* handle;\n    typedef int(*FPTR)(int, int);\n\n    handle = dlopen(dllname, 1);\n    if(handle == 0) {\n        return -1;\n    }\n\n    FPTR fptr = (FPTR)dlsym(handle, \"export_func_add\");\n\n    int result = (*fptr)(a, b);\n    return result;\n}\n```\n\n**æ³¨ï¼šå®é™…ä¸Šå°±æ˜¯æ˜ç¡®äº†åŠ¨æ€åº“ä¸­çš„å‡½æ•°çš„ç­¾ååï¼ˆå°±æ˜¯å‡½æ•°å‚æ•°ç±»å‹ï¼Œå‡½æ•°è¿”å›ç±»å‹ï¼‰ï¼Œç„¶åå®šä¹‰å¯¹åº”çš„å‡½æ•°æŒ‡é’ˆï¼Œæ ¹æ®å‡½æ•°åè·å–åˆ°è¿™ä¸ªå‡½æ•°ï¼Œç”¨å‡½æ•°æŒ‡é’ˆæŒ‡å‘å®ƒï¼Œæ¥ç€å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°æŒ‡é’ˆè°ƒç”¨è¿™ä¸ªå‡½æ•°äº†**\n\n## ç¼–å†™golangä»£ç \n\n```go\npackage main\n\n/*\n#include \"loadso.h\"\n#cgo LDFLAGS: -ldl\n*/\nimport \"C\"\nimport \"fmt\"\n\nfunc main() {\n        var a int = 20\n        var b int = 20\n        fmt.Printf(\"%d + %d = %d\\n\", a, b, C.export_func_add(C.int(a), C.int(b)))\n}\n```\n\n**æ³¨ï¼šçœ‹åˆ°æœ€é¡¶ä¸Šçš„ä»£ç æ³¨é‡Šäº†å—ï¼Ÿè¿™ä¸ªæ³¨é‡Šä¼šè¢«ç¼–è¯‘å™¨è¿›è¡Œè§£æï¼Œä¸æ˜¯ä¸€èˆ¬æ„ä¹‰ä¸Šçš„ä»£ç æ³¨é‡Šï¼Œä¸ªäººæ„Ÿè§‰æŒºå¥‡è‘©çš„ã€‚è¿˜æœ‰ç´§æ¥ç€çš„ä¸€è¡Œ`import \"C\"`, æ³¨æ„è¦ç´§æ¥ç€ï¼Œè¿™ä¹ŸæŒºåäººç±»çš„**\n","tags":["cè¯­è¨€","golang","soåº“","åŠ¨æ€é“¾æ¥åº“"],"categories":["Golang","CGO"]},{"title":"Fabricæºç ç³»åˆ—-003","url":"/2022/11/12/Fabricæºç ç³»åˆ—-003/","content":"\n# `BCCSP`æ¥å£\n\n`BCCSP`æ¥å£å®šä¹‰äº†ä»¥ä¸‹æ–¹æ³•ï¼Œå…¶å®å¯¹å¯†ç å­¦ä¸­çš„å‡½æ•°è¿›è¡Œäº†ä¸€ä¸ªåŠŸèƒ½åˆ†ç±»ï¼š\n\n- `KeyGen`ï¼šå¯†é’¥ç”Ÿæˆï¼ŒåŒ…å«å¯¹ç§°å’Œéå¯¹ç§°åŠ å¯†\n- `KeyDeriv`ï¼šå¯†é’¥æ´¾ç”Ÿ\n- `KeyImport`ï¼šå¯†é’¥å¯¼å…¥ï¼Œä»æ–‡ä»¶ã€å†…å­˜ã€æ•°å­—è¯ä¹¦ä¸­å¯¼å…¥\n- `GetKey`ï¼šè·å–å¯†é’¥\n- `Hash`ï¼šè®¡ç®—æ‘˜è¦\n- `GetHash`ï¼šè·å–æ‘˜è¦è®¡ç®—å®ä¾‹\n- `Sign`ï¼šæ•°å­—ç­¾å\n- `Verify`ï¼šç­¾åéªŒè¯\n- `Encrypt`ï¼šæ•°æ®åŠ å¯†ï¼ŒåŒ…å«å¯¹ç§°å’Œéå¯¹ç§°åŠ å¯†\n- `Decrypt`ï¼šæ•°æ®è§£å¯†ï¼ŒåŒ…å«å¯¹ç§°å’Œéå¯¹ç§°åŠ å¯†\n\n# SW\n\n## CSP\n\n`fabric/bccsp/sw/impl.go`\n\n`CSP`æ˜¯ä¸€ä¸ª`SW WRAPPER`ï¼Œ**è°ƒç”¨`BCCSP`ä¸­å®šä¹‰çš„æ–¹æ³•çš„æ€»çš„å…¥å£å°±æ˜¯`CSP`**, `CSP`åˆ©ç”¨åå°„è°ƒç”¨çœŸæ­£çš„å®ç°\n\n```GO\ntype CSP struct {\n\tks bccsp.KeyStore\n\n\tKeyGenerators map[reflect.Type]KeyGenerator\n\tKeyDerivers   map[reflect.Type]KeyDeriver\n\tKeyImporters  map[reflect.Type]KeyImporter\n\tEncryptors    map[reflect.Type]Encryptor\n\tDecryptors    map[reflect.Type]Decryptor\n\tSigners       map[reflect.Type]Signer\n\tVerifiers     map[reflect.Type]Verifier\n\tHashers       map[reflect.Type]Hasher\n}\n```\n\n**ç»“æ„ä½“å¯ä»¥ä½¿ç”¨åå°„è°ƒç”¨`BCCSP`æ¥å£çš„å…·ä½“å®ç°ï¼Œ`KeyGenerators` ç”Ÿæˆçš„å¦‚æœ`éä¸´æ—¶KEY`ï¼Œå°±ä¼šè¢«ä¿å­˜åœ¨`KeyStore`ä¸­\n\n`SW`ä¸­åŒ…å«äº†`AES`ã€`ECDSA`ã€`HASH(SHA256)`ã€`RSA`, å¯¹åº”äºBCCSPæ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œæœ‰ä»¥ä¸‹å®ç°ï¼š\n\n- `KeyGen:` `fabric/bccsp/sw/keygen.go`\n\n  åŒ…å«äº†`ECDSA`ã€`AES`2ç§å¯†é’¥çš„ç”Ÿæˆ\n\n  - `ecdsaKeyGenerator`\n  - `aesKeyGenerator`\n  \n- `KeyDeriv:` `fabric/bccsp/sw/keyderiv.go`\n\n  åŒ…å«äº†`ECDSA`çš„å…¬é’¥ã€ç§é’¥æ´¾ç”Ÿï¼Œ`AES`çš„ç§é’¥æ´¾ç”Ÿ 3ç§\n  - `ecdsaPublicKeyKeyDeriver`\n  - `ecdsaPrivateKeyKeyDeriver`\n  - `aesPrivateKeyKeyDeriver`\n\n- `KeyImport:` `fabric/bccsp/sw/keyimport.go`\n  åŒ…å«äº†:\n  \n  - `aes256ImportKeyOptsKeyImporter`\n  - `hmacImportKeyOptsKeyImporter`\n  - `ecdsaPKIXPublicKeyImportOptsKeyImporter`\n  - `ecdsaPrivateKeyImportOptsKeyImporter`\n  - `ecdsaGoPublicKeyImportOptsKeyImporter`\n  - `x509PublicKeyImportOptsKeyImporter`\n\n- `GetKey:` `KeyStore`çš„`GetKey`çš„è°ƒç”¨ï¼Œè¿™é‡Œæ²¡æœ‰åå°„è°ƒç”¨\n\n- `Hash:` `fabric/bccsp/sw/hash.go`\n  - `hasher `ç»“æ„ä½“å®ç°äº†`Hash`æ–¹æ³•\n- `GetHash:` `fabric/bccsp/sw/hash.go`\n  - `hasher `ç»“æ„ä½“å®ç°äº†`GetHash`æ–¹æ³•\n\n- `Sign:` `fabric/bccsp/sw/ecdsa.go`\n  - `ecdsaSigner`ç»“æ„ä½“å®ç°äº†æ­¤æ–¹æ³•ï¼Œåœ¨`fabric 1.4`ç‰ˆä¸­å¥½åƒ`rsaSigner`ç»“æ„ä½“ä¹Ÿå®ç°äº†æ­¤æ–¹æ³•\n\n- `Verify:` `fabric/bccsp/sw/ecdsa.go`\n  - `ecdsaPrivateKeyVerifier` ç»“æ„ä½“ä¸­å®ç°äº†æ­¤æ–¹æ³•\n  - `ecdsaPublicKeyKeyVerifier`ç»“æ„ä½“ä¸­å®ç°äº†æ­¤æ–¹æ³•\n\n- `Encrypt:` `fabric/bccsp/sw/aes.go`\n  - `aescbcpkcs7Encryptor` ç»“æ„ä½“\n- `Decrypt:` `fabric/bccsp/sw/aes.go`\n  - `aescbcpkcs7Encryptor` ç»“æ„ä½“\n","tags":["sw","è½¯å®ç°"],"categories":["åŒºå—é“¾","Fabric"]},{"title":"Fabricæºç ç³»åˆ—-002","url":"/2022/11/12/Fabricæºç ç³»åˆ—-002/","content":"\n# BCCSP æ¥å£\n\n**ä»¥ä¸‹å†…å®¹ä»[å¤ªå½¬å¹´ä¹…å¤±ä¿®çš„åšå®¢](https://lessisbetter.site/)ç›—ç‰ˆè€Œæ¥**\n\n`BCCSP`æ˜¯`Block Chain Crypto Service Provider`çš„ç¼©å†™ã€‚åœ¨Fabricä¸­ï¼ŒBCCSPè¢«æŠ½è±¡æˆä¸ºä¸€ä¸ªæ¥å£ã€‚\n\n`bccsp`æ¨¡å—æä¾›å¯†ç å­¦æœåŠ¡ï¼Œå®ƒåŒ…å«çš„å…·ä½“åŠŸèƒ½æœ‰ï¼šå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†çš„å¯†é’¥ç”Ÿæˆã€å¯¼å…¥ã€å¯¼å‡ºï¼Œæ•°å­—ç­¾åå’ŒéªŒè¯ï¼Œå¯¹ç§°åŠ å¯†å’Œè§£å¯†ã€æ‘˜è¦è®¡ç®—ã€‚\n\n`bccsp`ä½¿ç”¨äº†ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependence Inversion Principleï¼‰ï¼šä¾èµ–æŠ½è±¡è€Œä¸ä¾èµ–å…·ä½“å®ç°ï¼Œè¿™æ ·çš„å¥½å¤„å°±æ˜¯å¯ä»¥æŠŠå…·ä½“çš„å¯†ç å­¦å®ç°ï¼ˆå®ç°BCCSPæ¥å£ï¼‰å½“æˆæ’ä»¶è¿›è¡Œä½¿ç”¨ã€‚\n\nbccspæ¨¡å—ä¸­å½“å‰æœ‰2ç§å¯†ç å®ç°ï¼Œå®ƒä»¬éƒ½æ˜¯bccspä¸­çš„å¯†ç å­¦æ’ä»¶ï¼š`SW`å’Œ`PKCS11`ï¼Œ`SW`ä»£è¡¨çš„æ˜¯å›½é™…æ ‡å‡†åŠ å¯†çš„è½¯å®ç°ï¼Œ`SW`æ˜¯`software`çš„ç¼©å†™ï¼Œ`PKCS11`ä»£æŒ‡ç¡¬å®ç°ã€‚\n\n![BCCSP.png](https://s2.loli.net/2022/11/12/SYeZ7wR48ajJUGh.png)\n\n> æ‰©å±•é˜…è¯»ï¼š\n>\n> PKCS11æ˜¯PKCSç³»åˆ—æ ‡å‡†ä¸­çš„ç¬¬11ä¸ªï¼Œå®ƒå®šä¹‰äº†åº”ç”¨å±‚å’Œåº•å±‚åŠ å¯†è®¾å¤‡çš„äº¤äº’æ ‡å‡†ï¼Œæ¯”å¦‚è¿‡å»åœ¨ç”µè„‘ä¸Šï¼Œ\n> æ’å…¥USBKeyç”¨ç½‘é“¶è½¬è´¦æ—¶ï¼Œå°±éœ€è¦èµ°USBKeyä¸­çš„ç¡¬ä»¶è¿›è¡Œæ•°å­—ç­¾åï¼Œè¿™ä¸ªè¿‡ç¨‹å°±éœ€è¦ä½¿ç”¨PCKS11ã€‚\n\nå¯†ç å­¦é€šå¸¸æœ‰è½¯å®ç°å’Œç¡¬å®ç°ï¼Œè½¯å®ç°å°±æ˜¯å¸¸ç”¨çš„å„ç§åŠ å¯†åº“ï¼Œæ¯”å¦‚Goä¸­`crypto`åŒ…ï¼Œç¡¬å®ç°æ˜¯ä½¿ç”¨åŠ å¯†æœºæä¾›çš„ä¸€å¥—åŠ å¯†æœåŠ¡ã€‚è½¯å®ç°å’Œç¡¬å®ç°çš„é‡è¦åŒºåˆ«æ˜¯ï¼Œå¯†ç ç®—æ³•çš„å®‰å…¨æ€§å¼ºä¾èµ–éšæœºæ•°ï¼Œè½¯å®ç°åˆ©ç”¨çš„æ˜¯OSçš„ä¼ªéšæœºæ•°ï¼Œè€Œç¡¬å®ç°åˆ©ç”¨çš„æ˜¯åŠ å¯†æœºç”Ÿæˆçš„éšæœºæ•°ï¼Œæ‰€ä»¥ç¡¬å®ç°çš„å®‰å…¨å¼ºåº¦è¦é«˜äºè½¯å®ç°ã€‚\n\n## SWä»‹ç»\n\nSWæ˜¯å›½é™…æ ‡å‡†åŠ å¯†çš„è½¯å®ç°æ’ä»¶ï¼Œå®ƒåŒ…å«äº†ECDSAç®—æ³•ã€RSAç®—æ³•ã€AESç®—æ³•ï¼Œä»¥åŠSHAç³»åˆ—çš„æ‘˜è¦ç®—æ³•ã€‚\n\n`BCCSP`æ¥å£å®šä¹‰äº†ä»¥ä¸‹æ–¹æ³•ï¼Œå…¶å®å¯¹å¯†ç å­¦ä¸­çš„å‡½æ•°è¿›è¡Œäº†ä¸€ä¸ªåŠŸèƒ½åˆ†ç±»ï¼š\n\n- `KeyGen`ï¼šå¯†é’¥ç”Ÿæˆï¼ŒåŒ…å«å¯¹ç§°å’Œéå¯¹ç§°åŠ å¯†\n- `KeyDeriv`ï¼šå¯†é’¥æ´¾ç”Ÿ\n- `KeyImport`ï¼šå¯†é’¥å¯¼å…¥ï¼Œä»æ–‡ä»¶ã€å†…å­˜ã€æ•°å­—è¯ä¹¦ä¸­å¯¼å…¥\n- `GetKey`ï¼šè·å–å¯†é’¥\n- `Hash`ï¼šè®¡ç®—æ‘˜è¦\n- `GetHash`ï¼šè·å–æ‘˜è¦è®¡ç®—å®ä¾‹\n- `Sign`ï¼šæ•°å­—ç­¾å\n- `Verify`ï¼šç­¾åéªŒè¯\n- `Encrypt`ï¼šæ•°æ®åŠ å¯†ï¼ŒåŒ…å«å¯¹ç§°å’Œéå¯¹ç§°åŠ å¯†\n- `Decrypt`ï¼šæ•°æ®è§£å¯†ï¼ŒåŒ…å«å¯¹ç§°å’Œéå¯¹ç§°åŠ å¯†\n\n```go\n// BCCSP is the blockchain cryptographic service provider that offers\n// the implementation of cryptographic standards and algorithms.\ntype BCCSP interface {\n\n\t// KeyGen generates a key using opts.\n\tKeyGen(opts KeyGenOpts) (k Key, err error)\n\n\t// KeyDeriv derives a key from k using opts.\n\t// The opts argument should be appropriate for the primitive used.\n\tKeyDeriv(k Key, opts KeyDerivOpts) (dk Key, err error)\n\n\t// KeyImport imports a key from its raw representation using opts.\n\t// The opts argument should be appropriate for the primitive used.\n\tKeyImport(raw interface{}, opts KeyImportOpts) (k Key, err error)\n\n\t// GetKey returns the key this CSP associates to\n\t// the Subject Key Identifier ski.\n\tGetKey(ski []byte) (k Key, err error)\n\n\t// Hash hashes messages msg using options opts.\n\t// If opts is nil, the default hash function will be used.\n\tHash(msg []byte, opts HashOpts) (hash []byte, err error)\n\n\t// GetHash returns and instance of hash.Hash using options opts.\n\t// If opts is nil, the default hash function will be returned.\n\tGetHash(opts HashOpts) (h hash.Hash, err error)\n\n\t// Sign signs digest using key k.\n\t// The opts argument should be appropriate for the algorithm used.\n\t//\n\t// Note that when a signature of a hash of a larger message is needed,\n\t// the caller is responsible for hashing the larger message and passing\n\t// the hash (as digest).\n\tSign(k Key, digest []byte, opts SignerOpts) (signature []byte, err error)\n\n\t// Verify verifies signature against key k and digest\n\t// The opts argument should be appropriate for the algorithm used.\n\tVerify(k Key, signature, digest []byte, opts SignerOpts) (valid bool, err error)\n\n\t// Encrypt encrypts plaintext using key k.\n\t// The opts argument should be appropriate for the algorithm used.\n\tEncrypt(k Key, plaintext []byte, opts EncrypterOpts) (ciphertext []byte, err error)\n\n\t// Decrypt decrypts ciphertext using key k.\n\t// The opts argument should be appropriate for the algorithm used.\n\tDecrypt(k Key, ciphertext []byte, opts DecrypterOpts) (plaintext []byte, err error)\n}\n```\n\n\n\n## å¯æ’æ‹”å›½å¯†\n\nFabricæ”¯æŒå›½å¯†å¹¶éä»…ä»…åœ¨bccspä¸­å¢åŠ 1ä¸ªå›½å¯†å®ç°è¿™ä¹ˆç®€å•ï¼Œè¿˜éœ€è¦è®©æ•°å­—è¯ä¹¦æ”¯æŒå›½å¯†ï¼Œè®©æ•°å­—è¯ä¹¦çš„æ“ä½œç¬¦åˆX.509ã€‚å„è¯­è¨€çš„æ ‡å‡†åº“`x509`éƒ½æ˜¯é€‚é…æ ‡å‡†åŠ å¯†çš„ï¼Œå¹¶ä¸èƒ½ç›´æ¥ç”¨æ¥æ“ä½œå›½å¯†è¯ä¹¦ã€‚\n\nåœ¨æ•°å­—è¯ä¹¦æ”¯æŒå›½å¯†åï¼Œè¿˜å¯èƒ½éœ€è¦è¿›ä¸€æ­¥è€ƒè™‘ï¼Œæ˜¯å¦éœ€è¦TLSè¯ä¹¦ä½¿ç”¨å›½å¯†æ•°å­—è¯ä¹¦ï¼Œè®©é€šä¿¡è¿‡ç¨‹ä½¿ç”¨å›½å¯†ç®—æ³•ã€‚\n\nå¦å¤–ï¼Œå›½å¯†çš„å®ç°æœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œå¦‚æœéœ€è¦é€‚é…ä¸åŒçš„å›½å¯†å®ç°ï¼Œå°±éœ€è¦ä¿è¯å›½å¯†çš„å¯æ’æ‹”å’Œå¯æ‰©å±•ã€‚\n","tags":["BCCSP","SW","PKCS11","ä¾èµ–å€’ç½®åŸåˆ™","å¯†ç å­¦æ’ä»¶","Plugin"],"categories":["åŒºå—é“¾","Fabric"]},{"title":"Fabricæºç ç³»åˆ—-001","url":"/2022/11/11/Fabricæºç ç³»åˆ—-001/","content":"\n# æºç æ€»ç›®å½•ç»“æ„\n\n|  ç›®å½•å   | è¯´æ˜  |\n|  ----  | ----  |\n| bccsp | å…¨ç§°æ˜¯åŒºå—é“¾å¯†ç æœåŠ¡æä¾›è€…ï¼Œç”¨æ¥æä¾›åŒºå—é“¾ç›¸å…³çš„ç®—æ³•æ ‡å‡†å’Œä»–ä»¬çš„å®ç° |\n| ccaas_builder  | ç¼–è¯‘ç›¸å…³ |\n| ci  | æŒç»­é›†æˆ(CI)ç›¸å…³é…ç½®å’Œè„šæœ¬ |\n| cmd | å‘½ä»¤è¡Œæ“ä½œç›¸å…³å…¥å£ä»£ç  | \n| common  | ä¸€äº›å…¬å…±åº“ï¼ˆé”™è¯¯å¤„ç†ã€æ—¥å¿—å¤„ç†ã€è´¦æœ¬å­˜å‚¨ã€ç­–ç•¥ä»¥åŠå„ç§å·¥å…·ç­‰ç­‰ï¼‰ | \n| core | æ ¸å¿ƒåº“ï¼Œç»„ä»¶çš„æ ¸å¿ƒé€»è¾‘ï¼Œé’ˆå¯¹æ¯ä¸€ä¸ªç»„ä»¶éƒ½æœ‰ä¸€ä¸ªå­ç›®å½•ï¼ˆchaincode:ä¸æ™ºèƒ½åˆçº¦ç›¸å…³);(endorser:ä¸èƒŒä¹¦èŠ‚ç‚¹ç›¸å…³ï¼‰|\n| discovery | æœåŠ¡å‘ç°æ¨¡å—ç›¸å…³ä»£ç  |\n| docs | æ–‡æ¡£ç›¸å…³ |\n| gossip | ç»„ç»‡å†…éƒ¨èŠ‚ç‚¹æ•°æ®åŒæ­¥çš„é€šä¿¡åè®®ï¼Œæœ€ç»ˆä¸€è‡´æ€§ç®—æ³•ï¼Œç”¨äºç»„ç»‡å†…éƒ¨æ•°æ®åŒæ­¥ |\n| images | Dockeré•œåƒæ‰“åŒ…ï¼ŒDockeré•œåƒéƒ½æ˜¯é€šè¿‡è¿™ä¸ªç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ç”Ÿæˆçš„ |\n| integration | å¾…è¿ç§»ä»£ç  |\n| internal | å†…éƒ¨ä»£ç ï¼Œè¢«cmdåŒ…ç­‰è°ƒç”¨ |\n| msp | æˆå‘˜æœåŠ¡ç®¡ç†ï¼ˆmember service providerï¼‰ï¼Œåœ¨Fabricç½‘ç»œä¸­ä¼šä¸ºæ¯ä¸€ä¸ªæˆå‘˜æä¾›ç›¸åº”çš„è¯ä¹¦ï¼Œmspæ¨¡å—å°±æ˜¯è¯»å–è¿™äº›è¯ä¹¦å¹¶åšä¸€äº›ç›¸åº”çš„å¤„ç† |\n| orderer | æ’åºèŠ‚ç‚¹çš„å…¥å£ï¼Œç”¨äºæ¶ˆæ¯çš„è®¢é˜…ä¸åˆ†å‘å¤„ç† |\n| pkg | é‡å†™æˆ–å®ç°äº†ä¸€äº›golangåŸç”Ÿæ¥å£ |\n| protoutil | Proposalææ¡ˆç›¸å…³çš„å·¥å…·åŒ… |\n| release_notes | å‘å¸ƒç¬”è®° |\n| sampleconfig | é…ç½®ç¤ºä¾‹ |\n| scripts | è„šæœ¬ï¼ŒåŒ…å«å¯åŠ¨è„šæœ¬ã€æ£€æŸ¥è„šæœ¬ç­‰ |\n| swagger | swaggeræ–‡æ¡£ç”Ÿæˆé…ç½® |\n| tools | å·¥å…·åŒ…ï¼Œç›®å‰è¿˜æ˜¯ç©ºçš„ï¼ˆrelease-2.4åˆ†æ”¯ï¼‰|\n| vagrant | åŒ…å«äº†ç”¨ Vagrant å»ºç«‹ä¸€ä¸ªç®€å•çš„å¼€å‘ç¯å¢ƒæ‰€å¿…éœ€çš„è„šæœ¬ |\n| vendor | å­˜æ”¾Goä¸­ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åŒ… |\n\n\n# æ¨¡å—åˆ†ç±»\n## æ ¸å¿ƒæ¨¡å—\n\næä¾›æ ¸å¿ƒåŠŸèƒ½æœåŠ¡çš„ä»£ç ï¼ŒåŒ…æ‹¬`core`ã€`orderer`ä¸¤ä¸ªä»£ç åŒ…ï¼Œè¿™ä¸¤ä¸ªä»£ç åŒ…æ¶µç›–äº†Orderderæ’åºèŠ‚ç‚¹ä¸PeerèŠ‚ç‚¹ï¼ˆåŒ…å«EndorserèƒŒä¹¦èŠ‚ç‚¹ä¸Committerè®°å¸èŠ‚ç‚¹ï¼‰çš„æ ¸å¿ƒä»£ç \n\n## å…¬å…±æ¨¡å—\n\nä¸ºæ ¸å¿ƒæ¨¡å—å’Œå…¶å®ƒæ¨¡å—æä¾›åŸºç¡€æ”¯æŒæœåŠ¡ï¼ŒåŒ…æ‹¬`bccsp` `common` `gossip` `msp` `protoutil`ç­‰ç›®å½•ä»£ç ã€‚å…¶ä¸­`gossip`æ¶ˆæ¯æ¨¡å—ä¸º`peer`èŠ‚ç‚¹æä¾›å®‰å…¨ã€å¯é ã€å¯æ‰©å±•çš„P2Pæ•°æ®åˆ†å‘åä¹‰ã€‚`commom`å…¬å…±åŠŸèƒ½æ¨¡å—åŒ…æ‹¬å¸æœ¬æ•°æ®å­˜å‚¨æ¨¡å—ã€å®‰å…¨æœåŠ¡æ¨¡å—ã€é€šé“é…ç½®ç­‰ï¼Œä¸ºå…¶å®ƒæ¨¡å—æä¾›åº•å±‚å­˜å‚¨æœºåˆ¶ã€å®‰å…¨æœºåˆ¶ã€å¼‚æ­¥é€šä¿¡æœºåˆ¶ç­‰ã€‚\n\n## è¾…åŠ©æ¨¡å—\n\nä¸ºå…¶å®ƒæ¨¡å—æä¾›è¾…åŠ©å·¥å…·ã€è¿è¡Œç¯å¢ƒã€æµ‹è¯•ç”¨ä¾‹ã€æ–‡æ¡£ç­‰ï¼ŒåŒ…æ‹¬`ccaas_builder` `ci` `docs` `release_notes` `swagger`ç­‰\n\n","tags":["fabric","æºç "],"categories":["åŒºå—é“¾","Fabric"]},{"title":"Fabric-é€šè¿‡samplesäº†è§£fabricï¼ˆä¸‰ï¼‰","url":"/2022/11/07/Fabric-é€šè¿‡samplesäº†è§£fabricï¼ˆä¸‰ï¼‰/","content":"\n**æ³¨ï¼šä»¥ä¸‹å‘½ä»¤åœ¨`test-network`ç›®å½•ä¸‹æ‰§è¡Œ**\n```shell\nexport PATH=${PWD}/../bin:$PATH         # peer å‘½ä»¤æ‰€åœ¨ç›®å½•\nexport FABRIC_CFG_PATH=$PWD/../config/  # `core.yaml` é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•\n```\n\n# éƒ¨ç½²`wasmcc`\n```shell\n./network.sh deployCC -ccn wasmcc -ccp /Users/mao/work/wasm/opensource/hyperledger/fabric-chaincode-wasm/wasmcc -ccv 1.0 -ccl go\n```\n\n\n# è°ƒç”¨`wasmcc`éƒ¨ç½²`wasm chaincode`\n\né¦–å…ˆå‡†å¤‡å¥½ä¸€ä¸ªwasmæ–‡ä»¶ï¼Œä½¿ç”¨å·¥å…·æŠŠwasmæ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®è½¬æˆåå…­è¿›åˆ¶è¡¨ç¤ºï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œ\nç„¶åé€šè¿‡ä»¥ä¸‹å‘½ä»¤éƒ¨ç½®è¿™ä¸ª`wasm chaincode`,**æ³¨ï¼šå‘½ä»¤ä¸­çš„`wasmäºŒè¿›åˆ¶æ•°æ®çš„åå…­è¿›åˆ¶è¡¨ç¤ºå­—ç¬¦ä¸²`éœ€è¦æŒ‰å®é™…çš„æ•°æ®è¿›è¡Œæ›¿æ¢ã€‚è¿™ä¸ªæŠŠwasmå­—èŠ‚ç è½¬ä¸ºåå…­è¿›åˆ¶è¡¨ç¤ºï¼ˆå­—ç¬¦ä¸²ï¼‰çš„å·¥å…·æ˜¯[file-encoder](https://github.com/hyperledger-labs/fabric-chaincode-wasm/tree/main/tools/file-encoder)\n\n```shell\npeer chaincode invoke -o localhost:7050 --tls true --cafile ${PWD}/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n wasmcc --peerAddresses localhost:7051 --tlsRootCertFiles ${PWD}/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles ${PWD}/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c '{\"Args\":[\"create\",\"balancewasm\",\"wasmäºŒè¿›åˆ¶æ•°æ®çš„åå…­è¿›åˆ¶è¡¨ç¤ºå­—ç¬¦ä¸²\",\"account1\",\"100\",\"account2\",\"1000\"]}'\n```\n\n# è°ƒç”¨å‘½ä»¤æŸ¥çœ‹ç›®å‰å·²éƒ¨ç½²çš„`wasm chaincode`\n```shell\npeer chaincode query -C mychannel -n wasmcc -c '{\"Args\":[\"installedChaincodes\"]}'\n```\n\n# é€šè¿‡`wasmcc`æŸ¥è¯¢`wasm chaincode`ä¸­çš„`account1`çš„ä½™é¢\n```shell\npeer chaincode query -C mychannel -n wasmcc -c '{\"Args\":[\"execute\",\"balancewasm\",\"query\",\"account1\"]}'\n```\n\n\n# é€šè¿‡`wasmcc`è°ƒç”¨`wasm chaincode`ä¸­çš„å‡½æ•°`invoke`\n```shell\npeer chaincode invoke -o localhost:7050 --tls true --cafile ${PWD}/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n wasmcc --peerAddresses localhost:7051 --tlsRootCertFiles ${PWD}/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles ${PWD}/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c '{\"Args\":[\"execute\",\"balancewasm\",\"invoke\",\"account2\",\"account1\",\"10\"]}'\n``` \n\n# é€šè¿‡å·¥å…·`WASM Pusher`å®‰è£…`wasm chaincode`\n`wasmcc`æ”¯æŒ3ç§æ ¼å¼æ–‡ä»¶çš„å®‰è£…ï¼Œ`.wasm`æ ¼å¼ã€`.zip`æ ¼å¼ã€`wasm`å­—èŠ‚`åå…­è¿›åˆ¶è¡¨ç¤º`çš„å­—ç¬¦ä¸²å†…å®¹ã€‚\nä½¿ç”¨å‘½ä»¤å¦‚ä¸‹ï¼š\n```shell\n./wasm-pusher -n balancewasm -w ../../sample-wasm-chaincode/chaincode_example02/rust/app_main.wasm -u User1 -a a,100,b,100\n```\n`WASM Pusher`[è¯¦è§](https://github.com/hyperledger-labs/fabric-chaincode-wasm/tree/main/tools/wasm-pusher)\n\n","tags":["wasmcc","wasm chaincode","file-encoder","wasm pusher"],"categories":["åŒºå—é“¾","Fabric"]},{"title":"Fabric-é€šè¿‡samplesäº†è§£fabricï¼ˆäºŒï¼‰","url":"/2022/11/04/Fabric-é€šè¿‡samplesäº†è§£fabricï¼ˆäºŒï¼‰/","content":"\n# network.sh è„šæœ¬å‘½ä»¤\n\n```shell\n./network.sh help\nUsing docker and docker-compose\nUsage:\n  network.sh <Mode> [Flags]\n    Modes:\n      up - Bring up Fabric orderer and peer nodes. No channel is created\n      up createChannel - Bring up fabric network with one channel\n      createChannel - Create and join a channel after the network is created\n      deployCC - Deploy a chaincode to a channel (defaults to asset-transfer-basic)\n      down - Bring down the network\n\n    Flags:\n    Used with network.sh up, network.sh createChannel:\n    -ca <use CAs> -  Use Certificate Authorities to generate network crypto material\n    -c <channel name> - Name of channel to create (defaults to \"mychannel\")\n    -s <dbtype> - Peer state database to deploy: goleveldb (default) or couchdb\n    -r <max retry> - CLI times out after certain number of attempts (defaults to 5)\n    -d <delay> - CLI delays for a certain number of seconds (defaults to 3)\n    -verbose - Verbose mode\n\n    Used with network.sh deployCC\n    -c <channel name> - Name of channel to deploy chaincode to\n    -ccn <name> - Chaincode name.\n    -ccl <language> - Programming language of the chaincode to deploy: go, java, javascript, typescript\n    -ccv <version>  - Chaincode version. 1.0 (default), v2, version3.x, etc\n    -ccs <sequence>  - Chaincode definition sequence. Must be an integer, 1 (default), 2, 3, etc\n    -ccp <path>  - File path to the chaincode.\n    -ccep <policy>  - (Optional) Chaincode endorsement policy using signature policy syntax. The default policy requires an endorsement from Org1 and Org2\n    -cccg <collection-config>  - (Optional) File path to private data collections configuration file\n    -cci <fcn name>  - (Optional) Name of chaincode initialization function. When a function is provided, the execution of init will be requested and the function will be invoked.\n\n    -h - Print this message\n\n Possible Mode and flag combinations\n   up -ca -r -d -s -verbose\n   up createChannel -ca -c -r -d -s -verbose\n   createChannel -c -r -d -verbose\n   deployCC -ccn -ccl -ccv -ccs -ccp -cci -r -d -verbose\n\n Examples:\n   network.sh up createChannel -ca -c mychannel -s couchdb\n   network.sh createChannel -c channelName\n   network.sh deployCC -ccn basic -ccp ../asset-transfer-basic/chaincode-javascript/ -ccl javascript\n   network.sh deployCC -ccn mychaincode -ccp ./user/mychaincode -ccv 1 -ccl javascript\n```\n\n## æ¸…é™¤æµ‹è¯•ç½‘ä¸­çš„æ‰€æœ‰å®¹å™¨\n\n```shell\n./network.sh down\n```\n\n## å¯åŠ¨æµ‹è¯•ç½‘\n\n```shell\n./network.sh up\n```\n\n## åˆ›å»ºé€šé“\n\n```shell\n./network.sh createChannel    # ä¸æŒ‡å®šé€šé“åï¼Œé€šé“åé»˜è®¤ä¸ºmychannel\n./network.sh createChannel -c channel1 # æŒ‡å®šé€šé“å channel1\n```\n\n## å®‰è£…é“¾ç \n\n```shell\n./network.sh deployCC -ccn basic -ccp ../asset-transfer-basic/chaincode-go -ccl go\n```\n\n- `-ccn`æŒ‡å®šé“¾ç åç§° `chain code name`\n- `-ccl` æŒ‡å®šç¼–å†™é“¾ç çš„è¯­è¨€ `chain code language`\n- `-ccp` æŒ‡å®šé“¾ç æ‰€åœ¨çš„ç›®å½• `chain code path`\n- å…¶ä½™çš„æŸ¥çœ‹ `./network.sh help`\n\nè¿™ä¸€æ­¥åœ¨linuxä¸‹ï¼Œæ¯”å¦‚ubuntu,æˆ‘å½“æ—¶è®¾ç½®äº†goproxyæ˜¯åœ¨`~/.zshrc` å’Œ`/etc/profile`ä¸­è®¾ç½®çš„ï¼Œæ²¡æœ‰åœ¨`/etc/bash.bashrc`ä¸­è®¾ç½®(è¿™é‡Œè®¾ç½®çš„ç¯å¢ƒå˜é‡å¯¹æ‰€æœ‰ç”¨æˆ·æœ‰æ•ˆ)ï¼Œå› ä¸ºæ˜¯ä½¿ç”¨`sudo`æ¥è·‘å‘½ä»¤,æ‰€ä»¥åœ¨`~/.zshrc` å’Œ`/etc/profile`ä¸­è®¾ç½®çš„åœ¨ç»ˆç«¯é‡Œé¢`go env`æŸ¥çœ‹æ˜¯æ­£å¸¸çš„ï¼Œä½†å®‰è£…é“¾ç çš„å‘½ä»¤æ‰§è¡Œæ—¶è¿˜æ˜¯ä¸‹è½½ä¾èµ–è¶…æ—¶ï¼Œå› ä¸ºæ ¹æœ¬æ²¡æœ‰ä½¿ç”¨`goproxy`ã€‚\n\nè¿˜æœ‰åŠ `sudo`åæ‰¾ä¸åˆ°`go`çš„å‘,éœ€è¦åœ¨`~/.zshrc`ä¸­æ·»åŠ \n\n```PLAINTEXT\nalias sudo='sudo env PATH=$PATH LD_LIBRARY_PATH=$LD_LIBRARY_PATH'\n```\n\n## ä¸fabricç½‘ç»œäº¤äº’\n\n**ç¡®ä¿å½“å‰æ˜¯åœ¨`test-network`ç›®å½•**\n\n```shell\nexport PATH=${PWD}/../bin:$PATH\n```\n\næ·»åŠ è¿™ä¸ªç¯å¢ƒå˜é‡æ˜¯ä¸ºäº†ä¸‹é¢è°ƒç”¨`peer`å‘½ä»¤ç³»ç»Ÿèƒ½æ‰¾åˆ°`peer`æŒ‡ä»¤ï¼Œé™¤äº†`peer`æŒ‡ä»¤ï¼Œè¿˜æœ‰å…¶å®ƒä¸€äº›æŒ‡ä»¤ï¼Œå¦‚ä¸‹ï¼š\n\n```shell\n-rwxr-xr-x@ 1 mao  staff    15M Oct 26 23:58 configtxgen\n-rwxr-xr-x@ 1 mao  staff    14M Oct 26 23:58 configtxlator\n-rwxr-xr-x@ 1 mao  staff    11M Oct 26 23:58 cryptogen\n-rwxr-xr-x@ 1 mao  staff    16M Oct 26 23:58 discover\n-rwxr-xr-x@ 1 mao  staff    26M Jul  8 17:32 fabric-ca-client\n-rwxr-xr-x@ 1 mao  staff    32M Jul  8 17:33 fabric-ca-server\n-rwxr-xr-x@ 1 mao  staff    16M Oct 26 23:58 ledgerutil\n-rwxr-xr-x@ 1 mao  staff    26M Oct 26 23:58 orderer\n-rwxr-xr-x@ 1 mao  staff    12M Oct 26 23:58 osnadmin\n-rwxr-xr-x@ 1 mao  staff    33M Oct 26 23:58 peer\n```\n\nè¿˜éœ€è¦å°†`fabric-samples`ä»£ç åº“ä¸­çš„`FABRIC_CFG_PATH`è®¾ç½®ä¸ºæŒ‡å‘å…¶ä¸­çš„`core.yaml`æ–‡ä»¶ï¼š\n\n```shell\nexport FABRIC_CFG_PATH=$PWD/../config/\n```\n\nç°åœ¨ï¼Œå¯ä»¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä»¥å…è®¸ä½œä¸ºOrg1æ“ä½œ`peer` CLIï¼š\n\n```shell\n# Environment variables for Org1\n\nexport CORE_PEER_TLS_ENABLED=true\nexport CORE_PEER_LOCALMSPID=\"Org1MSP\"\nexport CORE_PEER_TLS_ROOTCERT_FILE=${PWD}/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt\nexport CORE_PEER_MSPCONFIGPATH=${PWD}/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp\nexport CORE_PEER_ADDRESS=localhost:7051\n```\n\n`CORE_PEER_TLS_ROOTCERT_FILE`å’Œ`CORE_PEER_MSPCONFIGPATH`ç¯å¢ƒå˜é‡æŒ‡å‘Org1çš„`organizations`æ–‡ä»¶å¤¹ä¸­çš„çš„åŠ å¯†ææ–™ã€‚ å¦‚æœæ‚¨ä½¿ç”¨ `./network.sh deployCC -ccl go` å®‰è£…å’Œå¯åŠ¨ asset-transfer (basic) é“¾ç ï¼Œæ‚¨å¯ä»¥è°ƒç”¨é“¾ç ï¼ˆGoï¼‰çš„ `InitLedger` æ–¹æ³•æ¥èµ‹äºˆä¸€äº›è´¦æœ¬ä¸Šçš„åˆå§‹èµ„äº§ï¼ˆå¦‚æœä½¿ç”¨ typescript æˆ–è€… javascriptï¼Œä¾‹å¦‚ `./network.sh deployCC -l javascript`ï¼Œä½ ä¼šè°ƒç”¨ç›¸å…³é“¾ç çš„ `initLedger` åŠŸèƒ½ï¼‰ã€‚ è¿è¡Œä»¥ä¸‹å‘½ä»¤ç”¨ä¸€äº›èµ„äº§æ¥åˆå§‹åŒ–è´¦æœ¬ï¼š\n\n### è°ƒç”¨é“¾ç å‡½æ•°`InitLedger`\n\n```shell\npeer chaincode invoke -o localhost:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile ${PWD}/organizations/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n basic --peerAddresses localhost:7051 --tlsRootCertFiles ${PWD}/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles ${PWD}/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c '{\"function\":\"InitLedger\",\"Args\":[]}'\n```\n\n**Mac M1**ä¸­è¯•éªŒæœ‰å¾ˆå¤šå‘ï¼Œæœ‰è¯´goç‰ˆæœ¬è¦1.13ï¼Œæœ‰è¯´æ˜¯Macä¸­çš„Docker Desktopçš„é”…ï¼Œå‡†å¤‡å†æä¸ª**Linuxç¯å¢ƒ**æ¥ç©äº†\n\n### æŸ¥è¯¢\n\n```shell\npeer chaincode query -C mychannel -n basic -c '{\"Args\":[\"GetAllAssets\"]}'\n```\n\n","tags":["up","down","creatChannel","up createChannel","deployCC"],"categories":["åŒºå—é“¾","Fabric"]},{"title":"Fabric-ç¼–è¯‘rustæºç ä¸ºwasm","url":"/2022/11/04/Fabric-ç¼–è¯‘rustæºç ä¸ºwasm/","content":"\n# ç¼–è¯‘rustæºç ä¸ºwasm\n\n## å®‰è£…å·¥å…·é“¾\n\nå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤æ¡å‘½ä»¤ï¼š\n\n```shell\ncurl https://sh.rustup.rs -sSf | sh\ncurl https://rustwasm.github.io/wasm-pack/installer/init.sh -sSf | sh\n```\n\nä¹Ÿå¯ä»¥å‚è€ƒ[å®˜æ–¹å®‰è£…å‘å¯¼](https://rustwasm.github.io/book/game-of-life/setup.html)\n\n## åˆ›å»º`rust` `lib`å·¥ç¨‹\n\n```shell\ncargo new hello_world --lib\n```\n\nç”Ÿæˆçš„`Cargo.toml`å†…å®¹ä¸ºï¼š\n\n```toml\n[package]\nname = \"hello_world\"\nversion = \"0.1.0\"\nedition = \"2021\"\n\n# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html\n\n[dependencies]\n\n```\n\næ·»åŠ ä¸€äº›å†…å®¹åˆ°`Cargo.toml`ä¸­å»\n\n```toml\n[lib]\ncrate-type = [\"cdylib\"]\n\n[dependencies]\nwasm-bindgen = \"0.2\"\n```\n\nä»£ç ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š\n\n```\n.\nâ”œâ”€â”€ Cargo.toml\nâ””â”€â”€ src\n   â””â”€â”€ lib.rs\n```\n\nåœ¨`lib.rs`ä¸­ç¼–å†™`rust`ä»£ç å®ç°å‡½æ•°ï¼Œå› ä¸ºåœ¨wasmccçš„ç‰¹æ®Šæ€§ï¼Œè¿™é‡Œçš„ç¼–å†™çš„ä»£ç ä¹Ÿå…·æœ‰ä¸€äº›ç‰¹æ®Šæ€§ï¼š\n\n- å¯ä»¥å¯¼å…¥è°ƒç”¨åœ¨wasmccä¸­å®ç°çš„å‡½æ•°\n\n  ```rust\n  extern \"C\" {\n      fn __print(msg: *const u8, len: usize) -> i64;\n      fn __get_parameter(paramNumber: usize, result: *const u8) -> i64;\n      fn __get_parameter_size(paramNumber: usize) -> i64;\n      fn __get_state(msg: *const u8, len: usize, value: *const u8) -> i64;\n      fn __get_state_size(msg: *const u8, len: usize) -> i64;\n      fn __put_state(key: *const u8, key_len: usize, value: *const u8, value_len: usize) -> i64;\n      fn __delete_state(msg: *const u8, len: usize) -> i64;\n      fn __return_result(msg: *const u8, len: usize) -> i64;\n  }\n  ```\n\n  **è¿™äº›å‡½æ•°å¯ä»¥åœ¨ç¼–å†™`rust`ä»£ç æ—¶ç›´æ¥è°ƒç”¨ï¼Œä¸éœ€è¦è‡ªå·±å®ç°ï¼Œè¿™äº›æ˜¯ç›¸å½“åœ¨Hostç¨‹åºä¸­å®ç°ï¼Œå¯ä»¥è¢« `wasm`ä»£ç è°ƒç”¨çš„å‡½æ•°**\n\n  åœ¨rustçš„å¯¼å‡ºå‡½æ•°ä¸­,å³wasmä»£ç çš„å¯¹å¤–æ¥å£ä¸­ï¼Œå¯ä»¥è°ƒç”¨ä¸Šè¿°çš„å‡½æ•°ï¼Œå¦‚ï¼š\n\n  - é€šè¿‡__get_parameter_size(0)å¯ä»¥å–å¾—ç¬¬1ä¸ªå‚æ•°çš„é•¿åº¦__\n  - é€šè¿‡__get_parameterå¯ä»¥å–å¾—å‚æ•°çš„å€¼ï¼Œå…·ä½“ç”¨æ³•å°±æ˜¯ä¼ å…¥ä¸€ä¸ªåºå·ï¼Œä¸€ä¸ªvec!çš„æŒ‡é’ˆ\n\n- å®ç°`init`å‡½æ•°ï¼ˆå¿…é¡»å®ç°ï¼Œ`wasmcc`çš„`create`å‡½æ•°ç”¨æ¥åˆ›å»º wasm chaincodeæ—¶å°±ä¼šè°ƒç”¨wasmä»£ç ä¸­çš„`init`å‡½æ•°\n\n  ```rust\n  #[no_mangle]\n  pub extern \"C\" fn init(args: i64) -> i64 {\n  \t// ...\n  }\n  ```\n\n## ç¼–è¯‘\n\nåœ¨`rust`å·¥ç¨‹çš„æ ¹ç›®å½•ä¸‹ï¼Œè¿è¡Œå‘½ä»¤ï¼š\n\n```shell\nwasm-pack build\n```\n\nå¦‚æœæˆåŠŸçš„è¯ï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆ`pkg/hello_world_bg.wasm`\n\nå…³äºCè¯­è¨€ç¼–å†™ä»£ç ï¼Œå†ç¼–è¯‘æˆwasmï¼Œæ–‡æ¡£ä¸­è¯´æ˜¯éœ€è¦å®‰è£…clang8 å’Œ llvmã€‚[æ–‡æ¡£](https://github.com/hyperledger-labs/fabric-chaincode-wasm/tree/main/sample-wasm-chaincode)ä¸­æ˜¯[Linuxçš„å‡ ä¸ªå‘è¡Œç‰ˆçš„ç¯å¢ƒ](https://apt.llvm.org/)ï¼Œç”±äºæˆ‘çš„æ˜¯Mac M1èŠ¯ç‰‡çš„ç¯å¢ƒï¼Œå°è¯•äº†ä¸€ä¸‹å¾—åˆ°ä¸€äº›é“¾æ¥å‡ºé”™ä¿¡æ¯ï¼ŒåŸå› æ˜¯æ‰¾ä¸åˆ°`__print`ã€`__get_parameter`ç­‰å‡ ä¸ªå‡½æ•°çš„æ‰¾ä¸åˆ°å®ç°éƒ¨åˆ†ï¼Œæ‰€ä»¥é“¾æ¥çš„æ—¶å€™å‡ºé”™ï¼Œè¿™ä¸ªç†è®ºä¸Šè¯´å¾—é€šï¼Œèƒ½ç¼–è¯‘æˆåŠŸæ‰æ˜¯ä¸èƒ½ç†è§£çš„ã€‚ä¸çŸ¥é“æ–‡æ¡£ä¸­è¯´çš„æ–¹æ³•æ˜¯æ€ä¹ˆç¼–è¯‘æˆåŠŸçš„ï¼Œåˆ°æ—¶å€™æœ‰ç©ºç”¨Linuxç¯å¢ƒè¯•ä¸€ä¸‹å§ã€‚\n","tags":["wasm","chaincode","rust","wasm-pack","build"],"categories":["åŒºå—é“¾","Fabric"]},{"title":"Fabric-wasmccä»‹ç»","url":"/2022/11/03/Fabric-wasmccä»‹ç»/","content":"\n# wasmcc\n\nå…¨ç§°ï¼š`Hyperledger Fabric WASM Chaincode`ï¼Œæ˜¯ç”±`hypterledger-labs`æä¾›çš„ä¸€ä¸ªé“¾ç ã€‚ä½œç”¨æ˜¯å¯ä»¥æŠŠä½¿ç”¨rust/Cç¼–å†™ä»£ç ç”Ÿæˆ`wasm`å­—èŠ‚ç ï¼ŒæŠŠwasmå­—èŠ‚ç éƒ¨ç½²åˆ°`fabric`ä¸­ï¼Œç„¶åä½¿ç”¨wasmccä½œä¸ºä»£ç†è°ƒç”¨wasmä¸­çš„å‡½æ•°ã€‚fabricä»¥æ­¤æ–¹å¼æ¥æ”¯æŒ`wasm chaincode`\n\n## æ­¥éª¤\n- 1. `wasmcc`éƒ¨ç½²åˆ°`fabric`ä¸­ï¼Œæ‰®æ¼”`wasm`ä»£ç è°ƒç”¨çš„ç»Ÿä¸€å…¥å£ï¼Œç›¸å½“äºwasmä»£ç çš„è°ƒç”¨ä»£ç†ã€‚\n`wasmcc`çš„éƒ¨ç½²å’Œå…¶å®ƒçš„æ™®é€šé“¾ç çš„éƒ¨ç½²æ–¹å¼ä¸€æ ·ï¼Œ`wasmcc`æ²¡æœ‰å®ä¾‹åŒ–å‚æ•°ï¼Œé€šè¿‡peer cliéƒ¨ç½²çš„å‘½ä»¤å¦‚ä¸‹ï¼š\n```shell\npeer chaincode install -n wasmcc -v 1.0 -p github.com/chaincode/wasmer-chaincode-test/wasmcc\n```\n```shell\npeer chaincode instantiate -n wasmcc -v 1.0 -C <channel-name> -c '{\"Args\":[]}' -o <orderer-address> --tls --cafile <orderer-ca>\n```\n- 2. é€šè¿‡è°ƒç”¨`wasmcc`çš„ `create` æ–¹æ³•åˆ›å»º`wasm chaincode`\n- 3. **é€šè¿‡è°ƒç”¨`wasmcc`çš„`execute`æ–¹æ³•è°ƒç”¨`wasm chaincode`**\n- 4. é€šè¿‡è°ƒç”¨`wasmcc`çš„`installedChaincodes`æ–¹æ³•è·å–ç›®å‰fabricä¸Šéƒ¨ç½²çš„æ‰€æœ‰`wasm chiancode`\n\n# wasmcc ä»£ç è§£è¯»\n\n## åŸºç¡€ç»“æ„(fabric é“¾ç çš„åŸºæœ¬ç»“æ„)\n\n\n{% mermaid %}\nclassDiagram\nclass WASMChaincode {\n\t+Init(stub shim.ChaincodeStubInterface) Response\n\t+Invoke(stub shim.ChaincodeStubInterface) Response\n\t-create(stub shim.ChaincodeStubInterface, args []string) Response\n\t-execute(stub shim.ChaincodeStubInterface, args []string) Response\n\t-installedChaincodes(stub shim.ChaincodeStubInterface, args []string) Response\n}\nclass VirtualMachine {\n...\n\t+ImportResolver ImportResolver\n\n}\nclass ImportResolver {\n\t<<interface>>\n\t+ResolveFunc(module, field string) FunctionImport\n\t+ResolveGlobal(module, field string) int64\n}\nclass Resolver {\n\t-string chaincodeName\n\t-shim.ChaincodeStubInterface stub          \n\t-[]string args          \n\t-[]byte result        \n\t-[]byte errMsg        \n\t+ResolveFunc(module, field string) FunctionImport\n\t+ResolveGlobal(module, field string) int64\n}\nclass ChaincodeStubInterface {\n\t<<interface>>\n\t...\n}\nclass ChaincodeStub {\n\t...\n}\n\nChaincodeStubInterface <|.. ChaincodeStub\nImportResolver <|.. Resolver\nWASMChaincode <-- VirtualMachine\nWASMChaincode ..> ChaincodeStubInterface\nVirtualMachine ..> ImportResolver\nResolver --> WASMChaincode\n\n{% endmermaid %}\n\n**wasmé“¾ç çš„åˆ›å»ºæµç¨‹ï¼ˆcreate/execute/installedChaincodesä¸‰ä¸ªæµç¨‹ç±»ä¼¼ï¼‰**\n\n{% mermaid %}\nsequenceDiagram\n\tparticipant gRpc Client\n\tparticipant WASMChaincode\n\tparticipant ChaincodeStub\n  gRpc Client ->> WASMChaincode: è°ƒç”¨é“¾ç çš„createå‡½æ•°ï¼ˆè§¦å‘é“¾ç Invokeï¼‰\n  WASMChaincode ->> ChaincodeStub: è·å–å‡½æ•°åŠå‡½æ•°å‚æ•°æ•°ç»„\n  ChaincodeStub -->> WASMChaincode: è¿”å›è¢«è°ƒç”¨å‡½æ•°åŠå‡½æ•°å‚æ•°æ•°ç»„\n  WASMChaincode ->> WASMChaincode: è°ƒç”¨è‡ªèº«createå‡½æ•°\n  WASMChaincode ->> ChaincodeStub: æ£€æŸ¥é“¾ç æ˜¯å¦å­˜åœ¨\n  ChaincodeStub -->> WASMChaincode: é“¾ç å·²å­˜åœ¨\n  WASMChaincode -->> gRpc Client: å¤±è´¥ï¼Œé“¾ç å·²å­˜åœ¨\n  ChaincodeStub -->> WASMChaincode: é“¾ç ä¸å­˜åœ¨ï¼Œç»§ç»­æ‰§è¡Œ\n  WASMChaincode ->> WASMChaincode: å¯¹wasmå­—èŠ‚ç è¿›è¡Œè§£ç ï¼Œå¾—èƒ½è§£å‹åçš„å­—èŠ‚æµ\n  WASMChaincode ->> WASMChaincode: ç»™Resolverå¯¹è±¡èµ‹å€¼ï¼ˆé‡Œé¢ä¿å­˜äº†é“¾ç åï¼Œstub, å‡½æ•°å‚æ•°æ•°ç»„ï¼‰\n  WASMChaincode ->> WASMChaincode: è°ƒç”¨runWASMï¼Œä¼ å…¥wasmå­—èŠ‚æµ,å‡½æ•°å\"init\",å‚æ•°ä¸ªæ•°ï¼Œä»¥åŠResolverå¯¹è±¡\n  WASMChaincode -->> gRpc Client: è°ƒç”¨runWASMå¤±è´¥ç«‹å³è¿”å›\n  WASMChaincode ->> WASMChaincode: åˆ›å»º\"chaincodeData\"å’Œé“¾ç åçš„ç»„åˆé”®\n  WASMChaincode ->> ChaincodeStub: \"chaincodeData\"å’Œé“¾ç åçš„ç»„åˆä¸ºé”®ï¼Œwasmå­—èŠ‚æµä¸ºå€¼ï¼Œå­˜å…¥çŠ¶æ€åº“\n  ChaincodeStub -->> WASMChaincode: è¿”å›\n  WASMChaincode -->> gRpc Client: è¿”å›\n\n{% endmermaid %}\n\n### å®šä¹‰ä¸€ä¸ªç»“æ„ä½“\n\n```go\ntype WASMChaincode struct {\n}\n```\n\n## Initæ–¹æ³•\n\n```go\nfunc (t *WASMChaincode) Init(stub shim.ChaincodeStubInterface) pb.Response {\n\tlogger.Infof(\"Init invoked\")\n\treturn shim.Success(nil)\n}\n```\n\né“¾ç åˆ›å»ºæˆ–å‡çº§æ—¶è¢«è°ƒç”¨ï¼Œ`wasmcc `çš„`Init`å†…éƒ¨åªè®°å½•äº†ä¸€ä¸‹æ—¥å¿—ï¼Œæ²¡æœ‰å…¶å®ƒå¤šä½™çš„æ“ä½œ\n\n## Invokeæ–¹æ³•\n\n```go\nfunc (t *WASMChaincode) Invoke(stub shim.ChaincodeStubInterface) pb.Response {\n\tlogger.Infof(\"Invoke function\")\n\tfunction, args := stub.GetFunctionAndParameters()\n\tlogger.Debugf(\"Invoke function %s with args %v\", function, args)\n\n\tif function == \"create\" {\n\t\t// Create a new wasm chaincode\n\t\treturn t.create(stub, args)\n\t} else if function == \"execute\" {\n\t\t// execute wasm chaincode\n\t\treturn t.execute(stub, args)\n\t} else if function == \"installedChaincodes\" {\n\t\t// get the list of installed wasm chaincode\n\t\treturn t.installedChaincodes(stub, args)\n\t}\n\n\treturn shim.Error(\"Invalid invoke function name. Expecting \\\"execute\\\" \\\"create\\\" \\\"query\\\"\")\n}\n```\n\nè¿™ä¸ªæ–¹æ³•çš„åŠŸèƒ½ï¼š\n\n- 1. åˆ›å»ºwasm chaincode: è°ƒç”¨å‡½æ•°`create`\n\n     ```go\n     // Store a new wasm chaincode in state. Receives chaincode name and wasm file encoded in hex\n     func (t *WASMChaincode) create(stub shim.ChaincodeStubInterface, args []string) pb.Response {\n     \tlogger.Infof(\"Create function\")\n     \tif len(args) < 2 {\n     \t\treturn shim.Error(\"Incorrect number of arguments. Expecting atleast 2 arguments\")\n     \t}\n     \n     \tchaincodeName := args[0]\n     \tlogger.Infof(\"Installing wasm chaincode: \" + chaincodeName)\n     \n     \t//check if same chaincode name is already present\n     \tchaincodeFromState, err := stub.GetState(chaincodeName)\n     \tif chaincodeFromState != nil {\n     \t\treturn shim.Error(ChaincodeExists)\n     \t}\n     \n     \t//Decode the chaincode\n     \tchaincodeHexEncoded := args[1]\n     \tchaincodeDecoded, err := decodeReceivedWASMChaincode(chaincodeHexEncoded)\n     \n     \tif err != nil {\n     \t\treturn shim.Error(err.Error())\n     \t}\n     \n     \t//Initialize global variables for exported wasm functions\n     \tr := Resolver{\n     \t\tchaincodeName, stub, args[2:], nil, nil,\n     \t}\n     \n     \tresult := runWASM(chaincodeDecoded, \"init\", len(args)-2, &r)\n     \n     \tlogger.Infof(\"Init Response:%d\\n\", result)\n     \n     \tif result != 0 {\n     \t\treturn shim.Error(\"Chaincode init invocation failed\")\n     \t}\n     \n     \t// Store the chaincode in\n     \tledgerChaincodeKey, err := stub.CreateCompositeKey(chaincodeStoreIndex, []string{chaincodeName})\n     \terr = stub.PutState(ledgerChaincodeKey, chaincodeDecoded)\n     \tif err != nil {\n     \t\ts := fmt.Sprintf(UnknownError, err.Error())\n     \t\treturn shim.Error(s)\n     \t}\n     \treturn shim.Success([]byte(\"Success! Installed wasm chaincode\"))\n     }\n     ```\n\n- 2. æ‰§è¡Œwasm chaincode ä¸­çš„å‡½æ•°\n\n     ```go\n     func (t *WASMChaincode) execute(stub shim.ChaincodeStubInterface, args []string) pb.Response {\n     \n     \tif len(args) < 2 {\n     \t\treturn shim.Error(\"Incorrect number of arguments. Expecting chaincode name to invoke\")\n     \t}\n     \n     \tchaincodeName := args[0]\n     \tfuncToInvoke := args[1]\n     \n     \t//Initialize global variables for exported wasm functions\n     \tr := Resolver{\n     \t\tchaincodeName, stub, args[2:], nil, nil,\n     \t}\n     \n     \t// Get the state from the ledger\n     \tledgerChaincodeKey, _ := stub.CreateCompositeKey(chaincodeStoreIndex, []string{chaincodeName})\n     \tChaincodebytes, _ := stub.GetState(ledgerChaincodeKey)\n     \tif Chaincodebytes == nil {\n     \t\tjsonResp := \"{\\\"Error\\\":\\\"No Chaincode for \" + chaincodeName + \"\\\"}\"\n     \t\treturn shim.Error(jsonResp)\n     \t}\n     \n     \tresult := runWASM(Chaincodebytes, funcToInvoke, len(args)-2, &r)\n     \n     \tlogger.Infof(\"Invoke Response:%d\\n\", result)\n     \treturn txnResult(result, r.result)\n     }\n     ```\n\n\n- 3. è·å–å·²å®‰è£…çš„`wasm chaincode`\n\n     ```go\n     func (t *WASMChaincode) installedChaincodes(stub shim.ChaincodeStubInterface, args []string) pb.Response {\n     \n     \t// Get all chaincodes from the ledger\n     \tinstalledChaincodeResultsIterator, err := stub.GetStateByPartialCompositeKey(chaincodeStoreIndex, []string{})\n     \tif err != nil {\n     \t\treturn shim.Error(err.Error())\n     \t}\n     \n     \t// Iterate through result set and get chaincode names\n     \tvar i int\n     \tvar installedChaincodeNamesList = \"\"\n     \n     \tfor i = 0; installedChaincodeResultsIterator.HasNext(); i++ {\n     \t\t// Note that we don't get the value (2nd return variable), we'll just get the marble name from the composite key\n     \t\tresponseRange, err := installedChaincodeResultsIterator.Next()\n     \t\tif err != nil {\n     \t\t\treturn shim.Error(err.Error())\n     \t\t}\n     \n     \t\t// get the color and name from color~name composite key\n     \t\tobjectType, compositeKeyParts, err := stub.SplitCompositeKey(responseRange.Key)\n     \t\tif err != nil {\n     \t\t\treturn shim.Error(err.Error())\n     \t\t}\n     \t\treturnedChaincodeName := compositeKeyParts[0]\n     \t\tlogger.Infof(\"- found a chaincode from index:%s name:%s\\n\", objectType, returnedChaincodeName)\n     \t\tinstalledChaincodeNamesList += returnedChaincodeName\n     \t\tinstalledChaincodeNamesList += \"\\n\"\n     \n     \t}\n     \n     \tlogger.Infof(\"Invoke Response:%s\\n\", installedChaincodeNamesList)\n     \treturn shim.Success([]byte(installedChaincodeNamesList))\n     }\n     ```\n","tags":["wasm","chaincode"],"categories":["åŒºå—é“¾","Fabric"]},{"title":"Fabric-é€šè¿‡samplesäº†è§£fabricï¼ˆä¸€ï¼‰","url":"/2022/11/02/Fabric-é€šè¿‡samplesäº†è§£fabricï¼ˆä¸€ï¼‰/","content":"\n# é€šè¿‡fabric-samplesäº†è§£fabric\n\néœ€è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\n\n- 1. å¦‚æœéœ€è¦ï¼Œè¯·å…‹éš† [hyperledger/fabric-samples](https://github.com/hyperledger/fabric-samples) ä»“åº“\n- 2. æ£€å‡ºé€‚å½“çš„ç‰ˆæœ¬æ ‡ç­¾\n- 3. å°†æŒ‡å®šç‰ˆæœ¬çš„ Hyperledger Fabric å¹³å°ç‰¹å®šäºŒè¿›åˆ¶æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶å®‰è£…åˆ° fabric-samples ä¸‹çš„ /bin å’Œ /config ç›®å½•ä¸­\n- 4. ä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„ Hyperledger Fabric docker é•œåƒ\n\n**æ— æ¢¯å­ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œä¸‹é¢è¿™ç§æ–¹æ³•è¡Œä¸é€š**\n\n# æ–¹æ³•1. ä½¿ç”¨è„šæœ¬å®Œæˆ\n\nå› ä¸º`curl -sSL https://bit.ly/2ysbOFE`ä¼šä¸‹è½½ä¸€ä¸ªè„šæœ¬ï¼Œè¿™ä¸ªè„šæœ¬å¦‚æœåœ¨æ— æ¢¯å­çš„æƒ…å†µä¸‹ï¼Œæ˜¯æ‰§è¡Œä¸æˆåŠŸçš„ï¼Œå¯ä»¥å…ˆä¸‹è½½è¿™ä¸ªè„šæœ¬ï¼Œè‡ªè¡Œä¿®æ”¹ã€‚\n\nå¦‚æœæƒ³è¦æœ€æ–°çš„ç”Ÿäº§å‘å¸ƒç‰ˆï¼Œå¿½ç•¥æ‰€æœ‰çš„ç‰ˆæœ¬æ ‡è¯†ç¬¦\n\n```shell\ncurl -sSL https://bit.ly/2ysbOFE | bash -s\n```\n\nå¦‚æœä½ æƒ³è¦ä¸€ä¸ªæŒ‡å®šçš„å‘å¸ƒç‰ˆæœ¬ï¼Œä¼ å…¥ä¸€ä¸ª Fabricã€Fabric-ca å’Œç¬¬ä¸‰æ–¹ Docker é•œåƒçš„ç‰ˆæœ¬æ ‡è¯†ç¬¦ã€‚ä¸‹è¾¹çš„å‘½ä»¤æ˜¾ç¤ºäº†å¦‚ä½•ä¸‹è½½æœ€æ–°çš„ç”Ÿäº§å‘å¸ƒç‰ˆ - **Fabric v2.2.0** å’Œ **Fabric CA v1.4.7** ã€‚\n\n```shell\ncurl -sSL https://bit.ly/2ysbOFE | bash -s -- <fabric_version> <fabric-ca_version>\ncurl -sSL https://bit.ly/2ysbOFE | bash -s -- 2.2.0 1.4.7\n```\n\n\n\n# æ–¹æ³•2. é€šè¿‡fabricé¡¹ç›®ä¸­çš„ä¸€ä¸ªè„šæœ¬\n\n- å…ˆ`clone fabric`ä»£ç \n\n  ```shell\n  git clone https://github.com/hyperledger/fabric.git\n  ```\n  \n- è¿›å…¥åˆ°`fabric`ç›®å½•ä¸‹\n\n  ```shell\n  cd fabric/scripts/\n  ./bootstrap.sh\n  ```\n\n  æ¥ä¸‹æ¥æ— æ¢¯å­è¿˜æ˜¯ä¼šé‡åˆ°é—®é¢˜,å¯ä»¥å¯¹bootstrap.shä¸­çš„å†…å®¹è¿›è¡Œä¿®æ”¹ï¼Œæˆ–æŒ‰è„šæœ¬çš„æµç¨‹è‡ªå·±æ‰‹åŠ¨ä¸‹è½½\n\n# å¯åŠ¨æµ‹è¯•ç½‘ç»œ\n\n## è¿›å…¥åˆ°ç›¸å…³ç›®å½•\n\n```shell\ncd fabric-samples/test-network\n```\n\n## åˆ é™¤æ‰å…ˆå‰è¿è¡Œçš„æ‰€æœ‰å®¹å™¨æˆ–å·¥ç¨‹\n\n```shell\n./network.sh down\n```\n\n## å¯åŠ¨æµ‹è¯•ç½‘\n\n```shell\n./network.sh up\n```\n\n","tags":["fabric","test-network"],"categories":["åŒºå—é“¾","Fabric"]},{"title":"Linux-SSHå…å¯†ç™»å½•é—®é¢˜","url":"/2022/11/02/Linux-SSHå…å¯†ç™»å½•é—®é¢˜/","content":"\né˜¿é‡Œäº‘æœåŠ¡å™¨çš„`authorized_keys`ä¸­å·²ç»æ·»åŠ è¿‡æˆ‘ä¸ªäººç”µè„‘çš„å…¬é’¥ï¼Œä¸€å¼€å§‹æ˜¯å¯ä»¥å…å¯†ç ç™»å½•çš„ï¼Œåæ¥ä¼°è®¡ä¸çŸ¥é“æˆ‘ä¸ªäººç”µè„‘æ›´æ–°äº†å•¥ï¼Œssh ç™»å½•è¿œç¨‹æœåŠ¡å™¨æ—¶ï¼Œæç¤ºï¼š\n\n```shell\nUnable to negotiate with `æœåŠ¡å™¨IPåœ°å€` port 22: no matching host key type found. Their offer: ssh-rsa,ssh-dss\n```\n\nè§£å†³æ–¹æ³•è®°å½•ä¸€ä¸‹ï¼š\n\n```shell\nvim ~/.ssh/config # æ²¡æœ‰å°±åˆ›å»º\n```\n\næ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œä¿å­˜é€€å‡º\n\n```shell\nHost xxx.xxx.xxx.xxx                          # æœåŠ¡å™¨åœ°å€\nHostKeyAlgorithms +ssh-dss\nPubkeyAcceptedKeyTypes ssh-rsa,ssh-dss\n```\n\nç½‘ä¸Šä¸€èˆ¬éƒ½è¯´æ˜¯æ·»åŠ ä¸Šé¢çš„å‰ä¸¤è¡Œå°±è§£å†³äº†ï¼Œä½†æˆ‘è¯•äº†ä¸è¡Œï¼Œåªæœ‰æ·»åŠ äº†ä¸Šé¢3è¡Œå†…å®¹æ‰è§£å†³\n","tags":["linux","ssh","key","å…å¯†ç ","å…å¯†ç™»å½•","è¿œç¨‹ç™»å½•"],"categories":["Linux"]},{"title":"Fabric-é“¾ç çš„åŸºæœ¬ç»“æ„å’Œç¤ºä¾‹è¯´æ˜","url":"/2022/11/02/Fabric-é“¾ç çš„åŸºæœ¬ç»“æ„å’Œç¤ºä¾‹è¯´æ˜/","content":"\n# é“¾ç ç»“æ„\n\n## é“¾ç æ¥å£\n\né“¾ç å¯åŠ¨å¿…é¡»é€šè¿‡è°ƒç”¨ shim åŒ…ä¸­çš„ Start å‡½æ•°ï¼Œä¼ é€’ä¸€ä¸ªç±»å‹ä¸º Chaincode çš„å‚æ•°ï¼Œè¯¥å‚æ•°æ˜¯ä¸€ä¸ªæ¥å£ç±»å‹ï¼Œæœ‰ä¸¤ä¸ªé‡è¦çš„å‡½æ•° Init ä¸ Invoke ã€‚\n\n```go\ntype Chaincode interface {\n    Init(stub ChaincodeStubInterface) peer.Response\n    Invoke(stub ChaincodeStubInterface) peer.Response\n}\n```\n\n- Init: åœ¨é“¾ç å®ä¾‹åŒ–æˆ–å‡çº§æ—¶è¢«è°ƒç”¨ï¼Œå®Œæˆåˆå§‹åŒ–æ•°æ®çš„å·¥ä½œ\n- Invoke: æ›´æ–°æˆ–æŸ¥è¯¢å¸æœ¬æ•°æ®çŠ¶æ€æ—¶è¢«è°ƒç”¨ï¼Œéœ€è¦åœ¨æ­¤æ–¹æ³•ä¸­**å®ç°å“åº”è°ƒç”¨æˆ–æŸ¥è¯¢çš„ä¸šåŠ¡é€»è¾‘**\n\nå®é™…å¼€å‘ä¸­ï¼Œå¼€å‘äººå‘˜å¯ä»¥è‡ªè¡Œå®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œé‡å†™Chaincodeæ¥å£çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œå¹¶å°†ä¸¤ä¸ªæ–¹æ³•æŒ‡å®šä¸ºè‡ªå®šä¹‰çš„ç»“æ„ä½“çš„æˆå‘˜æ–¹æ³•ã€‚ç›¸å½“äºjavaè¯­è¨€é‡Œé¢å†™ä¸€ä¸ªç±»å®ç°é“¾ç çš„æ¥å£ï¼Œå®ç°æ¥å£ä¸­çš„`Init`å’Œ`Invoke`æ–¹æ³•ã€‚\n\n## é“¾ç ç»“æ„\n\n```go\npackage main\n\n// å¼•å…¥å¿…è¦çš„åŒ…\nimport (\n    \"fmt\"\n\n    \"github.com/hyperledger/fabric/core/chaincode/shim\"\n    pb \"github.com/hyperledger/fabric/protos/peer\"\n)\n\n// å£°æ˜ä¸€ä¸ªç»“æ„ä½“\ntype SimpleChaincode struct {\n}\n\n// ä¸ºç»“æ„ä½“æ·»åŠ Initæ–¹æ³•\nfunc (t *SimpleChaincode) Init(stub shim.ChaincodeStubInterface) pb.Response {\n    // åœ¨è¯¥æ–¹æ³•ä¸­å®ç°é“¾ç åˆå§‹åŒ–æˆ–å‡çº§æ—¶çš„å¤„ç†é€»è¾‘\n    // ç¼–å†™æ—¶å¯çµæ´»ä½¿ç”¨stubä¸­çš„API\n}\n\n// ä¸ºç»“æ„ä½“æ·»åŠ Invokeæ–¹æ³•\nfunc (t *SimpleChaincode) Invoke(stub shim.ChaincodeStubInterface) pb.Response {\n    // åœ¨è¯¥æ–¹æ³•ä¸­å®ç°é“¾ç è¿è¡Œä¸­è¢«è°ƒç”¨æˆ–æŸ¥è¯¢æ—¶çš„å¤„ç†é€»è¾‘\n    // ç¼–å†™æ—¶å¯çµæ´»ä½¿ç”¨stubä¸­çš„API\n}\n\n// ä¸»å‡½æ•°ï¼Œéœ€è¦è°ƒç”¨shim.Startï¼ˆï¼‰æ–¹æ³•\nfunc main() {\n    err := shim.Start(new(SimpleChaincode))\n    if err != nil {\n        fmt.Printf(\"Error starting Simple chaincode: %s\", err)\n    }\n}\n```\n\n- **shim**`: ç”¨æ¥è®¿é—®/æ“ä½œæ•°æ®çŠ¶æ€ã€äº‹åŠ¡ä¸Šä¸‹æ–‡å’Œè°ƒç”¨`å…¶å®ƒé“¾`ä»£ç çš„APIï¼Œé“¾ç é€šè¿‡`shim.ChaincodeStub`æä¾›çš„æ–¹æ³•æ¥è¯»å–å’Œä¿®æ”¹å¸æœ¬çš„çŠ¶æ€ã€‚\n\n- **peer**: æä¾›äº†é“¾ç æ‰§è¡Œåçš„å“ï¼›åº”ä¿¡æ¯çš„APIï¼Œ `peer.Response`å°è£…äº†å“åº”ä¿¡æ¯\n\n# é“¾ç ç›¸å…³API\n\n`shim`åŒ…æä¾›äº†å¦‚ä¸‹å‡ ç§ç±»å‹çš„æ¥å£ï¼š\n\n- **å‚æ•°è§£æAP**`ï¼šè°ƒç”¨é“¾ç æ—¶éœ€è¦ç»™è¢«è°ƒç”¨çš„ç›®æ ‡å‡½æ•°/æ–¹æ³•ä¼ é€’å‚æ•°ï¼Œè¯¥ API æä¾›è§£æè¿™äº›å‚æ•°çš„æ–¹æ³•ï¼Œé“¾ç è¢«è°ƒç”¨æ—¶è§¦å‘é“¾ç ä¸­çš„`Invoke`æ–¹æ³•è¢«è°ƒç”¨ï¼Œåœ¨`Invoke`å†…éƒ¨ï¼Œå¯ä»¥é€šè¿‡å‚æ•°`stub`æ¥è·å–ç›®æ ‡å‡½æ•°/æ–¹æ³•å‚æ•°ã€‚\n- **å¸æœ¬çŠ¶æ€æ•°æ®æ“ä½œAPI**: è¯¥ API æä¾›äº†å¯¹è´¦æœ¬æ•°æ®çŠ¶æ€è¿›è¡Œæ“ä½œçš„æ–¹æ³•ï¼ŒåŒ…æ‹¬å¯¹çŠ¶æ€æ•°æ®çš„æŸ¥è¯¢åŠäº‹åŠ¡å¤„ç†ç­‰\n- **äº¤æ˜“ä¿¡æ¯è·å– APIï¼š**è·å–æäº¤çš„äº¤æ˜“ä¿¡æ¯çš„ç›¸å…³ API\n- **å¯¹ PrivateData æ“ä½œçš„ APIï¼š** Hyperledger Fabric åœ¨ 1.2.0 ç‰ˆæœ¬ä¸­æ–°å¢çš„å¯¹ç§æœ‰æ•°æ®æ“ä½œçš„ç›¸å…³ API\n- **å…¶ä»– APIï¼š**å…¶ä»–çš„ APIï¼ŒåŒ…æ‹¬äº‹ä»¶è®¾ç½®ã€è°ƒç”¨å…¶ä»–é“¾ç æ“ä½œ\n\n## å‚æ•°è§£æAPI\n\n```go\n// è¿”å›è°ƒç”¨é“¾ç æ—¶æŒ‡å®šæä¾›çš„å‚æ•°åˆ—è¡¨ï¼ˆä»¥å­—ç¬¦ä¸²æ•°ç»„å½¢å¼è¿”å›ï¼‰\nGetStringArgs() []string\n\n// è¿”å›è°ƒç”¨é“¾ç æ—¶åœ¨äº¤æ˜“ææ¡ˆä¸­æŒ‡å®šæä¾›çš„è¢«è°ƒç”¨çš„å‡½æ•°åç§°åŠå‡½æ•°çš„å‚æ•°åˆ—è¡¨ï¼ˆä»¥å­—ç¬¦ä¸²æ•°ç»„å½¢å¼è¿”å›ï¼‰\nGetFunctionAndParameters() (function string, params []string)\n\n// è¿”å›æäº¤äº¤æ˜“ææ¡ˆæ—¶æä¾›çš„å‚æ•°åˆ—è¡¨ï¼ˆä»¥å­—èŠ‚ä¸²æ•°ç»„å½¢å¼è¿”å›ï¼‰\nGetArgsSlice() ([]byte, error)\n\n// è¿”å›è°ƒç”¨é“¾ç æ—¶åœ¨äº¤æ˜“ææ¡ˆä¸­æŒ‡å®šæä¾›çš„è¢«è°ƒç”¨çš„å‡½æ•°åç§°åŠå‡½æ•°çš„å‚æ•°åˆ—è¡¨ï¼ˆä»¥å­—èŠ‚ä¸²æ•°ç»„å½¢å¼è¿”å›ï¼‰\nGetArgs() [][]byte\n```\n\nä¸€èˆ¬ä½¿ç”¨ GetFunctionAndParameters() åŠ GetStringArgs() ã€‚\n\n## å¸æœ¬æ•°æ®çŠ¶æ€æ“ä½œAPI\n\n```go\n// æŸ¥è¯¢è´¦æœ¬ï¼Œè¿”å›æŒ‡å®šé”®å¯¹åº”çš„å€¼\nGetState(key string) ([]byte, error)\n\n// å°è¯•æ·»åŠ /æ›´æ–°è´¦æœ¬ä¸­çš„ä¸€å¯¹é”®å€¼\n// è¿™ä¸€å¯¹é”®å€¼ä¼šè¢«æ·»åŠ åˆ°å†™é›†åˆä¸­ï¼Œç­‰å¾… Committer è¿›ä¸€æ­¥ç¡®è®¤ï¼ŒéªŒè¯é€šè¿‡åæ‰ä¼šçœŸæ­£å†™å…¥åˆ°è´¦æœ¬\nPutState(key string, value []byte) error\n\n// å°è¯•åˆ é™¤è´¦æœ¬ä¸­çš„ä¸€å¯¹é”®å€¼\n// åŒæ ·ï¼Œå¯¹è¯¥å¯¹é”®å€¼åˆ é™¤ä¼šæ·»åŠ åˆ°å†™é›†åˆä¸­ï¼Œç­‰å¾… Committer è¿›ä¸€æ­¥ç¡®è®¤ï¼ŒéªŒè¯é€šè¿‡åæ‰ä¼šçœŸæ­£å†™å…¥åˆ°è´¦æœ¬\nDelState(key string) error\n\n// æŸ¥è¯¢æŒ‡å®šèŒƒå›´çš„é”®å€¼ï¼ŒstartKey å’Œ endkey åˆ†åˆ«æŒ‡å®šå¼€å§‹ï¼ˆåŒ…æ‹¬ï¼‰å’Œç»ˆæ­¢ï¼ˆä¸åŒ…æ‹¬ï¼‰ï¼Œå½“ä¸ºç©ºæ—¶é»˜è®¤æ˜¯æœ€å¤§èŒƒå›´\n// è¿”å›ç»“æœæ˜¯ä¸€ä¸ªè¿­ä»£å™¨ç»“æ„ï¼Œå¯ä»¥æŒ‰ç…§å­—å…¸åºè¿­ä»£æ¯ä¸ªé”®å€¼å¯¹ï¼Œæœ€åéœ€è¦è°ƒç”¨ Close() æ–¹æ³•å…³é—­\nGetStateByRange(startKey, endKey string) (StateQueryIteratorInterface, error)\n\n// è¿”å›æŒ‡å®šé”®çš„æ‰€æœ‰å†å²å€¼ã€‚è¯¥æ–¹æ³•çš„ä½¿ç”¨éœ€è¦èŠ‚ç‚¹é…ç½®ä¸­æ‰“å¼€å†å²æ•°æ®åº“ç‰¹æ€§ï¼ˆledger.history.enableHistoryDatabase=trueï¼‰\nGetHistoryForKey(key string) (HistoryQueryIteratorInterface, error)\n\n// ç»™å®šä¸€ç»„å±æ€§ï¼ˆattributesï¼‰ï¼Œå°†è¿™äº›å±æ€§ç»„åˆèµ·æ¥æ„é€ è¿”å›ä¸€ä¸ªå¤åˆé”®\n// ä¾‹å¦‚ï¼šCreateComositeKey(\"name-age\",[]string{\"Alice\", \"12\"});\nCreateCompositeKey(objectType string, attributes []string) (string, error)\n\n// å°†æŒ‡å®šçš„å¤åˆé”®è¿›è¡Œåˆ†å‰²ï¼Œæ‹†åˆ†æˆæ„é€ å¤åˆé”®æ—¶æ‰€ç”¨çš„å±æ€§\nSplitCompositeKey(compositeKey string) (string, []string, error)\n\n// æ ¹æ®å±€éƒ¨çš„å¤åˆé”®ï¼ˆå‰ç¼€ï¼‰è¿”å›æ‰€æœ‰åŒ¹é…çš„é”®å€¼ï¼Œå³ä¸è´¦æœ¬ä¸­çš„é”®è¿›è¡Œå‰ç¼€åŒ¹é…\n// è¿”å›ç»“æœæ˜¯ä¸€ä¸ªè¿­ä»£å™¨ç»“æ„ï¼Œå¯ä»¥æŒ‰ç…§å­—å…¸åºè¿­ä»£æ¯ä¸ªé”®å€¼å¯¹ï¼Œæœ€åéœ€è¦è°ƒç”¨ Close() æ–¹æ³•å…³é—­\nGetStateByPartialCompositeKey(objectType string, keys []string) (StateQueryIteratorInterface, error)\n\n// å¯¹(æ”¯æŒå¯ŒæŸ¥è¯¢åŠŸèƒ½çš„)çŠ¶æ€æ•°æ®åº“è¿›è¡Œå¯ŒæŸ¥è¯¢ï¼Œè¿”å›ç»“æœæ˜¯ä¸€ä¸ªè¿­ä»£å™¨ç»“æ„ï¼Œç›®å‰åªæ”¯æŒ CouchDB\n// æ³¨æ„è¯¥æ–¹æ³•ä¸ä¼šè¢« Committer é‡æ–°æ‰§è¡Œè¿›è¡ŒéªŒè¯ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨äºæ›´æ–°è´¦æœ¬çŠ¶æ€çš„äº¤æ˜“ä¸­\nGetQueryResult(query string) (StateQueryIteratorInterface, error)\n```\n\n**æ³¨æ„ï¼š** é€šè¿‡ put å†™å…¥çš„æ•°æ®çŠ¶æ€ä¸èƒ½ç«‹åˆ» get åˆ°ï¼Œå› ä¸º put åªæ˜¯é“¾ç æ‰§è¡Œçš„æ¨¡æ‹Ÿäº¤æ˜“ï¼ˆé˜²æ­¢é‡å¤æäº¤æ”»å‡»ï¼‰ï¼Œå¹¶ä¸ä¼šçœŸæ­£å°†çŠ¶æ€ä¿å­˜åˆ°è´¦æœ¬ä¸­ï¼Œå¿…é¡»ç»è¿‡ Orderer è¾¾æˆå…±è¯†ä¹‹åï¼Œå°†æ•°æ®çŠ¶æ€ä¿å­˜åœ¨åŒºå—ä¸­ï¼Œç„¶åä¿å­˜åœ¨å„ peer èŠ‚ç‚¹çš„è´¦æœ¬ä¸­ã€‚\n\n## äº¤æ˜“ä¿¡æ¯ç›¸å…³API\n\n```go\n// è¿”å›äº¤æ˜“ææ¡ˆä¸­æŒ‡å®šçš„äº¤æ˜“ IDã€‚\n// ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œäº¤æ˜“ ID æ˜¯å®¢æˆ·ç«¯æäº¤ææ¡ˆæ—¶ç”± Nonce éšæœºä¸²å’Œç­¾åè€…èº«ä»½ä¿¡æ¯å“ˆå¸Œäº§ç”Ÿçš„æ•°å­—æ‘˜è¦\nGetTxID() string\n\n// è¿”å›äº¤æ˜“ææ¡ˆä¸­æŒ‡å®šçš„ Channel ID\nGetChannelID() string\n\n// è¿”å›äº¤æ˜“è¢«åˆ›å»ºæ—¶çš„å®¢æˆ·ç«¯æ‰“ä¸Šçš„çš„æ—¶é—´æˆ³\n// è¿™ä¸ªæ—¶é—´æˆ³æ˜¯ç›´æ¥ä»äº¤æ˜“ ChannnelHeader ä¸­æå–çš„ï¼Œæ‰€ä»¥åœ¨æ‰€ä»¥èƒŒä¹¦èŠ‚ç‚¹å¤„çœ‹åˆ°çš„å€¼éƒ½ç›¸åŒ\nGetTxTimestamp() (*timestamp.Timestamp, error)\n\n// è¿”å›äº¤æ˜“çš„ binding ä¿¡æ¯\n// äº¤æ˜“çš„ binding ä¿¡æ¯æ˜¯å°†äº¤ææ¡ˆçš„ nonseã€Creatorã€epoch ç­‰ä¿¡æ¯ç»„åˆèµ·æ¥å“ˆå¸Œå¾—åˆ°æ•°å­—æ‘˜è¦\nGetBinding() ([]byte, error)\n\n// è¿”å›è¯¥ stub çš„ SignedProposal ç»“æ„ï¼ŒåŒ…æ‹¬äº†è·Ÿäº¤æ˜“ææ¡ˆç›¸å…³çš„æ‰€æœ‰æ•°æ®\nGetSignedProposal() (*pb.SignedProposal, error)\n\n// è¿”å›è¯¥äº¤æ˜“æäº¤è€…çš„èº«ä»½ä¿¡æ¯ï¼ˆç”¨æˆ·è¯ä¹¦ï¼‰\n// ä» SignedProposal ä¸­çš„ SignatureHeader.Creator æå–\nGetCreator() ([]byte, error)\n\n// è¿”å›äº¤æ˜“ä¸­å¸¦æœ‰çš„ä¸€äº›ä¸´æ—¶ä¿¡æ¯\n// ä» ChaincodeProposalPayload.transient æå–ï¼Œå¯ä»¥å­˜æ”¾ä¸åº”ç”¨ç›¸å…³çš„ä¿å¯†ä¿¡æ¯ï¼Œè¯¥ä¿¡æ¯ä¸ä¼šè¢«å†™å…¥åˆ°è´¦æœ¬\nGetTransient() (map[string][]byte, error)\n```\n\n## å¯¹ PrivateData æ“ä½œçš„ API\n\n```go\n// æ ¹æ®æŒ‡å®šçš„ keyï¼Œä»æŒ‡å®šçš„ç§æœ‰æ•°æ®é›†ä¸­æŸ¥è¯¢å¯¹åº”çš„ç§æœ‰æ•°æ®\nGetPrivateData(collection, key string) ([]byte, error)\n\n// å°†æŒ‡å®šçš„ key ä¸ value ä¿å­˜åˆ°ç§æœ‰æ•°æ®é›†ä¸­\nPutPrivateData(collection string, key string, value []byte) error\n\n// æ ¹æ®æŒ‡å®šçš„ key ä»ç§æœ‰æ•°æ®é›†ä¸­åˆ é™¤ç›¸åº”çš„æ•°æ®\nDelPrivateData(collection, key string) error\n\n// æ ¹æ®æŒ‡å®šçš„å¼€å§‹ä¸ç»“æŸ key æŸ¥è¯¢èŒƒå›´ï¼ˆä¸åŒ…å«ç»“æŸkeyï¼‰å†…çš„ç§æœ‰æ•°æ®\nGetPrivateDataByRange(collection, startKey, endKey string) (StateQueryIteratorInterface, error)\n\n// æ ¹æ®ç»™å®šçš„éƒ¨åˆ†ç»„åˆé”®çš„é›†åˆï¼ŒæŸ¥è¯¢ç»™å®šçš„ç§æœ‰çŠ¶æ€\nGetPrivateDataByPartialCompositeKey(collection, objectType string, keys []string) (StateQueryIteratorInterface, error)\n\n// æ ¹æ®æŒ‡å®šçš„æŸ¥è¯¢å­—ç¬¦ä¸²æ‰§è¡Œå¯ŒæŸ¥è¯¢ ï¼ˆåªæ”¯æŒæ”¯æŒå¯ŒæŸ¥è¯¢çš„ CouchDBï¼‰\nGetPrivateDataQueryResult(collection, query string) (StateQueryIteratorInterface, error)\n```\n\n## å…¶ä»– API\n\n```go\n// è®¾å®šå½“è¿™ä¸ªäº¤æ˜“åœ¨ Committer å¤„è¢«è®¤è¯é€šè¿‡ï¼Œå†™å…¥åˆ°åŒºå—æ—¶å‘é€çš„äº‹ä»¶ï¼ˆeventï¼‰ï¼Œä¸€èˆ¬ç”± Client ç›‘å¬\nSetEvent(name string, payload []byte) error\n\n// è°ƒç”¨å¦å¤–ä¸€ä¸ªé“¾ç çš„ Invoke æ–¹æ³•\n// å¦‚æœè¢«è°ƒç”¨é“¾ç åœ¨åŒä¸€ä¸ªé€šé“å†…ï¼Œåˆ™æ·»åŠ å…¶è¯»å†™é›†åˆä¿¡æ¯åˆ°è°ƒç”¨äº¤æ˜“ï¼›å¦åˆ™æ‰§è¡Œè°ƒç”¨ä½†ä¸å½±å“è¯»å†™é›†åˆä¿¡æ¯\n// å¦‚æœ channel ä¸ºç©ºï¼Œåˆ™é»˜è®¤ä¸ºå½“å‰é€šé“ã€‚ç›®å‰ä»…é™è¯»æ“ä½œï¼ŒåŒæ—¶ä¸ä¼šç”Ÿæˆæ–°çš„äº¤æ˜“\nInvokeChaincode(chaincodeName string, args [][]byte, channel string) pb.Response\n```\n\n# é“¾ç å¼€å‘\n\n## å¸æˆ·è½¬å¸\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"strconv\"\n\n\t\"github.com/hyperledger/fabric-chaincode-go/shim\"\n\t\"github.com/hyperledger/fabric-protos-go/peer\"\n)\n\n// å£°æ˜ä¸€ä¸ªç»“æ„ä½“\ntype SimpleChaincode struct {\n}\n\n// åˆå§‹åŒ–æ•°æ®çŠ¶æ€ï¼Œ å®ä¾‹åŒ–/å‡çº§é“¾ç æ—¶è¢«è‡ªåŠ¨è°ƒç”¨\nfunc (t *SimpleChaincode) Init(stub shim.ChaincodeStubInterface) peer.Response {\n\t// println å‡½æ•°çš„è¾“å‡ºä¿¡æ¯ä¼šå‡ºç°åœ¨é“¾ç å®¹å™¨çš„æ—¥å¿—ä¸­\n\tfmt.Println(\"ex02 Init\")\n\n\t// è·å–ç”¨æˆ·ä¼ é€’ç»™è°ƒç”¨é“¾ç çš„æ‰€éœ€å‚æ•°\n\t_, args := stub.GetFunctionAndParameters()\n\n\tvar A, B string    // ä¸¤ä¸ªå¸æˆ·\n\tvar Aval, Bval int // ä¸¤ä¸ªå¸æˆ·çš„ä½™é¢\n\tvar err error\n\n\t// æ£€æŸ¥åˆæ³•æ€§ï¼Œæ£€æŸ¥å‚æ•°æ•°é‡æ˜¯å¦ä¸º4ä¸ªï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™è¿”å›é”™è¯¯ä¿¡æ¯\n\tif len(args) != 4 {\n\t\treturn shim.Error(\"Incorrect number of arguments. Expecting 4\")\n\t}\n\n\tA = args[0]                       // å¸æˆ·Aç”¨æˆ·å\n\tAval, err = strconv.Atoi(args[1]) // å¸æˆ·Aä½™é¢\n\tif err != nil {\n\t\treturn shim.Error(\"Expecting integer value for asset holding\")\n\t}\n\n\tB = args[2]                       // è´¦æˆ·Bç”¨æˆ·å\n\tBval, err = strconv.Atoi(args[3]) // å¸æˆ·Bä½™é¢\n\tif err != nil {\n\t\treturn shim.Error(\"Expecting integer value for asset holding\")\n\t}\n\n\tfmt.Printf(\"Aval = %d, Bval = %d\\n\", Aval, Bval)\n\n\t// å°†è´¦æˆ·Açš„çŠ¶æ€å†™å…¥è´¦æœ¬ä¸­\n\terr = stub.PutState(A, []byte(strconv.Itoa(Aval)))\n\tif err != nil {\n\t\treturn shim.Error(err.Error())\n\t}\n\n\t// å°†å¸æˆ·Bçš„çŠ¶æ€å†™å…¥è´¦æœ¬\n\terr = stub.PutState(B, []byte(strconv.Itoa(Bval)))\n\tif err != nil {\n\t\treturn shim.Error(err.Error())\n\t}\n\n\t// ä¸€åˆ‡æˆåŠŸï¼Œè¿”å›\n\treturn shim.Success(nil)\n}\n\n// å¯¹å¸æˆ·æ•°æ®è¿›è¡Œæ“ä½œæ—¶ï¼ˆqueryã€invokeï¼‰è¢«è‡ªåŠ¨è°ƒç”¨\nfunc (t *SimpleChaincode) Invoke(stub shim.ChaincodeStubInterface) peer.Response {\n\tfmt.Println(\"ex02 Invoke\")\n\t// è·å–ç”¨æˆ·ä¼ é€’ç»™è°ƒç”¨é“¾ç çš„å‡½æ•°åç§°åŠå‚æ•°\n\tfunction, args := stub.GetFunctionAndParameters()\n\n\t// å¯¹è·å–åˆ°çš„å‡½æ•°åç§°è¿›è¡Œåˆ¤æ–­\n\tif function == \"invoke\" {\n\t\t// è°ƒç”¨invokeå‡½æ•°å®ç°è½¬å¸æ“ä½œ\n\t\treturn t.invoke(stub, args)\n\t} else if function == \"delete\" {\n\t\t// è°ƒç”¨deleteå‡½æ•°å®ç°å¸æˆ·æ³¨é”€\n\t\treturn t.delete(stub, args)\n\t} else if function == \"query\" {\n\t\t// è°ƒç”¨queryå®ç°å¸æˆ·æŸ¥è¯¢æ“ä½œ\n\t\treturn t.query(stub, args)\n\t}\n\t// è°ƒç”¨çš„é“¾ç å‡½æ•°åå‡ºé”™ï¼Œè¿”å›shim.Error()\n\treturn shim.Error(\"Invalid invoke function name. Expecting \\\"invoke\\\" \\\"delete\\\" \\\"query\\\"\")\n}\n\n// å¸æˆ·é—´è½¬é’±\nfunc (t *SimpleChaincode) invoke(stub shim.ChaincodeStubInterface, args []string) peer.Response {\n\tvar A, B string    // å¸æˆ·Aå’ŒB\n\tvar Aval, Bval int // å¸æˆ·ä½™é¢\n\tvar X int          // è½¬è´¦é‡‘é¢\n\tvar err error\n\n\tif len(args) != 3 {\n\t\treturn shim.Error(\"Incorrect number of arguments. Expecting 3\")\n\t}\n\n\tA = args[0] // å¸æˆ·Aç”¨æˆ·å\n\tB = args[1] // å¸æˆ·Bç”¨æˆ·å\n\n\t// ä»è´¦æœ¬ä¸­è·å–Açš„ä½™é¢\n\tAvalbytes, err := stub.GetState(A)\n\tif err != nil {\n\t\treturn shim.Error(\"Failed to get state\")\n\t}\n\tif Avalbytes == nil {\n\t\treturn shim.Error(\"Entity not found\")\n\t}\n\tAval, _ = strconv.Atoi(string(Avalbytes))\n\n\t// ä»å¸æœ¬ä¸­è·å–Bçš„ä½™é¢\n\tBvalbytes, err := stub.GetState(B)\n\tif err != nil {\n\t\treturn shim.Error(\"Failed to get state\")\n\t}\n\tif Bvalbytes == nil {\n\t\treturn shim.Error(\"Entity not found\")\n\t}\n\tBval, _ = strconv.Atoi(string(Bvalbytes))\n\n\t// X ä¸ºè½¬è´¦é‡‘é¢\n\tX, err = strconv.Atoi(args[2])\n\tif err != nil {\n\t\treturn shim.Error(\"Invalid transaction amount, expecting a integer value\")\n\t}\n\n\t// è½¬å¸\n\tAval = Aval - X\n\tBval = Bval + X\n\tfmt.Printf(\"Aval = %d, Bval = %d\\n\", Aval, Bval)\n\n\t// æ›´æ–°è½¬å¸åè´¦æœ¬ä¸­Aä½™é¢\n\terr = stub.PutState(A, []byte(strconv.Itoa(Aval)))\n\tif err != nil {\n\t\treturn shim.Error(err.Error())\n\t}\n\n\t// æ›´æ–°è½¬å¸åè´¦æœ¬ä¸­Bä½™é¢\n\terr = stub.PutState(B, []byte(strconv.Itoa(Bval)))\n\tif err != nil {\n\t\treturn shim.Error(err.Error())\n\t}\n\n\treturn shim.Success(nil)\n}\n\n// å¸æˆ·æ³¨é”€\nfunc (t *SimpleChaincode) delete(stub shim.ChaincodeStubInterface, args []string) peer.Response {\n\tif len(args) != 1 {\n\t\treturn shim.Error(\"Incorrect number of arguments. Expecting 1\")\n\t}\n\n\tA := args[0] // å¸æˆ·ç”¨æˆ·å\n\n\t// ä»è´¦æœ¬ä¸­åˆ é™¤è¯¥å¸æˆ·çŠ¶æ€\n\terr := stub.DelState(A)\n\tif err != nil {\n\t\treturn shim.Error(err.Error())\n\t}\n\n\treturn shim.Success(nil)\n}\n\n// å¸æˆ·æŸ¥è¯¢\nfunc (t *SimpleChaincode) query(stub shim.ChaincodeStubInterface, args []string) peer.Response {\n\tvar A string\n\tvar err error\n\n\tif len(args) != 1 {\n\t\treturn shim.Error(\"Incorrect number of arguments. Expecting name of the person to query\")\n\t}\n\n\tA = args[0] // å¸æˆ·ç”¨æˆ·å\n\n\t// ä»å¸æˆ·ä¸­è·å–è¯¥å¸æˆ·ä½™é¢\n\tAvalbytes, err := stub.GetState(A)\n\tif err != nil {\n\t\tjsonResp := \"{\\\"Error\\\": \\\"Failed to get state for \" + A + \"\\\"}\"\n\t\treturn shim.Error(jsonResp)\n\t}\n\tif Avalbytes == nil {\n\t\tjsonResp := \"{\\\"Error\\\":\\\"Nil amount for \" + A + \"\\\"}\"\n\t\treturn shim.Error(jsonResp)\n\t}\n\n\tjsonResp := \"{\\\"Name\\\":\\\"\" + A + \"\\\",\\\"Amount\\\":\\\"\" + string(Avalbytes) + \"\\\"}\"\n\tfmt.Printf(\"Query Response:%s\\n\", jsonResp)\n\t// è¿”å›è½¬å¸é‡‘é¢\n\treturn shim.Success(Avalbytes)\n}\n\nfunc main() {\n\terr := shim.Start(new(SimpleChaincode))\n\tif err != nil {\n\t\tfmt.Printf(\"Error starting Simple chaincode: %s\", err)\n\t}\n}\n```\n\n","tags":["chaincode","fabric","shim","å¸æœ¬"],"categories":["åŒºå—é“¾","Fabric"]},{"title":"Rustå­¦ä¹ -çŸ¥è¯†ç‚¹-5","url":"/2022/10/19/Rustå­¦ä¹ -çŸ¥è¯†ç‚¹-5/","content":"\n# Rustä¸­Traitçš„ç»§æ‰¿\n\n`Trait`ç±»ä¼¼äº`java`ä¸­çš„`interface`ï¼Œå¯ä»¥ç»§æ‰¿\n\n# Rustä¸­çš„Structçš„ç»§æ‰¿\n\n~~**å·²è¢«ç§»é™¤**~~\n\né‚£æ€ä¹ˆåŠå‘¢ï¼Ÿæ”¹ä¸ºç»„åˆå§ï¼Œæ–‡å­—æè¿°æ€»æ˜¯è‹ç™½çš„ï¼Œç›´æ¥çœ‹ä»£ç å§\n\n`inherit.rs`\n\n```rust\nuse std::ops::{Deref, DerefMut};\n\npub struct Dog<'a> {\n    name: &'a str,\n}\n\nimpl<'a> Dog<'a> {\n    pub fn new(name: &'a str) -> Dog {\n        Dog {\n            name\n        }\n    }\n    pub fn run(&self) {\n        println!(\"the dog is running.\")\n    }\n\n    pub fn sleep(&self) {\n        println!(\"the dog is sleeping.\")\n    }\n\n    pub fn bark() {\n        println!(\"the dog is barking.\")\n    }\n}\n\npub struct Husky<'a> {\n    dog: Dog<'a>,\n}\n\nimpl<'a> Husky<'a> {\n    pub fn new(name: &'a str) -> Husky<'a> {\n        Husky {\n            dog: Dog::new(name)\n        }\n    }\n    pub fn get_dog(&'a self) -> &Dog<'a> {\n        &self.dog\n    }\n    pub fn run(&self) {\n        println!(\"the husky is running.\");\n    }\n    pub fn sleep(&self) {\n        println!(\"the husky is sleeping.\");\n    }\n    pub fn do_stupid_thing(&self) {\n        println!(\"the husky is acting as a fool.\")\n    }\n}\n\nimpl<'a> Deref for Husky<'a> {\n    type Target = Dog<'a>;\n\n    fn deref(&self) -> &Self::Target {\n        &self.dog\n    }\n}\n\nimpl<'a> DerefMut for Husky<'a> {\n    fn deref_mut(&mut self) -> &mut Dog<'a> {\n        &mut self.dog\n    }\n}\n```\n\nè°ƒç”¨ç«¯ä»£ç ï¼š`main.rs`\n\n```rust\nmod inherit;\n\nuse inherit::{Dog, Husky};\n\nfn main() {\n    let husky = Husky::new(\"fool\");\n    husky.sleep(); // the husky is sleeping.\n    husky.run(); // the husky is running.\n    husky.do_stupid_thing(); // the husky is acting as a fool.\n\n    let mut husky_dog: &Dog = &husky;\n    husky.get_dog().sleep(); // the dog is sleeping.\n    husky_dog.sleep(); // the dog is sleeping.\n    husky_dog.run(); // the dog is running.\n}\n```\n\n\n\n\n\n","tags":["Result","Option","é”™è¯¯ä¼ æ’­","é”™è¯¯å¤„ç†"],"categories":["Rust","åŸºç¡€"]},{"title":"Rustå­¦ä¹ -çŸ¥è¯†ç‚¹-4","url":"/2022/10/19/Rustå­¦ä¹ -çŸ¥è¯†ç‚¹-4/","content":"\n# ä¼ æ’­é”™è¯¯\n\nç¨‹åºä¸­æ¶‰åŠåˆ°çš„å‡½æ•°è°ƒç”¨å¾€å¾€ä¼šåµŒå¥—å¤šå±‚ï¼Œè€Œé”™è¯¯çš„å¤„ç†ä¹Ÿå¾€å¾€ä¸æ˜¯åœ¨å“ªå‡ºé”™ï¼Œå°±åœ¨å“ªé‡Œå¤„ç†ï¼Œåº•å±‚è¢«è°ƒç”¨çš„å‡½æ•°ä¸€èˆ¬ä¼šæŠŠé”™è¯¯ä¸Šä¼ äº¤ç»™è°ƒç”¨è€…å»å¤„ç†ã€‚å› ä¸ºä¸Šå±‚è°ƒç”¨æ–¹ä¸€èˆ¬ä¼šæ¶‰åŠä¸šåŠ¡é€»è¾‘ï¼Œåº•å±‚ä¸å¯¹é”™è¯¯åšç›¸åº”çš„ä¸šåŠ¡å¤„ç†ã€‚æ¯”å¦‚ï¼š\n\n```rust\nuse std::fs::File;\nuse std::io::{self, Read};\n\nfn read_username_from_file() -> Result<String, io::Error> {\n    // æ‰“å¼€æ–‡ä»¶ï¼Œfæ˜¯`Result<æ–‡ä»¶å¥æŸ„,io::Error>`\n    let f = File::open(\"hello.txt\");\n\n    let mut f = match f {\n        // æ‰“å¼€æ–‡ä»¶æˆåŠŸï¼Œå°†fileå¥æŸ„èµ‹å€¼ç»™f\n        Ok(file) => file,\n        // æ‰“å¼€æ–‡ä»¶å¤±è´¥ï¼Œå°†é”™è¯¯è¿”å›(å‘ä¸Šä¼ æ’­)\n        Err(e) => return Err(e),\n    };\n    // åˆ›å»ºåŠ¨æ€å­—ç¬¦ä¸²s\n    let mut s = String::new();\n    // ä»fæ–‡ä»¶å¥æŸ„è¯»å–æ•°æ®å¹¶å†™å…¥sä¸­\n    match f.read_to_string(&mut s) {\n        // è¯»å–æˆåŠŸï¼Œè¿”å›Okå°è£…çš„å­—ç¬¦ä¸²\n        Ok(_) => Ok(s),\n        // å°†é”™è¯¯å‘ä¸Šä¼ æ’­\n        Err(e) => Err(e),\n    }\n}\n```\n\n`read_username_from_file()`å†…éƒ¨ä¸€èˆ¬åªéœ€è¦å‘ä¸ŠæŠ›å‡ºé”™è¯¯å³å¯ï¼›è¯¥å‡½æ•°çš„è°ƒç”¨è€…æœ€ç»ˆä¼šå¯¹é”™è¯¯è¿›è¡Œå¤„ç†ï¼Œè‡³äºæ€ä¹ˆå¤„ç†å°±æ˜¯è°ƒç”¨è€…çš„äº‹ï¼Œå¯ä»¥é€‰æ‹©å‘ä¸Šä¼ æ’­ï¼Œä¹Ÿå¯ä»¥ç›´æ¥`panic`ï¼Œäº¦æˆ–å°†å…·ä½“çš„é”™è¯¯åŸå› åŒ…è£…åå‘ˆç°ç»™ç”¨æˆ·ã€‚\n\nè™½ç„¶é”™è¯¯æ˜¯ä¼ æ’­å‡ºå»äº†ï¼Œä½†æ˜¯ï¼Œä»£ç å†™èµ·æ¥æœ‰ç‚¹é•¿ï¼Œ`rust` æä¾›äº†`?`æ¥ç®€åŒ–é”™è¯¯çš„ä¼ æ’­ã€‚\n\n```rust\nuse std::fs::File;\nuse std::io;\nuse std::io::Read;\n\nfn read_username_from_file() -> Result<String, io::Error> {\n    let mut f = File::open(\"hello.txt\")?;\n    let mut s = String::new();\n    f.read_to_string(&mut s)?;\n    Ok(s)\n}\n```\n\nä»£ç é‡å‡å°‘æ˜æ˜¾ï¼Œå…¶å®`?`å°±æ˜¯ä¸€ä¸ªå®ï¼Œå®ƒçš„ä½œç”¨ä¸­ä¸Šé¢çš„`match`ä¸€æ ·ï¼š\n\n```rust\nlet mut f = match f {\n    // æ‰“å¼€æ–‡ä»¶æˆåŠŸï¼Œå°†fileå¥æŸ„èµ‹å€¼ç»™f\n    Ok(file) => file,\n    // æ‰“å¼€æ–‡ä»¶å¤±è´¥ï¼Œå°†é”™è¯¯è¿”å›(å‘ä¸Šä¼ æ’­)\n    Err(e) => return Err(e),\n};\n```\n\nä½†`?`è¿˜æœ‰ä¸€ç‚¹æ¯”`match`æ›´å¼ºçš„åœ°æ–¹ï¼Œæƒ³åƒä¸€ä¸‹ï¼Œä¸€ä¸ªç³»ç»Ÿä¸­ï¼Œè‚¯å®šæœ‰è‡ªå®šä¹‰çš„é”™è¯¯ç‰¹å¾ï¼Œé”™è¯¯ä¹‹é—´å¾ˆå¯èƒ½ä¼šå­˜åœ¨ä¸Šä¸‹çº§å…³ç³»ï¼Œä¾‹å¦‚æ ‡å‡†åº“ä¸­çš„`std::io:Error`å’Œ`std::error:Error`ï¼Œå‰è€…æ˜¯IOç›¸å…³çš„é”™è¯¯ç»“æ„ä½“ï¼Œåè€…æ˜¯ä¸€ä¸ªæœ€é€šç”¨çš„æ ‡å‡†é”™è¯¯ç‰¹å¾ï¼ŒåŒæ—¶å‰è€…å®ç°åœ¨äº†åè€…ï¼Œå› æ­¤`std::io::Error`å¯ä»¥è½¬æ¢ä¸º`std::error::Error`ã€‚\n\næ˜ç™½äº†ä¸Šè¿°çš„é”™è¯¯è½¬æ¢ï¼Œå†æ¥çœ‹ä¸‹é¢çš„ä¸€æ®µä»£ç æ¥ä½“ä¼šä¸€ä¸‹`?`æ¯”`match`æ›´å¼ºçš„åœ°æ–¹ï¼š\n\n```rust\nfn open_file() -> Result<File, Box<dyn std::error::Error>> {\n    let mut f = File::open(\"hello.txt\")?;\n    Ok(f)\n}\n```\n\n`?`è¿˜å¯ä»¥å®ç°é“¾å¼è°ƒç”¨ï¼Œå†™èµ·ä»£ç æ¥æ›´åŠ è¿è´¯ï¼š\n\n```rust\nuse std::fs::File;\nuse std::io;\nuse std::io::Read;\n\nfn read_username_from_file() -> Result<String, io::Error> {\n    let mut s = String::new();\n\n    File::open(\"hello.txt\")?.read_to_string(&mut s)?;\n\n    Ok(s)\n}\n```\n\n# `Option`çš„ä¼ æ’­\n\n`?`ä¸ä»…ä»…å¯ä»¥ç”¨äº`Result`çš„ä¼ æ’­ï¼Œè¿˜èƒ½ç”¨äº`Option`çš„ä¼ æ’­ï¼Œ`Option`çš„å®šä¹‰å¦‚ä¸‹ï¼š\n\n```rust\npub enum Option<T> {\n  Some(T),\n  None,\n}\n```\n\n`Result`é€šè¿‡`ï¼Ÿ`åå›é”™è¯¯ï¼Œé‚£ä¹ˆ`Option`å°±é€šè¿‡`?`è¿”å›Noneï¼š\n\n```rust\nfn first(arr: &[i32]) -> Option<&i32> {\n   let v = arr.get(0)?;\n   Some(v)\n}\n```\n\nä¸Šé¢çš„ä»£ç åªæ˜¯ä¸ºäº†æ¼”ç¤º`Option`çš„ä¼ æ’­ï¼Œä»åŠŸèƒ½ä¸Šæ¥è¯´ï¼Œå®Œå…¨å¯ä»¥ç”¨ä»¥ä¸‹ç®€åŒ–çš„ç‰ˆæœ¬ï¼š\n\n```rust\nfn first(arr: &[i32]) -> Option<&i32> {\n   arr.get(0)\n}\n```\n\nå½“ç„¶ï¼Œå¼€å‘ä¸­è‚¯å®šæœ‰`Option`ä¼ æ’­çš„åº”ç”¨åœºæ™¯çš„ï¼š\n\n```rust\nfn last_char_of_first_line(text: &str) -> Option<char> {\n    text.lines().next()?.chars().last()\n}\n```\n\nä¸Šé¢ä»£ç å±•ç¤ºäº†åœ¨é“¾å¼è°ƒç”¨ä¸­ä½¿ç”¨`?`æå‰è¿”å›`None`çš„ç”¨æ³•ï¼Œ`.next`æ–¹æ³•è¿”å›çš„æ˜¯`Option`ç±»å‹ï¼šå¦‚æœè¿”å›`Some(&str)`ï¼Œé‚£ä¹ˆç»§ç»­è°ƒç”¨`chars`æ–¹æ³•ï¼Œå¦‚æœè¿”å›`None`ï¼Œåˆ™ç›´æ¥`last_char_of_first_line`è¿”å›,è¿”å›`None`ï¼Œä¸å†ç»§ç»­é“¾å¼è°ƒç”¨ã€‚\n\n","tags":["Result","Option","é”™è¯¯ä¼ æ’­","é”™è¯¯å¤„ç†"],"categories":["Rust","åŸºç¡€"]},{"title":"Rustå­¦ä¹ -çŸ¥è¯†ç‚¹-3","url":"/2022/10/14/Rustå­¦ä¹ -çŸ¥è¯†ç‚¹-3/","content":"\n# æ‹¥æœ‰å…±äº«æ•°æ®çš„é“¾è¡¨\n\nä»¥ä¸€é“é¢˜å¼€å§‹å§ï¼Œå°è¯•ç”¨`Box<T>`å®ç°ä¸‹é¢çš„é“¾è¡¨\n\n![é“¾è¡¨.webp](https://s2.loli.net/2022/10/14/JAjkKl3hcapqr86.webp)\n\n# ä½¿ç”¨`Box<T>`å®ç°\n\n```rust\nuse crate::List::{Cons, Nil};\n\nenum List {\n    Cons(i32, Box<List>),\n    Nil,\n}\n\nfn main() {\n    // åˆ›å»ºé“¾è¡¨a\n    let a = Cons(5, Box::new(Cons(10, Box::new(List::new(Nil)))));\n\n    // åˆ›å»ºé“¾è¡¨bï¼Œ å¹¶é“¾æ¥åˆ°é“¾è¡¨a\n    let b = Cons(3, Box::new(a)); // bé“¾æ¥åˆ°aæ—¶ï¼Œå°±æŠŠaçš„æ‰€æœ‰æƒç»™è½¬ç§»èµ°äº†\n\n    // åˆ›å»ºé“¾è¡¨cï¼Œå¹¶è¿æ¥åˆ°é“¾è¡¨a\n    let c = Cons(4, Box::new(a)); // æŠ¥é”™äº†ï¼Œå› ä¸ºaçš„æ‰€æœ‰æƒå·²ç»è¢«è½¬ç§»äº†\n}\n```\n\n# ä½¿ç”¨å¼•ç”¨è§£å†³æ‰€æœ‰æƒé—®é¢˜\n\n- å¼•ç”¨æ–¹å¼ä¸€ï¼š\n\n```rust\nuse crate::List::{Cons, Nil};\n#[derive(Debug)]\nenum List<'a> {\n    Cons(i32, Box<&'a List<'a>>),\n    Nil,\n}\n\nfn main() {\n    let a = Cons(5,\n        Box::new(&Cons(10,\n            Box::new(List::new(&Nil))) // æŠ¥é”™ï¼Œåˆ›å»ºä¸´æ—¶å¼•ç”¨&Nilï¼Œä½†æ˜¯åœ¨aèµ‹å€¼æ—¶å·²ç»è¢«é”€æ¯\n        ) \n    ); // &Nilåœ¨è¿™é‡Œçš„ç»“æŸè¯­å¥è¢«é”€æ¯\n    println!(\"{:?}\", a);\n}\n```\n\nè¿™é‡Œæ¶‰åŠåˆ°ç”Ÿå‘½å‘¨æœŸçš„é—®é¢˜ `&Nil`æ˜¯ä¸€ä¸ªä¸´æ—¶å¼•ç”¨ï¼Œåœ¨è¿™é‡Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸæ¯”açš„ç”Ÿå‘½å‘¨æœŸè¦çŸ­ã€‚ç¼–è¯‘æ—¶å°±ä¼šæŠ¥é”™äº†ã€‚\n\n- å¼•ç”¨æ–¹å¼äºŒï¼š\n\n```rust\nuse crate::List::{Cons, Nil};\n#[derive(Debug)]\nenum List<'a> {\n    Cons(i32, Box<&'a List<'a>>),\n    Nil,\n}\n\nfn main() {\n    let a2 = &Nil;\n    let a1 = &Cons(10, Box::new(a2));\n    let a = &Cons(5, Box::new(a1));\n    \n    let b = Cons(3, Box::new(a));\n    let c = Cons(4, Box::new(a));\n    \n    println!(\"{:?}\", b); // Cons(3, Cons(5, Cons(10, Nil)))\n    println!(\"{:?}\", c); // Cons(4, Cons(5, Cons(10, Nil)))\n}\n```\n\nè™½ç„¶å¯ä»¥å®ç°ï¼Œä½†ä»£ç çœ‹ä¸Šå»å¤ªè´¨æœ´ï¼Œä¸å¤Ÿä¼˜é›…ï¼Œä¸èƒ½ä¸€çœ¼çœ‹å‡ºåµŒå¥—å…³ç³»ï¼Œä¹Ÿå°±æ˜¯ä¸å¤Ÿç›´è§‚ã€‚\n\n# `Rc<T>` ç™»åœº\n\n- æ‰€æœ‰æƒè½¬ç§»å¼•å‘çš„è¡€æ¡ˆ\n- ä½¿ç”¨å¼•ç”¨åˆè§‰å¾—ä¸å¤Ÿä¼˜é›…\n\n`Rc<T>`æ¥è§£å†³ï¼Œå®ƒæ”¯æŒå¤šé‡æ‰€æœ‰æƒï¼Œæ˜¯`Reference counting`çš„ç¼©å†™ã€‚å®ƒå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªå¼•ç”¨æ¬¡æ•°è®¡æ•°å™¨ï¼Œç”¨äºç¡®è®¤è¿™ä¸ªå€¼æ˜¯å¦ä»åœ¨ä½¿ç”¨ã€‚å¦‚æœå¯¹ä¸€ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°ä¸ºé›¶ï¼Œé‚£ä¹ˆæ„å‘³ç€è¿™ä¸ªå€¼å¯ä»¥è¢«å®‰å…¨æ¸…ç†æ‰äº†ï¼Œè€Œä¸ä¼šè§¦å‘å¼•ç”¨å¤±æ•ˆçš„é—®é¢˜ï¼š\n\n```rust\nuse std::rc::Rc;\n\n#[derive(Debug)]\nenum List {\n    Cons(i32, Rc<List>),\n    // æ›¿æ¢Boxä¸ºRc\n    Nil,\n}\n\nfn main() {\n    // åˆ›å»ºRcå®ä¾‹\n    let a = Rc::new(Cons(5,\n                         Rc::new(Cons(10,\n                                      Rc::new(Nil)))));\n    // è¿™é‡Œçš„Rc::cloneåªæ˜¯å¢åŠ å¼•ç”¨è®¡æ•°ï¼Œè™½ç„¶ä½¿ç”¨a.cloneä¹Ÿå¯ä»¥å®ç°ï¼Œä½†æ˜¯æ•°æ®ä¼šè¢«æ·±æ‹·è´\n    let b = Cons(3, Rc::clone(&a));\n\n    // å†æ¬¡å¢åŠ å¼•ç”¨æ¬¡æ•°\n    let c = Cons(4, Rc::clone(&a));\n\n    println!(\"{:?}\", b);    // Cons(3, Cons(5, Cons(10, Nil)))\n    println!(\"{:?}\", c);    // Cons(4, Cons(5, Cons(10, Nil)))\n}\n```\n\n# è§‚å¯Ÿå¼•ç”¨è®¡æ•°\n\n```rust\nuse std::rc::Rc;\n\n#[derive(Debug)]\nenum List {\n    Cons(i32, Rc<List>),\n    // æ›¿æ¢Boxä¸ºRc\n    Nil,\n}\n\nfn main() {\n    // åˆ›å»ºRcå®ä¾‹\n    let a = Rc::new(Cons(5,\n                         Rc::new(Cons(10,\n                                      Rc::new(Nil)))));\n    println!(\"åˆ›å»ºaä¹‹åçš„å¼•ç”¨è®¡æ•°ï¼š{}\", Rc::strong_count(&a)); // 1\n\n    let b = Cons(3, Rc::clone(&a));\n    println!(\"åˆ›å»ºbä¹‹åèƒ¡å¼•ç”¨è®¡æ•°ï¼š{}\", Rc::strong_count(&a)); // 2\n\n    // è¿›å…¥ä¸€ä¸ªä»£ç å—ä½œç”¨åŸŸ\n    {\n        let c = Cons(4, Rc::clone(&a));\n        println!(\"åˆ›å»ºcä¹‹åçš„å¼•ç”¨è®¡æ•°ï¼š{}\", Rc::strong_count(&a)); // 3\n    } // ç¦»å¼€ä»£ç å—ï¼Œcçš„ä½œç”¨åŸŸç»“æŸï¼Œcææ„ï¼Œaçš„å¼•ç”¨è®¡æ•°ä¼šå‡1ï¼Œå˜å›åˆ°2\n\n    println!(\"é”€æ¯cä¹‹åèƒ¡å¼•ç”¨è®¡æ•°ï¼š{}\", Rc::strong_count(&a)); // 2\n}\n```\n\n# æ€»ç»“\n\n`Rc<T>`é€šè¿‡ä¸å¯å˜å¼•ç”¨ä½¿å¾—ç¨‹åºçš„ä¸åŒéƒ¨åˆ†ä¹‹é—´å¯ä»¥å…±äº«åªè¯»æ•°æ®ã€‚å¦‚æœ`Rc<T>`å…è®¸æŒæœ‰å¤šä¸ªå¯å˜å¼•ç”¨çš„è¯ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¿åå€Ÿç”¨è§„åˆ™ï¼šåªå…è®¸å¤šä¸ªä¸å¯å˜å€Ÿç”¨æˆ–ä¸€ä¸ªå¯å˜å€Ÿç”¨ã€‚\n\n","tags":["Rc<T>","Box<T>","é“¾è¡¨","åµŒå¥—"],"categories":["Rust","åŸºç¡€"]},{"title":"Rustå­¦ä¹ -çŸ¥è¯†ç‚¹-2","url":"/2022/10/14/Rustå­¦ä¹ -çŸ¥è¯†ç‚¹-2/","content":"\n# åœ¨å¤šä¸ªçº¿ç¨‹é—´å…±äº«`Mutex<T>`\n\næˆ‘ä»¬å¯åŠ¨10ä¸ªçº¿ç¨‹ï¼Œå¹¶åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­åˆ†åˆ«ä¸ºå…±äº«çš„è®¡æ•°å™¨çš„å€¼åŠ 1ã€‚å¦‚æœæ­£å¸¸æ‰§è¡Œå®Œæˆï¼Œæœ€ç»ˆä¼šè®©è®¡æ•°å™¨çš„å€¼ä»0ç´¯è®¡åˆ°10ï¼š\n\n```rust\nuse std::thread;\nuse std::sync::Mutex;\n\nfn main() {\n    //ç”¨äºè®¡æ•°çš„äº’æ–¥ä½“\n    let counter = Mutex::new(0);\n    // ç”¨äºå­˜å‚¨çº¿ç¨‹\n    let mut handles = vec![];\n\n    for _ in 0..10 {\n        let handle = thread::spawn(move || {\n          \t\t\t\t\t\t\t\t\t\t\t// ^^^^^^^ value moved into closure here, in previous iteration of loop \n          \tlet mut num = counter.lock().unwrap();\n            *num += 1;\n        });\n        handles.push(handle);\n    }\n\n    for handle in handles {\n        // ç­‰å¾…æ‰€æœ‰çº¿ç¨‹éƒ½æ‰§è¡Œå®Œæ¯•\n        handle.join().unwrap();\n    }\n\n    println!(\"counter: {}\", *counter.lock().unwrap());\n}\n```\n\nä»£ç ä¸­å°è¯•å°†`counter`ç§»åŠ¨åˆ°çº¿ç¨‹ä¸­ï¼Œç¼–è¯‘å‡ºé”™ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡å¾ªç¯æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹ï¼Œ`counter`çš„æ‰€æœ‰æƒå·²ç»è¢«ç§»åŠ¨è¿›å»ï¼Œç­‰åˆ°ç¬¬äºŒæ¬¡å¾ªç¯åˆ›å»ºç¬¬äºŒä¸ªå­çº¿ç¨‹ï¼Œ`counter`å·²ç»æ²¡æœ‰äº†æ‰€æœ‰æƒã€‚è¿™æ ·å°±å¯¼è‡´ç¬¬äºŒæ¬¡ç§»åŠ¨æ—¶ç†è®ºä¸Šè‚¯å®šä¼šå¤±è´¥ã€‚ç¼–è¯‘å™¨å¾ˆèªæ˜åœ°æ•æ‰åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå°±æ‰¼æ€äº†è¿™ä¸ª`bug`ã€‚\n\n# å°è¯•ä½¿ç”¨`Rc<T>`æ¥å…±äº«counter\n\n`Rc<T>`æ˜¯ç”¨æ¥å…±äº«æ•°æ®ç”¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å°è¯•ä¸€ä¸‹ä½¿ç”¨`Rc<T>`åœ¨å¤šçº¿ç¨‹çš„åœºæ™¯ä¸‹ä½¿ç”¨çœ‹çœ‹èƒ½ä¸èƒ½è§£å†³ä¹‹å‰é‡åˆ°çš„æ‰€æœ‰æƒé—®é¢˜ã€‚`Rc<T>`æ˜¯æ™ºèƒ½æŒ‡é’ˆï¼Œå®ƒå†…éƒ¨æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°ï¼Œè¢«å®ƒï¼ˆåŒ…è£¹ï¼‰æŒ‡å‘çš„æ•°æ®çš„å¼•ç”¨æ¬¡æ•°è¢«`Rc<T>`å†…éƒ¨çš„å¼•ç”¨è®¡æ•°è®°å½•ã€‚`Rc<T>`çš„`clone()`æ–¹æ³•æ˜¯å¯¹æ™ºèƒ½æŒ‡é’ˆæœ¬èº«çš„å¤åˆ¶ï¼Œç”¨æ¥æŒ‡å‘åŒä¸€ä»½è¢«æ™ºèƒ½æŒ‡é’ˆåŒ…è£¹çš„æ•°æ®ã€‚è¿™æ ·å°±èƒ½å·§å¦™è§„é¿æ•°æ®çš„æ•°æ®çš„æ‰€æœ‰æƒé—®é¢˜äº†ï¼šå› ä¸ºå¾ªç¯æ—¶å¯ä»¥æ¯æ¬¡`clone`ä¸€ä¸ªæ–°çš„æ™ºèƒ½æŒ‡é’ˆ`Rc<T>`å‡ºæ¥ï¼ˆè¿™ä¸ªæ™ºèƒ½æŒ‡é’ˆæŒ‡å‘æˆ‘ä»¬çœŸæ­£è¦ä½¿ç”¨çš„æ•°æ®ï¼‰ã€‚ä½†æ˜¯ï¼Œäº‹å®ä¸Šå‘¢ï¼Ÿç¼–è¯‘å™¨åˆæ¥æ•™åšäººäº†ã€‚\n\n```rust\nuse std::rc::Rc;\nuse std::sync::Mutex;\nuse std::thread;\n\nfn main() {\n    // å°†Mutexå†åŒ…è£¹ä¸€å±‚Rc\n    let counter = Rc::new(Mutex::new(0));\n    let mut handles = vec![];\n\n    for _ in 0..10 {\n        let counter = Rc::clone(&counter);\n        let handle = thread::spawn(move || {        // æŠ¥é”™ï¼ŒRc<Mutex<i32>>ç±»å‹æ— æ³•å®‰å…¨åœ°åœ¨çº¿ç¨‹ä¸­ä¼ é€’\n            let mut num = counter.lock().unwrap();\n            *num += 1;\n        });\n        handles.push(handle);\n    }\n\n    for handle in handles {\n        handle.join().unwrap();\n    }\n\n    println!(\"counter: {}\", *counter.lock().unwrap())\n}\n```\n\nå½“`Rc<T>`ç®¡ç†å¼•ç”¨è®¡æ•°æ—¶ï¼Œå®ƒä¼šåœ¨æ¯æ¬¡è°ƒç”¨`clone`çš„è¿‡ç¨‹ä¸­å¢åŠ å¼•ç”¨è®¡æ•°ï¼Œå¹¶åœ¨å…‹éš†å‡ºçš„å®ä¾‹è¢«ä¸¢å¼ƒæ—¶å‡å°‘å¼•ç”¨è®¡æ•°ï¼Œä½†å®ƒå¹¶æ²¡æœ‰ä½¿ç”¨ä»»ä½•å¹¶å‘åŸè¯­æ¥ä¿è¯ä¿®æ”¹è®¡æ•°çš„è¿‡ç¨‹ä¸ä¼šè¢«å¦ä¸€ä¸ªçº¿ç¨‹æ‰€æ‰“æ–­ã€‚\n\n# ä½¿ç”¨åŸå­å¼•ç”¨è®¡æ•°`Arc<T>`\n\nrustè¿˜æä¾›äº†`Arc<T>`ç±»å‹ï¼Œæ¥ä»£æ›¿`Rc<T>`ç±»å‹æ¥è§£å†³ä¸Šé¢é—®é¢˜ï¼Œå®ƒæ—¢æ‹¥æœ‰ç±»ä¼¼äº`Rc<T>`çš„è¡Œä¸ºï¼Œåˆä¿è¯äº†è‡ªå·±å¯ä»¥è¢«å®‰å…¨åœ°ç”¨äºå¹¶å‘åœºæ™¯ï¼š\n\n```rust\nuse std::sync::Arc;\nuse std::sync::Mutex;\nuse std::thread;\n\nfn main() {\n    // å°†Rcæ›¿æ¢ä¸ºArc\n    let counter = Arc::new(Mutex::new(0));\n    let mut handles = vec![];\n\n    for _ in 0..10 {\n        let counter = Arc::clone(&counter);\n        let handle = thread::spawn(move || {\n            let mut num = counter.lock().unwrap();\n            *num += 1;\n        });\n        handles.push(handle);\n    }\n\n    for handle in handles {\n        handle.join().unwrap();\n    }\n\n    println!(\"counter: {}\", *counter.lock().unwrap())\n}\n```\n\næ”¹ç”¨` Arc<T>`åä¸Šé¢æˆåŠŸè®¡ç®—å‡ºäº†` counter` çš„å€¼ã€‚\n\n","tags":["Mutex","å¤šçº¿ç¨‹","Rc","Arc"],"categories":["Rust","åŸºç¡€"]},{"title":"Rustå­¦ä¹ -çŸ¥è¯†ç‚¹-1","url":"/2022/10/13/Rustå­¦ä¹ -çŸ¥è¯†ç‚¹-1/","content":"\n**&å’Œrefçš„ä½¿ç”¨æœ‰ä»€ä¹ˆä¸åŒï¼Œå“ªé‡Œéœ€è¦ç”¨`&`ï¼Ÿå“ªé‡Œéœ€è¦ç”¨`ref`ï¼Ÿ**\n\n---\n\n# ä¸€ã€`&`å’Œ`ref`é€šç”¨çš„åœºæ™¯\n\nå…ˆæ¥çœ‹çœ‹ç¬¬1ä¸ªç¤ºä¾‹ï¼š\n\n```rust\nfn main() {\n    let mut a: i32 = 1;\n    let b = &a;\n    println!(\"{}\", *b); // 1\n\n    let ref c = a;\n    println!(\"{}\", *c); // 1\n}\n```\n\nç¤ºä¾‹ä¸­ï¼Œ`b` å’Œ `c` å£°æ˜çš„æ–¹å¼ä¸åŒï¼Œä½†ä»ç»“æœæ¥çœ‹å¹¶æ— ä¸åŒï¼Œéƒ½æ˜¯è¡¨ç¤ºä¸€ä¸ªæŒ‡é’ˆã€‚\n\n- ç›¸åŒç‚¹ï¼šè¿™ä¸¤ä¸ªæŒ‡é’ˆå˜é‡éƒ½å„è‡ªä¿å­˜äº†ä¸€ä¸ªå†…å­˜åœ°å€ï¼Œè¿™ä¸ªå†…å­˜åœ°å€å°±æ˜¯å¯å˜å˜é‡`a` çš„å†…å­˜åœ°å€ã€‚\n- ä¸åŒç‚¹ï¼šå£°æ˜æ–¹å¼ä¸åŒï¼Œå…¶ä¸­`let b = &a;` å’Œ `let ref c = a;` è¿™é‡Œåªæ˜¯è¯­æ³•å½¢å¼ä¸Šçš„ä¸åŒï¼›åªéœ€è®°å¿†å³å¯\n\nå†æ¥çœ‹ç¬¬2ä¸ªç¤ºä¾‹ï¼š\n\n```rust\nfn main() {\n    let mut a: i32 = 1;\n\n    let b = &mut a; // æŒ‡é’ˆ b æœ¬èº«æ˜¯ä¸å¯ä»¥ä¿®æ”¹çš„ï¼Œä½†å®ƒæŒ‡å‘çš„å†…å®¹æ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚\n    *b = 2;\n    println!(\"{}\", a); // 2\n\n    let ref mut c = a; // æŒ‡é’ˆ c æœ¬èº«æ˜¯ä¸å¯ä»¥ä¿®æ”¹çš„ï¼Œä½†å®ƒæŒ‡å‘çš„å†…å®¹æ˜¯å¯ä»¥ä¿®æ”¹çš„ã€‚\n    *c = 3;\n    println!(\"{}\", a); //3\n}\n```\n\nåˆ°è¿™é‡Œä¸ºæ­¢ï¼Œä»å½¢å¼è¡¨ç°æ¥è¯´æœ‰ç‚¹åŒºåˆ«ï¼Œä¼¼ä¹ä½œç”¨ä¸€è‡´ï¼Œé‚£ä¸ºå•¥è¦æ•´ä¸¤ä¸ªè¡¨ç°å½¢å¼å‡ºæ¥å‘¢ï¼Ÿ\n\n# äºŒã€é€‚åˆç”¨`&`çš„åœºæ™¯\n\næƒ¯ä¾‹ï¼Œä¸é€¼é€¼ï¼Œçœ‹ç¤ºä¾‹ï¼š\n\n```rust\nfn foo(x: &mut i32) {\n    *x = 666;\n}\nfn main() {\n    let mut a: i32 = 888;\n    foo(&mut a);\n    println!(\"{}\", a); // 666\n}\n```\n\näººç‹ è¯ä¸å¤šï¼Œå†çœ‹ï¼š\n\n```rust\nfn foo(ref mut x: i32) {\n    *x = 666;\n}\nfn main() {\n    let mut a: i32 = 888;\n    foo(a);\n    println!(\"{}\", a); // 888\n}\n```\n\nä¸€å¯¹æ¯”ï¼Œå°±æ¯”è¾ƒæ˜æ˜¾äº†ã€‚ç»è¿‡åœºæ™¯ä¸€é‡Œé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯¹`&` å’Œ `ref`çš„è®¤è¯†ï¼Œæ„Ÿè§‰è¿™ä¸¤è´§æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼›ä½†æ˜¯åœ¨å‡½æ•°/æ–¹æ³•ç­¾åä¸­çš„åº”ç”¨æ—¶ï¼Œå°±æœ‰ç‚¹åç›´è§‰äº†ã€‚åªèƒ½è¯´rustè¯­æ³•è§„å®šå°±æ˜¯è¿™æ ·ï¼Œè¿™æ˜¯é¾Ÿè…šã€‚ä½†æ˜¯æˆ‘ä»¬ä»¥ä¹‹å‰å…¶å®ƒè¯­è¨€çš„ç»éªŒæ¥çœ‹å¾…åœºæ™¯äºŒï¼Œåˆä¼šè§‰å¾—è¿™ä¸ªç»“æœå¾ˆåˆç†ã€‚\n\n- å› ä¸º`foo(a)`çš„è°ƒç”¨è¯­ä¹‰å°±æ˜¯ä¼ å…¥ä¸€ä¸ªç±»å‹ä¸º`i32`çš„æ•´å‹å˜é‡ï¼Œè€Œä¸æ˜¯ä¼ å…¥`&i32`ã€‚ä¹Ÿå°±æ˜¯è¯´ä¼ å…¥çš„æ˜¯æ•´å‹å˜é‡æœ¬èº«ï¼Œä¸æ˜¯ä¼ å…¥æ•´å‹å˜é‡çš„å¼•ç”¨æˆ–è€…æŒ‡é’ˆã€‚æˆ‘ä»¬å†çœ‹`foo`å‡½æ•°çš„ç­¾åï¼š`fn foo(ref mut x: i32)` ï¼Œç­¾åä¸­æ˜ç¡®è¯´ä¼ å…¥çš„å‚æ•°ç±»å‹æ˜¯`i32`ï¼Œæ²¡æ¯›ç—…ã€‚é‚£è¿™ä¸ªå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå†…å­˜é‡Œé¢åˆ°åº•æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿçœ‹ç°è±¡ï¼Œæˆ‘è§‰å¾—æ˜¯è¿™æ ·çš„ï¼šè°ƒç”¨`foo(ref mut x: i32)`æ—¶ï¼Œä¹Ÿå°±æ˜¯`foo(a)`ï¼Œä¼ å…¥çš„æ˜¯i32ç±»å‹çš„ä¸€ä¸ªå˜é‡`a`ï¼Œå®ƒçš„å€¼ä¸º`888`ï¼ˆæ³¨æ„ä¸æ˜¯i32å˜é‡çš„å¼•ç”¨æˆ–è€…æŒ‡é’ˆï¼Œæˆ–è€…è¯´ä¸æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€ï¼‰ï¼Œé‚£ä¹ˆä¼šåœ¨å†…å­˜æ ˆä¸­æ‹·è´ä¸€ä¸ª`888`è¿™ä¸ªå€¼çš„å‰¯æœ¬å‡ºæ¥æ”¾åœ¨æ ˆä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³è±¡æˆè¿™ä¸ªå˜é‡å«`a'`,è¿™ä¸ª`a'`å’ŒåŸæ¥çš„`a`ä¸æ˜¯åœ¨ä¸€ä¸ªå†…å­˜åœ°å€é‡Œé¢ï¼Œä½†å®ƒä»¬çš„å€¼éƒ½ä¸º`888`ï¼Œæˆ‘ä¸æƒ³ç”»å›¾ï¼Œè‡ªå·±æƒ³è±¡ä¸€ä¸‹å§ï¼Œç„¶åæŠŠå½¢å‚`x`æŒ‡å‘äº†è¿™ä¸ªå‰¯æœ¬`a'`çš„å†…å­˜åœ°å€ï¼Œç„¶å`*x = 666`ä¿®æ”¹çš„æ˜¯è¿™ä¸ªå‰¯æœ¬çš„å†…å­˜åœ°é‡Œé¢çš„å€¼ï¼Œä¼ å…¥çš„`å®å‚888`æ²¡åšä¿®æ”¹ã€‚**ä¸ç®¡ä»€ä¹ˆè¯­è¨€ï¼Œæ•°æ®åœ¨å†…å­˜ä¸­çš„æ¥é¾™å»è„‰æƒ³æ¸…æ¥šéå¸¸é‡è¦ï¼Œå­¦ä¹ è¯­æ³•ä¸æ˜¯æ­»è®°ç¡¬èƒŒï¼Œäº†è§£å†…å­˜æ¨¡å‹å¯¹æŒæ¡ä¸€é—¨è¯­è¨€éå¸¸é‡è¦**\né•¿è¯çŸ­è¯´ï¼Œæ‡‚çš„éƒ½æ‡‚ï¼š\n- `foo(a)`è°ƒç”¨æ—¶ï¼Œè¦æŠŠ`a`çš„å€¼å¤åˆ¶ä¸€ä»½æ”¾åœ¨æ ˆç©ºé—´ä¸­ï¼Œå°±æ˜¯`a`çš„ä¸€ä¸ªå‰¯æœ¬ã€‚`foo`å‡½æ•°ä¸­æ“ä½œå°±æ˜¯è¿™ä¸ª`açš„å‰¯æœ¬`ã€‚ä½ æ—¢ç„¶ä¿®æ”¹çš„æ˜¯`açš„å‰¯æœ¬`ï¼Œé‚£å…³`a`å•¥äº‹ï¼Ÿ\n- `açš„å‰¯æœ¬`çš„å€¼æ˜¯è¢«ä¿®æ”¹äº†ï¼Œä½†æ˜¯`a`çš„å€¼æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œæ‰€ä»¥æœ€åæ‰“å°å‡ºæ¥çš„è¿˜æ˜¯888\n\né‚£æˆ‘éè¦åœ¨å‡½æ•°/æ–¹æ³•çš„å‚æ•°ä¸­ä½¿ç”¨`ref`ï¼Œè¿˜è¦è¾¾åˆ°`&`ä¸€æ ·çš„æ•ˆæœå‘¢ï¼Ÿä¹Ÿä¸æ˜¯ä¸è¡Œã€‚\n\n**æ²¡æœ‰å›°éš¾ï¼Œåˆ›é€ å›°éš¾ä¸Š â€”â€” è€å­**\n\n- é¦–å…ˆè‚¯å®šæ˜¯è¦æ”¹å˜`foo`å‡½æ•°çš„è°ƒç”¨è¯­ä¹‰ï¼Œèµ·ç è¦ä¿®æ”¹ä¸€ä¸‹å‡½æ•°ç­¾åå§ï¼Ÿå‡½æ•°ç­¾åä¸­çš„å‚æ•°ç±»å‹èµ·ç å¾—æ˜¯å¼•ç”¨å§ï¼Ÿæˆ–è€…å«æŒ‡é’ˆå§ï¼Ÿ\n- `fn foo(ref x: &mut i32)` è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬è¦çš„ä¿®æ”¹åçš„å‡½æ•°ç­¾å\n- å‡½æ•°ç­¾åæ˜¯æœ‰äº†ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬ç»™x å˜é‡èµ‹å€¼åº”è¯¥æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿæ˜¯ `*x = 666;` å—ï¼Ÿé‚£ç­¾åä¸­çš„ref ä¸åŒæ„äº†ï¼šä½ å½“æˆ‘ä¸å­˜åœ¨å—ï¼Ÿå› ä¸ºè¿™é‡Œæœ‰äº†`ref`ï¼Œæ‰€ä»¥å‰é¢è¿˜å¾—å†åŠ ä¸€ä¸ª`*` ï¼Œä»”ç»†ä½“ä¼šä½“ä¼šå§ã€‚\n\n```rust\nfn foo(ref x: &mut i32) {\n    **x = 666;\n}\nfn main() {\n    let mut a: i32 = 888;\n    foo(&mut a);\n    println!(\"{}\", a); // 666\n}\n```\n>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºå•¥è¿™æ ·å°±åˆå¯ä»¥äº†å‘¢ï¼Ÿå› ä¸ºå½¢å‚çš„ç±»å‹è¢«æ”¹ä¸ºäº† &mut i32 äº†ï¼Œé‚£ä¹ˆè°ƒç”¨æ—¶ï¼Œfoo(&mut a), ä¼ å…¥çš„æ˜¯açš„å†…å­˜åœ°å€ï¼Œè€Œä¸æ˜¯aå˜é‡æœ¬èº«ï¼Œè¿™ä¸ªæ—¶å€™**ä¸ä¼šå‘ç”Ÿ**æŠŠè¿™ä¸ªä¼ å…¥çš„å€¼è¿›è¡Œæ‹·è´ä¸€ä¸ªå‰¯æœ¬å­˜åœ¨æ ˆä¸­çš„æ“ä½œã€‚åªæ˜¯æŠŠå½¢å‚xæŒ‡å‘äº†å®å‚açš„å†…å­˜åœ°å€ï¼Œé€šä¿—ä½†å¯èƒ½ä¸å¤Ÿå‡†ç¡®åœ°è¯´ï¼šxæ˜¯ä¸€ä¸ªæŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆï¼Œä¹Ÿå°±æ˜¯è¯´ *x ä»£è¡¨çš„æ˜¯ &aï¼Œ**xæ˜¯ä»€ä¹ˆè‡ªå·±æƒ³æƒ³å§ã€‚\n\nç¨ç¨æ€»ç»“ä¸€ä¸‹ï¼šä¸€ä¸ª`*`ç”¨æ¥è¡¨ç¤ºæŒ‡é’ˆå˜é‡å–åˆ°æŒ‡é’ˆæ‰€æŒ‡çš„å˜é‡ï¼Œå¦‚æœæŒ‡é’ˆæ‰€æŒ‡çš„å˜é‡ä¹Ÿæ˜¯ä¸ªæŒ‡é’ˆå˜é‡å‘¢ï¼Ÿé‚£å°±`**`ï¼Œè¦æ˜¯æŒ‡é’ˆå˜é‡æŒ‡å‘ä¸€ä¸ªæŒ‡é’ˆå˜é‡å†æŒ‡å‘ä¸€ä¸ªæŒ‡é’ˆå˜é‡â€¦â€¦é‚£å°±æ˜¯`***`ã€‚æ‰€ä»¥åœ¨å‡½æ•°å‚æ•°å£°æ˜ä¸­ï¼Œä¸€èˆ¬ç”¨`&`æ¯”è¾ƒå¤šã€‚\n\n# ä¸‰ã€åªèƒ½ç”¨`ref`çš„åœºæ™¯\n\nç›´æ¥ä¸Šä»£ç ç¤ºä¾‹ï¼š\n\n```rust\nfn main() {\n    let s = Some(String::from(\"Hello!\"));\n    match s {\n        Some(t) => println!(\"t = {}\", t),\n        _ => {}\n    }\n    println!(\"s = {}\", s.unwrap());\n}\n```\n\nä½ è§‰å¾—rustç¼–è¯‘å™¨ä¼šè®©ä½ è¿‡ï¼Ÿå¤ªå¤©çœŸã€‚ç®€ç®€å•å•ä¸€æ®µä»£ç ï¼Œæ¶‰åŠåˆ°äº†rustä¸­çš„å˜é‡æ‰€æœ‰æƒé—®é¢˜ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ç¼–è¯‘å™¨çš„æŠ¥é”™ç»“æœï¼š\n\n```shell\n   --> src/main.rs:124:24\n    |\n121 |         Some(t) => println!(\"t = {}\", t),\n    |              - value partially moved here\n...\n124 |     println!(\"s = {}\", s.unwrap());\n    |                        ^ value used here after partial move\n    |\n    = note: partial move occurs because value has type `String`, which does not implement the `Copy` trait\nhelp: borrow this field in the pattern to avoid moving `s.0`\n    |\n121 |         Some(ref t) => println!(\"t = {}\", t),\n    |              +++\n\n```\n\nrustç¼–è¯‘å™¨å°±æ˜¯æœ€å¥½æœ€ä¸¥å‰çš„é‚£ä¸ªè€å¸ˆã€‚å¥¹è¯´çš„å¾ˆæ¸…æ¥šäº†ä¸ºä»€ä¹ˆä¸è®©ä½ é€šè¿‡ï¼Œç»™ä½ åˆ†æå¾—æ˜æ˜ç™½ç™½ï¼Œè€Œä¸”è¿˜ç»™å‡ºäº†å‚è€ƒç­”æ¡ˆã€‚\n\nç¼–è¯‘å™¨å¤§ä½¬çš„æ„æ€å°±æ˜¯è¯´ï¼šä½ å®šä¹‰äº†ä¸€ä¸ªå˜é‡`s`ï¼Œå®ƒçš„å€¼æ˜¯ç”¨SomeåŒ…è£¹çš„ä¸€ä¸ªStringç±»å‹çš„\"Hello!\"ã€‚ä¸€å¼€å§‹è¿™ä¸ª\"Hello!\"çš„æ‰€æœ‰æƒæ˜¯sçš„ã€‚ç»è¿‡äº†match sï¼Œå‘ç°åŒ¹é…åˆ°äº†Some(t)ï¼Œä¹Ÿå°±æ˜¯sé‡Œé¢è¿˜æ˜¯æœ‰è´§çš„ï¼Œè¿™ä¸ªè´§å‘¢ï¼Œå°±æ˜¯\"Hello!\"ï¼Œé‚£ç°åœ¨å°±è¦æŠŠè¿™ä¸ª\"Hello!\"èµ‹å€¼ç»™äº†tï¼Œè¿™è¿‡ç¨‹ä¸­å°±ä¼šå‘ç”Ÿå˜é‡æ‰€æœ‰æƒçš„è½¬ç§»ï¼šæ‰€æœ‰æƒç”± `s` è½¬ç»™äº† `t`ã€‚ä½†æ˜¯ç¼–è¯‘å™¨å‘ç°ï¼Œä»£ç æœ€åä¸€è¡Œï¼Œä½ ç«Ÿç„¶åˆå»ä½¿ç”¨å˜é‡sï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™sæ‰€ä»£è¡¨çš„SomeåŒ…è£¹å·²ç»å¤±å»äº†\"Hello!\"çš„æ‰€æœ‰æƒã€‚ç¼–è¯‘å™¨è®¤ä¸ºä½ è¿åäº†å†…å­˜å®‰å…¨çš„è§„åˆ™ã€‚\n\né‚£ä¹ˆç¼–è¯‘å™¨æ—¢ç„¶æœ‰è¿™ä¸ªè§„åˆ™ï¼Œä¸èƒ½ç¡¬æ¥ï¼Œé‚£æ€ä¹ˆåŠå‘¢ï¼Ÿé‚£å°±ä¸è½¬ç§»å˜é‡çš„æ‰€æœ‰æƒï¼›é‚£å°±è¦æåˆ°RUSTä¸­çš„å€Ÿç”¨çš„æ¦‚å¿µã€‚é€šä¿—ä½†æ˜¯å¯èƒ½ä¸å‡†ç¡®çš„è¯´æ³•å°±æ˜¯ï¼šä¸ç”¨å˜é‡ç›´æ¥è¿›è¡Œå¤åˆ¶æ“ä½œï¼ŒæŠŠå˜é‡çš„å¼•ç”¨æˆ–è€…æŒ‡é’ˆèµ‹å€¼ç»™å¦å¤–çš„å˜é‡ï¼Œè¿™å°±æ˜¯å‘ç”Ÿäº†å€Ÿç”¨ï¼Œä½†æ˜¯æ‰€æœ‰æƒä¿æŒä¸å˜ã€‚è¿™æ ·å°±ç¬¦åˆè§„åˆ™äº†ã€‚\n\né‚£ä¹ˆå›åˆ°ç¤ºä¾‹ä¸­ï¼Œå…³é”®ç‚¹å°±æ˜¯`Some(t) => println!(\"t = {}\", t)`è¿™å¥è¯­å¥æœ‰é—®é¢˜ï¼Œé‚£æˆ‘ä»¬å°±è¦å¯¹å®ƒè¿›è¡Œæ”¹é€ ï¼Œç¼–è¯‘å™¨è€å¸ˆéƒ½å·²ç»å‘Šè¯‰æˆ‘ä»¬æ€ä¹ˆæ”¹é€ äº†ã€‚å°±æ˜¯æ”¹ä¸ºï¼š`Some(ref t) => println!(\"t = {}\", t)`\n\né‚£æœ‰äººä¼šé—®ï¼Œæˆ‘èƒ½è¿™æ ·æ”¹é€ å—ï¼Ÿ`Some(& t) => println!(\"t = {}\", t)` ï¼Œæˆ‘ä¹Ÿæƒ³è¿™æ ·ï¼Œæ— å¥ˆç¼–è¯‘å™¨ä¸ç­”åº”å•Šã€‚è¿™ä¹Ÿèƒ½ç†è§£ï¼š\n\n- så˜é‡æ˜¯ä¸€ä¸ª Some ç±»å‹çš„å€¼ï¼Œ è¿™ä¸ªSomeé‡Œé¢è¦ä¹ˆæ˜¯Stringç±»å‹ï¼Œè¦ä¹ˆæ˜¯None ï¼Œä½†æ˜¯ä¸èƒ½æ˜¯ &String ç±»å‹ã€‚æ‰€ä»¥match sçš„æ—¶å€™ï¼Œç±»å‹è¦åŒ¹é…ä¸Šã€‚\n- é‚£ä¹ˆç°åœ¨Some(ref t)ï¼Œt æœ‰ ref çš„åŠ æŒï¼Œè¿™é‡Œå°±è¡¨ç¤ºæ˜¯å€Ÿç”¨ï¼Œå€Ÿç”¨å°±ä¸ä¼šå‘ç”Ÿæ‰€æœ‰æƒä»såˆ°tçš„è½¬ç§»ï¼Œä¾‹å­ä¸­ä¹Ÿç¬¦åˆrustçš„å€Ÿç”¨è§„åˆ™ï¼Œç¼–è¯‘å™¨è€å¸ˆå°±ä¼šè®©ä½ é€šè¿‡è€ƒæ ¸ã€‚\n\næˆ‘éè¦ç”¨&å‘¢ï¼Ÿä¹Ÿä¸æ˜¯æ²¡æœ‰åŠæ³•ï¼Œè¿˜æœ‰ä¸€ä¸ªå˜é€šçš„åŠæ³•ã€‚æ—¢ç„¶é—®é¢˜æ ¹æºæ˜¯sçš„æ‰€æœ‰æƒé—®é¢˜ï¼Œé‚£æˆ‘å°±ç›´æ¥åœ¨å€Ÿç”¨sï¼Œè€Œå®ƒå†…éƒ¨åŒ…è£¹çš„Stringå˜é‡è‡ªç„¶è€Œç„¶ä¹Ÿä¸ä¼šå‘ç”Ÿæ‰€æœ‰æƒè½¬ç§»ã€‚è¿™ä¸å°±ä»æ ¹æºæ˜¯è§£å†³é—®é¢˜äº†ï¼Ÿæµ…å°è¯•ä¸€ä¸‹ï¼š\n\n```rust\nfn main() {\n    let s = Some(String::from(\"Hello!\"));\n    match &s {\n        Some(t) => println!(\"t = {}\", t),\n        _ => {}\n    }\n    println!(\"s = {}\", s.unwrap());\n}\n```\n\n# å››ã€æ›´å¤šçš„ä¾‹å­\n\n```rust\nfn main() {\n    let v = 123;\n\n    let x: &i32 = &v; // OK!\n    let x: &i32 = &(123 + 456); // OK!\n    if let Some(x) = Some(123) {} // OK!\n\n    let ref x: i32 = v; // OK!\n    let ref x: i32 = 123 + 456; // OK!\n    if let Some(ref x) = Some(123) {} // OK!\n\n    if let Some(x: &i32) = Some(&123) {} // Errorï¼\n}\n```\n\n# äº”ã€æŒ‡é’ˆå˜é‡çš„è§£å¼•ç”¨\n\nä»¥ä¸‹æ“ä½œï¼Œ`@cpp`,rustè‡ªåŠ¨è§£å¤šå±‚åµŒå¥—å¼•ç”¨å¤§æ³•ï¼Œå¦ˆå¦ˆå†ä¹Ÿä¸ç”¨æˆ‘æ•°é”™`*`ä¸ªæ•°äº†\n\n```rust\nfn main() {\n    let a: &i32 = &123;\n    let b: &&i32 = &a;\n    let c: &&&i32 = &b;\n\n    println!(\"a = {}, b = {}, c = {}\", a, b, c);\n    println!(\"*a = {}, **b = {}, ***c = {}\", *a, **b, ***c);\n}\n\n/* output\na = 123, b = 123, c = 123\n*a = 123, **b = 123, ***c = 123\n*/\n```\n\n","tags":["rust","ref","æŒ‡é’ˆ"],"categories":["Rust","åŸºç¡€"]},{"title":"HexoæœåŠ¡å™¨æ­å»º","url":"/2022/10/12/HexoæœåŠ¡å™¨æ­å»º/","content":"\n# ç¬¬ä¸€éƒ¨åˆ†ï¼šæœåŠ¡ç«¯æ“ä½œ\n\n## 1. å®‰è£…gitå’Œnginx\n\n```shell\nyum install -y nginx git\n```\n\n## 2. æ·»åŠ ç”¨æˆ·å¹¶åšå…å¯†ç ç™»å½•\n\n### 2.1 æœåŠ¡å™¨ç«¯rootç”¨æˆ·å…å¯†ç™»å½•\n\n```shell\nvim ~/.ssh/authorized_keys    #rootç”¨æˆ·çš„å…å¯†ç ç™»å½•ï¼Œå°†æœ¬åœ°æœºå™¨çš„sshå…¬é’¥æ·»åŠ è¿›å»\n```\n\n### 2.2 æœåŠ¡å™¨ç«¯æ·»åŠ gitç”¨æˆ·\n\n```shell\nuseradd git\npasswd git\n\n# ç»™gitç”¨æˆ·é…ç½®sudoæƒé™\nchmod 740 /etc/sudoers\nvim /etc/sudoers\n# æ‰¾åˆ°root ALL=(ALL) ALLï¼Œåœ¨å®ƒä¸‹æ–¹åŠ å…¥ä¸€è¡Œ\ngit ALL=(ALL) ALL\n\nchmod 400 /etc/sudoers\n```\n\n### 2.3 gitç”¨æˆ·å…å¯†ç™»å½•\n\n```shell\nsu - git\nmkdir -p ~/.ssh\ntouch ~/.ssh/authorized_keys\nchmod 600 ~/.ssh/authorzied_keys\nchmod 700 ~/.ssh\nvim ~/.ssh/authorized_keys   #gitç”¨æˆ·çš„å…å¯†ç ç™»å½•ï¼Œå°†æœ¬åœ°æœºå™¨çš„sshå…¬é’¥æ·»åŠ è¿›å»\n```\n\n## 3. åˆ›å»ºä»“åº“å¹¶ä½¿ç”¨git-hookså®ç°è‡ªåŠ¨éƒ¨ç½²\n\n```shell\nsudo mkdir -p /var/repo #æ–°å»ºç›®å½•ï¼Œè¿™æ˜¯gitä»“åº“çš„ä½ç½®\nsudo mkdir -p /var/www/hexo #ç«™ç‚¹æ ¹ç›®å½•\ncd /var/repo\nsudo git init --bare blog.git #åˆ›å»ºä¸€ä¸ªåå«blogçš„ä»“åº“\n```\n\n## 4. åˆ›å»ºpost-updateè„šæœ¬\n\n```shell\nsudo vim /var/repo/blog.git/hooks/post-update\n```\n\nè„šæœ¬å†…å®¹å¦‚ä¸‹ï¼š\n\n```shell\n#!/bin/bash\ngit --work-tree=/var/www/hexo --git-dir=/var/repo/blog.git checkout -f\n```\n\næ·»åŠ æƒé™\n\n```shell\ncd /var/repo/blog.git/hooks/\nsudo chown -R git:git /var/repo/\nsudo chown -R git:git /var/www/hexo\nsudo chmod +x post-update  #èµ‹äºˆå…¶å¯æ‰§è¡Œæƒé™\n```\n\n## 5.é…ç½®nginx\n\n```shell\ncd /etc/nginx/conf.d\nvim blog.conf\n```\n\n`blog.conf`çš„å†…å®¹å¦‚ä¸‹ï¼š\n\n```shell\nserver {\n    listen    80 default_server;\n    listen    [::] default_server;\n    server_name    www.blockchainof.com;\n    root    /var/www/hexo;\n}\n```\n\næ£€æŸ¥Nginxé…ç½®è¯­æ³•å¹¶é‡å¯nginx:\n\n```shell\nnginx -t # æ£€æŸ¥è¯­æ³•\nnginx -s reload # é‡æ–°åŠ è½½\n```\n\n# ç¬¬äºŒéƒ¨åˆ†ï¼šæœ¬åœ°é…ç½®ï¼ˆMacï¼‰\n\n## 1. å®‰è£…HexoåŠå…¶æ’ä»¶\n\n```shell\nsudo npm install hexo-cli hexo-server hexo-deployer-git -g\n```\n\n## 2. æœ¬åœ°åˆå§‹åŒ–åšå®¢ç«™ç‚¹\n\n```shell\nhexo init ~/blog\nnpm install hexo-deployer-git --save\n```\n\n## 3. æœ¬åœ°Hexoé…ç½®\n\n```shell\n# ä¿®æ”¹Hexoçš„deployé…ç½®\ncd blog\nvim _config.yml\n\n# æ‰¾åˆ°deployé…ç½®éƒ¨åˆ†\n# Deployment\n## Docs: https://hexo.io/docs/deployment.html\ndeploy:\n  type: git\n  repo: root@xxx.xx.xxx.xxx:/var/repo/blog.git # IPå¡«å†™è‡ªå·±æœåŠ¡å™¨çš„IPå³å¯\n  branch: master\n```\n\n## 4. å°†æœ¬åœ°Hexoéƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨\n\n```shell\n# æ¸…é™¤ç¼“å­˜\nhexo clean\n\n# ç”Ÿæˆé™æ€é¡µé¢\nhexo generate\n\n# å°†æœ¬åœ°é™æ€é¡µé¢ç›®å½•éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨\nhexo delopy\n```\n\nå¯ä»¥å°†ä¸Šé¢çš„3æ¡æŒ‡ä»¤æ”¾åœ¨ä¸€ä¸ªshellè„šæœ¬å†…ï¼Œæ–¹ä¾¿éƒ¨ç½²\n\n```shell\n#!/bin/sh\n\nhexo clean\nhexo generate\nhexo deploy\n```\n\n","tags":["Hexo","git","nginx","å…å¯†ç ç™»å½•"],"categories":["ç¯å¢ƒæ­å»º-Hexo"]}]